{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Scrollable } from '../../../base/common/scrollable.js';\nimport { LinesLayout } from './linesLayout.js';\nimport { Viewport } from '../viewModel/viewModel.js';\nimport { ContentSizeChangedEvent } from '../viewModel/viewModelEventDispatcher.js';\nconst SMOOTH_SCROLLING_TIME = 125;\n\nclass EditorScrollDimensions {\n  constructor(width, contentWidth, height, contentHeight) {\n    width = width | 0;\n    contentWidth = contentWidth | 0;\n    height = height | 0;\n    contentHeight = contentHeight | 0;\n\n    if (width < 0) {\n      width = 0;\n    }\n\n    if (contentWidth < 0) {\n      contentWidth = 0;\n    }\n\n    if (height < 0) {\n      height = 0;\n    }\n\n    if (contentHeight < 0) {\n      contentHeight = 0;\n    }\n\n    this.width = width;\n    this.contentWidth = contentWidth;\n    this.scrollWidth = Math.max(width, contentWidth);\n    this.height = height;\n    this.contentHeight = contentHeight;\n    this.scrollHeight = Math.max(height, contentHeight);\n  }\n\n  equals(other) {\n    return this.width === other.width && this.contentWidth === other.contentWidth && this.height === other.height && this.contentHeight === other.contentHeight;\n  }\n\n}\n\nclass EditorScrollable extends Disposable {\n  constructor(smoothScrollDuration, scheduleAtNextAnimationFrame) {\n    super();\n    this._onDidContentSizeChange = this._register(new Emitter());\n    this.onDidContentSizeChange = this._onDidContentSizeChange.event;\n    this._dimensions = new EditorScrollDimensions(0, 0, 0, 0);\n    this._scrollable = this._register(new Scrollable(smoothScrollDuration, scheduleAtNextAnimationFrame));\n    this.onDidScroll = this._scrollable.onScroll;\n  }\n\n  getScrollable() {\n    return this._scrollable;\n  }\n\n  setSmoothScrollDuration(smoothScrollDuration) {\n    this._scrollable.setSmoothScrollDuration(smoothScrollDuration);\n  }\n\n  validateScrollPosition(scrollPosition) {\n    return this._scrollable.validateScrollPosition(scrollPosition);\n  }\n\n  getScrollDimensions() {\n    return this._dimensions;\n  }\n\n  setScrollDimensions(dimensions) {\n    if (this._dimensions.equals(dimensions)) {\n      return;\n    }\n\n    const oldDimensions = this._dimensions;\n    this._dimensions = dimensions;\n\n    this._scrollable.setScrollDimensions({\n      width: dimensions.width,\n      scrollWidth: dimensions.scrollWidth,\n      height: dimensions.height,\n      scrollHeight: dimensions.scrollHeight\n    }, true);\n\n    const contentWidthChanged = oldDimensions.contentWidth !== dimensions.contentWidth;\n    const contentHeightChanged = oldDimensions.contentHeight !== dimensions.contentHeight;\n\n    if (contentWidthChanged || contentHeightChanged) {\n      this._onDidContentSizeChange.fire(new ContentSizeChangedEvent(oldDimensions.contentWidth, oldDimensions.contentHeight, dimensions.contentWidth, dimensions.contentHeight));\n    }\n  }\n\n  getFutureScrollPosition() {\n    return this._scrollable.getFutureScrollPosition();\n  }\n\n  getCurrentScrollPosition() {\n    return this._scrollable.getCurrentScrollPosition();\n  }\n\n  setScrollPositionNow(update) {\n    this._scrollable.setScrollPositionNow(update);\n  }\n\n  setScrollPositionSmooth(update) {\n    this._scrollable.setScrollPositionSmooth(update);\n  }\n\n}\n\nexport class ViewLayout extends Disposable {\n  constructor(configuration, lineCount, scheduleAtNextAnimationFrame) {\n    super();\n    this._configuration = configuration;\n    const options = this._configuration.options;\n    const layoutInfo = options.get(129\n    /* layoutInfo */\n    );\n    const padding = options.get(74\n    /* padding */\n    );\n    this._linesLayout = new LinesLayout(lineCount, options.get(58\n    /* lineHeight */\n    ), padding.top, padding.bottom);\n    this._scrollable = this._register(new EditorScrollable(0, scheduleAtNextAnimationFrame));\n\n    this._configureSmoothScrollDuration();\n\n    this._scrollable.setScrollDimensions(new EditorScrollDimensions(layoutInfo.contentWidth, 0, layoutInfo.height, 0));\n\n    this.onDidScroll = this._scrollable.onDidScroll;\n    this.onDidContentSizeChange = this._scrollable.onDidContentSizeChange;\n\n    this._updateHeight();\n  }\n\n  dispose() {\n    super.dispose();\n  }\n\n  getScrollable() {\n    return this._scrollable.getScrollable();\n  }\n\n  onHeightMaybeChanged() {\n    this._updateHeight();\n  }\n\n  _configureSmoothScrollDuration() {\n    this._scrollable.setSmoothScrollDuration(this._configuration.options.get(102\n    /* smoothScrolling */\n    ) ? SMOOTH_SCROLLING_TIME : 0);\n  } // ---- begin view event handlers\n\n\n  onConfigurationChanged(e) {\n    const options = this._configuration.options;\n\n    if (e.hasChanged(58\n    /* lineHeight */\n    )) {\n      this._linesLayout.setLineHeight(options.get(58\n      /* lineHeight */\n      ));\n    }\n\n    if (e.hasChanged(74\n    /* padding */\n    )) {\n      const padding = options.get(74\n      /* padding */\n      );\n\n      this._linesLayout.setPadding(padding.top, padding.bottom);\n    }\n\n    if (e.hasChanged(129\n    /* layoutInfo */\n    )) {\n      const layoutInfo = options.get(129\n      /* layoutInfo */\n      );\n      const width = layoutInfo.contentWidth;\n      const height = layoutInfo.height;\n\n      const scrollDimensions = this._scrollable.getScrollDimensions();\n\n      const contentWidth = scrollDimensions.contentWidth;\n\n      this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, contentWidth)));\n    } else {\n      this._updateHeight();\n    }\n\n    if (e.hasChanged(102\n    /* smoothScrolling */\n    )) {\n      this._configureSmoothScrollDuration();\n    }\n  }\n\n  onFlushed(lineCount) {\n    this._linesLayout.onFlushed(lineCount);\n  }\n\n  onLinesDeleted(fromLineNumber, toLineNumber) {\n    this._linesLayout.onLinesDeleted(fromLineNumber, toLineNumber);\n  }\n\n  onLinesInserted(fromLineNumber, toLineNumber) {\n    this._linesLayout.onLinesInserted(fromLineNumber, toLineNumber);\n  } // ---- end view event handlers\n\n\n  _getHorizontalScrollbarHeight(width, scrollWidth) {\n    const options = this._configuration.options;\n    const scrollbar = options.get(91\n    /* scrollbar */\n    );\n\n    if (scrollbar.horizontal === 2\n    /* Hidden */\n    ) {\n      // horizontal scrollbar not visible\n      return 0;\n    }\n\n    if (width >= scrollWidth) {\n      // horizontal scrollbar not visible\n      return 0;\n    }\n\n    return scrollbar.horizontalScrollbarSize;\n  }\n\n  _getContentHeight(width, height, contentWidth) {\n    const options = this._configuration.options;\n\n    let result = this._linesLayout.getLinesTotalHeight();\n\n    if (options.get(93\n    /* scrollBeyondLastLine */\n    )) {\n      result += Math.max(0, height - options.get(58\n      /* lineHeight */\n      ) - options.get(74\n      /* padding */\n      ).bottom);\n    } else {\n      result += this._getHorizontalScrollbarHeight(width, contentWidth);\n    }\n\n    return result;\n  }\n\n  _updateHeight() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    const width = scrollDimensions.width;\n    const height = scrollDimensions.height;\n    const contentWidth = scrollDimensions.contentWidth;\n\n    this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, contentWidth)));\n  } // ---- Layouting logic\n\n\n  getCurrentViewport() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n  }\n\n  getFutureViewport() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    const currentScrollPosition = this._scrollable.getFutureScrollPosition();\n\n    return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n  }\n\n  _computeContentWidth(maxLineWidth) {\n    const options = this._configuration.options;\n    const wrappingInfo = options.get(130\n    /* wrappingInfo */\n    );\n    const fontInfo = options.get(43\n    /* fontInfo */\n    );\n\n    if (wrappingInfo.isViewportWrapping) {\n      const layoutInfo = options.get(129\n      /* layoutInfo */\n      );\n      const minimap = options.get(64\n      /* minimap */\n      );\n\n      if (maxLineWidth > layoutInfo.contentWidth + fontInfo.typicalHalfwidthCharacterWidth) {\n        // This is a case where viewport wrapping is on, but the line extends above the viewport\n        if (minimap.enabled && minimap.side === 'right') {\n          // We need to accomodate the scrollbar width\n          return maxLineWidth + layoutInfo.verticalScrollbarWidth;\n        }\n      }\n\n      return maxLineWidth;\n    } else {\n      const extraHorizontalSpace = options.get(92\n      /* scrollBeyondLastColumn */\n      ) * fontInfo.typicalHalfwidthCharacterWidth;\n\n      const whitespaceMinWidth = this._linesLayout.getWhitespaceMinWidth();\n\n      return Math.max(maxLineWidth + extraHorizontalSpace, whitespaceMinWidth);\n    }\n  }\n\n  setMaxLineWidth(maxLineWidth) {\n    const scrollDimensions = this._scrollable.getScrollDimensions(); // const newScrollWidth = ;\n\n\n    this._scrollable.setScrollDimensions(new EditorScrollDimensions(scrollDimensions.width, this._computeContentWidth(maxLineWidth), scrollDimensions.height, scrollDimensions.contentHeight)); // The height might depend on the fact that there is a horizontal scrollbar or not\n\n\n    this._updateHeight();\n  } // ---- view state\n\n\n  saveState() {\n    const currentScrollPosition = this._scrollable.getFutureScrollPosition();\n\n    let scrollTop = currentScrollPosition.scrollTop;\n\n    let firstLineNumberInViewport = this._linesLayout.getLineNumberAtOrAfterVerticalOffset(scrollTop);\n\n    let whitespaceAboveFirstLine = this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(firstLineNumberInViewport);\n\n    return {\n      scrollTop: scrollTop,\n      scrollTopWithoutViewZones: scrollTop - whitespaceAboveFirstLine,\n      scrollLeft: currentScrollPosition.scrollLeft\n    };\n  } // ---- IVerticalLayoutProvider\n\n\n  changeWhitespace(callback) {\n    const hadAChange = this._linesLayout.changeWhitespace(callback);\n\n    if (hadAChange) {\n      this.onHeightMaybeChanged();\n    }\n\n    return hadAChange;\n  }\n\n  getVerticalOffsetForLineNumber(lineNumber) {\n    return this._linesLayout.getVerticalOffsetForLineNumber(lineNumber);\n  }\n\n  isAfterLines(verticalOffset) {\n    return this._linesLayout.isAfterLines(verticalOffset);\n  }\n\n  isInTopPadding(verticalOffset) {\n    return this._linesLayout.isInTopPadding(verticalOffset);\n  }\n\n  isInBottomPadding(verticalOffset) {\n    return this._linesLayout.isInBottomPadding(verticalOffset);\n  }\n\n  getLineNumberAtVerticalOffset(verticalOffset) {\n    return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(verticalOffset);\n  }\n\n  getWhitespaceAtVerticalOffset(verticalOffset) {\n    return this._linesLayout.getWhitespaceAtVerticalOffset(verticalOffset);\n  }\n\n  getLinesViewportData() {\n    const visibleBox = this.getCurrentViewport();\n    return this._linesLayout.getLinesViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n  }\n\n  getLinesViewportDataAtScrollTop(scrollTop) {\n    // do some minimal validations on scrollTop\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    if (scrollTop + scrollDimensions.height > scrollDimensions.scrollHeight) {\n      scrollTop = scrollDimensions.scrollHeight - scrollDimensions.height;\n    }\n\n    if (scrollTop < 0) {\n      scrollTop = 0;\n    }\n\n    return this._linesLayout.getLinesViewportData(scrollTop, scrollTop + scrollDimensions.height);\n  }\n\n  getWhitespaceViewportData() {\n    const visibleBox = this.getCurrentViewport();\n    return this._linesLayout.getWhitespaceViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n  }\n\n  getWhitespaces() {\n    return this._linesLayout.getWhitespaces();\n  } // ---- IScrollingProvider\n\n\n  getContentWidth() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.contentWidth;\n  }\n\n  getScrollWidth() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.scrollWidth;\n  }\n\n  getContentHeight() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.contentHeight;\n  }\n\n  getScrollHeight() {\n    const scrollDimensions = this._scrollable.getScrollDimensions();\n\n    return scrollDimensions.scrollHeight;\n  }\n\n  getCurrentScrollLeft() {\n    const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return currentScrollPosition.scrollLeft;\n  }\n\n  getCurrentScrollTop() {\n    const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    return currentScrollPosition.scrollTop;\n  }\n\n  validateScrollPosition(scrollPosition) {\n    return this._scrollable.validateScrollPosition(scrollPosition);\n  }\n\n  setScrollPosition(position, type) {\n    if (type === 1\n    /* Immediate */\n    ) {\n      this._scrollable.setScrollPositionNow(position);\n    } else {\n      this._scrollable.setScrollPositionSmooth(position);\n    }\n  }\n\n  deltaScrollNow(deltaScrollLeft, deltaScrollTop) {\n    const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n\n    this._scrollable.setScrollPositionNow({\n      scrollLeft: currentScrollPosition.scrollLeft + deltaScrollLeft,\n      scrollTop: currentScrollPosition.scrollTop + deltaScrollTop\n    });\n  }\n\n}","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/common/viewLayout/viewLayout.js"],"names":["Emitter","Disposable","Scrollable","LinesLayout","Viewport","ContentSizeChangedEvent","SMOOTH_SCROLLING_TIME","EditorScrollDimensions","constructor","width","contentWidth","height","contentHeight","scrollWidth","Math","max","scrollHeight","equals","other","EditorScrollable","smoothScrollDuration","scheduleAtNextAnimationFrame","_onDidContentSizeChange","_register","onDidContentSizeChange","event","_dimensions","_scrollable","onDidScroll","onScroll","getScrollable","setSmoothScrollDuration","validateScrollPosition","scrollPosition","getScrollDimensions","setScrollDimensions","dimensions","oldDimensions","contentWidthChanged","contentHeightChanged","fire","getFutureScrollPosition","getCurrentScrollPosition","setScrollPositionNow","update","setScrollPositionSmooth","ViewLayout","configuration","lineCount","_configuration","options","layoutInfo","get","padding","_linesLayout","top","bottom","_configureSmoothScrollDuration","_updateHeight","dispose","onHeightMaybeChanged","onConfigurationChanged","e","hasChanged","setLineHeight","setPadding","scrollDimensions","_getContentHeight","onFlushed","onLinesDeleted","fromLineNumber","toLineNumber","onLinesInserted","_getHorizontalScrollbarHeight","scrollbar","horizontal","horizontalScrollbarSize","result","getLinesTotalHeight","getCurrentViewport","currentScrollPosition","scrollTop","scrollLeft","getFutureViewport","_computeContentWidth","maxLineWidth","wrappingInfo","fontInfo","isViewportWrapping","minimap","typicalHalfwidthCharacterWidth","enabled","side","verticalScrollbarWidth","extraHorizontalSpace","whitespaceMinWidth","getWhitespaceMinWidth","setMaxLineWidth","saveState","firstLineNumberInViewport","getLineNumberAtOrAfterVerticalOffset","whitespaceAboveFirstLine","getWhitespaceAccumulatedHeightBeforeLineNumber","scrollTopWithoutViewZones","changeWhitespace","callback","hadAChange","getVerticalOffsetForLineNumber","lineNumber","isAfterLines","verticalOffset","isInTopPadding","isInBottomPadding","getLineNumberAtVerticalOffset","getWhitespaceAtVerticalOffset","getLinesViewportData","visibleBox","getLinesViewportDataAtScrollTop","getWhitespaceViewportData","getWhitespaces","getContentWidth","getScrollWidth","getContentHeight","getScrollHeight","getCurrentScrollLeft","getCurrentScrollTop","setScrollPosition","position","type","deltaScrollNow","deltaScrollLeft","deltaScrollTop"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Scrollable } from '../../../base/common/scrollable.js';\nimport { LinesLayout } from './linesLayout.js';\nimport { Viewport } from '../viewModel/viewModel.js';\nimport { ContentSizeChangedEvent } from '../viewModel/viewModelEventDispatcher.js';\nconst SMOOTH_SCROLLING_TIME = 125;\nclass EditorScrollDimensions {\n    constructor(width, contentWidth, height, contentHeight) {\n        width = width | 0;\n        contentWidth = contentWidth | 0;\n        height = height | 0;\n        contentHeight = contentHeight | 0;\n        if (width < 0) {\n            width = 0;\n        }\n        if (contentWidth < 0) {\n            contentWidth = 0;\n        }\n        if (height < 0) {\n            height = 0;\n        }\n        if (contentHeight < 0) {\n            contentHeight = 0;\n        }\n        this.width = width;\n        this.contentWidth = contentWidth;\n        this.scrollWidth = Math.max(width, contentWidth);\n        this.height = height;\n        this.contentHeight = contentHeight;\n        this.scrollHeight = Math.max(height, contentHeight);\n    }\n    equals(other) {\n        return (this.width === other.width\n            && this.contentWidth === other.contentWidth\n            && this.height === other.height\n            && this.contentHeight === other.contentHeight);\n    }\n}\nclass EditorScrollable extends Disposable {\n    constructor(smoothScrollDuration, scheduleAtNextAnimationFrame) {\n        super();\n        this._onDidContentSizeChange = this._register(new Emitter());\n        this.onDidContentSizeChange = this._onDidContentSizeChange.event;\n        this._dimensions = new EditorScrollDimensions(0, 0, 0, 0);\n        this._scrollable = this._register(new Scrollable(smoothScrollDuration, scheduleAtNextAnimationFrame));\n        this.onDidScroll = this._scrollable.onScroll;\n    }\n    getScrollable() {\n        return this._scrollable;\n    }\n    setSmoothScrollDuration(smoothScrollDuration) {\n        this._scrollable.setSmoothScrollDuration(smoothScrollDuration);\n    }\n    validateScrollPosition(scrollPosition) {\n        return this._scrollable.validateScrollPosition(scrollPosition);\n    }\n    getScrollDimensions() {\n        return this._dimensions;\n    }\n    setScrollDimensions(dimensions) {\n        if (this._dimensions.equals(dimensions)) {\n            return;\n        }\n        const oldDimensions = this._dimensions;\n        this._dimensions = dimensions;\n        this._scrollable.setScrollDimensions({\n            width: dimensions.width,\n            scrollWidth: dimensions.scrollWidth,\n            height: dimensions.height,\n            scrollHeight: dimensions.scrollHeight\n        }, true);\n        const contentWidthChanged = (oldDimensions.contentWidth !== dimensions.contentWidth);\n        const contentHeightChanged = (oldDimensions.contentHeight !== dimensions.contentHeight);\n        if (contentWidthChanged || contentHeightChanged) {\n            this._onDidContentSizeChange.fire(new ContentSizeChangedEvent(oldDimensions.contentWidth, oldDimensions.contentHeight, dimensions.contentWidth, dimensions.contentHeight));\n        }\n    }\n    getFutureScrollPosition() {\n        return this._scrollable.getFutureScrollPosition();\n    }\n    getCurrentScrollPosition() {\n        return this._scrollable.getCurrentScrollPosition();\n    }\n    setScrollPositionNow(update) {\n        this._scrollable.setScrollPositionNow(update);\n    }\n    setScrollPositionSmooth(update) {\n        this._scrollable.setScrollPositionSmooth(update);\n    }\n}\nexport class ViewLayout extends Disposable {\n    constructor(configuration, lineCount, scheduleAtNextAnimationFrame) {\n        super();\n        this._configuration = configuration;\n        const options = this._configuration.options;\n        const layoutInfo = options.get(129 /* layoutInfo */);\n        const padding = options.get(74 /* padding */);\n        this._linesLayout = new LinesLayout(lineCount, options.get(58 /* lineHeight */), padding.top, padding.bottom);\n        this._scrollable = this._register(new EditorScrollable(0, scheduleAtNextAnimationFrame));\n        this._configureSmoothScrollDuration();\n        this._scrollable.setScrollDimensions(new EditorScrollDimensions(layoutInfo.contentWidth, 0, layoutInfo.height, 0));\n        this.onDidScroll = this._scrollable.onDidScroll;\n        this.onDidContentSizeChange = this._scrollable.onDidContentSizeChange;\n        this._updateHeight();\n    }\n    dispose() {\n        super.dispose();\n    }\n    getScrollable() {\n        return this._scrollable.getScrollable();\n    }\n    onHeightMaybeChanged() {\n        this._updateHeight();\n    }\n    _configureSmoothScrollDuration() {\n        this._scrollable.setSmoothScrollDuration(this._configuration.options.get(102 /* smoothScrolling */) ? SMOOTH_SCROLLING_TIME : 0);\n    }\n    // ---- begin view event handlers\n    onConfigurationChanged(e) {\n        const options = this._configuration.options;\n        if (e.hasChanged(58 /* lineHeight */)) {\n            this._linesLayout.setLineHeight(options.get(58 /* lineHeight */));\n        }\n        if (e.hasChanged(74 /* padding */)) {\n            const padding = options.get(74 /* padding */);\n            this._linesLayout.setPadding(padding.top, padding.bottom);\n        }\n        if (e.hasChanged(129 /* layoutInfo */)) {\n            const layoutInfo = options.get(129 /* layoutInfo */);\n            const width = layoutInfo.contentWidth;\n            const height = layoutInfo.height;\n            const scrollDimensions = this._scrollable.getScrollDimensions();\n            const contentWidth = scrollDimensions.contentWidth;\n            this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, contentWidth)));\n        }\n        else {\n            this._updateHeight();\n        }\n        if (e.hasChanged(102 /* smoothScrolling */)) {\n            this._configureSmoothScrollDuration();\n        }\n    }\n    onFlushed(lineCount) {\n        this._linesLayout.onFlushed(lineCount);\n    }\n    onLinesDeleted(fromLineNumber, toLineNumber) {\n        this._linesLayout.onLinesDeleted(fromLineNumber, toLineNumber);\n    }\n    onLinesInserted(fromLineNumber, toLineNumber) {\n        this._linesLayout.onLinesInserted(fromLineNumber, toLineNumber);\n    }\n    // ---- end view event handlers\n    _getHorizontalScrollbarHeight(width, scrollWidth) {\n        const options = this._configuration.options;\n        const scrollbar = options.get(91 /* scrollbar */);\n        if (scrollbar.horizontal === 2 /* Hidden */) {\n            // horizontal scrollbar not visible\n            return 0;\n        }\n        if (width >= scrollWidth) {\n            // horizontal scrollbar not visible\n            return 0;\n        }\n        return scrollbar.horizontalScrollbarSize;\n    }\n    _getContentHeight(width, height, contentWidth) {\n        const options = this._configuration.options;\n        let result = this._linesLayout.getLinesTotalHeight();\n        if (options.get(93 /* scrollBeyondLastLine */)) {\n            result += Math.max(0, height - options.get(58 /* lineHeight */) - options.get(74 /* padding */).bottom);\n        }\n        else {\n            result += this._getHorizontalScrollbarHeight(width, contentWidth);\n        }\n        return result;\n    }\n    _updateHeight() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        const width = scrollDimensions.width;\n        const height = scrollDimensions.height;\n        const contentWidth = scrollDimensions.contentWidth;\n        this._scrollable.setScrollDimensions(new EditorScrollDimensions(width, scrollDimensions.contentWidth, height, this._getContentHeight(width, height, contentWidth)));\n    }\n    // ---- Layouting logic\n    getCurrentViewport() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n        return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n    }\n    getFutureViewport() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        const currentScrollPosition = this._scrollable.getFutureScrollPosition();\n        return new Viewport(currentScrollPosition.scrollTop, currentScrollPosition.scrollLeft, scrollDimensions.width, scrollDimensions.height);\n    }\n    _computeContentWidth(maxLineWidth) {\n        const options = this._configuration.options;\n        const wrappingInfo = options.get(130 /* wrappingInfo */);\n        const fontInfo = options.get(43 /* fontInfo */);\n        if (wrappingInfo.isViewportWrapping) {\n            const layoutInfo = options.get(129 /* layoutInfo */);\n            const minimap = options.get(64 /* minimap */);\n            if (maxLineWidth > layoutInfo.contentWidth + fontInfo.typicalHalfwidthCharacterWidth) {\n                // This is a case where viewport wrapping is on, but the line extends above the viewport\n                if (minimap.enabled && minimap.side === 'right') {\n                    // We need to accomodate the scrollbar width\n                    return maxLineWidth + layoutInfo.verticalScrollbarWidth;\n                }\n            }\n            return maxLineWidth;\n        }\n        else {\n            const extraHorizontalSpace = options.get(92 /* scrollBeyondLastColumn */) * fontInfo.typicalHalfwidthCharacterWidth;\n            const whitespaceMinWidth = this._linesLayout.getWhitespaceMinWidth();\n            return Math.max(maxLineWidth + extraHorizontalSpace, whitespaceMinWidth);\n        }\n    }\n    setMaxLineWidth(maxLineWidth) {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        // const newScrollWidth = ;\n        this._scrollable.setScrollDimensions(new EditorScrollDimensions(scrollDimensions.width, this._computeContentWidth(maxLineWidth), scrollDimensions.height, scrollDimensions.contentHeight));\n        // The height might depend on the fact that there is a horizontal scrollbar or not\n        this._updateHeight();\n    }\n    // ---- view state\n    saveState() {\n        const currentScrollPosition = this._scrollable.getFutureScrollPosition();\n        let scrollTop = currentScrollPosition.scrollTop;\n        let firstLineNumberInViewport = this._linesLayout.getLineNumberAtOrAfterVerticalOffset(scrollTop);\n        let whitespaceAboveFirstLine = this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(firstLineNumberInViewport);\n        return {\n            scrollTop: scrollTop,\n            scrollTopWithoutViewZones: scrollTop - whitespaceAboveFirstLine,\n            scrollLeft: currentScrollPosition.scrollLeft\n        };\n    }\n    // ---- IVerticalLayoutProvider\n    changeWhitespace(callback) {\n        const hadAChange = this._linesLayout.changeWhitespace(callback);\n        if (hadAChange) {\n            this.onHeightMaybeChanged();\n        }\n        return hadAChange;\n    }\n    getVerticalOffsetForLineNumber(lineNumber) {\n        return this._linesLayout.getVerticalOffsetForLineNumber(lineNumber);\n    }\n    isAfterLines(verticalOffset) {\n        return this._linesLayout.isAfterLines(verticalOffset);\n    }\n    isInTopPadding(verticalOffset) {\n        return this._linesLayout.isInTopPadding(verticalOffset);\n    }\n    isInBottomPadding(verticalOffset) {\n        return this._linesLayout.isInBottomPadding(verticalOffset);\n    }\n    getLineNumberAtVerticalOffset(verticalOffset) {\n        return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(verticalOffset);\n    }\n    getWhitespaceAtVerticalOffset(verticalOffset) {\n        return this._linesLayout.getWhitespaceAtVerticalOffset(verticalOffset);\n    }\n    getLinesViewportData() {\n        const visibleBox = this.getCurrentViewport();\n        return this._linesLayout.getLinesViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n    }\n    getLinesViewportDataAtScrollTop(scrollTop) {\n        // do some minimal validations on scrollTop\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        if (scrollTop + scrollDimensions.height > scrollDimensions.scrollHeight) {\n            scrollTop = scrollDimensions.scrollHeight - scrollDimensions.height;\n        }\n        if (scrollTop < 0) {\n            scrollTop = 0;\n        }\n        return this._linesLayout.getLinesViewportData(scrollTop, scrollTop + scrollDimensions.height);\n    }\n    getWhitespaceViewportData() {\n        const visibleBox = this.getCurrentViewport();\n        return this._linesLayout.getWhitespaceViewportData(visibleBox.top, visibleBox.top + visibleBox.height);\n    }\n    getWhitespaces() {\n        return this._linesLayout.getWhitespaces();\n    }\n    // ---- IScrollingProvider\n    getContentWidth() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        return scrollDimensions.contentWidth;\n    }\n    getScrollWidth() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        return scrollDimensions.scrollWidth;\n    }\n    getContentHeight() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        return scrollDimensions.contentHeight;\n    }\n    getScrollHeight() {\n        const scrollDimensions = this._scrollable.getScrollDimensions();\n        return scrollDimensions.scrollHeight;\n    }\n    getCurrentScrollLeft() {\n        const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n        return currentScrollPosition.scrollLeft;\n    }\n    getCurrentScrollTop() {\n        const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n        return currentScrollPosition.scrollTop;\n    }\n    validateScrollPosition(scrollPosition) {\n        return this._scrollable.validateScrollPosition(scrollPosition);\n    }\n    setScrollPosition(position, type) {\n        if (type === 1 /* Immediate */) {\n            this._scrollable.setScrollPositionNow(position);\n        }\n        else {\n            this._scrollable.setScrollPositionSmooth(position);\n        }\n    }\n    deltaScrollNow(deltaScrollLeft, deltaScrollTop) {\n        const currentScrollPosition = this._scrollable.getCurrentScrollPosition();\n        this._scrollable.setScrollPositionNow({\n            scrollLeft: currentScrollPosition.scrollLeft + deltaScrollLeft,\n            scrollTop: currentScrollPosition.scrollTop + deltaScrollTop\n        });\n    }\n}\n"]},"metadata":{},"sourceType":"module"}