{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Color, RGBA } from '../../../base/common/color.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { Range } from '../../common/core/range.js';\nimport { getColorPresentations } from '../colorPicker/color.js';\nimport { ColorDetector } from '../colorPicker/colorDetector.js';\nimport { ColorPickerModel } from '../colorPicker/colorPickerModel.js';\nimport { ColorPickerWidget } from '../colorPicker/colorPickerWidget.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nexport class ColorHover {\n  constructor(owner, range, model, provider) {\n    this.owner = owner;\n    this.range = range;\n    this.model = model;\n    this.provider = provider;\n    /**\n     * Force the hover to always be rendered at this specific range,\n     * even in the case of multiple hover parts.\n     */\n\n    this.forceShowAtRange = true;\n  }\n\n  isValidForHoverAnchor(anchor) {\n    return anchor.type === 1\n    /* Range */\n    && this.range.startColumn <= anchor.range.startColumn && this.range.endColumn >= anchor.range.endColumn;\n  }\n\n}\nlet ColorHoverParticipant = class ColorHoverParticipant {\n  constructor(_editor, _hover, _themeService) {\n    this._editor = _editor;\n    this._hover = _hover;\n    this._themeService = _themeService;\n  }\n\n  computeSync(anchor, lineDecorations) {\n    return [];\n  }\n\n  computeAsync(anchor, lineDecorations, token) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this._editor.hasModel()) {\n        return [];\n      }\n\n      const colorDetector = ColorDetector.get(this._editor);\n\n      for (const d of lineDecorations) {\n        if (d.options.description !== 'color-detector-color') {\n          continue;\n        }\n\n        const colorData = colorDetector.getColorData(d.range.getStartPosition());\n\n        if (colorData) {\n          const colorHover = yield this._createColorHover(this._editor.getModel(), colorData.colorInfo, colorData.provider);\n          return [colorHover];\n        }\n      }\n\n      return [];\n    });\n  }\n\n  _createColorHover(editorModel, colorInfo, provider) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const originalText = editorModel.getValueInRange(colorInfo.range);\n      const {\n        red,\n        green,\n        blue,\n        alpha\n      } = colorInfo.color;\n      const rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\n      const color = new Color(rgba);\n      const colorPresentations = yield getColorPresentations(editorModel, colorInfo, provider, CancellationToken.None);\n      const model = new ColorPickerModel(color, [], 0);\n      model.colorPresentations = colorPresentations || [];\n      model.guessColorPresentation(color, originalText);\n      return new ColorHover(this, Range.lift(colorInfo.range), model, provider);\n    });\n  }\n\n  renderHoverParts(hoverParts, fragment, statusBar) {\n    if (hoverParts.length === 0 || !this._editor.hasModel()) {\n      return Disposable.None;\n    }\n\n    const disposables = new DisposableStore();\n    const colorHover = hoverParts[0];\n\n    const editorModel = this._editor.getModel();\n\n    const model = colorHover.model;\n    const widget = disposables.add(new ColorPickerWidget(fragment, model, this._editor.getOption(127\n    /* pixelRatio */\n    ), this._themeService));\n    let range = new Range(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);\n\n    const updateEditorModel = () => {\n      let textEdits;\n      let newRange;\n\n      if (model.presentation.textEdit) {\n        textEdits = [model.presentation.textEdit];\n        newRange = new Range(model.presentation.textEdit.range.startLineNumber, model.presentation.textEdit.range.startColumn, model.presentation.textEdit.range.endLineNumber, model.presentation.textEdit.range.endColumn);\n\n        const trackedRange = this._editor.getModel()._setTrackedRange(null, newRange, 3\n        /* GrowsOnlyWhenTypingAfter */\n        );\n\n        this._editor.pushUndoStop();\n\n        this._editor.executeEdits('colorpicker', textEdits);\n\n        newRange = this._editor.getModel()._getTrackedRange(trackedRange) || newRange;\n      } else {\n        textEdits = [{\n          identifier: null,\n          range,\n          text: model.presentation.label,\n          forceMoveMarkers: false\n        }];\n        newRange = range.setEndPosition(range.endLineNumber, range.startColumn + model.presentation.label.length);\n\n        this._editor.pushUndoStop();\n\n        this._editor.executeEdits('colorpicker', textEdits);\n      }\n\n      if (model.presentation.additionalTextEdits) {\n        textEdits = [...model.presentation.additionalTextEdits];\n\n        this._editor.executeEdits('colorpicker', textEdits);\n\n        this._hover.hide();\n      }\n\n      this._editor.pushUndoStop();\n\n      range = newRange;\n    };\n\n    const updateColorPresentations = color => {\n      return getColorPresentations(editorModel, {\n        range: range,\n        color: {\n          red: color.rgba.r / 255,\n          green: color.rgba.g / 255,\n          blue: color.rgba.b / 255,\n          alpha: color.rgba.a\n        }\n      }, colorHover.provider, CancellationToken.None).then(colorPresentations => {\n        model.colorPresentations = colorPresentations || [];\n      });\n    };\n\n    disposables.add(model.onColorFlushed(color => {\n      updateColorPresentations(color).then(updateEditorModel);\n    }));\n    disposables.add(model.onDidChangeColor(updateColorPresentations));\n\n    this._hover.setColorPicker(widget);\n\n    return disposables;\n  }\n\n};\nColorHoverParticipant = __decorate([__param(2, IThemeService)], ColorHoverParticipant);\nexport { ColorHoverParticipant };","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/hover/colorHoverParticipant.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","CancellationToken","Color","RGBA","Disposable","DisposableStore","Range","getColorPresentations","ColorDetector","ColorPickerModel","ColorPickerWidget","IThemeService","ColorHover","constructor","owner","range","model","provider","forceShowAtRange","isValidForHoverAnchor","anchor","type","startColumn","endColumn","ColorHoverParticipant","_editor","_hover","_themeService","computeSync","lineDecorations","computeAsync","token","hasModel","colorDetector","get","options","description","colorData","getColorData","getStartPosition","colorHover","_createColorHover","getModel","colorInfo","editorModel","originalText","getValueInRange","red","green","blue","alpha","color","rgba","Math","round","colorPresentations","None","guessColorPresentation","lift","renderHoverParts","hoverParts","fragment","statusBar","disposables","widget","add","getOption","startLineNumber","endLineNumber","updateEditorModel","textEdits","newRange","presentation","textEdit","trackedRange","_setTrackedRange","pushUndoStop","executeEdits","_getTrackedRange","identifier","text","label","forceMoveMarkers","setEndPosition","additionalTextEdits","hide","updateColorPresentations","g","b","a","onColorFlushed","onDidChangeColor","setColorPicker"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Color, RGBA } from '../../../base/common/color.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { Range } from '../../common/core/range.js';\nimport { getColorPresentations } from '../colorPicker/color.js';\nimport { ColorDetector } from '../colorPicker/colorDetector.js';\nimport { ColorPickerModel } from '../colorPicker/colorPickerModel.js';\nimport { ColorPickerWidget } from '../colorPicker/colorPickerWidget.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nexport class ColorHover {\n    constructor(owner, range, model, provider) {\n        this.owner = owner;\n        this.range = range;\n        this.model = model;\n        this.provider = provider;\n        /**\n         * Force the hover to always be rendered at this specific range,\n         * even in the case of multiple hover parts.\n         */\n        this.forceShowAtRange = true;\n    }\n    isValidForHoverAnchor(anchor) {\n        return (anchor.type === 1 /* Range */\n            && this.range.startColumn <= anchor.range.startColumn\n            && this.range.endColumn >= anchor.range.endColumn);\n    }\n}\nlet ColorHoverParticipant = class ColorHoverParticipant {\n    constructor(_editor, _hover, _themeService) {\n        this._editor = _editor;\n        this._hover = _hover;\n        this._themeService = _themeService;\n    }\n    computeSync(anchor, lineDecorations) {\n        return [];\n    }\n    computeAsync(anchor, lineDecorations, token) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this._editor.hasModel()) {\n                return [];\n            }\n            const colorDetector = ColorDetector.get(this._editor);\n            for (const d of lineDecorations) {\n                if (d.options.description !== 'color-detector-color') {\n                    continue;\n                }\n                const colorData = colorDetector.getColorData(d.range.getStartPosition());\n                if (colorData) {\n                    const colorHover = yield this._createColorHover(this._editor.getModel(), colorData.colorInfo, colorData.provider);\n                    return [colorHover];\n                }\n            }\n            return [];\n        });\n    }\n    _createColorHover(editorModel, colorInfo, provider) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const originalText = editorModel.getValueInRange(colorInfo.range);\n            const { red, green, blue, alpha } = colorInfo.color;\n            const rgba = new RGBA(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);\n            const color = new Color(rgba);\n            const colorPresentations = yield getColorPresentations(editorModel, colorInfo, provider, CancellationToken.None);\n            const model = new ColorPickerModel(color, [], 0);\n            model.colorPresentations = colorPresentations || [];\n            model.guessColorPresentation(color, originalText);\n            return new ColorHover(this, Range.lift(colorInfo.range), model, provider);\n        });\n    }\n    renderHoverParts(hoverParts, fragment, statusBar) {\n        if (hoverParts.length === 0 || !this._editor.hasModel()) {\n            return Disposable.None;\n        }\n        const disposables = new DisposableStore();\n        const colorHover = hoverParts[0];\n        const editorModel = this._editor.getModel();\n        const model = colorHover.model;\n        const widget = disposables.add(new ColorPickerWidget(fragment, model, this._editor.getOption(127 /* pixelRatio */), this._themeService));\n        let range = new Range(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);\n        const updateEditorModel = () => {\n            let textEdits;\n            let newRange;\n            if (model.presentation.textEdit) {\n                textEdits = [model.presentation.textEdit];\n                newRange = new Range(model.presentation.textEdit.range.startLineNumber, model.presentation.textEdit.range.startColumn, model.presentation.textEdit.range.endLineNumber, model.presentation.textEdit.range.endColumn);\n                const trackedRange = this._editor.getModel()._setTrackedRange(null, newRange, 3 /* GrowsOnlyWhenTypingAfter */);\n                this._editor.pushUndoStop();\n                this._editor.executeEdits('colorpicker', textEdits);\n                newRange = this._editor.getModel()._getTrackedRange(trackedRange) || newRange;\n            }\n            else {\n                textEdits = [{ identifier: null, range, text: model.presentation.label, forceMoveMarkers: false }];\n                newRange = range.setEndPosition(range.endLineNumber, range.startColumn + model.presentation.label.length);\n                this._editor.pushUndoStop();\n                this._editor.executeEdits('colorpicker', textEdits);\n            }\n            if (model.presentation.additionalTextEdits) {\n                textEdits = [...model.presentation.additionalTextEdits];\n                this._editor.executeEdits('colorpicker', textEdits);\n                this._hover.hide();\n            }\n            this._editor.pushUndoStop();\n            range = newRange;\n        };\n        const updateColorPresentations = (color) => {\n            return getColorPresentations(editorModel, {\n                range: range,\n                color: {\n                    red: color.rgba.r / 255,\n                    green: color.rgba.g / 255,\n                    blue: color.rgba.b / 255,\n                    alpha: color.rgba.a\n                }\n            }, colorHover.provider, CancellationToken.None).then((colorPresentations) => {\n                model.colorPresentations = colorPresentations || [];\n            });\n        };\n        disposables.add(model.onColorFlushed((color) => {\n            updateColorPresentations(color).then(updateEditorModel);\n        }));\n        disposables.add(model.onDidChangeColor(updateColorPresentations));\n        this._hover.setColorPicker(widget);\n        return disposables;\n    }\n};\nColorHoverParticipant = __decorate([\n    __param(2, IThemeService)\n], ColorHoverParticipant);\nexport { ColorHoverParticipant };\n"]},"metadata":{},"sourceType":"module"}