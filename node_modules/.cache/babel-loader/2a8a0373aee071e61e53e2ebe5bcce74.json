{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { DragAndDropData, StaticDND } from '../../dnd.js';\nimport { $, addDisposableListener, append, clearNode, createStyleSheet, getDomNodePagePosition, hasParentWithClass } from '../../dom.js';\nimport { DomEmitter } from '../../event.js';\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\nimport { ElementsDragAndDropData } from '../list/listView.js';\nimport { DefaultKeyboardNavigationDelegate, isInputElement, isMonacoEditor, List, MouseController } from '../list/listWidget.js';\nimport { getVisibleState, isFilterResult } from './indexTreeModel.js';\nimport { TreeMouseEventTarget } from './tree.js';\nimport { treeFilterClearIcon, treeFilterOnTypeOffIcon, treeFilterOnTypeOnIcon, treeItemExpandedIcon } from './treeIcons.js';\nimport { distinct, equals, range } from '../../../common/arrays.js';\nimport { disposableTimeout } from '../../../common/async.js';\nimport { SetMap } from '../../../common/collections.js';\nimport { Emitter, Event, EventBufferer, Relay } from '../../../common/event.js';\nimport { fuzzyScore, FuzzyScore } from '../../../common/filters.js';\nimport { Disposable, DisposableStore, dispose, toDisposable } from '../../../common/lifecycle.js';\nimport { clamp } from '../../../common/numbers.js';\nimport { isMacintosh } from '../../../common/platform.js';\nimport './media/tree.css';\nimport { localize } from '../../../../nls.js';\n\nclass TreeElementsDragAndDropData extends ElementsDragAndDropData {\n  constructor(data) {\n    super(data.elements.map(node => node.element));\n    this.data = data;\n  }\n\n}\n\nfunction asTreeDragAndDropData(data) {\n  if (data instanceof ElementsDragAndDropData) {\n    return new TreeElementsDragAndDropData(data);\n  }\n\n  return data;\n}\n\nclass TreeNodeListDragAndDrop {\n  constructor(modelProvider, dnd) {\n    this.modelProvider = modelProvider;\n    this.dnd = dnd;\n    this.autoExpandDisposable = Disposable.None;\n  }\n\n  getDragURI(node) {\n    return this.dnd.getDragURI(node.element);\n  }\n\n  getDragLabel(nodes, originalEvent) {\n    if (this.dnd.getDragLabel) {\n      return this.dnd.getDragLabel(nodes.map(node => node.element), originalEvent);\n    }\n\n    return undefined;\n  }\n\n  onDragStart(data, originalEvent) {\n    if (this.dnd.onDragStart) {\n      this.dnd.onDragStart(asTreeDragAndDropData(data), originalEvent);\n    }\n  }\n\n  onDragOver(data, targetNode, targetIndex, originalEvent) {\n    let raw = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n    const result = this.dnd.onDragOver(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n    const didChangeAutoExpandNode = this.autoExpandNode !== targetNode;\n\n    if (didChangeAutoExpandNode) {\n      this.autoExpandDisposable.dispose();\n      this.autoExpandNode = targetNode;\n    }\n\n    if (typeof targetNode === 'undefined') {\n      return result;\n    }\n\n    if (didChangeAutoExpandNode && typeof result !== 'boolean' && result.autoExpand) {\n      this.autoExpandDisposable = disposableTimeout(() => {\n        const model = this.modelProvider();\n        const ref = model.getNodeLocation(targetNode);\n\n        if (model.isCollapsed(ref)) {\n          model.setCollapsed(ref, false);\n        }\n\n        this.autoExpandNode = undefined;\n      }, 500);\n    }\n\n    if (typeof result === 'boolean' || !result.accept || typeof result.bubble === 'undefined' || result.feedback) {\n      if (!raw) {\n        const accept = typeof result === 'boolean' ? result : result.accept;\n        const effect = typeof result === 'boolean' ? undefined : result.effect;\n        return {\n          accept,\n          effect,\n          feedback: [targetIndex]\n        };\n      }\n\n      return result;\n    }\n\n    if (result.bubble === 1\n    /* Up */\n    ) {\n      const model = this.modelProvider();\n      const ref = model.getNodeLocation(targetNode);\n      const parentRef = model.getParentNodeLocation(ref);\n      const parentNode = model.getNode(parentRef);\n      const parentIndex = parentRef && model.getListIndex(parentRef);\n      return this.onDragOver(data, parentNode, parentIndex, originalEvent, false);\n    }\n\n    const model = this.modelProvider();\n    const ref = model.getNodeLocation(targetNode);\n    const start = model.getListIndex(ref);\n    const length = model.getListRenderCount(ref);\n    return Object.assign(Object.assign({}, result), {\n      feedback: range(start, start + length)\n    });\n  }\n\n  drop(data, targetNode, targetIndex, originalEvent) {\n    this.autoExpandDisposable.dispose();\n    this.autoExpandNode = undefined;\n    this.dnd.drop(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n  }\n\n  onDragEnd(originalEvent) {\n    if (this.dnd.onDragEnd) {\n      this.dnd.onDragEnd(originalEvent);\n    }\n  }\n\n}\n\nfunction asListOptions(modelProvider, options) {\n  return options && Object.assign(Object.assign({}, options), {\n    identityProvider: options.identityProvider && {\n      getId(el) {\n        return options.identityProvider.getId(el.element);\n      }\n\n    },\n    dnd: options.dnd && new TreeNodeListDragAndDrop(modelProvider, options.dnd),\n    multipleSelectionController: options.multipleSelectionController && {\n      isSelectionSingleChangeEvent(e) {\n        return options.multipleSelectionController.isSelectionSingleChangeEvent(Object.assign(Object.assign({}, e), {\n          element: e.element\n        }));\n      },\n\n      isSelectionRangeChangeEvent(e) {\n        return options.multipleSelectionController.isSelectionRangeChangeEvent(Object.assign(Object.assign({}, e), {\n          element: e.element\n        }));\n      }\n\n    },\n    accessibilityProvider: options.accessibilityProvider && Object.assign(Object.assign({}, options.accessibilityProvider), {\n      getSetSize(node) {\n        const model = modelProvider();\n        const ref = model.getNodeLocation(node);\n        const parentRef = model.getParentNodeLocation(ref);\n        const parentNode = model.getNode(parentRef);\n        return parentNode.visibleChildrenCount;\n      },\n\n      getPosInSet(node) {\n        return node.visibleChildIndex + 1;\n      },\n\n      isChecked: options.accessibilityProvider && options.accessibilityProvider.isChecked ? node => {\n        return options.accessibilityProvider.isChecked(node.element);\n      } : undefined,\n      getRole: options.accessibilityProvider && options.accessibilityProvider.getRole ? node => {\n        return options.accessibilityProvider.getRole(node.element);\n      } : () => 'treeitem',\n\n      getAriaLabel(e) {\n        return options.accessibilityProvider.getAriaLabel(e.element);\n      },\n\n      getWidgetAriaLabel() {\n        return options.accessibilityProvider.getWidgetAriaLabel();\n      },\n\n      getWidgetRole: options.accessibilityProvider && options.accessibilityProvider.getWidgetRole ? () => options.accessibilityProvider.getWidgetRole() : () => 'tree',\n      getAriaLevel: options.accessibilityProvider && options.accessibilityProvider.getAriaLevel ? node => options.accessibilityProvider.getAriaLevel(node.element) : node => {\n        return node.depth;\n      },\n      getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (node => {\n        return options.accessibilityProvider.getActiveDescendantId(node.element);\n      })\n    }),\n    keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && Object.assign(Object.assign({}, options.keyboardNavigationLabelProvider), {\n      getKeyboardNavigationLabel(node) {\n        return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(node.element);\n      }\n\n    }),\n    enableKeyboardNavigation: options.simpleKeyboardNavigation\n  });\n}\n\nexport class ComposedTreeDelegate {\n  constructor(delegate) {\n    this.delegate = delegate;\n  }\n\n  getHeight(element) {\n    return this.delegate.getHeight(element.element);\n  }\n\n  getTemplateId(element) {\n    return this.delegate.getTemplateId(element.element);\n  }\n\n  hasDynamicHeight(element) {\n    return !!this.delegate.hasDynamicHeight && this.delegate.hasDynamicHeight(element.element);\n  }\n\n  setDynamicHeight(element, height) {\n    if (this.delegate.setDynamicHeight) {\n      this.delegate.setDynamicHeight(element.element, height);\n    }\n  }\n\n}\nexport var RenderIndentGuides;\n\n(function (RenderIndentGuides) {\n  RenderIndentGuides[\"None\"] = \"none\";\n  RenderIndentGuides[\"OnHover\"] = \"onHover\";\n  RenderIndentGuides[\"Always\"] = \"always\";\n})(RenderIndentGuides || (RenderIndentGuides = {}));\n\nclass EventCollection {\n  constructor(onDidChange) {\n    let _elements = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n    this._elements = _elements;\n    this.onDidChange = Event.forEach(onDidChange, elements => this._elements = elements);\n  }\n\n  get elements() {\n    return this._elements;\n  }\n\n}\n\nclass TreeRenderer {\n  constructor(renderer, modelProvider, onDidChangeCollapseState, activeNodes) {\n    let options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    this.renderer = renderer;\n    this.modelProvider = modelProvider;\n    this.activeNodes = activeNodes;\n    this.renderedElements = new Map();\n    this.renderedNodes = new Map();\n    this.indent = TreeRenderer.DefaultIndent;\n    this.hideTwistiesOfChildlessElements = false;\n    this.shouldRenderIndentGuides = false;\n    this.renderedIndentGuides = new SetMap();\n    this.activeIndentNodes = new Set();\n    this.indentGuidesDisposable = Disposable.None;\n    this.disposables = new DisposableStore();\n    this.templateId = renderer.templateId;\n    this.updateOptions(options);\n    Event.map(onDidChangeCollapseState, e => e.node)(this.onDidChangeNodeTwistieState, this, this.disposables);\n\n    if (renderer.onDidChangeTwistieState) {\n      renderer.onDidChangeTwistieState(this.onDidChangeTwistieState, this, this.disposables);\n    }\n  }\n\n  updateOptions() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (typeof options.indent !== 'undefined') {\n      this.indent = clamp(options.indent, 0, 40);\n    }\n\n    if (typeof options.renderIndentGuides !== 'undefined') {\n      const shouldRenderIndentGuides = options.renderIndentGuides !== RenderIndentGuides.None;\n\n      if (shouldRenderIndentGuides !== this.shouldRenderIndentGuides) {\n        this.shouldRenderIndentGuides = shouldRenderIndentGuides;\n        this.indentGuidesDisposable.dispose();\n\n        if (shouldRenderIndentGuides) {\n          const disposables = new DisposableStore();\n          this.activeNodes.onDidChange(this._onDidChangeActiveNodes, this, disposables);\n          this.indentGuidesDisposable = disposables;\n\n          this._onDidChangeActiveNodes(this.activeNodes.elements);\n        }\n      }\n    }\n\n    if (typeof options.hideTwistiesOfChildlessElements !== 'undefined') {\n      this.hideTwistiesOfChildlessElements = options.hideTwistiesOfChildlessElements;\n    }\n  }\n\n  renderTemplate(container) {\n    const el = append(container, $('.monaco-tl-row'));\n    const indent = append(el, $('.monaco-tl-indent'));\n    const twistie = append(el, $('.monaco-tl-twistie'));\n    const contents = append(el, $('.monaco-tl-contents'));\n    const templateData = this.renderer.renderTemplate(contents);\n    return {\n      container,\n      indent,\n      twistie,\n      indentGuidesDisposable: Disposable.None,\n      templateData\n    };\n  }\n\n  renderElement(node, index, templateData, height) {\n    if (typeof height === 'number') {\n      this.renderedNodes.set(node, {\n        templateData,\n        height\n      });\n      this.renderedElements.set(node.element, node);\n    }\n\n    const indent = TreeRenderer.DefaultIndent + (node.depth - 1) * this.indent;\n    templateData.twistie.style.paddingLeft = `${indent}px`;\n    templateData.indent.style.width = `${indent + this.indent - 16}px`;\n    this.renderTwistie(node, templateData);\n\n    if (typeof height === 'number') {\n      this.renderIndentGuides(node, templateData);\n    }\n\n    this.renderer.renderElement(node, index, templateData.templateData, height);\n  }\n\n  disposeElement(node, index, templateData, height) {\n    templateData.indentGuidesDisposable.dispose();\n\n    if (this.renderer.disposeElement) {\n      this.renderer.disposeElement(node, index, templateData.templateData, height);\n    }\n\n    if (typeof height === 'number') {\n      this.renderedNodes.delete(node);\n      this.renderedElements.delete(node.element);\n    }\n  }\n\n  disposeTemplate(templateData) {\n    this.renderer.disposeTemplate(templateData.templateData);\n  }\n\n  onDidChangeTwistieState(element) {\n    const node = this.renderedElements.get(element);\n\n    if (!node) {\n      return;\n    }\n\n    this.onDidChangeNodeTwistieState(node);\n  }\n\n  onDidChangeNodeTwistieState(node) {\n    const data = this.renderedNodes.get(node);\n\n    if (!data) {\n      return;\n    }\n\n    this.renderTwistie(node, data.templateData);\n\n    this._onDidChangeActiveNodes(this.activeNodes.elements);\n\n    this.renderIndentGuides(node, data.templateData);\n  }\n\n  renderTwistie(node, templateData) {\n    templateData.twistie.classList.remove(...treeItemExpandedIcon.classNamesArray);\n    let twistieRendered = false;\n\n    if (this.renderer.renderTwistie) {\n      twistieRendered = this.renderer.renderTwistie(node.element, templateData.twistie);\n    }\n\n    if (node.collapsible && (!this.hideTwistiesOfChildlessElements || node.visibleChildrenCount > 0)) {\n      if (!twistieRendered) {\n        templateData.twistie.classList.add(...treeItemExpandedIcon.classNamesArray);\n      }\n\n      templateData.twistie.classList.add('collapsible');\n      templateData.twistie.classList.toggle('collapsed', node.collapsed);\n    } else {\n      templateData.twistie.classList.remove('collapsible', 'collapsed');\n    }\n\n    if (node.collapsible) {\n      templateData.container.setAttribute('aria-expanded', String(!node.collapsed));\n    } else {\n      templateData.container.removeAttribute('aria-expanded');\n    }\n  }\n\n  renderIndentGuides(target, templateData) {\n    clearNode(templateData.indent);\n    templateData.indentGuidesDisposable.dispose();\n\n    if (!this.shouldRenderIndentGuides) {\n      return;\n    }\n\n    const disposableStore = new DisposableStore();\n    const model = this.modelProvider();\n    let node = target;\n\n    while (true) {\n      const ref = model.getNodeLocation(node);\n      const parentRef = model.getParentNodeLocation(ref);\n\n      if (!parentRef) {\n        break;\n      }\n\n      const parent = model.getNode(parentRef);\n      const guide = $('.indent-guide', {\n        style: `width: ${this.indent}px`\n      });\n\n      if (this.activeIndentNodes.has(parent)) {\n        guide.classList.add('active');\n      }\n\n      if (templateData.indent.childElementCount === 0) {\n        templateData.indent.appendChild(guide);\n      } else {\n        templateData.indent.insertBefore(guide, templateData.indent.firstElementChild);\n      }\n\n      this.renderedIndentGuides.add(parent, guide);\n      disposableStore.add(toDisposable(() => this.renderedIndentGuides.delete(parent, guide)));\n      node = parent;\n    }\n\n    templateData.indentGuidesDisposable = disposableStore;\n  }\n\n  _onDidChangeActiveNodes(nodes) {\n    if (!this.shouldRenderIndentGuides) {\n      return;\n    }\n\n    const set = new Set();\n    const model = this.modelProvider();\n    nodes.forEach(node => {\n      const ref = model.getNodeLocation(node);\n\n      try {\n        const parentRef = model.getParentNodeLocation(ref);\n\n        if (node.collapsible && node.children.length > 0 && !node.collapsed) {\n          set.add(node);\n        } else if (parentRef) {\n          set.add(model.getNode(parentRef));\n        }\n      } catch (_a) {// noop\n      }\n    });\n    this.activeIndentNodes.forEach(node => {\n      if (!set.has(node)) {\n        this.renderedIndentGuides.forEach(node, line => line.classList.remove('active'));\n      }\n    });\n    set.forEach(node => {\n      if (!this.activeIndentNodes.has(node)) {\n        this.renderedIndentGuides.forEach(node, line => line.classList.add('active'));\n      }\n    });\n    this.activeIndentNodes = set;\n  }\n\n  dispose() {\n    this.renderedNodes.clear();\n    this.renderedElements.clear();\n    this.indentGuidesDisposable.dispose();\n    dispose(this.disposables);\n  }\n\n}\n\nTreeRenderer.DefaultIndent = 8;\n\nclass TypeFilter {\n  constructor(tree, keyboardNavigationLabelProvider, _filter) {\n    this.tree = tree;\n    this.keyboardNavigationLabelProvider = keyboardNavigationLabelProvider;\n    this._filter = _filter;\n    this._totalCount = 0;\n    this._matchCount = 0;\n    this._pattern = '';\n    this._lowercasePattern = '';\n    this.disposables = new DisposableStore();\n    tree.onWillRefilter(this.reset, this, this.disposables);\n  }\n\n  get totalCount() {\n    return this._totalCount;\n  }\n\n  get matchCount() {\n    return this._matchCount;\n  }\n\n  set pattern(pattern) {\n    this._pattern = pattern;\n    this._lowercasePattern = pattern.toLowerCase();\n  }\n\n  filter(element, parentVisibility) {\n    if (this._filter) {\n      const result = this._filter.filter(element, parentVisibility);\n\n      if (this.tree.options.simpleKeyboardNavigation) {\n        return result;\n      }\n\n      let visibility;\n\n      if (typeof result === 'boolean') {\n        visibility = result ? 1\n        /* Visible */\n        : 0\n        /* Hidden */\n        ;\n      } else if (isFilterResult(result)) {\n        visibility = getVisibleState(result.visibility);\n      } else {\n        visibility = result;\n      }\n\n      if (visibility === 0\n      /* Hidden */\n      ) {\n        return false;\n      }\n    }\n\n    this._totalCount++;\n\n    if (this.tree.options.simpleKeyboardNavigation || !this._pattern) {\n      this._matchCount++;\n      return {\n        data: FuzzyScore.Default,\n        visibility: true\n      };\n    }\n\n    const label = this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(element);\n    const labels = Array.isArray(label) ? label : [label];\n\n    for (const l of labels) {\n      const labelStr = l && l.toString();\n\n      if (typeof labelStr === 'undefined') {\n        return {\n          data: FuzzyScore.Default,\n          visibility: true\n        };\n      }\n\n      const score = fuzzyScore(this._pattern, this._lowercasePattern, 0, labelStr, labelStr.toLowerCase(), 0, true);\n\n      if (score) {\n        this._matchCount++;\n        return labels.length === 1 ? {\n          data: score,\n          visibility: true\n        } : {\n          data: {\n            label: labelStr,\n            score: score\n          },\n          visibility: true\n        };\n      }\n    }\n\n    if (this.tree.options.filterOnType) {\n      return 2\n      /* Recurse */\n      ;\n    } else {\n      return {\n        data: FuzzyScore.Default,\n        visibility: true\n      };\n    }\n  }\n\n  reset() {\n    this._totalCount = 0;\n    this._matchCount = 0;\n  }\n\n  dispose() {\n    dispose(this.disposables);\n  }\n\n}\n\nclass TypeFilterController {\n  constructor(tree, model, view, filter, keyboardNavigationDelegate) {\n    this.tree = tree;\n    this.view = view;\n    this.filter = filter;\n    this.keyboardNavigationDelegate = keyboardNavigationDelegate;\n    this._enabled = false;\n    this._pattern = '';\n    this._empty = false;\n    this._onDidChangeEmptyState = new Emitter();\n    this.positionClassName = 'ne';\n    this.automaticKeyboardNavigation = true;\n    this.triggered = false;\n    this._onDidChangePattern = new Emitter();\n    this.enabledDisposables = new DisposableStore();\n    this.disposables = new DisposableStore();\n    this.domNode = $(`.monaco-list-type-filter.${this.positionClassName}`);\n    this.domNode.draggable = true;\n    this.disposables.add(addDisposableListener(this.domNode, 'dragstart', () => this.onDragStart()));\n    this.messageDomNode = append(view.getHTMLElement(), $(`.monaco-list-type-filter-message`));\n    this.labelDomNode = append(this.domNode, $('span.label'));\n    const controls = append(this.domNode, $('.controls'));\n    this._filterOnType = !!tree.options.filterOnType;\n    this.filterOnTypeDomNode = append(controls, $('input.filter'));\n    this.filterOnTypeDomNode.type = 'checkbox';\n    this.filterOnTypeDomNode.checked = this._filterOnType;\n    this.filterOnTypeDomNode.tabIndex = -1;\n    this.updateFilterOnTypeTitleAndIcon();\n    this.disposables.add(addDisposableListener(this.filterOnTypeDomNode, 'input', () => this.onDidChangeFilterOnType()));\n    this.clearDomNode = append(controls, $('button.clear' + treeFilterClearIcon.cssSelector));\n    this.clearDomNode.tabIndex = -1;\n    this.clearDomNode.title = localize('clear', \"Clear\");\n    this.keyboardNavigationEventFilter = tree.options.keyboardNavigationEventFilter;\n    model.onDidSplice(this.onDidSpliceModel, this, this.disposables);\n    this.updateOptions(tree.options);\n  }\n\n  get enabled() {\n    return this._enabled;\n  }\n\n  get pattern() {\n    return this._pattern;\n  }\n\n  get filterOnType() {\n    return this._filterOnType;\n  }\n\n  updateOptions(options) {\n    if (options.simpleKeyboardNavigation) {\n      this.disable();\n    } else {\n      this.enable();\n    }\n\n    if (typeof options.filterOnType !== 'undefined') {\n      this._filterOnType = !!options.filterOnType;\n      this.filterOnTypeDomNode.checked = this._filterOnType;\n      this.updateFilterOnTypeTitleAndIcon();\n    }\n\n    if (typeof options.automaticKeyboardNavigation !== 'undefined') {\n      this.automaticKeyboardNavigation = options.automaticKeyboardNavigation;\n    }\n\n    this.tree.refilter();\n    this.render();\n\n    if (!this.automaticKeyboardNavigation) {\n      this.onEventOrInput('');\n    }\n  }\n\n  enable() {\n    if (this._enabled) {\n      return;\n    }\n\n    const onRawKeyDown = this.enabledDisposables.add(new DomEmitter(this.view.getHTMLElement(), 'keydown'));\n    const onKeyDown = Event.chain(onRawKeyDown.event).filter(e => !isInputElement(e.target) || e.target === this.filterOnTypeDomNode).filter(e => e.key !== 'Dead' && !/^Media/.test(e.key)).map(e => new StandardKeyboardEvent(e)).filter(this.keyboardNavigationEventFilter || (() => true)).filter(() => this.automaticKeyboardNavigation || this.triggered).filter(e => this.keyboardNavigationDelegate.mightProducePrintableCharacter(e) && !(e.keyCode === 18\n    /* DownArrow */\n    || e.keyCode === 16\n    /* UpArrow */\n    || e.keyCode === 15\n    /* LeftArrow */\n    || e.keyCode === 17\n    /* RightArrow */\n    ) || (this.pattern.length > 0 || this.triggered) && (e.keyCode === 9\n    /* Escape */\n    || e.keyCode === 1\n    /* Backspace */\n    ) && !e.altKey && !e.ctrlKey && !e.metaKey || e.keyCode === 1\n    /* Backspace */\n    && (isMacintosh ? e.altKey && !e.metaKey : e.ctrlKey) && !e.shiftKey).forEach(e => {\n      e.stopPropagation();\n      e.preventDefault();\n    }).event;\n    const onClearClick = this.enabledDisposables.add(new DomEmitter(this.clearDomNode, 'click'));\n    Event.chain(Event.any(onKeyDown, onClearClick.event)).event(this.onEventOrInput, this, this.enabledDisposables);\n    this.filter.pattern = '';\n    this.tree.refilter();\n    this.render();\n    this._enabled = true;\n    this.triggered = false;\n  }\n\n  disable() {\n    if (!this._enabled) {\n      return;\n    }\n\n    this.domNode.remove();\n    this.enabledDisposables.clear();\n    this.tree.refilter();\n    this.render();\n    this._enabled = false;\n    this.triggered = false;\n  }\n\n  onEventOrInput(e) {\n    if (typeof e === 'string') {\n      this.onInput(e);\n    } else if (e instanceof MouseEvent || e.keyCode === 9\n    /* Escape */\n    || e.keyCode === 1\n    /* Backspace */\n    && (isMacintosh ? e.altKey : e.ctrlKey)) {\n      this.onInput('');\n    } else if (e.keyCode === 1\n    /* Backspace */\n    ) {\n      this.onInput(this.pattern.length === 0 ? '' : this.pattern.substr(0, this.pattern.length - 1));\n    } else {\n      this.onInput(this.pattern + e.browserEvent.key);\n    }\n  }\n\n  onInput(pattern) {\n    const container = this.view.getHTMLElement();\n\n    if (pattern && !this.domNode.parentElement) {\n      container.append(this.domNode);\n    } else if (!pattern && this.domNode.parentElement) {\n      this.domNode.remove();\n      this.tree.domFocus();\n    }\n\n    this._pattern = pattern;\n\n    this._onDidChangePattern.fire(pattern);\n\n    this.filter.pattern = pattern;\n    this.tree.refilter();\n\n    if (pattern) {\n      this.tree.focusNext(0, true, undefined, node => !FuzzyScore.isDefault(node.filterData));\n    }\n\n    const focus = this.tree.getFocus();\n\n    if (focus.length > 0) {\n      const element = focus[0];\n\n      if (this.tree.getRelativeTop(element) === null) {\n        this.tree.reveal(element, 0.5);\n      }\n    }\n\n    this.render();\n\n    if (!pattern) {\n      this.triggered = false;\n    }\n  }\n\n  onDragStart() {\n    const container = this.view.getHTMLElement();\n    const {\n      left\n    } = getDomNodePagePosition(container);\n    const containerWidth = container.clientWidth;\n    const midContainerWidth = containerWidth / 2;\n    const width = this.domNode.clientWidth;\n    const disposables = new DisposableStore();\n    let positionClassName = this.positionClassName;\n\n    const updatePosition = () => {\n      switch (positionClassName) {\n        case 'nw':\n          this.domNode.style.top = `4px`;\n          this.domNode.style.left = `4px`;\n          break;\n\n        case 'ne':\n          this.domNode.style.top = `4px`;\n          this.domNode.style.left = `${containerWidth - width - 6}px`;\n          break;\n      }\n    };\n\n    const onDragOver = event => {\n      event.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n      const x = event.clientX - left;\n\n      if (event.dataTransfer) {\n        event.dataTransfer.dropEffect = 'none';\n      }\n\n      if (x < midContainerWidth) {\n        positionClassName = 'nw';\n      } else {\n        positionClassName = 'ne';\n      }\n\n      updatePosition();\n    };\n\n    const onDragEnd = () => {\n      this.positionClassName = positionClassName;\n      this.domNode.className = `monaco-list-type-filter ${this.positionClassName}`;\n      this.domNode.style.top = '';\n      this.domNode.style.left = '';\n      dispose(disposables);\n    };\n\n    updatePosition();\n    this.domNode.classList.remove(positionClassName);\n    this.domNode.classList.add('dragging');\n    disposables.add(toDisposable(() => this.domNode.classList.remove('dragging')));\n    disposables.add(addDisposableListener(document, 'dragover', e => onDragOver(e)));\n    disposables.add(addDisposableListener(this.domNode, 'dragend', () => onDragEnd()));\n    StaticDND.CurrentDragAndDropData = new DragAndDropData('vscode-ui');\n    disposables.add(toDisposable(() => StaticDND.CurrentDragAndDropData = undefined));\n  }\n\n  onDidSpliceModel() {\n    if (!this._enabled || this.pattern.length === 0) {\n      return;\n    }\n\n    this.tree.refilter();\n    this.render();\n  }\n\n  onDidChangeFilterOnType() {\n    this.tree.updateOptions({\n      filterOnType: this.filterOnTypeDomNode.checked\n    });\n    this.tree.refilter();\n    this.tree.domFocus();\n    this.render();\n    this.updateFilterOnTypeTitleAndIcon();\n  }\n\n  updateFilterOnTypeTitleAndIcon() {\n    if (this.filterOnType) {\n      this.filterOnTypeDomNode.classList.remove(...treeFilterOnTypeOffIcon.classNamesArray);\n      this.filterOnTypeDomNode.classList.add(...treeFilterOnTypeOnIcon.classNamesArray);\n      this.filterOnTypeDomNode.title = localize('disable filter on type', \"Disable Filter on Type\");\n    } else {\n      this.filterOnTypeDomNode.classList.remove(...treeFilterOnTypeOnIcon.classNamesArray);\n      this.filterOnTypeDomNode.classList.add(...treeFilterOnTypeOffIcon.classNamesArray);\n      this.filterOnTypeDomNode.title = localize('enable filter on type', \"Enable Filter on Type\");\n    }\n  }\n\n  render() {\n    const noMatches = this.filter.totalCount > 0 && this.filter.matchCount === 0;\n\n    if (this.pattern && this.tree.options.filterOnType && noMatches) {\n      this.messageDomNode.textContent = localize('empty', \"No elements found\");\n      this._empty = true;\n    } else {\n      this.messageDomNode.innerText = '';\n      this._empty = false;\n    }\n\n    this.domNode.classList.toggle('no-matches', noMatches);\n    this.domNode.title = localize('found', \"Matched {0} out of {1} elements\", this.filter.matchCount, this.filter.totalCount);\n    this.labelDomNode.textContent = this.pattern.length > 16 ? 'â€¦' + this.pattern.substr(this.pattern.length - 16) : this.pattern;\n\n    this._onDidChangeEmptyState.fire(this._empty);\n  }\n\n  shouldAllowFocus(node) {\n    if (!this.enabled || !this.pattern || this.filterOnType) {\n      return true;\n    }\n\n    if (this.filter.totalCount > 0 && this.filter.matchCount <= 1) {\n      return true;\n    }\n\n    return !FuzzyScore.isDefault(node.filterData);\n  }\n\n  dispose() {\n    if (this._enabled) {\n      this.domNode.remove();\n      this.enabledDisposables.dispose();\n      this._enabled = false;\n      this.triggered = false;\n    }\n\n    this._onDidChangePattern.dispose();\n\n    dispose(this.disposables);\n  }\n\n}\n\nfunction asTreeMouseEvent(event) {\n  let target = TreeMouseEventTarget.Unknown;\n\n  if (hasParentWithClass(event.browserEvent.target, 'monaco-tl-twistie', 'monaco-tl-row')) {\n    target = TreeMouseEventTarget.Twistie;\n  } else if (hasParentWithClass(event.browserEvent.target, 'monaco-tl-contents', 'monaco-tl-row')) {\n    target = TreeMouseEventTarget.Element;\n  }\n\n  return {\n    browserEvent: event.browserEvent,\n    element: event.element ? event.element.element : null,\n    target\n  };\n}\n\nfunction dfs(node, fn) {\n  fn(node);\n  node.children.forEach(child => dfs(child, fn));\n}\n/**\n * The trait concept needs to exist at the tree level, because collapsed\n * tree nodes will not be known by the list.\n */\n\n\nclass Trait {\n  constructor(getFirstViewElementWithTrait, identityProvider) {\n    this.getFirstViewElementWithTrait = getFirstViewElementWithTrait;\n    this.identityProvider = identityProvider;\n    this.nodes = [];\n    this._onDidChange = new Emitter();\n    this.onDidChange = this._onDidChange.event;\n  }\n\n  get nodeSet() {\n    if (!this._nodeSet) {\n      this._nodeSet = this.createNodeSet();\n    }\n\n    return this._nodeSet;\n  }\n\n  set(nodes, browserEvent) {\n    var _a;\n\n    if (!((_a = browserEvent) === null || _a === void 0 ? void 0 : _a.__forceEvent) && equals(this.nodes, nodes)) {\n      return;\n    }\n\n    this._set(nodes, false, browserEvent);\n  }\n\n  _set(nodes, silent, browserEvent) {\n    this.nodes = [...nodes];\n    this.elements = undefined;\n    this._nodeSet = undefined;\n\n    if (!silent) {\n      const that = this;\n\n      this._onDidChange.fire({\n        get elements() {\n          return that.get();\n        },\n\n        browserEvent\n      });\n    }\n  }\n\n  get() {\n    if (!this.elements) {\n      this.elements = this.nodes.map(node => node.element);\n    }\n\n    return [...this.elements];\n  }\n\n  getNodes() {\n    return this.nodes;\n  }\n\n  has(node) {\n    return this.nodeSet.has(node);\n  }\n\n  onDidModelSplice(_ref) {\n    let {\n      insertedNodes,\n      deletedNodes\n    } = _ref;\n\n    if (!this.identityProvider) {\n      const set = this.createNodeSet();\n\n      const visit = node => set.delete(node);\n\n      deletedNodes.forEach(node => dfs(node, visit));\n      this.set([...set.values()]);\n      return;\n    }\n\n    const deletedNodesIdSet = new Set();\n\n    const deletedNodesVisitor = node => deletedNodesIdSet.add(this.identityProvider.getId(node.element).toString());\n\n    deletedNodes.forEach(node => dfs(node, deletedNodesVisitor));\n    const insertedNodesMap = new Map();\n\n    const insertedNodesVisitor = node => insertedNodesMap.set(this.identityProvider.getId(node.element).toString(), node);\n\n    insertedNodes.forEach(node => dfs(node, insertedNodesVisitor));\n    const nodes = [];\n\n    for (const node of this.nodes) {\n      const id = this.identityProvider.getId(node.element).toString();\n      const wasDeleted = deletedNodesIdSet.has(id);\n\n      if (!wasDeleted) {\n        nodes.push(node);\n      } else {\n        const insertedNode = insertedNodesMap.get(id);\n\n        if (insertedNode) {\n          nodes.push(insertedNode);\n        }\n      }\n    }\n\n    if (this.nodes.length > 0 && nodes.length === 0) {\n      const node = this.getFirstViewElementWithTrait();\n\n      if (node) {\n        nodes.push(node);\n      }\n    }\n\n    this._set(nodes, true);\n  }\n\n  createNodeSet() {\n    const set = new Set();\n\n    for (const node of this.nodes) {\n      set.add(node);\n    }\n\n    return set;\n  }\n\n}\n\nclass TreeNodeListMouseController extends MouseController {\n  constructor(list, tree) {\n    super(list);\n    this.tree = tree;\n  }\n\n  onViewPointer(e) {\n    if (isInputElement(e.browserEvent.target) || isMonacoEditor(e.browserEvent.target)) {\n      return;\n    }\n\n    const node = e.element;\n\n    if (!node) {\n      return super.onViewPointer(e);\n    }\n\n    if (this.isSelectionRangeChangeEvent(e) || this.isSelectionSingleChangeEvent(e)) {\n      return super.onViewPointer(e);\n    }\n\n    const target = e.browserEvent.target;\n    const onTwistie = target.classList.contains('monaco-tl-twistie') || target.classList.contains('monaco-icon-label') && target.classList.contains('folder-icon') && e.browserEvent.offsetX < 16;\n    let expandOnlyOnTwistieClick = false;\n\n    if (typeof this.tree.expandOnlyOnTwistieClick === 'function') {\n      expandOnlyOnTwistieClick = this.tree.expandOnlyOnTwistieClick(node.element);\n    } else {\n      expandOnlyOnTwistieClick = !!this.tree.expandOnlyOnTwistieClick;\n    }\n\n    if (expandOnlyOnTwistieClick && !onTwistie && e.browserEvent.detail !== 2) {\n      return super.onViewPointer(e);\n    }\n\n    if (!this.tree.expandOnDoubleClick && e.browserEvent.detail === 2) {\n      return super.onViewPointer(e);\n    }\n\n    if (node.collapsible) {\n      const model = this.tree.model; // internal\n\n      const location = model.getNodeLocation(node);\n      const recursive = e.browserEvent.altKey;\n      this.tree.setFocus([location]);\n      model.setCollapsed(location, undefined, recursive);\n\n      if (expandOnlyOnTwistieClick && onTwistie) {\n        return;\n      }\n    }\n\n    super.onViewPointer(e);\n  }\n\n  onDoubleClick(e) {\n    const onTwistie = e.browserEvent.target.classList.contains('monaco-tl-twistie');\n\n    if (onTwistie || !this.tree.expandOnDoubleClick) {\n      return;\n    }\n\n    super.onDoubleClick(e);\n  }\n\n}\n/**\n * We use this List subclass to restore selection and focus as nodes\n * get rendered in the list, possibly due to a node expand() call.\n */\n\n\nclass TreeNodeList extends List {\n  constructor(user, container, virtualDelegate, renderers, focusTrait, selectionTrait, anchorTrait, options) {\n    super(user, container, virtualDelegate, renderers, options);\n    this.focusTrait = focusTrait;\n    this.selectionTrait = selectionTrait;\n    this.anchorTrait = anchorTrait;\n  }\n\n  createMouseController(options) {\n    return new TreeNodeListMouseController(this, options.tree);\n  }\n\n  splice(start, deleteCount) {\n    let elements = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    super.splice(start, deleteCount, elements);\n\n    if (elements.length === 0) {\n      return;\n    }\n\n    const additionalFocus = [];\n    const additionalSelection = [];\n    let anchor;\n    elements.forEach((node, index) => {\n      if (this.focusTrait.has(node)) {\n        additionalFocus.push(start + index);\n      }\n\n      if (this.selectionTrait.has(node)) {\n        additionalSelection.push(start + index);\n      }\n\n      if (this.anchorTrait.has(node)) {\n        anchor = start + index;\n      }\n    });\n\n    if (additionalFocus.length > 0) {\n      super.setFocus(distinct([...super.getFocus(), ...additionalFocus]));\n    }\n\n    if (additionalSelection.length > 0) {\n      super.setSelection(distinct([...super.getSelection(), ...additionalSelection]));\n    }\n\n    if (typeof anchor === 'number') {\n      super.setAnchor(anchor);\n    }\n  }\n\n  setFocus(indexes, browserEvent) {\n    let fromAPI = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    super.setFocus(indexes, browserEvent);\n\n    if (!fromAPI) {\n      this.focusTrait.set(indexes.map(i => this.element(i)), browserEvent);\n    }\n  }\n\n  setSelection(indexes, browserEvent) {\n    let fromAPI = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    super.setSelection(indexes, browserEvent);\n\n    if (!fromAPI) {\n      this.selectionTrait.set(indexes.map(i => this.element(i)), browserEvent);\n    }\n  }\n\n  setAnchor(index) {\n    let fromAPI = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    super.setAnchor(index);\n\n    if (!fromAPI) {\n      if (typeof index === 'undefined') {\n        this.anchorTrait.set([]);\n      } else {\n        this.anchorTrait.set([this.element(index)]);\n      }\n    }\n  }\n\n}\n\nexport class AbstractTree {\n  constructor(user, container, delegate, renderers) {\n    let _options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n\n    this._options = _options;\n    this.eventBufferer = new EventBufferer();\n    this.disposables = new DisposableStore();\n    this._onWillRefilter = new Emitter();\n    this.onWillRefilter = this._onWillRefilter.event;\n    this._onDidUpdateOptions = new Emitter();\n    const treeDelegate = new ComposedTreeDelegate(delegate);\n    const onDidChangeCollapseStateRelay = new Relay();\n    const onDidChangeActiveNodes = new Relay();\n    const activeNodes = new EventCollection(onDidChangeActiveNodes.event);\n    this.renderers = renderers.map(r => new TreeRenderer(r, () => this.model, onDidChangeCollapseStateRelay.event, activeNodes, _options));\n\n    for (let r of this.renderers) {\n      this.disposables.add(r);\n    }\n\n    let filter;\n\n    if (_options.keyboardNavigationLabelProvider) {\n      filter = new TypeFilter(this, _options.keyboardNavigationLabelProvider, _options.filter);\n      _options = Object.assign(Object.assign({}, _options), {\n        filter: filter\n      }); // TODO need typescript help here\n\n      this.disposables.add(filter);\n    }\n\n    this.focus = new Trait(() => this.view.getFocusedElements()[0], _options.identityProvider);\n    this.selection = new Trait(() => this.view.getSelectedElements()[0], _options.identityProvider);\n    this.anchor = new Trait(() => this.view.getAnchorElement(), _options.identityProvider);\n    this.view = new TreeNodeList(user, container, treeDelegate, this.renderers, this.focus, this.selection, this.anchor, Object.assign(Object.assign({}, asListOptions(() => this.model, _options)), {\n      tree: this\n    }));\n    this.model = this.createModel(user, this.view, _options);\n    onDidChangeCollapseStateRelay.input = this.model.onDidChangeCollapseState;\n    const onDidModelSplice = Event.forEach(this.model.onDidSplice, e => {\n      this.eventBufferer.bufferEvents(() => {\n        this.focus.onDidModelSplice(e);\n        this.selection.onDidModelSplice(e);\n      });\n    }); // Make sure the `forEach` always runs\n\n    onDidModelSplice(() => null, null, this.disposables); // Active nodes can change when the model changes or when focus or selection change.\n    // We debounce it with 0 delay since these events may fire in the same stack and we only\n    // want to run this once. It also doesn't matter if it runs on the next tick since it's only\n    // a nice to have UI feature.\n\n    onDidChangeActiveNodes.input = Event.chain(Event.any(onDidModelSplice, this.focus.onDidChange, this.selection.onDidChange)).debounce(() => null, 0).map(() => {\n      const set = new Set();\n\n      for (const node of this.focus.getNodes()) {\n        set.add(node);\n      }\n\n      for (const node of this.selection.getNodes()) {\n        set.add(node);\n      }\n\n      return [...set.values()];\n    }).event;\n\n    if (_options.keyboardSupport !== false) {\n      const onKeyDown = Event.chain(this.view.onKeyDown).filter(e => !isInputElement(e.target)).map(e => new StandardKeyboardEvent(e));\n      onKeyDown.filter(e => e.keyCode === 15\n      /* LeftArrow */\n      ).on(this.onLeftArrow, this, this.disposables);\n      onKeyDown.filter(e => e.keyCode === 17\n      /* RightArrow */\n      ).on(this.onRightArrow, this, this.disposables);\n      onKeyDown.filter(e => e.keyCode === 10\n      /* Space */\n      ).on(this.onSpace, this, this.disposables);\n    }\n\n    if (_options.keyboardNavigationLabelProvider) {\n      const delegate = _options.keyboardNavigationDelegate || DefaultKeyboardNavigationDelegate;\n      this.typeFilterController = new TypeFilterController(this, this.model, this.view, filter, delegate);\n\n      this.focusNavigationFilter = node => this.typeFilterController.shouldAllowFocus(node);\n\n      this.disposables.add(this.typeFilterController);\n    }\n\n    this.styleElement = createStyleSheet(this.view.getHTMLElement());\n    this.getHTMLElement().classList.toggle('always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n  }\n\n  get onDidChangeFocus() {\n    return this.eventBufferer.wrapEvent(this.focus.onDidChange);\n  }\n\n  get onDidChangeSelection() {\n    return this.eventBufferer.wrapEvent(this.selection.onDidChange);\n  }\n\n  get onMouseDblClick() {\n    return Event.map(this.view.onMouseDblClick, asTreeMouseEvent);\n  }\n\n  get onPointer() {\n    return Event.map(this.view.onPointer, asTreeMouseEvent);\n  }\n\n  get onDidFocus() {\n    return this.view.onDidFocus;\n  }\n\n  get onDidChangeCollapseState() {\n    return this.model.onDidChangeCollapseState;\n  }\n\n  get expandOnDoubleClick() {\n    return typeof this._options.expandOnDoubleClick === 'undefined' ? true : this._options.expandOnDoubleClick;\n  }\n\n  get expandOnlyOnTwistieClick() {\n    return typeof this._options.expandOnlyOnTwistieClick === 'undefined' ? true : this._options.expandOnlyOnTwistieClick;\n  }\n\n  get onDidDispose() {\n    return this.view.onDidDispose;\n  }\n\n  updateOptions() {\n    let optionsUpdate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this._options = Object.assign(Object.assign({}, this._options), optionsUpdate);\n\n    for (const renderer of this.renderers) {\n      renderer.updateOptions(optionsUpdate);\n    }\n\n    this.view.updateOptions(Object.assign(Object.assign({}, this._options), {\n      enableKeyboardNavigation: this._options.simpleKeyboardNavigation\n    }));\n\n    if (this.typeFilterController) {\n      this.typeFilterController.updateOptions(this._options);\n    }\n\n    this._onDidUpdateOptions.fire(this._options);\n\n    this.getHTMLElement().classList.toggle('always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n  }\n\n  get options() {\n    return this._options;\n  } // Widget\n\n\n  getHTMLElement() {\n    return this.view.getHTMLElement();\n  }\n\n  get scrollTop() {\n    return this.view.scrollTop;\n  }\n\n  set scrollTop(scrollTop) {\n    this.view.scrollTop = scrollTop;\n  }\n\n  domFocus() {\n    this.view.domFocus();\n  }\n\n  layout(height, width) {\n    this.view.layout(height, width);\n  }\n\n  style(styles) {\n    const suffix = `.${this.view.domId}`;\n    const content = [];\n\n    if (styles.treeIndentGuidesStroke) {\n      content.push(`.monaco-list${suffix}:hover .monaco-tl-indent > .indent-guide, .monaco-list${suffix}.always .monaco-tl-indent > .indent-guide  { border-color: ${styles.treeIndentGuidesStroke.transparent(0.4)}; }`);\n      content.push(`.monaco-list${suffix} .monaco-tl-indent > .indent-guide.active { border-color: ${styles.treeIndentGuidesStroke}; }`);\n    }\n\n    this.styleElement.textContent = content.join('\\n');\n    this.view.style(styles);\n  }\n\n  collapse(location) {\n    let recursive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    return this.model.setCollapsed(location, true, recursive);\n  }\n\n  expand(location) {\n    let recursive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    return this.model.setCollapsed(location, false, recursive);\n  }\n\n  isCollapsible(location) {\n    return this.model.isCollapsible(location);\n  }\n\n  setCollapsible(location, collapsible) {\n    return this.model.setCollapsible(location, collapsible);\n  }\n\n  isCollapsed(location) {\n    return this.model.isCollapsed(location);\n  }\n\n  refilter() {\n    this._onWillRefilter.fire(undefined);\n\n    this.model.refilter();\n  }\n\n  setSelection(elements, browserEvent) {\n    const nodes = elements.map(e => this.model.getNode(e));\n    this.selection.set(nodes, browserEvent);\n    const indexes = elements.map(e => this.model.getListIndex(e)).filter(i => i > -1);\n    this.view.setSelection(indexes, browserEvent, true);\n  }\n\n  getSelection() {\n    return this.selection.get();\n  }\n\n  setFocus(elements, browserEvent) {\n    const nodes = elements.map(e => this.model.getNode(e));\n    this.focus.set(nodes, browserEvent);\n    const indexes = elements.map(e => this.model.getListIndex(e)).filter(i => i > -1);\n    this.view.setFocus(indexes, browserEvent, true);\n  }\n\n  focusNext() {\n    let n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    let loop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    let browserEvent = arguments.length > 2 ? arguments[2] : undefined;\n    let filter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this.focusNavigationFilter;\n    this.view.focusNext(n, loop, browserEvent, filter);\n  }\n\n  getFocus() {\n    return this.focus.get();\n  }\n\n  reveal(location, relativeTop) {\n    this.model.expandTo(location);\n    const index = this.model.getListIndex(location);\n\n    if (index === -1) {\n      return;\n    }\n\n    this.view.reveal(index, relativeTop);\n  }\n  /**\n   * Returns the relative position of an element rendered in the list.\n   * Returns `null` if the element isn't *entirely* in the visible viewport.\n   */\n\n\n  getRelativeTop(location) {\n    const index = this.model.getListIndex(location);\n\n    if (index === -1) {\n      return null;\n    }\n\n    return this.view.getRelativeTop(index);\n  } // List\n\n\n  onLeftArrow(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    const node = nodes[0];\n    const location = this.model.getNodeLocation(node);\n    const didChange = this.model.setCollapsed(location, true);\n\n    if (!didChange) {\n      const parentLocation = this.model.getParentNodeLocation(location);\n\n      if (!parentLocation) {\n        return;\n      }\n\n      const parentListIndex = this.model.getListIndex(parentLocation);\n      this.view.reveal(parentListIndex);\n      this.view.setFocus([parentListIndex]);\n    }\n  }\n\n  onRightArrow(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    const node = nodes[0];\n    const location = this.model.getNodeLocation(node);\n    const didChange = this.model.setCollapsed(location, false);\n\n    if (!didChange) {\n      if (!node.children.some(child => child.visible)) {\n        return;\n      }\n\n      const [focusedIndex] = this.view.getFocus();\n      const firstChildIndex = focusedIndex + 1;\n      this.view.reveal(firstChildIndex);\n      this.view.setFocus([firstChildIndex]);\n    }\n  }\n\n  onSpace(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const nodes = this.view.getFocusedElements();\n\n    if (nodes.length === 0) {\n      return;\n    }\n\n    const node = nodes[0];\n    const location = this.model.getNodeLocation(node);\n    const recursive = e.browserEvent.altKey;\n    this.model.setCollapsed(location, undefined, recursive);\n  }\n\n  dispose() {\n    dispose(this.disposables);\n    this.view.dispose();\n  }\n\n}","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/base/browser/ui/tree/abstractTree.js"],"names":["DragAndDropData","StaticDND","$","addDisposableListener","append","clearNode","createStyleSheet","getDomNodePagePosition","hasParentWithClass","DomEmitter","StandardKeyboardEvent","ElementsDragAndDropData","DefaultKeyboardNavigationDelegate","isInputElement","isMonacoEditor","List","MouseController","getVisibleState","isFilterResult","TreeMouseEventTarget","treeFilterClearIcon","treeFilterOnTypeOffIcon","treeFilterOnTypeOnIcon","treeItemExpandedIcon","distinct","equals","range","disposableTimeout","SetMap","Emitter","Event","EventBufferer","Relay","fuzzyScore","FuzzyScore","Disposable","DisposableStore","dispose","toDisposable","clamp","isMacintosh","localize","TreeElementsDragAndDropData","constructor","data","elements","map","node","element","asTreeDragAndDropData","TreeNodeListDragAndDrop","modelProvider","dnd","autoExpandDisposable","None","getDragURI","getDragLabel","nodes","originalEvent","undefined","onDragStart","onDragOver","targetNode","targetIndex","raw","result","didChangeAutoExpandNode","autoExpandNode","autoExpand","model","ref","getNodeLocation","isCollapsed","setCollapsed","accept","bubble","feedback","effect","parentRef","getParentNodeLocation","parentNode","getNode","parentIndex","getListIndex","start","length","getListRenderCount","Object","assign","drop","onDragEnd","asListOptions","options","identityProvider","getId","el","multipleSelectionController","isSelectionSingleChangeEvent","e","isSelectionRangeChangeEvent","accessibilityProvider","getSetSize","visibleChildrenCount","getPosInSet","visibleChildIndex","isChecked","getRole","getAriaLabel","getWidgetAriaLabel","getWidgetRole","getAriaLevel","depth","getActiveDescendantId","keyboardNavigationLabelProvider","getKeyboardNavigationLabel","enableKeyboardNavigation","simpleKeyboardNavigation","ComposedTreeDelegate","delegate","getHeight","getTemplateId","hasDynamicHeight","setDynamicHeight","height","RenderIndentGuides","EventCollection","onDidChange","_elements","forEach","TreeRenderer","renderer","onDidChangeCollapseState","activeNodes","renderedElements","Map","renderedNodes","indent","DefaultIndent","hideTwistiesOfChildlessElements","shouldRenderIndentGuides","renderedIndentGuides","activeIndentNodes","Set","indentGuidesDisposable","disposables","templateId","updateOptions","onDidChangeNodeTwistieState","onDidChangeTwistieState","renderIndentGuides","_onDidChangeActiveNodes","renderTemplate","container","twistie","contents","templateData","renderElement","index","set","style","paddingLeft","width","renderTwistie","disposeElement","delete","disposeTemplate","get","classList","remove","classNamesArray","twistieRendered","collapsible","add","toggle","collapsed","setAttribute","String","removeAttribute","target","disposableStore","parent","guide","has","childElementCount","appendChild","insertBefore","firstElementChild","children","_a","line","clear","TypeFilter","tree","_filter","_totalCount","_matchCount","_pattern","_lowercasePattern","onWillRefilter","reset","totalCount","matchCount","pattern","toLowerCase","filter","parentVisibility","visibility","Default","label","labels","Array","isArray","l","labelStr","toString","score","filterOnType","TypeFilterController","view","keyboardNavigationDelegate","_enabled","_empty","_onDidChangeEmptyState","positionClassName","automaticKeyboardNavigation","triggered","_onDidChangePattern","enabledDisposables","domNode","draggable","messageDomNode","getHTMLElement","labelDomNode","controls","_filterOnType","filterOnTypeDomNode","type","checked","tabIndex","updateFilterOnTypeTitleAndIcon","onDidChangeFilterOnType","clearDomNode","cssSelector","title","keyboardNavigationEventFilter","onDidSplice","onDidSpliceModel","enabled","disable","enable","refilter","render","onEventOrInput","onRawKeyDown","onKeyDown","chain","event","key","test","mightProducePrintableCharacter","keyCode","altKey","ctrlKey","metaKey","shiftKey","stopPropagation","preventDefault","onClearClick","any","onInput","MouseEvent","substr","browserEvent","parentElement","domFocus","fire","focusNext","isDefault","filterData","focus","getFocus","getRelativeTop","reveal","left","containerWidth","clientWidth","midContainerWidth","updatePosition","top","x","clientX","dataTransfer","dropEffect","className","document","CurrentDragAndDropData","noMatches","textContent","innerText","shouldAllowFocus","asTreeMouseEvent","Unknown","Twistie","Element","dfs","fn","child","Trait","getFirstViewElementWithTrait","_onDidChange","nodeSet","_nodeSet","createNodeSet","__forceEvent","_set","silent","that","getNodes","onDidModelSplice","insertedNodes","deletedNodes","visit","values","deletedNodesIdSet","deletedNodesVisitor","insertedNodesMap","insertedNodesVisitor","id","wasDeleted","push","insertedNode","TreeNodeListMouseController","list","onViewPointer","onTwistie","contains","offsetX","expandOnlyOnTwistieClick","detail","expandOnDoubleClick","location","recursive","setFocus","onDoubleClick","TreeNodeList","user","virtualDelegate","renderers","focusTrait","selectionTrait","anchorTrait","createMouseController","splice","deleteCount","additionalFocus","additionalSelection","anchor","setSelection","getSelection","setAnchor","indexes","fromAPI","i","AbstractTree","_options","eventBufferer","_onWillRefilter","_onDidUpdateOptions","treeDelegate","onDidChangeCollapseStateRelay","onDidChangeActiveNodes","r","getFocusedElements","selection","getSelectedElements","getAnchorElement","createModel","input","bufferEvents","debounce","keyboardSupport","on","onLeftArrow","onRightArrow","onSpace","typeFilterController","focusNavigationFilter","styleElement","Always","onDidChangeFocus","wrapEvent","onDidChangeSelection","onMouseDblClick","onPointer","onDidFocus","onDidDispose","optionsUpdate","scrollTop","layout","styles","suffix","domId","content","treeIndentGuidesStroke","transparent","join","collapse","expand","isCollapsible","setCollapsible","n","loop","relativeTop","expandTo","didChange","parentLocation","parentListIndex","some","visible","focusedIndex","firstChildIndex"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { DragAndDropData, StaticDND } from '../../dnd.js';\nimport { $, addDisposableListener, append, clearNode, createStyleSheet, getDomNodePagePosition, hasParentWithClass } from '../../dom.js';\nimport { DomEmitter } from '../../event.js';\nimport { StandardKeyboardEvent } from '../../keyboardEvent.js';\nimport { ElementsDragAndDropData } from '../list/listView.js';\nimport { DefaultKeyboardNavigationDelegate, isInputElement, isMonacoEditor, List, MouseController } from '../list/listWidget.js';\nimport { getVisibleState, isFilterResult } from './indexTreeModel.js';\nimport { TreeMouseEventTarget } from './tree.js';\nimport { treeFilterClearIcon, treeFilterOnTypeOffIcon, treeFilterOnTypeOnIcon, treeItemExpandedIcon } from './treeIcons.js';\nimport { distinct, equals, range } from '../../../common/arrays.js';\nimport { disposableTimeout } from '../../../common/async.js';\nimport { SetMap } from '../../../common/collections.js';\nimport { Emitter, Event, EventBufferer, Relay } from '../../../common/event.js';\nimport { fuzzyScore, FuzzyScore } from '../../../common/filters.js';\nimport { Disposable, DisposableStore, dispose, toDisposable } from '../../../common/lifecycle.js';\nimport { clamp } from '../../../common/numbers.js';\nimport { isMacintosh } from '../../../common/platform.js';\nimport './media/tree.css';\nimport { localize } from '../../../../nls.js';\nclass TreeElementsDragAndDropData extends ElementsDragAndDropData {\n    constructor(data) {\n        super(data.elements.map(node => node.element));\n        this.data = data;\n    }\n}\nfunction asTreeDragAndDropData(data) {\n    if (data instanceof ElementsDragAndDropData) {\n        return new TreeElementsDragAndDropData(data);\n    }\n    return data;\n}\nclass TreeNodeListDragAndDrop {\n    constructor(modelProvider, dnd) {\n        this.modelProvider = modelProvider;\n        this.dnd = dnd;\n        this.autoExpandDisposable = Disposable.None;\n    }\n    getDragURI(node) {\n        return this.dnd.getDragURI(node.element);\n    }\n    getDragLabel(nodes, originalEvent) {\n        if (this.dnd.getDragLabel) {\n            return this.dnd.getDragLabel(nodes.map(node => node.element), originalEvent);\n        }\n        return undefined;\n    }\n    onDragStart(data, originalEvent) {\n        if (this.dnd.onDragStart) {\n            this.dnd.onDragStart(asTreeDragAndDropData(data), originalEvent);\n        }\n    }\n    onDragOver(data, targetNode, targetIndex, originalEvent, raw = true) {\n        const result = this.dnd.onDragOver(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n        const didChangeAutoExpandNode = this.autoExpandNode !== targetNode;\n        if (didChangeAutoExpandNode) {\n            this.autoExpandDisposable.dispose();\n            this.autoExpandNode = targetNode;\n        }\n        if (typeof targetNode === 'undefined') {\n            return result;\n        }\n        if (didChangeAutoExpandNode && typeof result !== 'boolean' && result.autoExpand) {\n            this.autoExpandDisposable = disposableTimeout(() => {\n                const model = this.modelProvider();\n                const ref = model.getNodeLocation(targetNode);\n                if (model.isCollapsed(ref)) {\n                    model.setCollapsed(ref, false);\n                }\n                this.autoExpandNode = undefined;\n            }, 500);\n        }\n        if (typeof result === 'boolean' || !result.accept || typeof result.bubble === 'undefined' || result.feedback) {\n            if (!raw) {\n                const accept = typeof result === 'boolean' ? result : result.accept;\n                const effect = typeof result === 'boolean' ? undefined : result.effect;\n                return { accept, effect, feedback: [targetIndex] };\n            }\n            return result;\n        }\n        if (result.bubble === 1 /* Up */) {\n            const model = this.modelProvider();\n            const ref = model.getNodeLocation(targetNode);\n            const parentRef = model.getParentNodeLocation(ref);\n            const parentNode = model.getNode(parentRef);\n            const parentIndex = parentRef && model.getListIndex(parentRef);\n            return this.onDragOver(data, parentNode, parentIndex, originalEvent, false);\n        }\n        const model = this.modelProvider();\n        const ref = model.getNodeLocation(targetNode);\n        const start = model.getListIndex(ref);\n        const length = model.getListRenderCount(ref);\n        return Object.assign(Object.assign({}, result), { feedback: range(start, start + length) });\n    }\n    drop(data, targetNode, targetIndex, originalEvent) {\n        this.autoExpandDisposable.dispose();\n        this.autoExpandNode = undefined;\n        this.dnd.drop(asTreeDragAndDropData(data), targetNode && targetNode.element, targetIndex, originalEvent);\n    }\n    onDragEnd(originalEvent) {\n        if (this.dnd.onDragEnd) {\n            this.dnd.onDragEnd(originalEvent);\n        }\n    }\n}\nfunction asListOptions(modelProvider, options) {\n    return options && Object.assign(Object.assign({}, options), { identityProvider: options.identityProvider && {\n            getId(el) {\n                return options.identityProvider.getId(el.element);\n            }\n        }, dnd: options.dnd && new TreeNodeListDragAndDrop(modelProvider, options.dnd), multipleSelectionController: options.multipleSelectionController && {\n            isSelectionSingleChangeEvent(e) {\n                return options.multipleSelectionController.isSelectionSingleChangeEvent(Object.assign(Object.assign({}, e), { element: e.element }));\n            },\n            isSelectionRangeChangeEvent(e) {\n                return options.multipleSelectionController.isSelectionRangeChangeEvent(Object.assign(Object.assign({}, e), { element: e.element }));\n            }\n        }, accessibilityProvider: options.accessibilityProvider && Object.assign(Object.assign({}, options.accessibilityProvider), { getSetSize(node) {\n                const model = modelProvider();\n                const ref = model.getNodeLocation(node);\n                const parentRef = model.getParentNodeLocation(ref);\n                const parentNode = model.getNode(parentRef);\n                return parentNode.visibleChildrenCount;\n            },\n            getPosInSet(node) {\n                return node.visibleChildIndex + 1;\n            }, isChecked: options.accessibilityProvider && options.accessibilityProvider.isChecked ? (node) => {\n                return options.accessibilityProvider.isChecked(node.element);\n            } : undefined, getRole: options.accessibilityProvider && options.accessibilityProvider.getRole ? (node) => {\n                return options.accessibilityProvider.getRole(node.element);\n            } : () => 'treeitem', getAriaLabel(e) {\n                return options.accessibilityProvider.getAriaLabel(e.element);\n            },\n            getWidgetAriaLabel() {\n                return options.accessibilityProvider.getWidgetAriaLabel();\n            }, getWidgetRole: options.accessibilityProvider && options.accessibilityProvider.getWidgetRole ? () => options.accessibilityProvider.getWidgetRole() : () => 'tree', getAriaLevel: options.accessibilityProvider && options.accessibilityProvider.getAriaLevel ? (node) => options.accessibilityProvider.getAriaLevel(node.element) : (node) => {\n                return node.depth;\n            }, getActiveDescendantId: options.accessibilityProvider.getActiveDescendantId && (node => {\n                return options.accessibilityProvider.getActiveDescendantId(node.element);\n            }) }), keyboardNavigationLabelProvider: options.keyboardNavigationLabelProvider && Object.assign(Object.assign({}, options.keyboardNavigationLabelProvider), { getKeyboardNavigationLabel(node) {\n                return options.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(node.element);\n            } }), enableKeyboardNavigation: options.simpleKeyboardNavigation });\n}\nexport class ComposedTreeDelegate {\n    constructor(delegate) {\n        this.delegate = delegate;\n    }\n    getHeight(element) {\n        return this.delegate.getHeight(element.element);\n    }\n    getTemplateId(element) {\n        return this.delegate.getTemplateId(element.element);\n    }\n    hasDynamicHeight(element) {\n        return !!this.delegate.hasDynamicHeight && this.delegate.hasDynamicHeight(element.element);\n    }\n    setDynamicHeight(element, height) {\n        if (this.delegate.setDynamicHeight) {\n            this.delegate.setDynamicHeight(element.element, height);\n        }\n    }\n}\nexport var RenderIndentGuides;\n(function (RenderIndentGuides) {\n    RenderIndentGuides[\"None\"] = \"none\";\n    RenderIndentGuides[\"OnHover\"] = \"onHover\";\n    RenderIndentGuides[\"Always\"] = \"always\";\n})(RenderIndentGuides || (RenderIndentGuides = {}));\nclass EventCollection {\n    constructor(onDidChange, _elements = []) {\n        this._elements = _elements;\n        this.onDidChange = Event.forEach(onDidChange, elements => this._elements = elements);\n    }\n    get elements() {\n        return this._elements;\n    }\n}\nclass TreeRenderer {\n    constructor(renderer, modelProvider, onDidChangeCollapseState, activeNodes, options = {}) {\n        this.renderer = renderer;\n        this.modelProvider = modelProvider;\n        this.activeNodes = activeNodes;\n        this.renderedElements = new Map();\n        this.renderedNodes = new Map();\n        this.indent = TreeRenderer.DefaultIndent;\n        this.hideTwistiesOfChildlessElements = false;\n        this.shouldRenderIndentGuides = false;\n        this.renderedIndentGuides = new SetMap();\n        this.activeIndentNodes = new Set();\n        this.indentGuidesDisposable = Disposable.None;\n        this.disposables = new DisposableStore();\n        this.templateId = renderer.templateId;\n        this.updateOptions(options);\n        Event.map(onDidChangeCollapseState, e => e.node)(this.onDidChangeNodeTwistieState, this, this.disposables);\n        if (renderer.onDidChangeTwistieState) {\n            renderer.onDidChangeTwistieState(this.onDidChangeTwistieState, this, this.disposables);\n        }\n    }\n    updateOptions(options = {}) {\n        if (typeof options.indent !== 'undefined') {\n            this.indent = clamp(options.indent, 0, 40);\n        }\n        if (typeof options.renderIndentGuides !== 'undefined') {\n            const shouldRenderIndentGuides = options.renderIndentGuides !== RenderIndentGuides.None;\n            if (shouldRenderIndentGuides !== this.shouldRenderIndentGuides) {\n                this.shouldRenderIndentGuides = shouldRenderIndentGuides;\n                this.indentGuidesDisposable.dispose();\n                if (shouldRenderIndentGuides) {\n                    const disposables = new DisposableStore();\n                    this.activeNodes.onDidChange(this._onDidChangeActiveNodes, this, disposables);\n                    this.indentGuidesDisposable = disposables;\n                    this._onDidChangeActiveNodes(this.activeNodes.elements);\n                }\n            }\n        }\n        if (typeof options.hideTwistiesOfChildlessElements !== 'undefined') {\n            this.hideTwistiesOfChildlessElements = options.hideTwistiesOfChildlessElements;\n        }\n    }\n    renderTemplate(container) {\n        const el = append(container, $('.monaco-tl-row'));\n        const indent = append(el, $('.monaco-tl-indent'));\n        const twistie = append(el, $('.monaco-tl-twistie'));\n        const contents = append(el, $('.monaco-tl-contents'));\n        const templateData = this.renderer.renderTemplate(contents);\n        return { container, indent, twistie, indentGuidesDisposable: Disposable.None, templateData };\n    }\n    renderElement(node, index, templateData, height) {\n        if (typeof height === 'number') {\n            this.renderedNodes.set(node, { templateData, height });\n            this.renderedElements.set(node.element, node);\n        }\n        const indent = TreeRenderer.DefaultIndent + (node.depth - 1) * this.indent;\n        templateData.twistie.style.paddingLeft = `${indent}px`;\n        templateData.indent.style.width = `${indent + this.indent - 16}px`;\n        this.renderTwistie(node, templateData);\n        if (typeof height === 'number') {\n            this.renderIndentGuides(node, templateData);\n        }\n        this.renderer.renderElement(node, index, templateData.templateData, height);\n    }\n    disposeElement(node, index, templateData, height) {\n        templateData.indentGuidesDisposable.dispose();\n        if (this.renderer.disposeElement) {\n            this.renderer.disposeElement(node, index, templateData.templateData, height);\n        }\n        if (typeof height === 'number') {\n            this.renderedNodes.delete(node);\n            this.renderedElements.delete(node.element);\n        }\n    }\n    disposeTemplate(templateData) {\n        this.renderer.disposeTemplate(templateData.templateData);\n    }\n    onDidChangeTwistieState(element) {\n        const node = this.renderedElements.get(element);\n        if (!node) {\n            return;\n        }\n        this.onDidChangeNodeTwistieState(node);\n    }\n    onDidChangeNodeTwistieState(node) {\n        const data = this.renderedNodes.get(node);\n        if (!data) {\n            return;\n        }\n        this.renderTwistie(node, data.templateData);\n        this._onDidChangeActiveNodes(this.activeNodes.elements);\n        this.renderIndentGuides(node, data.templateData);\n    }\n    renderTwistie(node, templateData) {\n        templateData.twistie.classList.remove(...treeItemExpandedIcon.classNamesArray);\n        let twistieRendered = false;\n        if (this.renderer.renderTwistie) {\n            twistieRendered = this.renderer.renderTwistie(node.element, templateData.twistie);\n        }\n        if (node.collapsible && (!this.hideTwistiesOfChildlessElements || node.visibleChildrenCount > 0)) {\n            if (!twistieRendered) {\n                templateData.twistie.classList.add(...treeItemExpandedIcon.classNamesArray);\n            }\n            templateData.twistie.classList.add('collapsible');\n            templateData.twistie.classList.toggle('collapsed', node.collapsed);\n        }\n        else {\n            templateData.twistie.classList.remove('collapsible', 'collapsed');\n        }\n        if (node.collapsible) {\n            templateData.container.setAttribute('aria-expanded', String(!node.collapsed));\n        }\n        else {\n            templateData.container.removeAttribute('aria-expanded');\n        }\n    }\n    renderIndentGuides(target, templateData) {\n        clearNode(templateData.indent);\n        templateData.indentGuidesDisposable.dispose();\n        if (!this.shouldRenderIndentGuides) {\n            return;\n        }\n        const disposableStore = new DisposableStore();\n        const model = this.modelProvider();\n        let node = target;\n        while (true) {\n            const ref = model.getNodeLocation(node);\n            const parentRef = model.getParentNodeLocation(ref);\n            if (!parentRef) {\n                break;\n            }\n            const parent = model.getNode(parentRef);\n            const guide = $('.indent-guide', { style: `width: ${this.indent}px` });\n            if (this.activeIndentNodes.has(parent)) {\n                guide.classList.add('active');\n            }\n            if (templateData.indent.childElementCount === 0) {\n                templateData.indent.appendChild(guide);\n            }\n            else {\n                templateData.indent.insertBefore(guide, templateData.indent.firstElementChild);\n            }\n            this.renderedIndentGuides.add(parent, guide);\n            disposableStore.add(toDisposable(() => this.renderedIndentGuides.delete(parent, guide)));\n            node = parent;\n        }\n        templateData.indentGuidesDisposable = disposableStore;\n    }\n    _onDidChangeActiveNodes(nodes) {\n        if (!this.shouldRenderIndentGuides) {\n            return;\n        }\n        const set = new Set();\n        const model = this.modelProvider();\n        nodes.forEach(node => {\n            const ref = model.getNodeLocation(node);\n            try {\n                const parentRef = model.getParentNodeLocation(ref);\n                if (node.collapsible && node.children.length > 0 && !node.collapsed) {\n                    set.add(node);\n                }\n                else if (parentRef) {\n                    set.add(model.getNode(parentRef));\n                }\n            }\n            catch (_a) {\n                // noop\n            }\n        });\n        this.activeIndentNodes.forEach(node => {\n            if (!set.has(node)) {\n                this.renderedIndentGuides.forEach(node, line => line.classList.remove('active'));\n            }\n        });\n        set.forEach(node => {\n            if (!this.activeIndentNodes.has(node)) {\n                this.renderedIndentGuides.forEach(node, line => line.classList.add('active'));\n            }\n        });\n        this.activeIndentNodes = set;\n    }\n    dispose() {\n        this.renderedNodes.clear();\n        this.renderedElements.clear();\n        this.indentGuidesDisposable.dispose();\n        dispose(this.disposables);\n    }\n}\nTreeRenderer.DefaultIndent = 8;\nclass TypeFilter {\n    constructor(tree, keyboardNavigationLabelProvider, _filter) {\n        this.tree = tree;\n        this.keyboardNavigationLabelProvider = keyboardNavigationLabelProvider;\n        this._filter = _filter;\n        this._totalCount = 0;\n        this._matchCount = 0;\n        this._pattern = '';\n        this._lowercasePattern = '';\n        this.disposables = new DisposableStore();\n        tree.onWillRefilter(this.reset, this, this.disposables);\n    }\n    get totalCount() { return this._totalCount; }\n    get matchCount() { return this._matchCount; }\n    set pattern(pattern) {\n        this._pattern = pattern;\n        this._lowercasePattern = pattern.toLowerCase();\n    }\n    filter(element, parentVisibility) {\n        if (this._filter) {\n            const result = this._filter.filter(element, parentVisibility);\n            if (this.tree.options.simpleKeyboardNavigation) {\n                return result;\n            }\n            let visibility;\n            if (typeof result === 'boolean') {\n                visibility = result ? 1 /* Visible */ : 0 /* Hidden */;\n            }\n            else if (isFilterResult(result)) {\n                visibility = getVisibleState(result.visibility);\n            }\n            else {\n                visibility = result;\n            }\n            if (visibility === 0 /* Hidden */) {\n                return false;\n            }\n        }\n        this._totalCount++;\n        if (this.tree.options.simpleKeyboardNavigation || !this._pattern) {\n            this._matchCount++;\n            return { data: FuzzyScore.Default, visibility: true };\n        }\n        const label = this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(element);\n        const labels = Array.isArray(label) ? label : [label];\n        for (const l of labels) {\n            const labelStr = l && l.toString();\n            if (typeof labelStr === 'undefined') {\n                return { data: FuzzyScore.Default, visibility: true };\n            }\n            const score = fuzzyScore(this._pattern, this._lowercasePattern, 0, labelStr, labelStr.toLowerCase(), 0, true);\n            if (score) {\n                this._matchCount++;\n                return labels.length === 1 ?\n                    { data: score, visibility: true } :\n                    { data: { label: labelStr, score: score }, visibility: true };\n            }\n        }\n        if (this.tree.options.filterOnType) {\n            return 2 /* Recurse */;\n        }\n        else {\n            return { data: FuzzyScore.Default, visibility: true };\n        }\n    }\n    reset() {\n        this._totalCount = 0;\n        this._matchCount = 0;\n    }\n    dispose() {\n        dispose(this.disposables);\n    }\n}\nclass TypeFilterController {\n    constructor(tree, model, view, filter, keyboardNavigationDelegate) {\n        this.tree = tree;\n        this.view = view;\n        this.filter = filter;\n        this.keyboardNavigationDelegate = keyboardNavigationDelegate;\n        this._enabled = false;\n        this._pattern = '';\n        this._empty = false;\n        this._onDidChangeEmptyState = new Emitter();\n        this.positionClassName = 'ne';\n        this.automaticKeyboardNavigation = true;\n        this.triggered = false;\n        this._onDidChangePattern = new Emitter();\n        this.enabledDisposables = new DisposableStore();\n        this.disposables = new DisposableStore();\n        this.domNode = $(`.monaco-list-type-filter.${this.positionClassName}`);\n        this.domNode.draggable = true;\n        this.disposables.add(addDisposableListener(this.domNode, 'dragstart', () => this.onDragStart()));\n        this.messageDomNode = append(view.getHTMLElement(), $(`.monaco-list-type-filter-message`));\n        this.labelDomNode = append(this.domNode, $('span.label'));\n        const controls = append(this.domNode, $('.controls'));\n        this._filterOnType = !!tree.options.filterOnType;\n        this.filterOnTypeDomNode = append(controls, $('input.filter'));\n        this.filterOnTypeDomNode.type = 'checkbox';\n        this.filterOnTypeDomNode.checked = this._filterOnType;\n        this.filterOnTypeDomNode.tabIndex = -1;\n        this.updateFilterOnTypeTitleAndIcon();\n        this.disposables.add(addDisposableListener(this.filterOnTypeDomNode, 'input', () => this.onDidChangeFilterOnType()));\n        this.clearDomNode = append(controls, $('button.clear' + treeFilterClearIcon.cssSelector));\n        this.clearDomNode.tabIndex = -1;\n        this.clearDomNode.title = localize('clear', \"Clear\");\n        this.keyboardNavigationEventFilter = tree.options.keyboardNavigationEventFilter;\n        model.onDidSplice(this.onDidSpliceModel, this, this.disposables);\n        this.updateOptions(tree.options);\n    }\n    get enabled() { return this._enabled; }\n    get pattern() { return this._pattern; }\n    get filterOnType() { return this._filterOnType; }\n    updateOptions(options) {\n        if (options.simpleKeyboardNavigation) {\n            this.disable();\n        }\n        else {\n            this.enable();\n        }\n        if (typeof options.filterOnType !== 'undefined') {\n            this._filterOnType = !!options.filterOnType;\n            this.filterOnTypeDomNode.checked = this._filterOnType;\n            this.updateFilterOnTypeTitleAndIcon();\n        }\n        if (typeof options.automaticKeyboardNavigation !== 'undefined') {\n            this.automaticKeyboardNavigation = options.automaticKeyboardNavigation;\n        }\n        this.tree.refilter();\n        this.render();\n        if (!this.automaticKeyboardNavigation) {\n            this.onEventOrInput('');\n        }\n    }\n    enable() {\n        if (this._enabled) {\n            return;\n        }\n        const onRawKeyDown = this.enabledDisposables.add(new DomEmitter(this.view.getHTMLElement(), 'keydown'));\n        const onKeyDown = Event.chain(onRawKeyDown.event)\n            .filter(e => !isInputElement(e.target) || e.target === this.filterOnTypeDomNode)\n            .filter(e => e.key !== 'Dead' && !/^Media/.test(e.key))\n            .map(e => new StandardKeyboardEvent(e))\n            .filter(this.keyboardNavigationEventFilter || (() => true))\n            .filter(() => this.automaticKeyboardNavigation || this.triggered)\n            .filter(e => (this.keyboardNavigationDelegate.mightProducePrintableCharacter(e) && !(e.keyCode === 18 /* DownArrow */ || e.keyCode === 16 /* UpArrow */ || e.keyCode === 15 /* LeftArrow */ || e.keyCode === 17 /* RightArrow */)) || ((this.pattern.length > 0 || this.triggered) && ((e.keyCode === 9 /* Escape */ || e.keyCode === 1 /* Backspace */) && !e.altKey && !e.ctrlKey && !e.metaKey) || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? (e.altKey && !e.metaKey) : e.ctrlKey) && !e.shiftKey)))\n            .forEach(e => { e.stopPropagation(); e.preventDefault(); })\n            .event;\n        const onClearClick = this.enabledDisposables.add(new DomEmitter(this.clearDomNode, 'click'));\n        Event.chain(Event.any(onKeyDown, onClearClick.event))\n            .event(this.onEventOrInput, this, this.enabledDisposables);\n        this.filter.pattern = '';\n        this.tree.refilter();\n        this.render();\n        this._enabled = true;\n        this.triggered = false;\n    }\n    disable() {\n        if (!this._enabled) {\n            return;\n        }\n        this.domNode.remove();\n        this.enabledDisposables.clear();\n        this.tree.refilter();\n        this.render();\n        this._enabled = false;\n        this.triggered = false;\n    }\n    onEventOrInput(e) {\n        if (typeof e === 'string') {\n            this.onInput(e);\n        }\n        else if (e instanceof MouseEvent || e.keyCode === 9 /* Escape */ || (e.keyCode === 1 /* Backspace */ && (isMacintosh ? e.altKey : e.ctrlKey))) {\n            this.onInput('');\n        }\n        else if (e.keyCode === 1 /* Backspace */) {\n            this.onInput(this.pattern.length === 0 ? '' : this.pattern.substr(0, this.pattern.length - 1));\n        }\n        else {\n            this.onInput(this.pattern + e.browserEvent.key);\n        }\n    }\n    onInput(pattern) {\n        const container = this.view.getHTMLElement();\n        if (pattern && !this.domNode.parentElement) {\n            container.append(this.domNode);\n        }\n        else if (!pattern && this.domNode.parentElement) {\n            this.domNode.remove();\n            this.tree.domFocus();\n        }\n        this._pattern = pattern;\n        this._onDidChangePattern.fire(pattern);\n        this.filter.pattern = pattern;\n        this.tree.refilter();\n        if (pattern) {\n            this.tree.focusNext(0, true, undefined, node => !FuzzyScore.isDefault(node.filterData));\n        }\n        const focus = this.tree.getFocus();\n        if (focus.length > 0) {\n            const element = focus[0];\n            if (this.tree.getRelativeTop(element) === null) {\n                this.tree.reveal(element, 0.5);\n            }\n        }\n        this.render();\n        if (!pattern) {\n            this.triggered = false;\n        }\n    }\n    onDragStart() {\n        const container = this.view.getHTMLElement();\n        const { left } = getDomNodePagePosition(container);\n        const containerWidth = container.clientWidth;\n        const midContainerWidth = containerWidth / 2;\n        const width = this.domNode.clientWidth;\n        const disposables = new DisposableStore();\n        let positionClassName = this.positionClassName;\n        const updatePosition = () => {\n            switch (positionClassName) {\n                case 'nw':\n                    this.domNode.style.top = `4px`;\n                    this.domNode.style.left = `4px`;\n                    break;\n                case 'ne':\n                    this.domNode.style.top = `4px`;\n                    this.domNode.style.left = `${containerWidth - width - 6}px`;\n                    break;\n            }\n        };\n        const onDragOver = (event) => {\n            event.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n            const x = event.clientX - left;\n            if (event.dataTransfer) {\n                event.dataTransfer.dropEffect = 'none';\n            }\n            if (x < midContainerWidth) {\n                positionClassName = 'nw';\n            }\n            else {\n                positionClassName = 'ne';\n            }\n            updatePosition();\n        };\n        const onDragEnd = () => {\n            this.positionClassName = positionClassName;\n            this.domNode.className = `monaco-list-type-filter ${this.positionClassName}`;\n            this.domNode.style.top = '';\n            this.domNode.style.left = '';\n            dispose(disposables);\n        };\n        updatePosition();\n        this.domNode.classList.remove(positionClassName);\n        this.domNode.classList.add('dragging');\n        disposables.add(toDisposable(() => this.domNode.classList.remove('dragging')));\n        disposables.add(addDisposableListener(document, 'dragover', e => onDragOver(e)));\n        disposables.add(addDisposableListener(this.domNode, 'dragend', () => onDragEnd()));\n        StaticDND.CurrentDragAndDropData = new DragAndDropData('vscode-ui');\n        disposables.add(toDisposable(() => StaticDND.CurrentDragAndDropData = undefined));\n    }\n    onDidSpliceModel() {\n        if (!this._enabled || this.pattern.length === 0) {\n            return;\n        }\n        this.tree.refilter();\n        this.render();\n    }\n    onDidChangeFilterOnType() {\n        this.tree.updateOptions({ filterOnType: this.filterOnTypeDomNode.checked });\n        this.tree.refilter();\n        this.tree.domFocus();\n        this.render();\n        this.updateFilterOnTypeTitleAndIcon();\n    }\n    updateFilterOnTypeTitleAndIcon() {\n        if (this.filterOnType) {\n            this.filterOnTypeDomNode.classList.remove(...treeFilterOnTypeOffIcon.classNamesArray);\n            this.filterOnTypeDomNode.classList.add(...treeFilterOnTypeOnIcon.classNamesArray);\n            this.filterOnTypeDomNode.title = localize('disable filter on type', \"Disable Filter on Type\");\n        }\n        else {\n            this.filterOnTypeDomNode.classList.remove(...treeFilterOnTypeOnIcon.classNamesArray);\n            this.filterOnTypeDomNode.classList.add(...treeFilterOnTypeOffIcon.classNamesArray);\n            this.filterOnTypeDomNode.title = localize('enable filter on type', \"Enable Filter on Type\");\n        }\n    }\n    render() {\n        const noMatches = this.filter.totalCount > 0 && this.filter.matchCount === 0;\n        if (this.pattern && this.tree.options.filterOnType && noMatches) {\n            this.messageDomNode.textContent = localize('empty', \"No elements found\");\n            this._empty = true;\n        }\n        else {\n            this.messageDomNode.innerText = '';\n            this._empty = false;\n        }\n        this.domNode.classList.toggle('no-matches', noMatches);\n        this.domNode.title = localize('found', \"Matched {0} out of {1} elements\", this.filter.matchCount, this.filter.totalCount);\n        this.labelDomNode.textContent = this.pattern.length > 16 ? 'â€¦' + this.pattern.substr(this.pattern.length - 16) : this.pattern;\n        this._onDidChangeEmptyState.fire(this._empty);\n    }\n    shouldAllowFocus(node) {\n        if (!this.enabled || !this.pattern || this.filterOnType) {\n            return true;\n        }\n        if (this.filter.totalCount > 0 && this.filter.matchCount <= 1) {\n            return true;\n        }\n        return !FuzzyScore.isDefault(node.filterData);\n    }\n    dispose() {\n        if (this._enabled) {\n            this.domNode.remove();\n            this.enabledDisposables.dispose();\n            this._enabled = false;\n            this.triggered = false;\n        }\n        this._onDidChangePattern.dispose();\n        dispose(this.disposables);\n    }\n}\nfunction asTreeMouseEvent(event) {\n    let target = TreeMouseEventTarget.Unknown;\n    if (hasParentWithClass(event.browserEvent.target, 'monaco-tl-twistie', 'monaco-tl-row')) {\n        target = TreeMouseEventTarget.Twistie;\n    }\n    else if (hasParentWithClass(event.browserEvent.target, 'monaco-tl-contents', 'monaco-tl-row')) {\n        target = TreeMouseEventTarget.Element;\n    }\n    return {\n        browserEvent: event.browserEvent,\n        element: event.element ? event.element.element : null,\n        target\n    };\n}\nfunction dfs(node, fn) {\n    fn(node);\n    node.children.forEach(child => dfs(child, fn));\n}\n/**\n * The trait concept needs to exist at the tree level, because collapsed\n * tree nodes will not be known by the list.\n */\nclass Trait {\n    constructor(getFirstViewElementWithTrait, identityProvider) {\n        this.getFirstViewElementWithTrait = getFirstViewElementWithTrait;\n        this.identityProvider = identityProvider;\n        this.nodes = [];\n        this._onDidChange = new Emitter();\n        this.onDidChange = this._onDidChange.event;\n    }\n    get nodeSet() {\n        if (!this._nodeSet) {\n            this._nodeSet = this.createNodeSet();\n        }\n        return this._nodeSet;\n    }\n    set(nodes, browserEvent) {\n        var _a;\n        if (!((_a = browserEvent) === null || _a === void 0 ? void 0 : _a.__forceEvent) && equals(this.nodes, nodes)) {\n            return;\n        }\n        this._set(nodes, false, browserEvent);\n    }\n    _set(nodes, silent, browserEvent) {\n        this.nodes = [...nodes];\n        this.elements = undefined;\n        this._nodeSet = undefined;\n        if (!silent) {\n            const that = this;\n            this._onDidChange.fire({ get elements() { return that.get(); }, browserEvent });\n        }\n    }\n    get() {\n        if (!this.elements) {\n            this.elements = this.nodes.map(node => node.element);\n        }\n        return [...this.elements];\n    }\n    getNodes() {\n        return this.nodes;\n    }\n    has(node) {\n        return this.nodeSet.has(node);\n    }\n    onDidModelSplice({ insertedNodes, deletedNodes }) {\n        if (!this.identityProvider) {\n            const set = this.createNodeSet();\n            const visit = (node) => set.delete(node);\n            deletedNodes.forEach(node => dfs(node, visit));\n            this.set([...set.values()]);\n            return;\n        }\n        const deletedNodesIdSet = new Set();\n        const deletedNodesVisitor = (node) => deletedNodesIdSet.add(this.identityProvider.getId(node.element).toString());\n        deletedNodes.forEach(node => dfs(node, deletedNodesVisitor));\n        const insertedNodesMap = new Map();\n        const insertedNodesVisitor = (node) => insertedNodesMap.set(this.identityProvider.getId(node.element).toString(), node);\n        insertedNodes.forEach(node => dfs(node, insertedNodesVisitor));\n        const nodes = [];\n        for (const node of this.nodes) {\n            const id = this.identityProvider.getId(node.element).toString();\n            const wasDeleted = deletedNodesIdSet.has(id);\n            if (!wasDeleted) {\n                nodes.push(node);\n            }\n            else {\n                const insertedNode = insertedNodesMap.get(id);\n                if (insertedNode) {\n                    nodes.push(insertedNode);\n                }\n            }\n        }\n        if (this.nodes.length > 0 && nodes.length === 0) {\n            const node = this.getFirstViewElementWithTrait();\n            if (node) {\n                nodes.push(node);\n            }\n        }\n        this._set(nodes, true);\n    }\n    createNodeSet() {\n        const set = new Set();\n        for (const node of this.nodes) {\n            set.add(node);\n        }\n        return set;\n    }\n}\nclass TreeNodeListMouseController extends MouseController {\n    constructor(list, tree) {\n        super(list);\n        this.tree = tree;\n    }\n    onViewPointer(e) {\n        if (isInputElement(e.browserEvent.target) || isMonacoEditor(e.browserEvent.target)) {\n            return;\n        }\n        const node = e.element;\n        if (!node) {\n            return super.onViewPointer(e);\n        }\n        if (this.isSelectionRangeChangeEvent(e) || this.isSelectionSingleChangeEvent(e)) {\n            return super.onViewPointer(e);\n        }\n        const target = e.browserEvent.target;\n        const onTwistie = target.classList.contains('monaco-tl-twistie')\n            || (target.classList.contains('monaco-icon-label') && target.classList.contains('folder-icon') && e.browserEvent.offsetX < 16);\n        let expandOnlyOnTwistieClick = false;\n        if (typeof this.tree.expandOnlyOnTwistieClick === 'function') {\n            expandOnlyOnTwistieClick = this.tree.expandOnlyOnTwistieClick(node.element);\n        }\n        else {\n            expandOnlyOnTwistieClick = !!this.tree.expandOnlyOnTwistieClick;\n        }\n        if (expandOnlyOnTwistieClick && !onTwistie && e.browserEvent.detail !== 2) {\n            return super.onViewPointer(e);\n        }\n        if (!this.tree.expandOnDoubleClick && e.browserEvent.detail === 2) {\n            return super.onViewPointer(e);\n        }\n        if (node.collapsible) {\n            const model = this.tree.model; // internal\n            const location = model.getNodeLocation(node);\n            const recursive = e.browserEvent.altKey;\n            this.tree.setFocus([location]);\n            model.setCollapsed(location, undefined, recursive);\n            if (expandOnlyOnTwistieClick && onTwistie) {\n                return;\n            }\n        }\n        super.onViewPointer(e);\n    }\n    onDoubleClick(e) {\n        const onTwistie = e.browserEvent.target.classList.contains('monaco-tl-twistie');\n        if (onTwistie || !this.tree.expandOnDoubleClick) {\n            return;\n        }\n        super.onDoubleClick(e);\n    }\n}\n/**\n * We use this List subclass to restore selection and focus as nodes\n * get rendered in the list, possibly due to a node expand() call.\n */\nclass TreeNodeList extends List {\n    constructor(user, container, virtualDelegate, renderers, focusTrait, selectionTrait, anchorTrait, options) {\n        super(user, container, virtualDelegate, renderers, options);\n        this.focusTrait = focusTrait;\n        this.selectionTrait = selectionTrait;\n        this.anchorTrait = anchorTrait;\n    }\n    createMouseController(options) {\n        return new TreeNodeListMouseController(this, options.tree);\n    }\n    splice(start, deleteCount, elements = []) {\n        super.splice(start, deleteCount, elements);\n        if (elements.length === 0) {\n            return;\n        }\n        const additionalFocus = [];\n        const additionalSelection = [];\n        let anchor;\n        elements.forEach((node, index) => {\n            if (this.focusTrait.has(node)) {\n                additionalFocus.push(start + index);\n            }\n            if (this.selectionTrait.has(node)) {\n                additionalSelection.push(start + index);\n            }\n            if (this.anchorTrait.has(node)) {\n                anchor = start + index;\n            }\n        });\n        if (additionalFocus.length > 0) {\n            super.setFocus(distinct([...super.getFocus(), ...additionalFocus]));\n        }\n        if (additionalSelection.length > 0) {\n            super.setSelection(distinct([...super.getSelection(), ...additionalSelection]));\n        }\n        if (typeof anchor === 'number') {\n            super.setAnchor(anchor);\n        }\n    }\n    setFocus(indexes, browserEvent, fromAPI = false) {\n        super.setFocus(indexes, browserEvent);\n        if (!fromAPI) {\n            this.focusTrait.set(indexes.map(i => this.element(i)), browserEvent);\n        }\n    }\n    setSelection(indexes, browserEvent, fromAPI = false) {\n        super.setSelection(indexes, browserEvent);\n        if (!fromAPI) {\n            this.selectionTrait.set(indexes.map(i => this.element(i)), browserEvent);\n        }\n    }\n    setAnchor(index, fromAPI = false) {\n        super.setAnchor(index);\n        if (!fromAPI) {\n            if (typeof index === 'undefined') {\n                this.anchorTrait.set([]);\n            }\n            else {\n                this.anchorTrait.set([this.element(index)]);\n            }\n        }\n    }\n}\nexport class AbstractTree {\n    constructor(user, container, delegate, renderers, _options = {}) {\n        this._options = _options;\n        this.eventBufferer = new EventBufferer();\n        this.disposables = new DisposableStore();\n        this._onWillRefilter = new Emitter();\n        this.onWillRefilter = this._onWillRefilter.event;\n        this._onDidUpdateOptions = new Emitter();\n        const treeDelegate = new ComposedTreeDelegate(delegate);\n        const onDidChangeCollapseStateRelay = new Relay();\n        const onDidChangeActiveNodes = new Relay();\n        const activeNodes = new EventCollection(onDidChangeActiveNodes.event);\n        this.renderers = renderers.map(r => new TreeRenderer(r, () => this.model, onDidChangeCollapseStateRelay.event, activeNodes, _options));\n        for (let r of this.renderers) {\n            this.disposables.add(r);\n        }\n        let filter;\n        if (_options.keyboardNavigationLabelProvider) {\n            filter = new TypeFilter(this, _options.keyboardNavigationLabelProvider, _options.filter);\n            _options = Object.assign(Object.assign({}, _options), { filter: filter }); // TODO need typescript help here\n            this.disposables.add(filter);\n        }\n        this.focus = new Trait(() => this.view.getFocusedElements()[0], _options.identityProvider);\n        this.selection = new Trait(() => this.view.getSelectedElements()[0], _options.identityProvider);\n        this.anchor = new Trait(() => this.view.getAnchorElement(), _options.identityProvider);\n        this.view = new TreeNodeList(user, container, treeDelegate, this.renderers, this.focus, this.selection, this.anchor, Object.assign(Object.assign({}, asListOptions(() => this.model, _options)), { tree: this }));\n        this.model = this.createModel(user, this.view, _options);\n        onDidChangeCollapseStateRelay.input = this.model.onDidChangeCollapseState;\n        const onDidModelSplice = Event.forEach(this.model.onDidSplice, e => {\n            this.eventBufferer.bufferEvents(() => {\n                this.focus.onDidModelSplice(e);\n                this.selection.onDidModelSplice(e);\n            });\n        });\n        // Make sure the `forEach` always runs\n        onDidModelSplice(() => null, null, this.disposables);\n        // Active nodes can change when the model changes or when focus or selection change.\n        // We debounce it with 0 delay since these events may fire in the same stack and we only\n        // want to run this once. It also doesn't matter if it runs on the next tick since it's only\n        // a nice to have UI feature.\n        onDidChangeActiveNodes.input = Event.chain(Event.any(onDidModelSplice, this.focus.onDidChange, this.selection.onDidChange))\n            .debounce(() => null, 0)\n            .map(() => {\n            const set = new Set();\n            for (const node of this.focus.getNodes()) {\n                set.add(node);\n            }\n            for (const node of this.selection.getNodes()) {\n                set.add(node);\n            }\n            return [...set.values()];\n        }).event;\n        if (_options.keyboardSupport !== false) {\n            const onKeyDown = Event.chain(this.view.onKeyDown)\n                .filter(e => !isInputElement(e.target))\n                .map(e => new StandardKeyboardEvent(e));\n            onKeyDown.filter(e => e.keyCode === 15 /* LeftArrow */).on(this.onLeftArrow, this, this.disposables);\n            onKeyDown.filter(e => e.keyCode === 17 /* RightArrow */).on(this.onRightArrow, this, this.disposables);\n            onKeyDown.filter(e => e.keyCode === 10 /* Space */).on(this.onSpace, this, this.disposables);\n        }\n        if (_options.keyboardNavigationLabelProvider) {\n            const delegate = _options.keyboardNavigationDelegate || DefaultKeyboardNavigationDelegate;\n            this.typeFilterController = new TypeFilterController(this, this.model, this.view, filter, delegate);\n            this.focusNavigationFilter = node => this.typeFilterController.shouldAllowFocus(node);\n            this.disposables.add(this.typeFilterController);\n        }\n        this.styleElement = createStyleSheet(this.view.getHTMLElement());\n        this.getHTMLElement().classList.toggle('always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n    }\n    get onDidChangeFocus() { return this.eventBufferer.wrapEvent(this.focus.onDidChange); }\n    get onDidChangeSelection() { return this.eventBufferer.wrapEvent(this.selection.onDidChange); }\n    get onMouseDblClick() { return Event.map(this.view.onMouseDblClick, asTreeMouseEvent); }\n    get onPointer() { return Event.map(this.view.onPointer, asTreeMouseEvent); }\n    get onDidFocus() { return this.view.onDidFocus; }\n    get onDidChangeCollapseState() { return this.model.onDidChangeCollapseState; }\n    get expandOnDoubleClick() { return typeof this._options.expandOnDoubleClick === 'undefined' ? true : this._options.expandOnDoubleClick; }\n    get expandOnlyOnTwistieClick() { return typeof this._options.expandOnlyOnTwistieClick === 'undefined' ? true : this._options.expandOnlyOnTwistieClick; }\n    get onDidDispose() { return this.view.onDidDispose; }\n    updateOptions(optionsUpdate = {}) {\n        this._options = Object.assign(Object.assign({}, this._options), optionsUpdate);\n        for (const renderer of this.renderers) {\n            renderer.updateOptions(optionsUpdate);\n        }\n        this.view.updateOptions(Object.assign(Object.assign({}, this._options), { enableKeyboardNavigation: this._options.simpleKeyboardNavigation }));\n        if (this.typeFilterController) {\n            this.typeFilterController.updateOptions(this._options);\n        }\n        this._onDidUpdateOptions.fire(this._options);\n        this.getHTMLElement().classList.toggle('always', this._options.renderIndentGuides === RenderIndentGuides.Always);\n    }\n    get options() {\n        return this._options;\n    }\n    // Widget\n    getHTMLElement() {\n        return this.view.getHTMLElement();\n    }\n    get scrollTop() {\n        return this.view.scrollTop;\n    }\n    set scrollTop(scrollTop) {\n        this.view.scrollTop = scrollTop;\n    }\n    domFocus() {\n        this.view.domFocus();\n    }\n    layout(height, width) {\n        this.view.layout(height, width);\n    }\n    style(styles) {\n        const suffix = `.${this.view.domId}`;\n        const content = [];\n        if (styles.treeIndentGuidesStroke) {\n            content.push(`.monaco-list${suffix}:hover .monaco-tl-indent > .indent-guide, .monaco-list${suffix}.always .monaco-tl-indent > .indent-guide  { border-color: ${styles.treeIndentGuidesStroke.transparent(0.4)}; }`);\n            content.push(`.monaco-list${suffix} .monaco-tl-indent > .indent-guide.active { border-color: ${styles.treeIndentGuidesStroke}; }`);\n        }\n        this.styleElement.textContent = content.join('\\n');\n        this.view.style(styles);\n    }\n    collapse(location, recursive = false) {\n        return this.model.setCollapsed(location, true, recursive);\n    }\n    expand(location, recursive = false) {\n        return this.model.setCollapsed(location, false, recursive);\n    }\n    isCollapsible(location) {\n        return this.model.isCollapsible(location);\n    }\n    setCollapsible(location, collapsible) {\n        return this.model.setCollapsible(location, collapsible);\n    }\n    isCollapsed(location) {\n        return this.model.isCollapsed(location);\n    }\n    refilter() {\n        this._onWillRefilter.fire(undefined);\n        this.model.refilter();\n    }\n    setSelection(elements, browserEvent) {\n        const nodes = elements.map(e => this.model.getNode(e));\n        this.selection.set(nodes, browserEvent);\n        const indexes = elements.map(e => this.model.getListIndex(e)).filter(i => i > -1);\n        this.view.setSelection(indexes, browserEvent, true);\n    }\n    getSelection() {\n        return this.selection.get();\n    }\n    setFocus(elements, browserEvent) {\n        const nodes = elements.map(e => this.model.getNode(e));\n        this.focus.set(nodes, browserEvent);\n        const indexes = elements.map(e => this.model.getListIndex(e)).filter(i => i > -1);\n        this.view.setFocus(indexes, browserEvent, true);\n    }\n    focusNext(n = 1, loop = false, browserEvent, filter = this.focusNavigationFilter) {\n        this.view.focusNext(n, loop, browserEvent, filter);\n    }\n    getFocus() {\n        return this.focus.get();\n    }\n    reveal(location, relativeTop) {\n        this.model.expandTo(location);\n        const index = this.model.getListIndex(location);\n        if (index === -1) {\n            return;\n        }\n        this.view.reveal(index, relativeTop);\n    }\n    /**\n     * Returns the relative position of an element rendered in the list.\n     * Returns `null` if the element isn't *entirely* in the visible viewport.\n     */\n    getRelativeTop(location) {\n        const index = this.model.getListIndex(location);\n        if (index === -1) {\n            return null;\n        }\n        return this.view.getRelativeTop(index);\n    }\n    // List\n    onLeftArrow(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const nodes = this.view.getFocusedElements();\n        if (nodes.length === 0) {\n            return;\n        }\n        const node = nodes[0];\n        const location = this.model.getNodeLocation(node);\n        const didChange = this.model.setCollapsed(location, true);\n        if (!didChange) {\n            const parentLocation = this.model.getParentNodeLocation(location);\n            if (!parentLocation) {\n                return;\n            }\n            const parentListIndex = this.model.getListIndex(parentLocation);\n            this.view.reveal(parentListIndex);\n            this.view.setFocus([parentListIndex]);\n        }\n    }\n    onRightArrow(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const nodes = this.view.getFocusedElements();\n        if (nodes.length === 0) {\n            return;\n        }\n        const node = nodes[0];\n        const location = this.model.getNodeLocation(node);\n        const didChange = this.model.setCollapsed(location, false);\n        if (!didChange) {\n            if (!node.children.some(child => child.visible)) {\n                return;\n            }\n            const [focusedIndex] = this.view.getFocus();\n            const firstChildIndex = focusedIndex + 1;\n            this.view.reveal(firstChildIndex);\n            this.view.setFocus([firstChildIndex]);\n        }\n    }\n    onSpace(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const nodes = this.view.getFocusedElements();\n        if (nodes.length === 0) {\n            return;\n        }\n        const node = nodes[0];\n        const location = this.model.getNodeLocation(node);\n        const recursive = e.browserEvent.altKey;\n        this.model.setCollapsed(location, undefined, recursive);\n    }\n    dispose() {\n        dispose(this.disposables);\n        this.view.dispose();\n    }\n}\n"]},"metadata":{},"sourceType":"module"}