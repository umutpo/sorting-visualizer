{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { IdleValue } from '../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { SimpleKeybinding } from '../../../base/common/keybindings.js';\nimport { DisposableStore, dispose, MutableDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { assertType, isObject } from '../../../base/common/types.js';\nimport { StableEditorScrollState } from '../../browser/core/editorState.js';\nimport { EditorAction, EditorCommand, registerEditorAction, registerEditorCommand, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { EditOperation } from '../../common/core/editOperation.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { SnippetController2 } from '../snippet/snippetController2.js';\nimport { SnippetParser } from '../snippet/snippetParser.js';\nimport { ISuggestMemoryService } from './suggestMemory.js';\nimport { WordContextKey } from './wordContextKey.js';\nimport * as nls from '../../../nls.js';\nimport { MenuRegistry } from '../../../platform/actions/common/actions.js';\nimport { CommandsRegistry, ICommandService } from '../../../platform/commands/common/commands.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingsRegistry } from '../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { Context as SuggestContext, suggestWidgetStatusbarMenu } from './suggest.js';\nimport { SuggestAlternatives } from './suggestAlternatives.js';\nimport { CommitCharacterController } from './suggestCommitCharacters.js';\nimport { SuggestModel } from './suggestModel.js';\nimport { OvertypingCapturer } from './suggestOvertypingCapturer.js';\nimport { SuggestWidget } from './suggestWidget.js'; // sticky suggest widget which doesn't disappear on focus out and such\n\nlet _sticky = false; // _sticky = Boolean(\"true\"); // done \"weirdly\" so that a lint warning prevents you from pushing this\n\nclass LineSuffix {\n  constructor(_model, _position) {\n    this._model = _model;\n    this._position = _position; // spy on what's happening right of the cursor. two cases:\n    // 1. end of line -> check that it's still end of line\n    // 2. mid of line -> add a marker and compute the delta\n\n    const maxColumn = _model.getLineMaxColumn(_position.lineNumber);\n\n    if (maxColumn !== _position.column) {\n      const offset = _model.getOffsetAt(_position);\n\n      const end = _model.getPositionAt(offset + 1);\n\n      this._marker = _model.deltaDecorations([], [{\n        range: Range.fromPositions(_position, end),\n        options: {\n          description: 'suggest-line-suffix',\n          stickiness: 1\n          /* NeverGrowsWhenTypingAtEdges */\n\n        }\n      }]);\n    }\n  }\n\n  dispose() {\n    if (this._marker && !this._model.isDisposed()) {\n      this._model.deltaDecorations(this._marker, []);\n    }\n  }\n\n  delta(position) {\n    if (this._model.isDisposed() || this._position.lineNumber !== position.lineNumber) {\n      // bail out early if things seems fishy\n      return 0;\n    } // read the marker (in case suggest was triggered at line end) or compare\n    // the cursor to the line end.\n\n\n    if (this._marker) {\n      const range = this._model.getDecorationRange(this._marker[0]);\n\n      const end = this._model.getOffsetAt(range.getStartPosition());\n\n      return end - this._model.getOffsetAt(position);\n    } else {\n      return this._model.getLineMaxColumn(position.lineNumber) - position.column;\n    }\n  }\n\n}\n\nlet SuggestController = class SuggestController {\n  constructor(editor, _memoryService, _commandService, _contextKeyService, _instantiationService, _logService) {\n    this._memoryService = _memoryService;\n    this._commandService = _commandService;\n    this._contextKeyService = _contextKeyService;\n    this._instantiationService = _instantiationService;\n    this._logService = _logService;\n    this._lineSuffix = new MutableDisposable();\n    this._toDispose = new DisposableStore();\n    this._selectors = new PriorityRegistry(s => s.priority);\n    this.editor = editor;\n    this.model = _instantiationService.createInstance(SuggestModel, this.editor); // context key: update insert/replace mode\n\n    const ctxInsertMode = SuggestContext.InsertMode.bindTo(_contextKeyService);\n    ctxInsertMode.set(editor.getOption(105\n    /* suggest */\n    ).insertMode);\n    this.model.onDidTrigger(() => ctxInsertMode.set(editor.getOption(105\n    /* suggest */\n    ).insertMode));\n    this.widget = this._toDispose.add(new IdleValue(() => {\n      const widget = this._instantiationService.createInstance(SuggestWidget, this.editor);\n\n      this._toDispose.add(widget);\n\n      this._toDispose.add(widget.onDidSelect(item => this._insertSuggestion(item, 0), this)); // Wire up logic to accept a suggestion on certain characters\n\n\n      const commitCharacterController = new CommitCharacterController(this.editor, widget, item => this._insertSuggestion(item, 2\n      /* NoAfterUndoStop */\n      ));\n\n      this._toDispose.add(commitCharacterController);\n\n      this._toDispose.add(this.model.onDidSuggest(e => {\n        if (e.completionModel.items.length === 0) {\n          commitCharacterController.reset();\n        }\n      })); // Wire up makes text edit context key\n\n\n      const ctxMakesTextEdit = SuggestContext.MakesTextEdit.bindTo(this._contextKeyService);\n      const ctxHasInsertAndReplace = SuggestContext.HasInsertAndReplaceRange.bindTo(this._contextKeyService);\n      const ctxCanResolve = SuggestContext.CanResolve.bindTo(this._contextKeyService);\n\n      this._toDispose.add(toDisposable(() => {\n        ctxMakesTextEdit.reset();\n        ctxHasInsertAndReplace.reset();\n        ctxCanResolve.reset();\n      }));\n\n      this._toDispose.add(widget.onDidFocus(_ref => {\n        let {\n          item\n        } = _ref;\n        // (ctx: makesTextEdit)\n        const position = this.editor.getPosition();\n        const startColumn = item.editStart.column;\n        const endColumn = position.column;\n        let value = true;\n\n        if (this.editor.getOption(1\n        /* acceptSuggestionOnEnter */\n        ) === 'smart' && this.model.state === 2\n        /* Auto */\n        && !item.completion.additionalTextEdits && !(item.completion.insertTextRules & 4\n        /* InsertAsSnippet */\n        ) && endColumn - startColumn === item.completion.insertText.length) {\n          const oldText = this.editor.getModel().getValueInRange({\n            startLineNumber: position.lineNumber,\n            startColumn,\n            endLineNumber: position.lineNumber,\n            endColumn\n          });\n          value = oldText !== item.completion.insertText;\n        }\n\n        ctxMakesTextEdit.set(value); // (ctx: hasInsertAndReplaceRange)\n\n        ctxHasInsertAndReplace.set(!Position.equals(item.editInsertEnd, item.editReplaceEnd)); // (ctx: canResolve)\n\n        ctxCanResolve.set(Boolean(item.provider.resolveCompletionItem) || Boolean(item.completion.documentation) || item.completion.detail !== item.completion.label);\n      }));\n\n      this._toDispose.add(widget.onDetailsKeyDown(e => {\n        // cmd + c on macOS, ctrl + c on Win / Linux\n        if (e.toKeybinding().equals(new SimpleKeybinding(true, false, false, false, 33\n        /* KeyC */\n        )) || platform.isMacintosh && e.toKeybinding().equals(new SimpleKeybinding(false, false, false, true, 33\n        /* KeyC */\n        ))) {\n          e.stopPropagation();\n          return;\n        }\n\n        if (!e.toKeybinding().isModifierKey()) {\n          this.editor.focus();\n        }\n      }));\n\n      return widget;\n    })); // Wire up text overtyping capture\n\n    this._overtypingCapturer = this._toDispose.add(new IdleValue(() => {\n      return this._toDispose.add(new OvertypingCapturer(this.editor, this.model));\n    }));\n    this._alternatives = this._toDispose.add(new IdleValue(() => {\n      return this._toDispose.add(new SuggestAlternatives(this.editor, this._contextKeyService));\n    }));\n\n    this._toDispose.add(_instantiationService.createInstance(WordContextKey, editor));\n\n    this._toDispose.add(this.model.onDidTrigger(e => {\n      this.widget.value.showTriggered(e.auto, e.shy ? 250 : 50);\n      this._lineSuffix.value = new LineSuffix(this.editor.getModel(), e.position);\n    }));\n\n    this._toDispose.add(this.model.onDidSuggest(e => {\n      if (!e.shy) {\n        let index = -1;\n\n        for (const selector of this._selectors.itemsOrderedByPriorityDesc) {\n          index = selector.select(this.editor.getModel(), this.editor.getPosition(), e.completionModel.items);\n\n          if (index !== -1) {\n            break;\n          }\n        }\n\n        if (index === -1) {\n          index = this._memoryService.select(this.editor.getModel(), this.editor.getPosition(), e.completionModel.items);\n        }\n\n        this.widget.value.showSuggestions(e.completionModel, index, e.isFrozen, e.auto);\n      }\n    }));\n\n    this._toDispose.add(this.model.onDidCancel(e => {\n      if (!e.retrigger) {\n        this.widget.value.hideWidget();\n      }\n    }));\n\n    this._toDispose.add(this.editor.onDidBlurEditorWidget(() => {\n      if (!_sticky) {\n        this.model.cancel();\n        this.model.clear();\n      }\n    })); // Manage the acceptSuggestionsOnEnter context key\n\n\n    let acceptSuggestionsOnEnter = SuggestContext.AcceptSuggestionsOnEnter.bindTo(_contextKeyService);\n\n    let updateFromConfig = () => {\n      const acceptSuggestionOnEnter = this.editor.getOption(1\n      /* acceptSuggestionOnEnter */\n      );\n      acceptSuggestionsOnEnter.set(acceptSuggestionOnEnter === 'on' || acceptSuggestionOnEnter === 'smart');\n    };\n\n    this._toDispose.add(this.editor.onDidChangeConfiguration(() => updateFromConfig()));\n\n    updateFromConfig();\n  }\n\n  static get(editor) {\n    return editor.getContribution(SuggestController.ID);\n  }\n\n  dispose() {\n    this._alternatives.dispose();\n\n    this._toDispose.dispose();\n\n    this.widget.dispose();\n    this.model.dispose();\n\n    this._lineSuffix.dispose();\n  }\n\n  _insertSuggestion(event, flags) {\n    if (!event || !event.item) {\n      this._alternatives.value.reset();\n\n      this.model.cancel();\n      this.model.clear();\n      return;\n    }\n\n    if (!this.editor.hasModel()) {\n      return;\n    }\n\n    const model = this.editor.getModel();\n    const modelVersionNow = model.getAlternativeVersionId();\n    const {\n      item\n    } = event; //\n\n    const tasks = [];\n    const cts = new CancellationTokenSource(); // pushing undo stops *before* additional text edits and\n    // *after* the main edit\n\n    if (!(flags & 1\n    /* NoBeforeUndoStop */\n    )) {\n      this.editor.pushUndoStop();\n    } // compute overwrite[Before|After] deltas BEFORE applying extra edits\n\n\n    const info = this.getOverwriteInfo(item, Boolean(flags & 8\n    /* AlternativeOverwriteConfig */\n    )); // keep item in memory\n\n    this._memoryService.memorize(model, this.editor.getPosition(), item);\n\n    if (Array.isArray(item.completion.additionalTextEdits)) {\n      // sync additional edits\n      const scrollState = StableEditorScrollState.capture(this.editor);\n      this.editor.executeEdits('suggestController.additionalTextEdits.sync', item.completion.additionalTextEdits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n      scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);\n    } else if (!item.isResolved) {\n      // async additional edits\n      const sw = new StopWatch(true);\n      let position;\n      const docListener = model.onDidChangeContent(e => {\n        if (e.isFlush) {\n          cts.cancel();\n          docListener.dispose();\n          return;\n        }\n\n        for (let change of e.changes) {\n          const thisPosition = Range.getEndPosition(change.range);\n\n          if (!position || Position.isBefore(thisPosition, position)) {\n            position = thisPosition;\n          }\n        }\n      });\n      let oldFlags = flags;\n      flags |= 2\n      /* NoAfterUndoStop */\n      ;\n      let didType = false;\n      let typeListener = this.editor.onWillType(() => {\n        typeListener.dispose();\n        didType = true;\n\n        if (!(oldFlags & 2\n        /* NoAfterUndoStop */\n        )) {\n          this.editor.pushUndoStop();\n        }\n      });\n      tasks.push(item.resolve(cts.token).then(() => {\n        if (!item.completion.additionalTextEdits || cts.token.isCancellationRequested) {\n          return false;\n        }\n\n        if (position && item.completion.additionalTextEdits.some(edit => Position.isBefore(position, Range.getStartPosition(edit.range)))) {\n          return false;\n        }\n\n        if (didType) {\n          this.editor.pushUndoStop();\n        }\n\n        const scrollState = StableEditorScrollState.capture(this.editor);\n        this.editor.executeEdits('suggestController.additionalTextEdits.async', item.completion.additionalTextEdits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n        scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);\n\n        if (didType || !(oldFlags & 2\n        /* NoAfterUndoStop */\n        )) {\n          this.editor.pushUndoStop();\n        }\n\n        return true;\n      }).then(applied => {\n        this._logService.trace('[suggest] async resolving of edits DONE (ms, applied?)', sw.elapsed(), applied);\n\n        docListener.dispose();\n        typeListener.dispose();\n      }));\n    }\n\n    let {\n      insertText\n    } = item.completion;\n\n    if (!(item.completion.insertTextRules & 4\n    /* InsertAsSnippet */\n    )) {\n      insertText = SnippetParser.escape(insertText);\n    }\n\n    SnippetController2.get(this.editor).insert(insertText, {\n      overwriteBefore: info.overwriteBefore,\n      overwriteAfter: info.overwriteAfter,\n      undoStopBefore: false,\n      undoStopAfter: false,\n      adjustWhitespace: !(item.completion.insertTextRules & 1\n      /* KeepWhitespace */\n      ),\n      clipboardText: event.model.clipboardText,\n      overtypingCapturer: this._overtypingCapturer.value\n    });\n\n    if (!(flags & 2\n    /* NoAfterUndoStop */\n    )) {\n      this.editor.pushUndoStop();\n    }\n\n    if (!item.completion.command) {\n      // done\n      this.model.cancel();\n    } else if (item.completion.command.id === TriggerSuggestAction.id) {\n      // retigger\n      this.model.trigger({\n        auto: true,\n        shy: false\n      }, true);\n    } else {\n      // exec command, done\n      tasks.push(this._commandService.executeCommand(item.completion.command.id, ...(item.completion.command.arguments ? [...item.completion.command.arguments] : [])).catch(onUnexpectedError));\n      this.model.cancel();\n    }\n\n    if (flags & 4\n    /* KeepAlternativeSuggestions */\n    ) {\n      this._alternatives.value.set(event, next => {\n        // cancel resolving of additional edits\n        cts.cancel(); // this is not so pretty. when inserting the 'next'\n        // suggestion we undo until we are at the state at\n        // which we were before inserting the previous suggestion...\n\n        while (model.canUndo()) {\n          if (modelVersionNow !== model.getAlternativeVersionId()) {\n            model.undo();\n          }\n\n          this._insertSuggestion(next, 1\n          /* NoBeforeUndoStop */\n          | 2\n          /* NoAfterUndoStop */\n          | (flags & 8\n          /* AlternativeOverwriteConfig */\n          ? 8\n          /* AlternativeOverwriteConfig */\n          : 0));\n\n          break;\n        }\n      });\n    }\n\n    this._alertCompletionItem(item); // clear only now - after all tasks are done\n\n\n    Promise.all(tasks).finally(() => {\n      this.model.clear();\n      cts.dispose();\n    });\n  }\n\n  getOverwriteInfo(item, toggleMode) {\n    assertType(this.editor.hasModel());\n    let replace = this.editor.getOption(105\n    /* suggest */\n    ).insertMode === 'replace';\n\n    if (toggleMode) {\n      replace = !replace;\n    }\n\n    const overwriteBefore = item.position.column - item.editStart.column;\n    const overwriteAfter = (replace ? item.editReplaceEnd.column : item.editInsertEnd.column) - item.position.column;\n    const columnDelta = this.editor.getPosition().column - item.position.column;\n    const suffixDelta = this._lineSuffix.value ? this._lineSuffix.value.delta(this.editor.getPosition()) : 0;\n    return {\n      overwriteBefore: overwriteBefore + columnDelta,\n      overwriteAfter: overwriteAfter + suffixDelta\n    };\n  }\n\n  _alertCompletionItem(item) {\n    if (isNonEmptyArray(item.completion.additionalTextEdits)) {\n      let msg = nls.localize('aria.alert.snippet', \"Accepting '{0}' made {1} additional edits\", item.textLabel, item.completion.additionalTextEdits.length);\n      alert(msg);\n    }\n  }\n\n  triggerSuggest(onlyFrom) {\n    if (this.editor.hasModel()) {\n      this.model.trigger({\n        auto: false,\n        shy: false\n      }, false, onlyFrom);\n      this.editor.revealPosition(this.editor.getPosition(), 0\n      /* Smooth */\n      );\n      this.editor.focus();\n    }\n  }\n\n  triggerSuggestAndAcceptBest(arg) {\n    if (!this.editor.hasModel()) {\n      return;\n    }\n\n    const positionNow = this.editor.getPosition();\n\n    const fallback = () => {\n      if (positionNow.equals(this.editor.getPosition())) {\n        this._commandService.executeCommand(arg.fallback);\n      }\n    };\n\n    const makesTextEdit = item => {\n      if (item.completion.insertTextRules & 4\n      /* InsertAsSnippet */\n      || item.completion.additionalTextEdits) {\n        // snippet, other editor -> makes edit\n        return true;\n      }\n\n      const position = this.editor.getPosition();\n      const startColumn = item.editStart.column;\n      const endColumn = position.column;\n\n      if (endColumn - startColumn !== item.completion.insertText.length) {\n        // unequal lengths -> makes edit\n        return true;\n      }\n\n      const textNow = this.editor.getModel().getValueInRange({\n        startLineNumber: position.lineNumber,\n        startColumn,\n        endLineNumber: position.lineNumber,\n        endColumn\n      }); // unequal text -> makes edit\n\n      return textNow !== item.completion.insertText;\n    };\n\n    Event.once(this.model.onDidTrigger)(_ => {\n      // wait for trigger because only then the cancel-event is trustworthy\n      let listener = [];\n      Event.any(this.model.onDidTrigger, this.model.onDidCancel)(() => {\n        // retrigger or cancel -> try to type default text\n        dispose(listener);\n        fallback();\n      }, undefined, listener);\n      this.model.onDidSuggest(_ref2 => {\n        let {\n          completionModel\n        } = _ref2;\n        dispose(listener);\n\n        if (completionModel.items.length === 0) {\n          fallback();\n          return;\n        }\n\n        const index = this._memoryService.select(this.editor.getModel(), this.editor.getPosition(), completionModel.items);\n\n        const item = completionModel.items[index];\n\n        if (!makesTextEdit(item)) {\n          fallback();\n          return;\n        }\n\n        this.editor.pushUndoStop();\n\n        this._insertSuggestion({\n          index,\n          item,\n          model: completionModel\n        }, 4\n        /* KeepAlternativeSuggestions */\n        | 1\n        /* NoBeforeUndoStop */\n        | 2\n        /* NoAfterUndoStop */\n        );\n      }, undefined, listener);\n    });\n    this.model.trigger({\n      auto: false,\n      shy: true\n    });\n    this.editor.revealPosition(positionNow, 0\n    /* Smooth */\n    );\n    this.editor.focus();\n  }\n\n  acceptSelectedSuggestion(keepAlternativeSuggestions, alternativeOverwriteConfig) {\n    const item = this.widget.value.getFocusedItem();\n    let flags = 0;\n\n    if (keepAlternativeSuggestions) {\n      flags |= 4\n      /* KeepAlternativeSuggestions */\n      ;\n    }\n\n    if (alternativeOverwriteConfig) {\n      flags |= 8\n      /* AlternativeOverwriteConfig */\n      ;\n    }\n\n    this._insertSuggestion(item, flags);\n  }\n\n  acceptNextSuggestion() {\n    this._alternatives.value.next();\n  }\n\n  acceptPrevSuggestion() {\n    this._alternatives.value.prev();\n  }\n\n  cancelSuggestWidget() {\n    this.model.cancel();\n    this.model.clear();\n    this.widget.value.hideWidget();\n  }\n\n  selectNextSuggestion() {\n    this.widget.value.selectNext();\n  }\n\n  selectNextPageSuggestion() {\n    this.widget.value.selectNextPage();\n  }\n\n  selectLastSuggestion() {\n    this.widget.value.selectLast();\n  }\n\n  selectPrevSuggestion() {\n    this.widget.value.selectPrevious();\n  }\n\n  selectPrevPageSuggestion() {\n    this.widget.value.selectPreviousPage();\n  }\n\n  selectFirstSuggestion() {\n    this.widget.value.selectFirst();\n  }\n\n  toggleSuggestionDetails() {\n    this.widget.value.toggleDetails();\n  }\n\n  toggleExplainMode() {\n    this.widget.value.toggleExplainMode();\n  }\n\n  toggleSuggestionFocus() {\n    this.widget.value.toggleDetailsFocus();\n  }\n\n  resetWidgetSize() {\n    this.widget.value.resetPersistedSize();\n  }\n\n  forceRenderingAbove() {\n    this.widget.value.forceRenderingAbove();\n  }\n\n  stopForceRenderingAbove() {\n    if (!this.widget.isInitialized) {\n      // This method has no effect if the widget is not initialized yet.\n      return;\n    }\n\n    this.widget.value.stopForceRenderingAbove();\n  }\n\n  registerSelector(selector) {\n    return this._selectors.register(selector);\n  }\n\n};\nSuggestController.ID = 'editor.contrib.suggestController';\nSuggestController = __decorate([__param(1, ISuggestMemoryService), __param(2, ICommandService), __param(3, IContextKeyService), __param(4, IInstantiationService), __param(5, ILogService)], SuggestController);\nexport { SuggestController };\n\nclass PriorityRegistry {\n  constructor(prioritySelector) {\n    this.prioritySelector = prioritySelector;\n    this._items = new Array();\n  }\n\n  register(value) {\n    if (this._items.indexOf(value) !== -1) {\n      throw new Error('Value is already registered');\n    }\n\n    this._items.push(value);\n\n    this._items.sort((s1, s2) => this.prioritySelector(s2) - this.prioritySelector(s1));\n\n    return {\n      dispose: () => {\n        const idx = this._items.indexOf(value);\n\n        if (idx >= 0) {\n          this._items.splice(idx, 1);\n        }\n      }\n    };\n  }\n\n  get itemsOrderedByPriorityDesc() {\n    return this._items;\n  }\n\n}\n\nexport class TriggerSuggestAction extends EditorAction {\n  constructor() {\n    super({\n      id: TriggerSuggestAction.id,\n      label: nls.localize('suggest.trigger.label', \"Trigger Suggest\"),\n      alias: 'Trigger Suggest',\n      precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCompletionItemProvider),\n      kbOpts: {\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 10\n        /* Space */\n        ,\n        secondary: [2048\n        /* CtrlCmd */\n        | 39\n        /* KeyI */\n        ],\n        mac: {\n          primary: 256\n          /* WinCtrl */\n          | 10\n          /* Space */\n          ,\n          secondary: [512\n          /* Alt */\n          | 9\n          /* Escape */\n          , 2048\n          /* CtrlCmd */\n          | 39\n          /* KeyI */\n          ]\n        },\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  run(accessor, editor) {\n    const controller = SuggestController.get(editor);\n\n    if (!controller) {\n      return;\n    }\n\n    controller.triggerSuggest();\n  }\n\n}\nTriggerSuggestAction.id = 'editor.action.triggerSuggest';\nregisterEditorContribution(SuggestController.ID, SuggestController);\nregisterEditorAction(TriggerSuggestAction);\nconst weight = 100\n/* EditorContrib */\n+ 90;\nconst SuggestCommand = EditorCommand.bindToContribution(SuggestController.get);\nregisterEditorCommand(new SuggestCommand({\n  id: 'acceptSelectedSuggestion',\n  precondition: SuggestContext.Visible,\n\n  handler(x) {\n    x.acceptSelectedSuggestion(true, false);\n  }\n\n})); // normal tab\n\nKeybindingsRegistry.registerKeybindingRule({\n  id: 'acceptSelectedSuggestion',\n  when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\n  primary: 2\n  /* Tab */\n  ,\n  weight\n}); // accept on enter has special rules\n\nKeybindingsRegistry.registerKeybindingRule({\n  id: 'acceptSelectedSuggestion',\n  when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus, SuggestContext.AcceptSuggestionsOnEnter, SuggestContext.MakesTextEdit),\n  primary: 3\n  /* Enter */\n  ,\n  weight\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n  command: {\n    id: 'acceptSelectedSuggestion',\n    title: nls.localize('accept.insert', \"Insert\")\n  },\n  group: 'left',\n  order: 1,\n  when: SuggestContext.HasInsertAndReplaceRange.toNegated()\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n  command: {\n    id: 'acceptSelectedSuggestion',\n    title: nls.localize('accept.insert', \"Insert\")\n  },\n  group: 'left',\n  order: 1,\n  when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('insert'))\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n  command: {\n    id: 'acceptSelectedSuggestion',\n    title: nls.localize('accept.replace', \"Replace\")\n  },\n  group: 'left',\n  order: 1,\n  when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('replace'))\n});\nregisterEditorCommand(new SuggestCommand({\n  id: 'acceptAlternativeSelectedSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 1024\n    /* Shift */\n    | 3\n    /* Enter */\n    ,\n    secondary: [1024\n    /* Shift */\n    | 2\n    /* Tab */\n    ]\n  },\n\n  handler(x) {\n    x.acceptSelectedSuggestion(false, true);\n  },\n\n  menuOpts: [{\n    menuId: suggestWidgetStatusbarMenu,\n    group: 'left',\n    order: 2,\n    when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('insert')),\n    title: nls.localize('accept.replace', \"Replace\")\n  }, {\n    menuId: suggestWidgetStatusbarMenu,\n    group: 'left',\n    order: 2,\n    when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('replace')),\n    title: nls.localize('accept.insert', \"Insert\")\n  }]\n})); // continue to support the old command\n\nCommandsRegistry.registerCommandAlias('acceptSelectedSuggestionOnEnter', 'acceptSelectedSuggestion');\nregisterEditorCommand(new SuggestCommand({\n  id: 'hideSuggestWidget',\n  precondition: SuggestContext.Visible,\n  handler: x => x.cancelSuggestWidget(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 9\n    /* Escape */\n    ,\n    secondary: [1024\n    /* Shift */\n    | 9\n    /* Escape */\n    ]\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectNextSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectNextSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 18\n    /* DownArrow */\n    ,\n    secondary: [2048\n    /* CtrlCmd */\n    | 18\n    /* DownArrow */\n    ],\n    mac: {\n      primary: 18\n      /* DownArrow */\n      ,\n      secondary: [2048\n      /* CtrlCmd */\n      | 18\n      /* DownArrow */\n      , 256\n      /* WinCtrl */\n      | 44\n      /* KeyN */\n      ]\n    }\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectNextPageSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectNextPageSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 12\n    /* PageDown */\n    ,\n    secondary: [2048\n    /* CtrlCmd */\n    | 12\n    /* PageDown */\n    ]\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectLastSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectLastSuggestion()\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectPrevSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectPrevSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 16\n    /* UpArrow */\n    ,\n    secondary: [2048\n    /* CtrlCmd */\n    | 16\n    /* UpArrow */\n    ],\n    mac: {\n      primary: 16\n      /* UpArrow */\n      ,\n      secondary: [2048\n      /* CtrlCmd */\n      | 16\n      /* UpArrow */\n      , 256\n      /* WinCtrl */\n      | 46\n      /* KeyP */\n      ]\n    }\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectPrevPageSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectPrevPageSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 11\n    /* PageUp */\n    ,\n    secondary: [2048\n    /* CtrlCmd */\n    | 11\n    /* PageUp */\n    ]\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'selectFirstSuggestion',\n  precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n  handler: c => c.selectFirstSuggestion()\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'toggleSuggestionDetails',\n  precondition: SuggestContext.Visible,\n  handler: x => x.toggleSuggestionDetails(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 2048\n    /* CtrlCmd */\n    | 10\n    /* Space */\n    ,\n    secondary: [2048\n    /* CtrlCmd */\n    | 39\n    /* KeyI */\n    ],\n    mac: {\n      primary: 256\n      /* WinCtrl */\n      | 10\n      /* Space */\n      ,\n      secondary: [2048\n      /* CtrlCmd */\n      | 39\n      /* KeyI */\n      ]\n    }\n  },\n  menuOpts: [{\n    menuId: suggestWidgetStatusbarMenu,\n    group: 'right',\n    order: 1,\n    when: ContextKeyExpr.and(SuggestContext.DetailsVisible, SuggestContext.CanResolve),\n    title: nls.localize('detail.more', \"show less\")\n  }, {\n    menuId: suggestWidgetStatusbarMenu,\n    group: 'right',\n    order: 1,\n    when: ContextKeyExpr.and(SuggestContext.DetailsVisible.toNegated(), SuggestContext.CanResolve),\n    title: nls.localize('detail.less', \"show more\")\n  }]\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'toggleExplainMode',\n  precondition: SuggestContext.Visible,\n  handler: x => x.toggleExplainMode(),\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    ,\n    primary: 2048\n    /* CtrlCmd */\n    | 85\n    /* Slash */\n\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'toggleSuggestionFocus',\n  precondition: SuggestContext.Visible,\n  handler: x => x.toggleSuggestionFocus(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 2048\n    /* CtrlCmd */\n    | 512\n    /* Alt */\n    | 10\n    /* Space */\n    ,\n    mac: {\n      primary: 256\n      /* WinCtrl */\n      | 512\n      /* Alt */\n      | 10\n      /* Space */\n\n    }\n  }\n})); //#region tab completions\n\nregisterEditorCommand(new SuggestCommand({\n  id: 'insertBestCompletion',\n  precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), WordContextKey.AtEnd, SuggestContext.Visible.toNegated(), SuggestAlternatives.OtherSuggestions.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n  handler: (x, arg) => {\n    x.triggerSuggestAndAcceptBest(isObject(arg) ? Object.assign({\n      fallback: 'tab'\n    }, arg) : {\n      fallback: 'tab'\n    });\n  },\n  kbOpts: {\n    weight,\n    primary: 2\n    /* Tab */\n\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'insertNextSuggestion',\n  precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n  handler: x => x.acceptNextSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 2\n    /* Tab */\n\n  }\n}));\nregisterEditorCommand(new SuggestCommand({\n  id: 'insertPrevSuggestion',\n  precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n  handler: x => x.acceptPrevSuggestion(),\n  kbOpts: {\n    weight: weight,\n    kbExpr: EditorContextKeys.textInputFocus,\n    primary: 1024\n    /* Shift */\n    | 2\n    /* Tab */\n\n  }\n}));\nregisterEditorAction(class extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.resetSuggestSize',\n      label: nls.localize('suggest.reset.label', \"Reset Suggest Widget Size\"),\n      alias: 'Reset Suggest Widget Size',\n      precondition: undefined\n    });\n  }\n\n  run(_accessor, editor) {\n    SuggestController.get(editor).resetWidgetSize();\n  }\n\n});","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestController.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","alert","isNonEmptyArray","IdleValue","CancellationTokenSource","onUnexpectedError","Event","SimpleKeybinding","DisposableStore","dispose","MutableDisposable","toDisposable","platform","StopWatch","assertType","isObject","StableEditorScrollState","EditorAction","EditorCommand","registerEditorAction","registerEditorCommand","registerEditorContribution","EditOperation","Position","Range","EditorContextKeys","SnippetController2","SnippetParser","ISuggestMemoryService","WordContextKey","nls","MenuRegistry","CommandsRegistry","ICommandService","ContextKeyExpr","IContextKeyService","IInstantiationService","KeybindingsRegistry","ILogService","Context","SuggestContext","suggestWidgetStatusbarMenu","SuggestAlternatives","CommitCharacterController","SuggestModel","OvertypingCapturer","SuggestWidget","_sticky","LineSuffix","constructor","_model","_position","maxColumn","getLineMaxColumn","lineNumber","column","offset","getOffsetAt","end","getPositionAt","_marker","deltaDecorations","range","fromPositions","options","description","stickiness","isDisposed","delta","position","getDecorationRange","getStartPosition","SuggestController","editor","_memoryService","_commandService","_contextKeyService","_instantiationService","_logService","_lineSuffix","_toDispose","_selectors","PriorityRegistry","s","priority","model","createInstance","ctxInsertMode","InsertMode","bindTo","set","getOption","insertMode","onDidTrigger","widget","add","onDidSelect","item","_insertSuggestion","commitCharacterController","onDidSuggest","e","completionModel","items","reset","ctxMakesTextEdit","MakesTextEdit","ctxHasInsertAndReplace","HasInsertAndReplaceRange","ctxCanResolve","CanResolve","onDidFocus","getPosition","startColumn","editStart","endColumn","value","state","completion","additionalTextEdits","insertTextRules","insertText","oldText","getModel","getValueInRange","startLineNumber","endLineNumber","equals","editInsertEnd","editReplaceEnd","Boolean","provider","resolveCompletionItem","documentation","detail","label","onDetailsKeyDown","toKeybinding","isMacintosh","stopPropagation","isModifierKey","focus","_overtypingCapturer","_alternatives","showTriggered","auto","shy","index","selector","itemsOrderedByPriorityDesc","select","showSuggestions","isFrozen","onDidCancel","retrigger","hideWidget","onDidBlurEditorWidget","cancel","clear","acceptSuggestionsOnEnter","AcceptSuggestionsOnEnter","updateFromConfig","acceptSuggestionOnEnter","onDidChangeConfiguration","get","getContribution","ID","event","flags","hasModel","modelVersionNow","getAlternativeVersionId","tasks","cts","pushUndoStop","info","getOverwriteInfo","memorize","Array","isArray","scrollState","capture","executeEdits","map","edit","replace","lift","text","restoreRelativeVerticalPositionOfCursor","isResolved","sw","docListener","onDidChangeContent","isFlush","change","changes","thisPosition","getEndPosition","isBefore","oldFlags","didType","typeListener","onWillType","push","resolve","token","then","isCancellationRequested","some","applied","trace","elapsed","escape","insert","overwriteBefore","overwriteAfter","undoStopBefore","undoStopAfter","adjustWhitespace","clipboardText","overtypingCapturer","command","id","TriggerSuggestAction","trigger","executeCommand","catch","next","canUndo","undo","_alertCompletionItem","Promise","all","finally","toggleMode","columnDelta","suffixDelta","msg","localize","textLabel","triggerSuggest","onlyFrom","revealPosition","triggerSuggestAndAcceptBest","arg","positionNow","fallback","makesTextEdit","textNow","once","_","listener","any","undefined","acceptSelectedSuggestion","keepAlternativeSuggestions","alternativeOverwriteConfig","getFocusedItem","acceptNextSuggestion","acceptPrevSuggestion","prev","cancelSuggestWidget","selectNextSuggestion","selectNext","selectNextPageSuggestion","selectNextPage","selectLastSuggestion","selectLast","selectPrevSuggestion","selectPrevious","selectPrevPageSuggestion","selectPreviousPage","selectFirstSuggestion","selectFirst","toggleSuggestionDetails","toggleDetails","toggleExplainMode","toggleSuggestionFocus","toggleDetailsFocus","resetWidgetSize","resetPersistedSize","forceRenderingAbove","stopForceRenderingAbove","isInitialized","registerSelector","register","prioritySelector","_items","indexOf","Error","sort","s1","s2","idx","splice","alias","precondition","and","writable","hasCompletionItemProvider","kbOpts","kbExpr","textInputFocus","primary","secondary","mac","weight","run","accessor","controller","SuggestCommand","bindToContribution","Visible","handler","x","registerKeybindingRule","when","appendMenuItem","title","group","order","toNegated","isEqualTo","menuOpts","menuId","registerCommandAlias","MultipleSuggestions","DetailsVisible","AtEnd","OtherSuggestions","InSnippetMode","assign","_accessor"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,IAAIQ,OAAO,GAAI,QAAQ,KAAKA,OAAd,IAA0B,UAAUC,UAAV,EAAsBC,SAAtB,EAAiC;AACrE,SAAO,UAAUhB,MAAV,EAAkBC,GAAlB,EAAuB;AAAEe,IAAAA,SAAS,CAAChB,MAAD,EAASC,GAAT,EAAcc,UAAd,CAAT;AAAqC,GAArE;AACH,CAFD;;AAGA,SAASE,KAAT,QAAsB,uCAAtB;AACA,SAASC,eAAT,QAAgC,gCAAhC;AACA,SAASC,SAAT,QAA0B,+BAA1B;AACA,SAASC,uBAAT,QAAwC,sCAAxC;AACA,SAASC,iBAAT,QAAkC,gCAAlC;AACA,SAASC,KAAT,QAAsB,+BAAtB;AACA,SAASC,gBAAT,QAAiC,qCAAjC;AACA,SAASC,eAAT,EAA0BC,OAA1B,EAAmCC,iBAAnC,EAAsDC,YAAtD,QAA0E,mCAA1E;AACA,OAAO,KAAKC,QAAZ,MAA0B,kCAA1B;AACA,SAASC,SAAT,QAA0B,mCAA1B;AACA,SAASC,UAAT,EAAqBC,QAArB,QAAqC,+BAArC;AACA,SAASC,uBAAT,QAAwC,mCAAxC;AACA,SAASC,YAAT,EAAuBC,aAAvB,EAAsCC,oBAAtC,EAA4DC,qBAA5D,EAAmFC,0BAAnF,QAAqH,mCAArH;AACA,SAASC,aAAT,QAA8B,oCAA9B;AACA,SAASC,QAAT,QAAyB,+BAAzB;AACA,SAASC,KAAT,QAAsB,4BAAtB;AACA,SAASC,iBAAT,QAAkC,mCAAlC;AACA,SAASC,kBAAT,QAAmC,kCAAnC;AACA,SAASC,aAAT,QAA8B,6BAA9B;AACA,SAASC,qBAAT,QAAsC,oBAAtC;AACA,SAASC,cAAT,QAA+B,qBAA/B;AACA,OAAO,KAAKC,GAAZ,MAAqB,iBAArB;AACA,SAASC,YAAT,QAA6B,6CAA7B;AACA,SAASC,gBAAT,EAA2BC,eAA3B,QAAkD,+CAAlD;AACA,SAASC,cAAT,EAAyBC,kBAAzB,QAAmD,mDAAnD;AACA,SAASC,qBAAT,QAAsC,yDAAtC;AACA,SAASC,mBAAT,QAAoC,4DAApC;AACA,SAASC,WAAT,QAA4B,qCAA5B;AACA,SAASC,OAAO,IAAIC,cAApB,EAAoCC,0BAApC,QAAsE,cAAtE;AACA,SAASC,mBAAT,QAAoC,0BAApC;AACA,SAASC,yBAAT,QAA0C,8BAA1C;AACA,SAASC,YAAT,QAA6B,mBAA7B;AACA,SAASC,kBAAT,QAAmC,gCAAnC;AACA,SAASC,aAAT,QAA8B,oBAA9B,C,CACA;;AACA,IAAIC,OAAO,GAAG,KAAd,C,CACA;;AACA,MAAMC,UAAN,CAAiB;AACbC,EAAAA,WAAW,CAACC,MAAD,EAASC,SAAT,EAAoB;AAC3B,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,SAAL,GAAiBA,SAAjB,CAF2B,CAG3B;AACA;AACA;;AACA,UAAMC,SAAS,GAAGF,MAAM,CAACG,gBAAP,CAAwBF,SAAS,CAACG,UAAlC,CAAlB;;AACA,QAAIF,SAAS,KAAKD,SAAS,CAACI,MAA5B,EAAoC;AAChC,YAAMC,MAAM,GAAGN,MAAM,CAACO,WAAP,CAAmBN,SAAnB,CAAf;;AACA,YAAMO,GAAG,GAAGR,MAAM,CAACS,aAAP,CAAqBH,MAAM,GAAG,CAA9B,CAAZ;;AACA,WAAKI,OAAL,GAAeV,MAAM,CAACW,gBAAP,CAAwB,EAAxB,EAA4B,CAAC;AACpCC,QAAAA,KAAK,EAAEtC,KAAK,CAACuC,aAAN,CAAoBZ,SAApB,EAA+BO,GAA/B,CAD6B;AAEpCM,QAAAA,OAAO,EAAE;AAAEC,UAAAA,WAAW,EAAE,qBAAf;AAAsCC,UAAAA,UAAU,EAAE;AAAE;;AAApD;AAF2B,OAAD,CAA5B,CAAf;AAIH;AACJ;;AACDzD,EAAAA,OAAO,GAAG;AACN,QAAI,KAAKmD,OAAL,IAAgB,CAAC,KAAKV,MAAL,CAAYiB,UAAZ,EAArB,EAA+C;AAC3C,WAAKjB,MAAL,CAAYW,gBAAZ,CAA6B,KAAKD,OAAlC,EAA2C,EAA3C;AACH;AACJ;;AACDQ,EAAAA,KAAK,CAACC,QAAD,EAAW;AACZ,QAAI,KAAKnB,MAAL,CAAYiB,UAAZ,MAA4B,KAAKhB,SAAL,CAAeG,UAAf,KAA8Be,QAAQ,CAACf,UAAvE,EAAmF;AAC/E;AACA,aAAO,CAAP;AACH,KAJW,CAKZ;AACA;;;AACA,QAAI,KAAKM,OAAT,EAAkB;AACd,YAAME,KAAK,GAAG,KAAKZ,MAAL,CAAYoB,kBAAZ,CAA+B,KAAKV,OAAL,CAAa,CAAb,CAA/B,CAAd;;AACA,YAAMF,GAAG,GAAG,KAAKR,MAAL,CAAYO,WAAZ,CAAwBK,KAAK,CAACS,gBAAN,EAAxB,CAAZ;;AACA,aAAOb,GAAG,GAAG,KAAKR,MAAL,CAAYO,WAAZ,CAAwBY,QAAxB,CAAb;AACH,KAJD,MAKK;AACD,aAAO,KAAKnB,MAAL,CAAYG,gBAAZ,CAA6BgB,QAAQ,CAACf,UAAtC,IAAoDe,QAAQ,CAACd,MAApE;AACH;AACJ;;AArCY;;AAuCjB,IAAIiB,iBAAiB,GAAG,MAAMA,iBAAN,CAAwB;AAC5CvB,EAAAA,WAAW,CAACwB,MAAD,EAASC,cAAT,EAAyBC,eAAzB,EAA0CC,kBAA1C,EAA8DC,qBAA9D,EAAqFC,WAArF,EAAkG;AACzG,SAAKJ,cAAL,GAAsBA,cAAtB;AACA,SAAKC,eAAL,GAAuBA,eAAvB;AACA,SAAKC,kBAAL,GAA0BA,kBAA1B;AACA,SAAKC,qBAAL,GAA6BA,qBAA7B;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,WAAL,GAAmB,IAAIrE,iBAAJ,EAAnB;AACA,SAAKsE,UAAL,GAAkB,IAAIxE,eAAJ,EAAlB;AACA,SAAKyE,UAAL,GAAkB,IAAIC,gBAAJ,CAAqBC,CAAC,IAAIA,CAAC,CAACC,QAA5B,CAAlB;AACA,SAAKX,MAAL,GAAcA,MAAd;AACA,SAAKY,KAAL,GAAaR,qBAAqB,CAACS,cAAtB,CAAqC1C,YAArC,EAAmD,KAAK6B,MAAxD,CAAb,CAVyG,CAWzG;;AACA,UAAMc,aAAa,GAAG/C,cAAc,CAACgD,UAAf,CAA0BC,MAA1B,CAAiCb,kBAAjC,CAAtB;AACAW,IAAAA,aAAa,CAACG,GAAd,CAAkBjB,MAAM,CAACkB,SAAP,CAAiB;AAAI;AAArB,MAAoCC,UAAtD;AACA,SAAKP,KAAL,CAAWQ,YAAX,CAAwB,MAAMN,aAAa,CAACG,GAAd,CAAkBjB,MAAM,CAACkB,SAAP,CAAiB;AAAI;AAArB,MAAoCC,UAAtD,CAA9B;AACA,SAAKE,MAAL,GAAc,KAAKd,UAAL,CAAgBe,GAAhB,CAAoB,IAAI5F,SAAJ,CAAc,MAAM;AAClD,YAAM2F,MAAM,GAAG,KAAKjB,qBAAL,CAA2BS,cAA3B,CAA0CxC,aAA1C,EAAyD,KAAK2B,MAA9D,CAAf;;AACA,WAAKO,UAAL,CAAgBe,GAAhB,CAAoBD,MAApB;;AACA,WAAKd,UAAL,CAAgBe,GAAhB,CAAoBD,MAAM,CAACE,WAAP,CAAmBC,IAAI,IAAI,KAAKC,iBAAL,CAAuBD,IAAvB,EAA6B,CAA7B,CAA3B,EAA4D,IAA5D,CAApB,EAHkD,CAIlD;;;AACA,YAAME,yBAAyB,GAAG,IAAIxD,yBAAJ,CAA8B,KAAK8B,MAAnC,EAA2CqB,MAA3C,EAAmDG,IAAI,IAAI,KAAKC,iBAAL,CAAuBD,IAAvB,EAA6B;AAAE;AAA/B,OAA3D,CAAlC;;AACA,WAAKjB,UAAL,CAAgBe,GAAhB,CAAoBI,yBAApB;;AACA,WAAKnB,UAAL,CAAgBe,GAAhB,CAAoB,KAAKV,KAAL,CAAWe,YAAX,CAAwBC,CAAC,IAAI;AAC7C,YAAIA,CAAC,CAACC,eAAF,CAAkBC,KAAlB,CAAwBlH,MAAxB,KAAmC,CAAvC,EAA0C;AACtC8G,UAAAA,yBAAyB,CAACK,KAA1B;AACH;AACJ,OAJmB,CAApB,EAPkD,CAYlD;;;AACA,YAAMC,gBAAgB,GAAGjE,cAAc,CAACkE,aAAf,CAA6BjB,MAA7B,CAAoC,KAAKb,kBAAzC,CAAzB;AACA,YAAM+B,sBAAsB,GAAGnE,cAAc,CAACoE,wBAAf,CAAwCnB,MAAxC,CAA+C,KAAKb,kBAApD,CAA/B;AACA,YAAMiC,aAAa,GAAGrE,cAAc,CAACsE,UAAf,CAA0BrB,MAA1B,CAAiC,KAAKb,kBAAtC,CAAtB;;AACA,WAAKI,UAAL,CAAgBe,GAAhB,CAAoBpF,YAAY,CAAC,MAAM;AACnC8F,QAAAA,gBAAgB,CAACD,KAAjB;AACAG,QAAAA,sBAAsB,CAACH,KAAvB;AACAK,QAAAA,aAAa,CAACL,KAAd;AACH,OAJ+B,CAAhC;;AAKA,WAAKxB,UAAL,CAAgBe,GAAhB,CAAoBD,MAAM,CAACiB,UAAP,CAAkB,QAAc;AAAA,YAAb;AAAEd,UAAAA;AAAF,SAAa;AAChD;AACA,cAAM5B,QAAQ,GAAG,KAAKI,MAAL,CAAYuC,WAAZ,EAAjB;AACA,cAAMC,WAAW,GAAGhB,IAAI,CAACiB,SAAL,CAAe3D,MAAnC;AACA,cAAM4D,SAAS,GAAG9C,QAAQ,CAACd,MAA3B;AACA,YAAI6D,KAAK,GAAG,IAAZ;;AACA,YAAI,KAAK3C,MAAL,CAAYkB,SAAZ,CAAsB;AAAE;AAAxB,cAA2D,OAA3D,IACG,KAAKN,KAAL,CAAWgC,KAAX,KAAqB;AAAE;AAD1B,WAEG,CAACpB,IAAI,CAACqB,UAAL,CAAgBC,mBAFpB,IAGG,EAAEtB,IAAI,CAACqB,UAAL,CAAgBE,eAAhB,GAAkC;AAAE;AAAtC,SAHH,IAIGL,SAAS,GAAGF,WAAZ,KAA4BhB,IAAI,CAACqB,UAAL,CAAgBG,UAAhB,CAA2BpI,MAJ9D,EAIsE;AAClE,gBAAMqI,OAAO,GAAG,KAAKjD,MAAL,CAAYkD,QAAZ,GAAuBC,eAAvB,CAAuC;AACnDC,YAAAA,eAAe,EAAExD,QAAQ,CAACf,UADyB;AAEnD2D,YAAAA,WAFmD;AAGnDa,YAAAA,aAAa,EAAEzD,QAAQ,CAACf,UAH2B;AAInD6D,YAAAA;AAJmD,WAAvC,CAAhB;AAMAC,UAAAA,KAAK,GAAGM,OAAO,KAAKzB,IAAI,CAACqB,UAAL,CAAgBG,UAApC;AACH;;AACDhB,QAAAA,gBAAgB,CAACf,GAAjB,CAAqB0B,KAArB,EAnBgD,CAoBhD;;AACAT,QAAAA,sBAAsB,CAACjB,GAAvB,CAA2B,CAACnE,QAAQ,CAACwG,MAAT,CAAgB9B,IAAI,CAAC+B,aAArB,EAAoC/B,IAAI,CAACgC,cAAzC,CAA5B,EArBgD,CAsBhD;;AACApB,QAAAA,aAAa,CAACnB,GAAd,CAAkBwC,OAAO,CAACjC,IAAI,CAACkC,QAAL,CAAcC,qBAAf,CAAP,IAAgDF,OAAO,CAACjC,IAAI,CAACqB,UAAL,CAAgBe,aAAjB,CAAvD,IAA0FpC,IAAI,CAACqB,UAAL,CAAgBgB,MAAhB,KAA2BrC,IAAI,CAACqB,UAAL,CAAgBiB,KAAvJ;AACH,OAxBmB,CAApB;;AAyBA,WAAKvD,UAAL,CAAgBe,GAAhB,CAAoBD,MAAM,CAAC0C,gBAAP,CAAwBnC,CAAC,IAAI;AAC7C;AACA,YAAIA,CAAC,CAACoC,YAAF,GAAiBV,MAAjB,CAAwB,IAAIxH,gBAAJ,CAAqB,IAArB,EAA2B,KAA3B,EAAkC,KAAlC,EAAyC,KAAzC,EAAgD;AAAG;AAAnD,SAAxB,KACCK,QAAQ,CAAC8H,WAAT,IAAwBrC,CAAC,CAACoC,YAAF,GAAiBV,MAAjB,CAAwB,IAAIxH,gBAAJ,CAAqB,KAArB,EAA4B,KAA5B,EAAmC,KAAnC,EAA0C,IAA1C,EAAgD;AAAG;AAAnD,SAAxB,CAD7B,EACuH;AACnH8F,UAAAA,CAAC,CAACsC,eAAF;AACA;AACH;;AACD,YAAI,CAACtC,CAAC,CAACoC,YAAF,GAAiBG,aAAjB,EAAL,EAAuC;AACnC,eAAKnE,MAAL,CAAYoE,KAAZ;AACH;AACJ,OAVmB,CAApB;;AAWA,aAAO/C,MAAP;AACH,KA1DiC,CAApB,CAAd,CAfyG,CA0EzG;;AACA,SAAKgD,mBAAL,GAA2B,KAAK9D,UAAL,CAAgBe,GAAhB,CAAoB,IAAI5F,SAAJ,CAAc,MAAM;AAC/D,aAAO,KAAK6E,UAAL,CAAgBe,GAAhB,CAAoB,IAAIlD,kBAAJ,CAAuB,KAAK4B,MAA5B,EAAoC,KAAKY,KAAzC,CAApB,CAAP;AACH,KAF8C,CAApB,CAA3B;AAGA,SAAK0D,aAAL,GAAqB,KAAK/D,UAAL,CAAgBe,GAAhB,CAAoB,IAAI5F,SAAJ,CAAc,MAAM;AACzD,aAAO,KAAK6E,UAAL,CAAgBe,GAAhB,CAAoB,IAAIrD,mBAAJ,CAAwB,KAAK+B,MAA7B,EAAqC,KAAKG,kBAA1C,CAApB,CAAP;AACH,KAFwC,CAApB,CAArB;;AAGA,SAAKI,UAAL,CAAgBe,GAAhB,CAAoBlB,qBAAqB,CAACS,cAAtB,CAAqCzD,cAArC,EAAqD4C,MAArD,CAApB;;AACA,SAAKO,UAAL,CAAgBe,GAAhB,CAAoB,KAAKV,KAAL,CAAWQ,YAAX,CAAwBQ,CAAC,IAAI;AAC7C,WAAKP,MAAL,CAAYsB,KAAZ,CAAkB4B,aAAlB,CAAgC3C,CAAC,CAAC4C,IAAlC,EAAwC5C,CAAC,CAAC6C,GAAF,GAAQ,GAAR,GAAc,EAAtD;AACA,WAAKnE,WAAL,CAAiBqC,KAAjB,GAAyB,IAAIpE,UAAJ,CAAe,KAAKyB,MAAL,CAAYkD,QAAZ,EAAf,EAAuCtB,CAAC,CAAChC,QAAzC,CAAzB;AACH,KAHmB,CAApB;;AAIA,SAAKW,UAAL,CAAgBe,GAAhB,CAAoB,KAAKV,KAAL,CAAWe,YAAX,CAAwBC,CAAC,IAAI;AAC7C,UAAI,CAACA,CAAC,CAAC6C,GAAP,EAAY;AACR,YAAIC,KAAK,GAAG,CAAC,CAAb;;AACA,aAAK,MAAMC,QAAX,IAAuB,KAAKnE,UAAL,CAAgBoE,0BAAvC,EAAmE;AAC/DF,UAAAA,KAAK,GAAGC,QAAQ,CAACE,MAAT,CAAgB,KAAK7E,MAAL,CAAYkD,QAAZ,EAAhB,EAAwC,KAAKlD,MAAL,CAAYuC,WAAZ,EAAxC,EAAmEX,CAAC,CAACC,eAAF,CAAkBC,KAArF,CAAR;;AACA,cAAI4C,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd;AACH;AACJ;;AACD,YAAIA,KAAK,KAAK,CAAC,CAAf,EAAkB;AACdA,UAAAA,KAAK,GAAG,KAAKzE,cAAL,CAAoB4E,MAApB,CAA2B,KAAK7E,MAAL,CAAYkD,QAAZ,EAA3B,EAAmD,KAAKlD,MAAL,CAAYuC,WAAZ,EAAnD,EAA8EX,CAAC,CAACC,eAAF,CAAkBC,KAAhG,CAAR;AACH;;AACD,aAAKT,MAAL,CAAYsB,KAAZ,CAAkBmC,eAAlB,CAAkClD,CAAC,CAACC,eAApC,EAAqD6C,KAArD,EAA4D9C,CAAC,CAACmD,QAA9D,EAAwEnD,CAAC,CAAC4C,IAA1E;AACH;AACJ,KAdmB,CAApB;;AAeA,SAAKjE,UAAL,CAAgBe,GAAhB,CAAoB,KAAKV,KAAL,CAAWoE,WAAX,CAAuBpD,CAAC,IAAI;AAC5C,UAAI,CAACA,CAAC,CAACqD,SAAP,EAAkB;AACd,aAAK5D,MAAL,CAAYsB,KAAZ,CAAkBuC,UAAlB;AACH;AACJ,KAJmB,CAApB;;AAKA,SAAK3E,UAAL,CAAgBe,GAAhB,CAAoB,KAAKtB,MAAL,CAAYmF,qBAAZ,CAAkC,MAAM;AACxD,UAAI,CAAC7G,OAAL,EAAc;AACV,aAAKsC,KAAL,CAAWwE,MAAX;AACA,aAAKxE,KAAL,CAAWyE,KAAX;AACH;AACJ,KALmB,CAApB,EA1GyG,CAgHzG;;;AACA,QAAIC,wBAAwB,GAAGvH,cAAc,CAACwH,wBAAf,CAAwCvE,MAAxC,CAA+Cb,kBAA/C,CAA/B;;AACA,QAAIqF,gBAAgB,GAAG,MAAM;AACzB,YAAMC,uBAAuB,GAAG,KAAKzF,MAAL,CAAYkB,SAAZ,CAAsB;AAAE;AAAxB,OAAhC;AACAoE,MAAAA,wBAAwB,CAACrE,GAAzB,CAA6BwE,uBAAuB,KAAK,IAA5B,IAAoCA,uBAAuB,KAAK,OAA7F;AACH,KAHD;;AAIA,SAAKlF,UAAL,CAAgBe,GAAhB,CAAoB,KAAKtB,MAAL,CAAY0F,wBAAZ,CAAqC,MAAMF,gBAAgB,EAA3D,CAApB;;AACAA,IAAAA,gBAAgB;AACnB;;AACS,SAAHG,GAAG,CAAC3F,MAAD,EAAS;AACf,WAAOA,MAAM,CAAC4F,eAAP,CAAuB7F,iBAAiB,CAAC8F,EAAzC,CAAP;AACH;;AACD7J,EAAAA,OAAO,GAAG;AACN,SAAKsI,aAAL,CAAmBtI,OAAnB;;AACA,SAAKuE,UAAL,CAAgBvE,OAAhB;;AACA,SAAKqF,MAAL,CAAYrF,OAAZ;AACA,SAAK4E,KAAL,CAAW5E,OAAX;;AACA,SAAKsE,WAAL,CAAiBtE,OAAjB;AACH;;AACDyF,EAAAA,iBAAiB,CAACqE,KAAD,EAAQC,KAAR,EAAe;AAC5B,QAAI,CAACD,KAAD,IAAU,CAACA,KAAK,CAACtE,IAArB,EAA2B;AACvB,WAAK8C,aAAL,CAAmB3B,KAAnB,CAAyBZ,KAAzB;;AACA,WAAKnB,KAAL,CAAWwE,MAAX;AACA,WAAKxE,KAAL,CAAWyE,KAAX;AACA;AACH;;AACD,QAAI,CAAC,KAAKrF,MAAL,CAAYgG,QAAZ,EAAL,EAA6B;AACzB;AACH;;AACD,UAAMpF,KAAK,GAAG,KAAKZ,MAAL,CAAYkD,QAAZ,EAAd;AACA,UAAM+C,eAAe,GAAGrF,KAAK,CAACsF,uBAAN,EAAxB;AACA,UAAM;AAAE1E,MAAAA;AAAF,QAAWsE,KAAjB,CAZ4B,CAa5B;;AACA,UAAMK,KAAK,GAAG,EAAd;AACA,UAAMC,GAAG,GAAG,IAAIzK,uBAAJ,EAAZ,CAf4B,CAgB5B;AACA;;AACA,QAAI,EAAEoK,KAAK,GAAG;AAAE;AAAZ,KAAJ,EAAyC;AACrC,WAAK/F,MAAL,CAAYqG,YAAZ;AACH,KApB2B,CAqB5B;;;AACA,UAAMC,IAAI,GAAG,KAAKC,gBAAL,CAAsB/E,IAAtB,EAA4BiC,OAAO,CAACsC,KAAK,GAAG;AAAE;AAAX,KAAnC,CAAb,CAtB4B,CAuB5B;;AACA,SAAK9F,cAAL,CAAoBuG,QAApB,CAA6B5F,KAA7B,EAAoC,KAAKZ,MAAL,CAAYuC,WAAZ,EAApC,EAA+Df,IAA/D;;AACA,QAAIiF,KAAK,CAACC,OAAN,CAAclF,IAAI,CAACqB,UAAL,CAAgBC,mBAA9B,CAAJ,EAAwD;AACpD;AACA,YAAM6D,WAAW,GAAGpK,uBAAuB,CAACqK,OAAxB,CAAgC,KAAK5G,MAArC,CAApB;AACA,WAAKA,MAAL,CAAY6G,YAAZ,CAAyB,4CAAzB,EAAuErF,IAAI,CAACqB,UAAL,CAAgBC,mBAAhB,CAAoCgE,GAApC,CAAwCC,IAAI,IAAIlK,aAAa,CAACmK,OAAd,CAAsBjK,KAAK,CAACkK,IAAN,CAAWF,IAAI,CAAC1H,KAAhB,CAAtB,EAA8C0H,IAAI,CAACG,IAAnD,CAAhD,CAAvE;AACAP,MAAAA,WAAW,CAACQ,uCAAZ,CAAoD,KAAKnH,MAAzD;AACH,KALD,MAMK,IAAI,CAACwB,IAAI,CAAC4F,UAAV,EAAsB;AACvB;AACA,YAAMC,EAAE,GAAG,IAAIjL,SAAJ,CAAc,IAAd,CAAX;AACA,UAAIwD,QAAJ;AACA,YAAM0H,WAAW,GAAG1G,KAAK,CAAC2G,kBAAN,CAAyB3F,CAAC,IAAI;AAC9C,YAAIA,CAAC,CAAC4F,OAAN,EAAe;AACXpB,UAAAA,GAAG,CAAChB,MAAJ;AACAkC,UAAAA,WAAW,CAACtL,OAAZ;AACA;AACH;;AACD,aAAK,IAAIyL,MAAT,IAAmB7F,CAAC,CAAC8F,OAArB,EAA8B;AAC1B,gBAAMC,YAAY,GAAG5K,KAAK,CAAC6K,cAAN,CAAqBH,MAAM,CAACpI,KAA5B,CAArB;;AACA,cAAI,CAACO,QAAD,IAAa9C,QAAQ,CAAC+K,QAAT,CAAkBF,YAAlB,EAAgC/H,QAAhC,CAAjB,EAA4D;AACxDA,YAAAA,QAAQ,GAAG+H,YAAX;AACH;AACJ;AACJ,OAZmB,CAApB;AAaA,UAAIG,QAAQ,GAAG/B,KAAf;AACAA,MAAAA,KAAK,IAAI;AAAE;AAAX;AACA,UAAIgC,OAAO,GAAG,KAAd;AACA,UAAIC,YAAY,GAAG,KAAKhI,MAAL,CAAYiI,UAAZ,CAAuB,MAAM;AAC5CD,QAAAA,YAAY,CAAChM,OAAb;AACA+L,QAAAA,OAAO,GAAG,IAAV;;AACA,YAAI,EAAED,QAAQ,GAAG;AAAE;AAAf,SAAJ,EAA2C;AACvC,eAAK9H,MAAL,CAAYqG,YAAZ;AACH;AACJ,OANkB,CAAnB;AAOAF,MAAAA,KAAK,CAAC+B,IAAN,CAAW1G,IAAI,CAAC2G,OAAL,CAAa/B,GAAG,CAACgC,KAAjB,EAAwBC,IAAxB,CAA6B,MAAM;AAC1C,YAAI,CAAC7G,IAAI,CAACqB,UAAL,CAAgBC,mBAAjB,IAAwCsD,GAAG,CAACgC,KAAJ,CAAUE,uBAAtD,EAA+E;AAC3E,iBAAO,KAAP;AACH;;AACD,YAAI1I,QAAQ,IAAI4B,IAAI,CAACqB,UAAL,CAAgBC,mBAAhB,CAAoCyF,IAApC,CAAyCxB,IAAI,IAAIjK,QAAQ,CAAC+K,QAAT,CAAkBjI,QAAlB,EAA4B7C,KAAK,CAAC+C,gBAAN,CAAuBiH,IAAI,CAAC1H,KAA5B,CAA5B,CAAjD,CAAhB,EAAmI;AAC/H,iBAAO,KAAP;AACH;;AACD,YAAI0I,OAAJ,EAAa;AACT,eAAK/H,MAAL,CAAYqG,YAAZ;AACH;;AACD,cAAMM,WAAW,GAAGpK,uBAAuB,CAACqK,OAAxB,CAAgC,KAAK5G,MAArC,CAApB;AACA,aAAKA,MAAL,CAAY6G,YAAZ,CAAyB,6CAAzB,EAAwErF,IAAI,CAACqB,UAAL,CAAgBC,mBAAhB,CAAoCgE,GAApC,CAAwCC,IAAI,IAAIlK,aAAa,CAACmK,OAAd,CAAsBjK,KAAK,CAACkK,IAAN,CAAWF,IAAI,CAAC1H,KAAhB,CAAtB,EAA8C0H,IAAI,CAACG,IAAnD,CAAhD,CAAxE;AACAP,QAAAA,WAAW,CAACQ,uCAAZ,CAAoD,KAAKnH,MAAzD;;AACA,YAAI+H,OAAO,IAAI,EAAED,QAAQ,GAAG;AAAE;AAAf,SAAf,EAAsD;AAClD,eAAK9H,MAAL,CAAYqG,YAAZ;AACH;;AACD,eAAO,IAAP;AACH,OAjBU,EAiBRgC,IAjBQ,CAiBHG,OAAO,IAAI;AACf,aAAKnI,WAAL,CAAiBoI,KAAjB,CAAuB,wDAAvB,EAAiFpB,EAAE,CAACqB,OAAH,EAAjF,EAA+FF,OAA/F;;AACAlB,QAAAA,WAAW,CAACtL,OAAZ;AACAgM,QAAAA,YAAY,CAAChM,OAAb;AACH,OArBU,CAAX;AAsBH;;AACD,QAAI;AAAEgH,MAAAA;AAAF,QAAiBxB,IAAI,CAACqB,UAA1B;;AACA,QAAI,EAAErB,IAAI,CAACqB,UAAL,CAAgBE,eAAhB,GAAkC;AAAE;AAAtC,KAAJ,EAAkE;AAC9DC,MAAAA,UAAU,GAAG9F,aAAa,CAACyL,MAAd,CAAqB3F,UAArB,CAAb;AACH;;AACD/F,IAAAA,kBAAkB,CAAC0I,GAAnB,CAAuB,KAAK3F,MAA5B,EAAoC4I,MAApC,CAA2C5F,UAA3C,EAAuD;AACnD6F,MAAAA,eAAe,EAAEvC,IAAI,CAACuC,eAD6B;AAEnDC,MAAAA,cAAc,EAAExC,IAAI,CAACwC,cAF8B;AAGnDC,MAAAA,cAAc,EAAE,KAHmC;AAInDC,MAAAA,aAAa,EAAE,KAJoC;AAKnDC,MAAAA,gBAAgB,EAAE,EAAEzH,IAAI,CAACqB,UAAL,CAAgBE,eAAhB,GAAkC;AAAE;AAAtC,OALiC;AAMnDmG,MAAAA,aAAa,EAAEpD,KAAK,CAAClF,KAAN,CAAYsI,aANwB;AAOnDC,MAAAA,kBAAkB,EAAE,KAAK9E,mBAAL,CAAyB1B;AAPM,KAAvD;;AASA,QAAI,EAAEoD,KAAK,GAAG;AAAE;AAAZ,KAAJ,EAAwC;AACpC,WAAK/F,MAAL,CAAYqG,YAAZ;AACH;;AACD,QAAI,CAAC7E,IAAI,CAACqB,UAAL,CAAgBuG,OAArB,EAA8B;AAC1B;AACA,WAAKxI,KAAL,CAAWwE,MAAX;AACH,KAHD,MAIK,IAAI5D,IAAI,CAACqB,UAAL,CAAgBuG,OAAhB,CAAwBC,EAAxB,KAA+BC,oBAAoB,CAACD,EAAxD,EAA4D;AAC7D;AACA,WAAKzI,KAAL,CAAW2I,OAAX,CAAmB;AAAE/E,QAAAA,IAAI,EAAE,IAAR;AAAcC,QAAAA,GAAG,EAAE;AAAnB,OAAnB,EAA+C,IAA/C;AACH,KAHI,MAIA;AACD;AACA0B,MAAAA,KAAK,CAAC+B,IAAN,CAAW,KAAKhI,eAAL,CAAqBsJ,cAArB,CAAoChI,IAAI,CAACqB,UAAL,CAAgBuG,OAAhB,CAAwBC,EAA5D,EAAgE,IAAI7H,IAAI,CAACqB,UAAL,CAAgBuG,OAAhB,CAAwBzO,SAAxB,GAAoC,CAAC,GAAG6G,IAAI,CAACqB,UAAL,CAAgBuG,OAAhB,CAAwBzO,SAA5B,CAApC,GAA6E,EAAjF,CAAhE,EAAsJ8O,KAAtJ,CAA4J7N,iBAA5J,CAAX;AACA,WAAKgF,KAAL,CAAWwE,MAAX;AACH;;AACD,QAAIW,KAAK,GAAG;AAAE;AAAd,MAAgD;AAC5C,WAAKzB,aAAL,CAAmB3B,KAAnB,CAAyB1B,GAAzB,CAA6B6E,KAA7B,EAAoC4D,IAAI,IAAI;AACxC;AACAtD,QAAAA,GAAG,CAAChB,MAAJ,GAFwC,CAGxC;AACA;AACA;;AACA,eAAOxE,KAAK,CAAC+I,OAAN,EAAP,EAAwB;AACpB,cAAI1D,eAAe,KAAKrF,KAAK,CAACsF,uBAAN,EAAxB,EAAyD;AACrDtF,YAAAA,KAAK,CAACgJ,IAAN;AACH;;AACD,eAAKnI,iBAAL,CAAuBiI,IAAvB,EAA6B;AAAE;AAAF,YAA2B;AAAE;AAA7B,aAAsD3D,KAAK,GAAG;AAAE;AAAV,YAA6C;AAAE;AAA/C,YAAkF,CAAxI,CAA7B;;AACA;AACH;AACJ,OAbD;AAcH;;AACD,SAAK8D,oBAAL,CAA0BrI,IAA1B,EA9H4B,CA+H5B;;;AACAsI,IAAAA,OAAO,CAACC,GAAR,CAAY5D,KAAZ,EAAmB6D,OAAnB,CAA2B,MAAM;AAC7B,WAAKpJ,KAAL,CAAWyE,KAAX;AACAe,MAAAA,GAAG,CAACpK,OAAJ;AACH,KAHD;AAIH;;AACDuK,EAAAA,gBAAgB,CAAC/E,IAAD,EAAOyI,UAAP,EAAmB;AAC/B5N,IAAAA,UAAU,CAAC,KAAK2D,MAAL,CAAYgG,QAAZ,EAAD,CAAV;AACA,QAAIgB,OAAO,GAAG,KAAKhH,MAAL,CAAYkB,SAAZ,CAAsB;AAAI;AAA1B,MAAyCC,UAAzC,KAAwD,SAAtE;;AACA,QAAI8I,UAAJ,EAAgB;AACZjD,MAAAA,OAAO,GAAG,CAACA,OAAX;AACH;;AACD,UAAM6B,eAAe,GAAGrH,IAAI,CAAC5B,QAAL,CAAcd,MAAd,GAAuB0C,IAAI,CAACiB,SAAL,CAAe3D,MAA9D;AACA,UAAMgK,cAAc,GAAG,CAAC9B,OAAO,GAAGxF,IAAI,CAACgC,cAAL,CAAoB1E,MAAvB,GAAgC0C,IAAI,CAAC+B,aAAL,CAAmBzE,MAA3D,IAAqE0C,IAAI,CAAC5B,QAAL,CAAcd,MAA1G;AACA,UAAMoL,WAAW,GAAG,KAAKlK,MAAL,CAAYuC,WAAZ,GAA0BzD,MAA1B,GAAmC0C,IAAI,CAAC5B,QAAL,CAAcd,MAArE;AACA,UAAMqL,WAAW,GAAG,KAAK7J,WAAL,CAAiBqC,KAAjB,GAAyB,KAAKrC,WAAL,CAAiBqC,KAAjB,CAAuBhD,KAAvB,CAA6B,KAAKK,MAAL,CAAYuC,WAAZ,EAA7B,CAAzB,GAAmF,CAAvG;AACA,WAAO;AACHsG,MAAAA,eAAe,EAAEA,eAAe,GAAGqB,WADhC;AAEHpB,MAAAA,cAAc,EAAEA,cAAc,GAAGqB;AAF9B,KAAP;AAIH;;AACDN,EAAAA,oBAAoB,CAACrI,IAAD,EAAO;AACvB,QAAI/F,eAAe,CAAC+F,IAAI,CAACqB,UAAL,CAAgBC,mBAAjB,CAAnB,EAA0D;AACtD,UAAIsH,GAAG,GAAG/M,GAAG,CAACgN,QAAJ,CAAa,oBAAb,EAAmC,2CAAnC,EAAgF7I,IAAI,CAAC8I,SAArF,EAAgG9I,IAAI,CAACqB,UAAL,CAAgBC,mBAAhB,CAAoClI,MAApI,CAAV;AACAY,MAAAA,KAAK,CAAC4O,GAAD,CAAL;AACH;AACJ;;AACDG,EAAAA,cAAc,CAACC,QAAD,EAAW;AACrB,QAAI,KAAKxK,MAAL,CAAYgG,QAAZ,EAAJ,EAA4B;AACxB,WAAKpF,KAAL,CAAW2I,OAAX,CAAmB;AAAE/E,QAAAA,IAAI,EAAE,KAAR;AAAeC,QAAAA,GAAG,EAAE;AAApB,OAAnB,EAAgD,KAAhD,EAAuD+F,QAAvD;AACA,WAAKxK,MAAL,CAAYyK,cAAZ,CAA2B,KAAKzK,MAAL,CAAYuC,WAAZ,EAA3B,EAAsD;AAAE;AAAxD;AACA,WAAKvC,MAAL,CAAYoE,KAAZ;AACH;AACJ;;AACDsG,EAAAA,2BAA2B,CAACC,GAAD,EAAM;AAC7B,QAAI,CAAC,KAAK3K,MAAL,CAAYgG,QAAZ,EAAL,EAA6B;AACzB;AACH;;AACD,UAAM4E,WAAW,GAAG,KAAK5K,MAAL,CAAYuC,WAAZ,EAApB;;AACA,UAAMsI,QAAQ,GAAG,MAAM;AACnB,UAAID,WAAW,CAACtH,MAAZ,CAAmB,KAAKtD,MAAL,CAAYuC,WAAZ,EAAnB,CAAJ,EAAmD;AAC/C,aAAKrC,eAAL,CAAqBsJ,cAArB,CAAoCmB,GAAG,CAACE,QAAxC;AACH;AACJ,KAJD;;AAKA,UAAMC,aAAa,GAAItJ,IAAD,IAAU;AAC5B,UAAIA,IAAI,CAACqB,UAAL,CAAgBE,eAAhB,GAAkC;AAAE;AAApC,SAA6DvB,IAAI,CAACqB,UAAL,CAAgBC,mBAAjF,EAAsG;AAClG;AACA,eAAO,IAAP;AACH;;AACD,YAAMlD,QAAQ,GAAG,KAAKI,MAAL,CAAYuC,WAAZ,EAAjB;AACA,YAAMC,WAAW,GAAGhB,IAAI,CAACiB,SAAL,CAAe3D,MAAnC;AACA,YAAM4D,SAAS,GAAG9C,QAAQ,CAACd,MAA3B;;AACA,UAAI4D,SAAS,GAAGF,WAAZ,KAA4BhB,IAAI,CAACqB,UAAL,CAAgBG,UAAhB,CAA2BpI,MAA3D,EAAmE;AAC/D;AACA,eAAO,IAAP;AACH;;AACD,YAAMmQ,OAAO,GAAG,KAAK/K,MAAL,CAAYkD,QAAZ,GAAuBC,eAAvB,CAAuC;AACnDC,QAAAA,eAAe,EAAExD,QAAQ,CAACf,UADyB;AAEnD2D,QAAAA,WAFmD;AAGnDa,QAAAA,aAAa,EAAEzD,QAAQ,CAACf,UAH2B;AAInD6D,QAAAA;AAJmD,OAAvC,CAAhB,CAZ4B,CAkB5B;;AACA,aAAOqI,OAAO,KAAKvJ,IAAI,CAACqB,UAAL,CAAgBG,UAAnC;AACH,KApBD;;AAqBAnH,IAAAA,KAAK,CAACmP,IAAN,CAAW,KAAKpK,KAAL,CAAWQ,YAAtB,EAAoC6J,CAAC,IAAI;AACrC;AACA,UAAIC,QAAQ,GAAG,EAAf;AACArP,MAAAA,KAAK,CAACsP,GAAN,CAAU,KAAKvK,KAAL,CAAWQ,YAArB,EAAmC,KAAKR,KAAL,CAAWoE,WAA9C,EAA2D,MAAM;AAC7D;AACAhJ,QAAAA,OAAO,CAACkP,QAAD,CAAP;AACAL,QAAAA,QAAQ;AACX,OAJD,EAIGO,SAJH,EAIcF,QAJd;AAKA,WAAKtK,KAAL,CAAWe,YAAX,CAAwB,SAAyB;AAAA,YAAxB;AAAEE,UAAAA;AAAF,SAAwB;AAC7C7F,QAAAA,OAAO,CAACkP,QAAD,CAAP;;AACA,YAAIrJ,eAAe,CAACC,KAAhB,CAAsBlH,MAAtB,KAAiC,CAArC,EAAwC;AACpCiQ,UAAAA,QAAQ;AACR;AACH;;AACD,cAAMnG,KAAK,GAAG,KAAKzE,cAAL,CAAoB4E,MAApB,CAA2B,KAAK7E,MAAL,CAAYkD,QAAZ,EAA3B,EAAmD,KAAKlD,MAAL,CAAYuC,WAAZ,EAAnD,EAA8EV,eAAe,CAACC,KAA9F,CAAd;;AACA,cAAMN,IAAI,GAAGK,eAAe,CAACC,KAAhB,CAAsB4C,KAAtB,CAAb;;AACA,YAAI,CAACoG,aAAa,CAACtJ,IAAD,CAAlB,EAA0B;AACtBqJ,UAAAA,QAAQ;AACR;AACH;;AACD,aAAK7K,MAAL,CAAYqG,YAAZ;;AACA,aAAK5E,iBAAL,CAAuB;AAAEiD,UAAAA,KAAF;AAASlD,UAAAA,IAAT;AAAeZ,UAAAA,KAAK,EAAEiB;AAAtB,SAAvB,EAAgE;AAAE;AAAF,UAAqC;AAAE;AAAvC,UAAgE;AAAE;AAAlI;AACH,OAdD,EAcGuJ,SAdH,EAccF,QAdd;AAeH,KAvBD;AAwBA,SAAKtK,KAAL,CAAW2I,OAAX,CAAmB;AAAE/E,MAAAA,IAAI,EAAE,KAAR;AAAeC,MAAAA,GAAG,EAAE;AAApB,KAAnB;AACA,SAAKzE,MAAL,CAAYyK,cAAZ,CAA2BG,WAA3B,EAAwC;AAAE;AAA1C;AACA,SAAK5K,MAAL,CAAYoE,KAAZ;AACH;;AACDiH,EAAAA,wBAAwB,CAACC,0BAAD,EAA6BC,0BAA7B,EAAyD;AAC7E,UAAM/J,IAAI,GAAG,KAAKH,MAAL,CAAYsB,KAAZ,CAAkB6I,cAAlB,EAAb;AACA,QAAIzF,KAAK,GAAG,CAAZ;;AACA,QAAIuF,0BAAJ,EAAgC;AAC5BvF,MAAAA,KAAK,IAAI;AAAE;AAAX;AACH;;AACD,QAAIwF,0BAAJ,EAAgC;AAC5BxF,MAAAA,KAAK,IAAI;AAAE;AAAX;AACH;;AACD,SAAKtE,iBAAL,CAAuBD,IAAvB,EAA6BuE,KAA7B;AACH;;AACD0F,EAAAA,oBAAoB,GAAG;AACnB,SAAKnH,aAAL,CAAmB3B,KAAnB,CAAyB+G,IAAzB;AACH;;AACDgC,EAAAA,oBAAoB,GAAG;AACnB,SAAKpH,aAAL,CAAmB3B,KAAnB,CAAyBgJ,IAAzB;AACH;;AACDC,EAAAA,mBAAmB,GAAG;AAClB,SAAKhL,KAAL,CAAWwE,MAAX;AACA,SAAKxE,KAAL,CAAWyE,KAAX;AACA,SAAKhE,MAAL,CAAYsB,KAAZ,CAAkBuC,UAAlB;AACH;;AACD2G,EAAAA,oBAAoB,GAAG;AACnB,SAAKxK,MAAL,CAAYsB,KAAZ,CAAkBmJ,UAAlB;AACH;;AACDC,EAAAA,wBAAwB,GAAG;AACvB,SAAK1K,MAAL,CAAYsB,KAAZ,CAAkBqJ,cAAlB;AACH;;AACDC,EAAAA,oBAAoB,GAAG;AACnB,SAAK5K,MAAL,CAAYsB,KAAZ,CAAkBuJ,UAAlB;AACH;;AACDC,EAAAA,oBAAoB,GAAG;AACnB,SAAK9K,MAAL,CAAYsB,KAAZ,CAAkByJ,cAAlB;AACH;;AACDC,EAAAA,wBAAwB,GAAG;AACvB,SAAKhL,MAAL,CAAYsB,KAAZ,CAAkB2J,kBAAlB;AACH;;AACDC,EAAAA,qBAAqB,GAAG;AACpB,SAAKlL,MAAL,CAAYsB,KAAZ,CAAkB6J,WAAlB;AACH;;AACDC,EAAAA,uBAAuB,GAAG;AACtB,SAAKpL,MAAL,CAAYsB,KAAZ,CAAkB+J,aAAlB;AACH;;AACDC,EAAAA,iBAAiB,GAAG;AAChB,SAAKtL,MAAL,CAAYsB,KAAZ,CAAkBgK,iBAAlB;AACH;;AACDC,EAAAA,qBAAqB,GAAG;AACpB,SAAKvL,MAAL,CAAYsB,KAAZ,CAAkBkK,kBAAlB;AACH;;AACDC,EAAAA,eAAe,GAAG;AACd,SAAKzL,MAAL,CAAYsB,KAAZ,CAAkBoK,kBAAlB;AACH;;AACDC,EAAAA,mBAAmB,GAAG;AAClB,SAAK3L,MAAL,CAAYsB,KAAZ,CAAkBqK,mBAAlB;AACH;;AACDC,EAAAA,uBAAuB,GAAG;AACtB,QAAI,CAAC,KAAK5L,MAAL,CAAY6L,aAAjB,EAAgC;AAC5B;AACA;AACH;;AACD,SAAK7L,MAAL,CAAYsB,KAAZ,CAAkBsK,uBAAlB;AACH;;AACDE,EAAAA,gBAAgB,CAACxI,QAAD,EAAW;AACvB,WAAO,KAAKnE,UAAL,CAAgB4M,QAAhB,CAAyBzI,QAAzB,CAAP;AACH;;AAha2C,CAAhD;AAkaA5E,iBAAiB,CAAC8F,EAAlB,GAAuB,kCAAvB;AACA9F,iBAAiB,GAAG1F,UAAU,CAAC,CAC3BgB,OAAO,CAAC,CAAD,EAAI8B,qBAAJ,CADoB,EAE3B9B,OAAO,CAAC,CAAD,EAAImC,eAAJ,CAFoB,EAG3BnC,OAAO,CAAC,CAAD,EAAIqC,kBAAJ,CAHoB,EAI3BrC,OAAO,CAAC,CAAD,EAAIsC,qBAAJ,CAJoB,EAK3BtC,OAAO,CAAC,CAAD,EAAIwC,WAAJ,CALoB,CAAD,EAM3BkC,iBAN2B,CAA9B;AAOA,SAASA,iBAAT;;AACA,MAAMU,gBAAN,CAAuB;AACnBjC,EAAAA,WAAW,CAAC6O,gBAAD,EAAmB;AAC1B,SAAKA,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,MAAL,GAAc,IAAI7G,KAAJ,EAAd;AACH;;AACD2G,EAAAA,QAAQ,CAACzK,KAAD,EAAQ;AACZ,QAAI,KAAK2K,MAAL,CAAYC,OAAZ,CAAoB5K,KAApB,MAA+B,CAAC,CAApC,EAAuC;AACnC,YAAM,IAAI6K,KAAJ,CAAU,6BAAV,CAAN;AACH;;AACD,SAAKF,MAAL,CAAYpF,IAAZ,CAAiBvF,KAAjB;;AACA,SAAK2K,MAAL,CAAYG,IAAZ,CAAiB,CAACC,EAAD,EAAKC,EAAL,KAAY,KAAKN,gBAAL,CAAsBM,EAAtB,IAA4B,KAAKN,gBAAL,CAAsBK,EAAtB,CAAzD;;AACA,WAAO;AACH1R,MAAAA,OAAO,EAAE,MAAM;AACX,cAAM4R,GAAG,GAAG,KAAKN,MAAL,CAAYC,OAAZ,CAAoB5K,KAApB,CAAZ;;AACA,YAAIiL,GAAG,IAAI,CAAX,EAAc;AACV,eAAKN,MAAL,CAAYO,MAAZ,CAAmBD,GAAnB,EAAwB,CAAxB;AACH;AACJ;AANE,KAAP;AAQH;;AAC6B,MAA1BhJ,0BAA0B,GAAG;AAC7B,WAAO,KAAK0I,MAAZ;AACH;;AAtBkB;;AAwBvB,OAAO,MAAMhE,oBAAN,SAAmC9M,YAAnC,CAAgD;AACnDgC,EAAAA,WAAW,GAAG;AACV,UAAM;AACF6K,MAAAA,EAAE,EAAEC,oBAAoB,CAACD,EADvB;AAEFvF,MAAAA,KAAK,EAAEzG,GAAG,CAACgN,QAAJ,CAAa,uBAAb,EAAsC,iBAAtC,CAFL;AAGFyD,MAAAA,KAAK,EAAE,iBAHL;AAIFC,MAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBhR,iBAAiB,CAACiR,QAArC,EAA+CjR,iBAAiB,CAACkR,yBAAjE,CAJZ;AAKFC,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cADtB;AAEJC,QAAAA,OAAO,EAAE;AAAK;AAAL,UAAqB;AAAG;AAF7B;AAGJC,QAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,UAAqB;AAAG;AAAzB,SAHP;AAIJC,QAAAA,GAAG,EAAE;AAAEF,UAAAA,OAAO,EAAE;AAAI;AAAJ,YAAoB;AAAG;AAAlC;AAA+CC,UAAAA,SAAS,EAAE,CAAC;AAAI;AAAJ,YAAgB;AAAE;AAAnB,YAAiC;AAAK;AAAL,YAAqB;AAAG;AAAzD;AAA1D,SAJD;AAKJE,QAAAA,MAAM,EAAE;AAAI;;AALR;AALN,KAAN;AAaH;;AACDC,EAAAA,GAAG,CAACC,QAAD,EAAW3O,MAAX,EAAmB;AAClB,UAAM4O,UAAU,GAAG7O,iBAAiB,CAAC4F,GAAlB,CAAsB3F,MAAtB,CAAnB;;AACA,QAAI,CAAC4O,UAAL,EAAiB;AACb;AACH;;AACDA,IAAAA,UAAU,CAACrE,cAAX;AACH;;AAtBkD;AAwBvDjB,oBAAoB,CAACD,EAArB,GAA0B,8BAA1B;AACAzM,0BAA0B,CAACmD,iBAAiB,CAAC8F,EAAnB,EAAuB9F,iBAAvB,CAA1B;AACArD,oBAAoB,CAAC4M,oBAAD,CAApB;AACA,MAAMmF,MAAM,GAAG;AAAI;AAAJ,EAA0B,EAAzC;AACA,MAAMI,cAAc,GAAGpS,aAAa,CAACqS,kBAAd,CAAiC/O,iBAAiB,CAAC4F,GAAnD,CAAvB;AACAhJ,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,0BADiC;AAErC0E,EAAAA,YAAY,EAAEhQ,cAAc,CAACgR,OAFQ;;AAGrCC,EAAAA,OAAO,CAACC,CAAD,EAAI;AACPA,IAAAA,CAAC,CAAC5D,wBAAF,CAA2B,IAA3B,EAAiC,KAAjC;AACH;;AALoC,CAAnB,CAAD,CAArB,C,CAOA;;AACAzN,mBAAmB,CAACsR,sBAApB,CAA2C;AACvC7F,EAAAA,EAAE,EAAE,0BADmC;AAEvC8F,EAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2C/R,iBAAiB,CAACqR,cAA7D,CAFiC;AAGvCC,EAAAA,OAAO,EAAE;AAAE;AAH4B;AAIvCG,EAAAA;AAJuC,CAA3C,E,CAMA;;AACA7Q,mBAAmB,CAACsR,sBAApB,CAA2C;AACvC7F,EAAAA,EAAE,EAAE,0BADmC;AAEvC8F,EAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2C/R,iBAAiB,CAACqR,cAA7D,EAA6EtQ,cAAc,CAACwH,wBAA5F,EAAsHxH,cAAc,CAACkE,aAArI,CAFiC;AAGvCqM,EAAAA,OAAO,EAAE;AAAE;AAH4B;AAIvCG,EAAAA;AAJuC,CAA3C;AAMAnR,YAAY,CAAC8R,cAAb,CAA4BpR,0BAA5B,EAAwD;AACpDoL,EAAAA,OAAO,EAAE;AAAEC,IAAAA,EAAE,EAAE,0BAAN;AAAkCgG,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,eAAb,EAA8B,QAA9B;AAAzC,GAD2C;AAEpDiF,EAAAA,KAAK,EAAE,MAF6C;AAGpDC,EAAAA,KAAK,EAAE,CAH6C;AAIpDJ,EAAAA,IAAI,EAAEpR,cAAc,CAACoE,wBAAf,CAAwCqN,SAAxC;AAJ8C,CAAxD;AAMAlS,YAAY,CAAC8R,cAAb,CAA4BpR,0BAA5B,EAAwD;AACpDoL,EAAAA,OAAO,EAAE;AAAEC,IAAAA,EAAE,EAAE,0BAAN;AAAkCgG,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,eAAb,EAA8B,QAA9B;AAAzC,GAD2C;AAEpDiF,EAAAA,KAAK,EAAE,MAF6C;AAGpDC,EAAAA,KAAK,EAAE,CAH6C;AAIpDJ,EAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACoE,wBAAlC,EAA4DpE,cAAc,CAACgD,UAAf,CAA0B0O,SAA1B,CAAoC,QAApC,CAA5D;AAJ8C,CAAxD;AAMAnS,YAAY,CAAC8R,cAAb,CAA4BpR,0BAA5B,EAAwD;AACpDoL,EAAAA,OAAO,EAAE;AAAEC,IAAAA,EAAE,EAAE,0BAAN;AAAkCgG,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,gBAAb,EAA+B,SAA/B;AAAzC,GAD2C;AAEpDiF,EAAAA,KAAK,EAAE,MAF6C;AAGpDC,EAAAA,KAAK,EAAE,CAH6C;AAIpDJ,EAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACoE,wBAAlC,EAA4DpE,cAAc,CAACgD,UAAf,CAA0B0O,SAA1B,CAAoC,SAApC,CAA5D;AAJ8C,CAAxD;AAMA9S,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,qCADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2C/R,iBAAiB,CAACqR,cAA7D,CAFuB;AAGrCF,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAmB;AAAE;AAH1B;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAmB;AAAE;AAAtB;AAJP,GAH6B;;AASrCS,EAAAA,OAAO,CAACC,CAAD,EAAI;AACPA,IAAAA,CAAC,CAAC5D,wBAAF,CAA2B,KAA3B,EAAkC,IAAlC;AACH,GAXoC;;AAYrCqE,EAAAA,QAAQ,EAAE,CAAC;AACHC,IAAAA,MAAM,EAAE3R,0BADL;AAEHsR,IAAAA,KAAK,EAAE,MAFJ;AAGHC,IAAAA,KAAK,EAAE,CAHJ;AAIHJ,IAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACoE,wBAAlC,EAA4DpE,cAAc,CAACgD,UAAf,CAA0B0O,SAA1B,CAAoC,QAApC,CAA5D,CAJH;AAKHJ,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,gBAAb,EAA+B,SAA/B;AALJ,GAAD,EAMH;AACCsF,IAAAA,MAAM,EAAE3R,0BADT;AAECsR,IAAAA,KAAK,EAAE,MAFR;AAGCC,IAAAA,KAAK,EAAE,CAHR;AAICJ,IAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACoE,wBAAlC,EAA4DpE,cAAc,CAACgD,UAAf,CAA0B0O,SAA1B,CAAoC,SAApC,CAA5D,CAJP;AAKCJ,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,eAAb,EAA8B,QAA9B;AALR,GANG;AAZ2B,CAAnB,CAAD,CAArB,C,CA0BA;;AACA9M,gBAAgB,CAACqS,oBAAjB,CAAsC,iCAAtC,EAAyE,0BAAzE;AACAjT,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,mBADiC;AAErC0E,EAAAA,YAAY,EAAEhQ,cAAc,CAACgR,OAFQ;AAGrCC,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACrD,mBAAF,EAHuB;AAIrCuC,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAE;AAHP;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAmB;AAAE;AAAtB;AAJP;AAJ6B,CAAnB,CAAD,CAArB;AAWA5R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAACmR,oBAAF,EAHuB;AAIrCsC,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAG;AAHR;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAqB;AAAG;AAAzB,KAJP;AAKJC,IAAAA,GAAG,EAAE;AAAEF,MAAAA,OAAO,EAAE;AAAG;AAAd;AAA+BC,MAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,QAAqB;AAAG;AAAzB,QAA0C;AAAI;AAAJ,QAAoB;AAAG;AAAjE;AAA1C;AALD;AAJ6B,CAAnB,CAAD,CAArB;AAYA5R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,0BADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAACqR,wBAAF,EAHuB;AAIrCoC,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAG;AAHR;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAqB;AAAG;AAAzB;AAJP;AAJ6B,CAAnB,CAAD,CAArB;AAWA5R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAACuR,oBAAF;AAHuB,CAAnB,CAAD,CAArB;AAKAtP,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAACyR,oBAAF,EAHuB;AAIrCgC,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAG;AAHR;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAqB;AAAG;AAAzB,KAJP;AAKJC,IAAAA,GAAG,EAAE;AAAEF,MAAAA,OAAO,EAAE;AAAG;AAAd;AAA6BC,MAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,QAAqB;AAAG;AAAzB,QAAwC;AAAI;AAAJ,QAAoB;AAAG;AAA/D;AAAxC;AALD;AAJ6B,CAAnB,CAAD,CAArB;AAYA5R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,0BADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAAC2R,wBAAF,EAHuB;AAIrC8B,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAG;AAHR;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAqB;AAAG;AAAzB;AAJP;AAJ6B,CAAnB,CAAD,CAArB;AAWA5R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,uBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAACgR,OAAlC,EAA2ChR,cAAc,CAAC8R,mBAA1D,CAFuB;AAGrCb,EAAAA,OAAO,EAAEtU,CAAC,IAAIA,CAAC,CAAC6R,qBAAF;AAHuB,CAAnB,CAAD,CAArB;AAKA5P,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,yBADiC;AAErC0E,EAAAA,YAAY,EAAEhQ,cAAc,CAACgR,OAFQ;AAGrCC,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACxC,uBAAF,EAHuB;AAIrC0B,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAqB;AAAG;AAH7B;AAIJC,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAqB;AAAG;AAAzB,KAJP;AAKJC,IAAAA,GAAG,EAAE;AAAEF,MAAAA,OAAO,EAAE;AAAI;AAAJ,QAAoB;AAAG;AAAlC;AAA+CC,MAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,QAAqB;AAAG;AAAzB;AAA1D;AALD,GAJ6B;AAWrCmB,EAAAA,QAAQ,EAAE,CAAC;AACHC,IAAAA,MAAM,EAAE3R,0BADL;AAEHsR,IAAAA,KAAK,EAAE,OAFJ;AAGHC,IAAAA,KAAK,EAAE,CAHJ;AAIHJ,IAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAAC+R,cAAlC,EAAkD/R,cAAc,CAACsE,UAAjE,CAJH;AAKHgN,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,aAAb,EAA4B,WAA5B;AALJ,GAAD,EAMH;AACCsF,IAAAA,MAAM,EAAE3R,0BADT;AAECsR,IAAAA,KAAK,EAAE,OAFR;AAGCC,IAAAA,KAAK,EAAE,CAHR;AAICJ,IAAAA,IAAI,EAAE1R,cAAc,CAACuQ,GAAf,CAAmBjQ,cAAc,CAAC+R,cAAf,CAA8BN,SAA9B,EAAnB,EAA8DzR,cAAc,CAACsE,UAA7E,CAJP;AAKCgN,IAAAA,KAAK,EAAEhS,GAAG,CAACgN,QAAJ,CAAa,aAAb,EAA4B,WAA5B;AALR,GANG;AAX2B,CAAnB,CAAD,CAArB;AAyBA1N,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,mBADiC;AAErC0E,EAAAA,YAAY,EAAEhQ,cAAc,CAACgR,OAFQ;AAGrCC,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACtC,iBAAF,EAHuB;AAIrCwB,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAE;AAAI;AADR;AAEJH,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAqB;AAAG;;AAF7B;AAJ6B,CAAnB,CAAD,CAArB;AASA3R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,uBADiC;AAErC0E,EAAAA,YAAY,EAAEhQ,cAAc,CAACgR,OAFQ;AAGrCC,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACrC,qBAAF,EAHuB;AAIrCuB,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAqB;AAAI;AAAzB,MAAqC;AAAG;AAH7C;AAIJE,IAAAA,GAAG,EAAE;AAAEF,MAAAA,OAAO,EAAE;AAAI;AAAJ,QAAoB;AAAI;AAAxB,QAAoC;AAAG;;AAAlD;AAJD;AAJ6B,CAAnB,CAAD,CAArB,C,CAWA;;AACA3R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBhR,iBAAiB,CAACqR,cAArC,EAAqD5Q,cAAc,CAAC6F,MAAf,CAAsB,6BAAtB,EAAqD,IAArD,CAArD,EAAiHlG,cAAc,CAAC2S,KAAhI,EAAuIhS,cAAc,CAACgR,OAAf,CAAuBS,SAAvB,EAAvI,EAA2KvR,mBAAmB,CAAC+R,gBAApB,CAAqCR,SAArC,EAA3K,EAA6NvS,kBAAkB,CAACgT,aAAnB,CAAiCT,SAAjC,EAA7N,CAFuB;AAGrCR,EAAAA,OAAO,EAAE,CAACC,CAAD,EAAItE,GAAJ,KAAY;AACjBsE,IAAAA,CAAC,CAACvE,2BAAF,CAA8BpO,QAAQ,CAACqO,GAAD,CAAR,GAAgB7P,MAAM,CAACoV,MAAP,CAAc;AAAErF,MAAAA,QAAQ,EAAE;AAAZ,KAAd,EAAmCF,GAAnC,CAAhB,GAA0D;AAAEE,MAAAA,QAAQ,EAAE;AAAZ,KAAxF;AACH,GALoC;AAMrCsD,EAAAA,MAAM,EAAE;AACJM,IAAAA,MADI;AAEJH,IAAAA,OAAO,EAAE;AAAE;;AAFP;AAN6B,CAAnB,CAAD,CAArB;AAWA3R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBhR,iBAAiB,CAACqR,cAArC,EAAqD5Q,cAAc,CAAC6F,MAAf,CAAsB,6BAAtB,EAAqD,IAArD,CAArD,EAAiHrF,mBAAmB,CAAC+R,gBAArI,EAAuJjS,cAAc,CAACgR,OAAf,CAAuBS,SAAvB,EAAvJ,EAA2LvS,kBAAkB,CAACgT,aAAnB,CAAiCT,SAAjC,EAA3L,CAFuB;AAGrCR,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACxD,oBAAF,EAHuB;AAIrC0C,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAE;;AAHP;AAJ6B,CAAnB,CAAD,CAArB;AAUA3R,qBAAqB,CAAC,IAAIkS,cAAJ,CAAmB;AACrCxF,EAAAA,EAAE,EAAE,sBADiC;AAErC0E,EAAAA,YAAY,EAAEtQ,cAAc,CAACuQ,GAAf,CAAmBhR,iBAAiB,CAACqR,cAArC,EAAqD5Q,cAAc,CAAC6F,MAAf,CAAsB,6BAAtB,EAAqD,IAArD,CAArD,EAAiHrF,mBAAmB,CAAC+R,gBAArI,EAAuJjS,cAAc,CAACgR,OAAf,CAAuBS,SAAvB,EAAvJ,EAA2LvS,kBAAkB,CAACgT,aAAnB,CAAiCT,SAAjC,EAA3L,CAFuB;AAGrCR,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACvD,oBAAF,EAHuB;AAIrCyC,EAAAA,MAAM,EAAE;AACJM,IAAAA,MAAM,EAAEA,MADJ;AAEJL,IAAAA,MAAM,EAAEpR,iBAAiB,CAACqR,cAFtB;AAGJC,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAmB;AAAE;;AAH1B;AAJ6B,CAAnB,CAAD,CAArB;AAUA5R,oBAAoB,CAAC,cAAcF,YAAd,CAA2B;AAC5CgC,EAAAA,WAAW,GAAG;AACV,UAAM;AACF6K,MAAAA,EAAE,EAAE,gCADF;AAEFvF,MAAAA,KAAK,EAAEzG,GAAG,CAACgN,QAAJ,CAAa,qBAAb,EAAoC,2BAApC,CAFL;AAGFyD,MAAAA,KAAK,EAAE,2BAHL;AAIFC,MAAAA,YAAY,EAAE3C;AAJZ,KAAN;AAMH;;AACDsD,EAAAA,GAAG,CAACyB,SAAD,EAAYnQ,MAAZ,EAAoB;AACnBD,IAAAA,iBAAiB,CAAC4F,GAAlB,CAAsB3F,MAAtB,EAA8B8M,eAA9B;AACH;;AAX2C,CAA5B,CAApB","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { IdleValue } from '../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { SimpleKeybinding } from '../../../base/common/keybindings.js';\nimport { DisposableStore, dispose, MutableDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { assertType, isObject } from '../../../base/common/types.js';\nimport { StableEditorScrollState } from '../../browser/core/editorState.js';\nimport { EditorAction, EditorCommand, registerEditorAction, registerEditorCommand, registerEditorContribution } from '../../browser/editorExtensions.js';\nimport { EditOperation } from '../../common/core/editOperation.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { SnippetController2 } from '../snippet/snippetController2.js';\nimport { SnippetParser } from '../snippet/snippetParser.js';\nimport { ISuggestMemoryService } from './suggestMemory.js';\nimport { WordContextKey } from './wordContextKey.js';\nimport * as nls from '../../../nls.js';\nimport { MenuRegistry } from '../../../platform/actions/common/actions.js';\nimport { CommandsRegistry, ICommandService } from '../../../platform/commands/common/commands.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingsRegistry } from '../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { Context as SuggestContext, suggestWidgetStatusbarMenu } from './suggest.js';\nimport { SuggestAlternatives } from './suggestAlternatives.js';\nimport { CommitCharacterController } from './suggestCommitCharacters.js';\nimport { SuggestModel } from './suggestModel.js';\nimport { OvertypingCapturer } from './suggestOvertypingCapturer.js';\nimport { SuggestWidget } from './suggestWidget.js';\n// sticky suggest widget which doesn't disappear on focus out and such\nlet _sticky = false;\n// _sticky = Boolean(\"true\"); // done \"weirdly\" so that a lint warning prevents you from pushing this\nclass LineSuffix {\n    constructor(_model, _position) {\n        this._model = _model;\n        this._position = _position;\n        // spy on what's happening right of the cursor. two cases:\n        // 1. end of line -> check that it's still end of line\n        // 2. mid of line -> add a marker and compute the delta\n        const maxColumn = _model.getLineMaxColumn(_position.lineNumber);\n        if (maxColumn !== _position.column) {\n            const offset = _model.getOffsetAt(_position);\n            const end = _model.getPositionAt(offset + 1);\n            this._marker = _model.deltaDecorations([], [{\n                    range: Range.fromPositions(_position, end),\n                    options: { description: 'suggest-line-suffix', stickiness: 1 /* NeverGrowsWhenTypingAtEdges */ }\n                }]);\n        }\n    }\n    dispose() {\n        if (this._marker && !this._model.isDisposed()) {\n            this._model.deltaDecorations(this._marker, []);\n        }\n    }\n    delta(position) {\n        if (this._model.isDisposed() || this._position.lineNumber !== position.lineNumber) {\n            // bail out early if things seems fishy\n            return 0;\n        }\n        // read the marker (in case suggest was triggered at line end) or compare\n        // the cursor to the line end.\n        if (this._marker) {\n            const range = this._model.getDecorationRange(this._marker[0]);\n            const end = this._model.getOffsetAt(range.getStartPosition());\n            return end - this._model.getOffsetAt(position);\n        }\n        else {\n            return this._model.getLineMaxColumn(position.lineNumber) - position.column;\n        }\n    }\n}\nlet SuggestController = class SuggestController {\n    constructor(editor, _memoryService, _commandService, _contextKeyService, _instantiationService, _logService) {\n        this._memoryService = _memoryService;\n        this._commandService = _commandService;\n        this._contextKeyService = _contextKeyService;\n        this._instantiationService = _instantiationService;\n        this._logService = _logService;\n        this._lineSuffix = new MutableDisposable();\n        this._toDispose = new DisposableStore();\n        this._selectors = new PriorityRegistry(s => s.priority);\n        this.editor = editor;\n        this.model = _instantiationService.createInstance(SuggestModel, this.editor);\n        // context key: update insert/replace mode\n        const ctxInsertMode = SuggestContext.InsertMode.bindTo(_contextKeyService);\n        ctxInsertMode.set(editor.getOption(105 /* suggest */).insertMode);\n        this.model.onDidTrigger(() => ctxInsertMode.set(editor.getOption(105 /* suggest */).insertMode));\n        this.widget = this._toDispose.add(new IdleValue(() => {\n            const widget = this._instantiationService.createInstance(SuggestWidget, this.editor);\n            this._toDispose.add(widget);\n            this._toDispose.add(widget.onDidSelect(item => this._insertSuggestion(item, 0), this));\n            // Wire up logic to accept a suggestion on certain characters\n            const commitCharacterController = new CommitCharacterController(this.editor, widget, item => this._insertSuggestion(item, 2 /* NoAfterUndoStop */));\n            this._toDispose.add(commitCharacterController);\n            this._toDispose.add(this.model.onDidSuggest(e => {\n                if (e.completionModel.items.length === 0) {\n                    commitCharacterController.reset();\n                }\n            }));\n            // Wire up makes text edit context key\n            const ctxMakesTextEdit = SuggestContext.MakesTextEdit.bindTo(this._contextKeyService);\n            const ctxHasInsertAndReplace = SuggestContext.HasInsertAndReplaceRange.bindTo(this._contextKeyService);\n            const ctxCanResolve = SuggestContext.CanResolve.bindTo(this._contextKeyService);\n            this._toDispose.add(toDisposable(() => {\n                ctxMakesTextEdit.reset();\n                ctxHasInsertAndReplace.reset();\n                ctxCanResolve.reset();\n            }));\n            this._toDispose.add(widget.onDidFocus(({ item }) => {\n                // (ctx: makesTextEdit)\n                const position = this.editor.getPosition();\n                const startColumn = item.editStart.column;\n                const endColumn = position.column;\n                let value = true;\n                if (this.editor.getOption(1 /* acceptSuggestionOnEnter */) === 'smart'\n                    && this.model.state === 2 /* Auto */\n                    && !item.completion.additionalTextEdits\n                    && !(item.completion.insertTextRules & 4 /* InsertAsSnippet */)\n                    && endColumn - startColumn === item.completion.insertText.length) {\n                    const oldText = this.editor.getModel().getValueInRange({\n                        startLineNumber: position.lineNumber,\n                        startColumn,\n                        endLineNumber: position.lineNumber,\n                        endColumn\n                    });\n                    value = oldText !== item.completion.insertText;\n                }\n                ctxMakesTextEdit.set(value);\n                // (ctx: hasInsertAndReplaceRange)\n                ctxHasInsertAndReplace.set(!Position.equals(item.editInsertEnd, item.editReplaceEnd));\n                // (ctx: canResolve)\n                ctxCanResolve.set(Boolean(item.provider.resolveCompletionItem) || Boolean(item.completion.documentation) || item.completion.detail !== item.completion.label);\n            }));\n            this._toDispose.add(widget.onDetailsKeyDown(e => {\n                // cmd + c on macOS, ctrl + c on Win / Linux\n                if (e.toKeybinding().equals(new SimpleKeybinding(true, false, false, false, 33 /* KeyC */)) ||\n                    (platform.isMacintosh && e.toKeybinding().equals(new SimpleKeybinding(false, false, false, true, 33 /* KeyC */)))) {\n                    e.stopPropagation();\n                    return;\n                }\n                if (!e.toKeybinding().isModifierKey()) {\n                    this.editor.focus();\n                }\n            }));\n            return widget;\n        }));\n        // Wire up text overtyping capture\n        this._overtypingCapturer = this._toDispose.add(new IdleValue(() => {\n            return this._toDispose.add(new OvertypingCapturer(this.editor, this.model));\n        }));\n        this._alternatives = this._toDispose.add(new IdleValue(() => {\n            return this._toDispose.add(new SuggestAlternatives(this.editor, this._contextKeyService));\n        }));\n        this._toDispose.add(_instantiationService.createInstance(WordContextKey, editor));\n        this._toDispose.add(this.model.onDidTrigger(e => {\n            this.widget.value.showTriggered(e.auto, e.shy ? 250 : 50);\n            this._lineSuffix.value = new LineSuffix(this.editor.getModel(), e.position);\n        }));\n        this._toDispose.add(this.model.onDidSuggest(e => {\n            if (!e.shy) {\n                let index = -1;\n                for (const selector of this._selectors.itemsOrderedByPriorityDesc) {\n                    index = selector.select(this.editor.getModel(), this.editor.getPosition(), e.completionModel.items);\n                    if (index !== -1) {\n                        break;\n                    }\n                }\n                if (index === -1) {\n                    index = this._memoryService.select(this.editor.getModel(), this.editor.getPosition(), e.completionModel.items);\n                }\n                this.widget.value.showSuggestions(e.completionModel, index, e.isFrozen, e.auto);\n            }\n        }));\n        this._toDispose.add(this.model.onDidCancel(e => {\n            if (!e.retrigger) {\n                this.widget.value.hideWidget();\n            }\n        }));\n        this._toDispose.add(this.editor.onDidBlurEditorWidget(() => {\n            if (!_sticky) {\n                this.model.cancel();\n                this.model.clear();\n            }\n        }));\n        // Manage the acceptSuggestionsOnEnter context key\n        let acceptSuggestionsOnEnter = SuggestContext.AcceptSuggestionsOnEnter.bindTo(_contextKeyService);\n        let updateFromConfig = () => {\n            const acceptSuggestionOnEnter = this.editor.getOption(1 /* acceptSuggestionOnEnter */);\n            acceptSuggestionsOnEnter.set(acceptSuggestionOnEnter === 'on' || acceptSuggestionOnEnter === 'smart');\n        };\n        this._toDispose.add(this.editor.onDidChangeConfiguration(() => updateFromConfig()));\n        updateFromConfig();\n    }\n    static get(editor) {\n        return editor.getContribution(SuggestController.ID);\n    }\n    dispose() {\n        this._alternatives.dispose();\n        this._toDispose.dispose();\n        this.widget.dispose();\n        this.model.dispose();\n        this._lineSuffix.dispose();\n    }\n    _insertSuggestion(event, flags) {\n        if (!event || !event.item) {\n            this._alternatives.value.reset();\n            this.model.cancel();\n            this.model.clear();\n            return;\n        }\n        if (!this.editor.hasModel()) {\n            return;\n        }\n        const model = this.editor.getModel();\n        const modelVersionNow = model.getAlternativeVersionId();\n        const { item } = event;\n        //\n        const tasks = [];\n        const cts = new CancellationTokenSource();\n        // pushing undo stops *before* additional text edits and\n        // *after* the main edit\n        if (!(flags & 1 /* NoBeforeUndoStop */)) {\n            this.editor.pushUndoStop();\n        }\n        // compute overwrite[Before|After] deltas BEFORE applying extra edits\n        const info = this.getOverwriteInfo(item, Boolean(flags & 8 /* AlternativeOverwriteConfig */));\n        // keep item in memory\n        this._memoryService.memorize(model, this.editor.getPosition(), item);\n        if (Array.isArray(item.completion.additionalTextEdits)) {\n            // sync additional edits\n            const scrollState = StableEditorScrollState.capture(this.editor);\n            this.editor.executeEdits('suggestController.additionalTextEdits.sync', item.completion.additionalTextEdits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n            scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);\n        }\n        else if (!item.isResolved) {\n            // async additional edits\n            const sw = new StopWatch(true);\n            let position;\n            const docListener = model.onDidChangeContent(e => {\n                if (e.isFlush) {\n                    cts.cancel();\n                    docListener.dispose();\n                    return;\n                }\n                for (let change of e.changes) {\n                    const thisPosition = Range.getEndPosition(change.range);\n                    if (!position || Position.isBefore(thisPosition, position)) {\n                        position = thisPosition;\n                    }\n                }\n            });\n            let oldFlags = flags;\n            flags |= 2 /* NoAfterUndoStop */;\n            let didType = false;\n            let typeListener = this.editor.onWillType(() => {\n                typeListener.dispose();\n                didType = true;\n                if (!(oldFlags & 2 /* NoAfterUndoStop */)) {\n                    this.editor.pushUndoStop();\n                }\n            });\n            tasks.push(item.resolve(cts.token).then(() => {\n                if (!item.completion.additionalTextEdits || cts.token.isCancellationRequested) {\n                    return false;\n                }\n                if (position && item.completion.additionalTextEdits.some(edit => Position.isBefore(position, Range.getStartPosition(edit.range)))) {\n                    return false;\n                }\n                if (didType) {\n                    this.editor.pushUndoStop();\n                }\n                const scrollState = StableEditorScrollState.capture(this.editor);\n                this.editor.executeEdits('suggestController.additionalTextEdits.async', item.completion.additionalTextEdits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n                scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);\n                if (didType || !(oldFlags & 2 /* NoAfterUndoStop */)) {\n                    this.editor.pushUndoStop();\n                }\n                return true;\n            }).then(applied => {\n                this._logService.trace('[suggest] async resolving of edits DONE (ms, applied?)', sw.elapsed(), applied);\n                docListener.dispose();\n                typeListener.dispose();\n            }));\n        }\n        let { insertText } = item.completion;\n        if (!(item.completion.insertTextRules & 4 /* InsertAsSnippet */)) {\n            insertText = SnippetParser.escape(insertText);\n        }\n        SnippetController2.get(this.editor).insert(insertText, {\n            overwriteBefore: info.overwriteBefore,\n            overwriteAfter: info.overwriteAfter,\n            undoStopBefore: false,\n            undoStopAfter: false,\n            adjustWhitespace: !(item.completion.insertTextRules & 1 /* KeepWhitespace */),\n            clipboardText: event.model.clipboardText,\n            overtypingCapturer: this._overtypingCapturer.value\n        });\n        if (!(flags & 2 /* NoAfterUndoStop */)) {\n            this.editor.pushUndoStop();\n        }\n        if (!item.completion.command) {\n            // done\n            this.model.cancel();\n        }\n        else if (item.completion.command.id === TriggerSuggestAction.id) {\n            // retigger\n            this.model.trigger({ auto: true, shy: false }, true);\n        }\n        else {\n            // exec command, done\n            tasks.push(this._commandService.executeCommand(item.completion.command.id, ...(item.completion.command.arguments ? [...item.completion.command.arguments] : [])).catch(onUnexpectedError));\n            this.model.cancel();\n        }\n        if (flags & 4 /* KeepAlternativeSuggestions */) {\n            this._alternatives.value.set(event, next => {\n                // cancel resolving of additional edits\n                cts.cancel();\n                // this is not so pretty. when inserting the 'next'\n                // suggestion we undo until we are at the state at\n                // which we were before inserting the previous suggestion...\n                while (model.canUndo()) {\n                    if (modelVersionNow !== model.getAlternativeVersionId()) {\n                        model.undo();\n                    }\n                    this._insertSuggestion(next, 1 /* NoBeforeUndoStop */ | 2 /* NoAfterUndoStop */ | (flags & 8 /* AlternativeOverwriteConfig */ ? 8 /* AlternativeOverwriteConfig */ : 0));\n                    break;\n                }\n            });\n        }\n        this._alertCompletionItem(item);\n        // clear only now - after all tasks are done\n        Promise.all(tasks).finally(() => {\n            this.model.clear();\n            cts.dispose();\n        });\n    }\n    getOverwriteInfo(item, toggleMode) {\n        assertType(this.editor.hasModel());\n        let replace = this.editor.getOption(105 /* suggest */).insertMode === 'replace';\n        if (toggleMode) {\n            replace = !replace;\n        }\n        const overwriteBefore = item.position.column - item.editStart.column;\n        const overwriteAfter = (replace ? item.editReplaceEnd.column : item.editInsertEnd.column) - item.position.column;\n        const columnDelta = this.editor.getPosition().column - item.position.column;\n        const suffixDelta = this._lineSuffix.value ? this._lineSuffix.value.delta(this.editor.getPosition()) : 0;\n        return {\n            overwriteBefore: overwriteBefore + columnDelta,\n            overwriteAfter: overwriteAfter + suffixDelta\n        };\n    }\n    _alertCompletionItem(item) {\n        if (isNonEmptyArray(item.completion.additionalTextEdits)) {\n            let msg = nls.localize('aria.alert.snippet', \"Accepting '{0}' made {1} additional edits\", item.textLabel, item.completion.additionalTextEdits.length);\n            alert(msg);\n        }\n    }\n    triggerSuggest(onlyFrom) {\n        if (this.editor.hasModel()) {\n            this.model.trigger({ auto: false, shy: false }, false, onlyFrom);\n            this.editor.revealPosition(this.editor.getPosition(), 0 /* Smooth */);\n            this.editor.focus();\n        }\n    }\n    triggerSuggestAndAcceptBest(arg) {\n        if (!this.editor.hasModel()) {\n            return;\n        }\n        const positionNow = this.editor.getPosition();\n        const fallback = () => {\n            if (positionNow.equals(this.editor.getPosition())) {\n                this._commandService.executeCommand(arg.fallback);\n            }\n        };\n        const makesTextEdit = (item) => {\n            if (item.completion.insertTextRules & 4 /* InsertAsSnippet */ || item.completion.additionalTextEdits) {\n                // snippet, other editor -> makes edit\n                return true;\n            }\n            const position = this.editor.getPosition();\n            const startColumn = item.editStart.column;\n            const endColumn = position.column;\n            if (endColumn - startColumn !== item.completion.insertText.length) {\n                // unequal lengths -> makes edit\n                return true;\n            }\n            const textNow = this.editor.getModel().getValueInRange({\n                startLineNumber: position.lineNumber,\n                startColumn,\n                endLineNumber: position.lineNumber,\n                endColumn\n            });\n            // unequal text -> makes edit\n            return textNow !== item.completion.insertText;\n        };\n        Event.once(this.model.onDidTrigger)(_ => {\n            // wait for trigger because only then the cancel-event is trustworthy\n            let listener = [];\n            Event.any(this.model.onDidTrigger, this.model.onDidCancel)(() => {\n                // retrigger or cancel -> try to type default text\n                dispose(listener);\n                fallback();\n            }, undefined, listener);\n            this.model.onDidSuggest(({ completionModel }) => {\n                dispose(listener);\n                if (completionModel.items.length === 0) {\n                    fallback();\n                    return;\n                }\n                const index = this._memoryService.select(this.editor.getModel(), this.editor.getPosition(), completionModel.items);\n                const item = completionModel.items[index];\n                if (!makesTextEdit(item)) {\n                    fallback();\n                    return;\n                }\n                this.editor.pushUndoStop();\n                this._insertSuggestion({ index, item, model: completionModel }, 4 /* KeepAlternativeSuggestions */ | 1 /* NoBeforeUndoStop */ | 2 /* NoAfterUndoStop */);\n            }, undefined, listener);\n        });\n        this.model.trigger({ auto: false, shy: true });\n        this.editor.revealPosition(positionNow, 0 /* Smooth */);\n        this.editor.focus();\n    }\n    acceptSelectedSuggestion(keepAlternativeSuggestions, alternativeOverwriteConfig) {\n        const item = this.widget.value.getFocusedItem();\n        let flags = 0;\n        if (keepAlternativeSuggestions) {\n            flags |= 4 /* KeepAlternativeSuggestions */;\n        }\n        if (alternativeOverwriteConfig) {\n            flags |= 8 /* AlternativeOverwriteConfig */;\n        }\n        this._insertSuggestion(item, flags);\n    }\n    acceptNextSuggestion() {\n        this._alternatives.value.next();\n    }\n    acceptPrevSuggestion() {\n        this._alternatives.value.prev();\n    }\n    cancelSuggestWidget() {\n        this.model.cancel();\n        this.model.clear();\n        this.widget.value.hideWidget();\n    }\n    selectNextSuggestion() {\n        this.widget.value.selectNext();\n    }\n    selectNextPageSuggestion() {\n        this.widget.value.selectNextPage();\n    }\n    selectLastSuggestion() {\n        this.widget.value.selectLast();\n    }\n    selectPrevSuggestion() {\n        this.widget.value.selectPrevious();\n    }\n    selectPrevPageSuggestion() {\n        this.widget.value.selectPreviousPage();\n    }\n    selectFirstSuggestion() {\n        this.widget.value.selectFirst();\n    }\n    toggleSuggestionDetails() {\n        this.widget.value.toggleDetails();\n    }\n    toggleExplainMode() {\n        this.widget.value.toggleExplainMode();\n    }\n    toggleSuggestionFocus() {\n        this.widget.value.toggleDetailsFocus();\n    }\n    resetWidgetSize() {\n        this.widget.value.resetPersistedSize();\n    }\n    forceRenderingAbove() {\n        this.widget.value.forceRenderingAbove();\n    }\n    stopForceRenderingAbove() {\n        if (!this.widget.isInitialized) {\n            // This method has no effect if the widget is not initialized yet.\n            return;\n        }\n        this.widget.value.stopForceRenderingAbove();\n    }\n    registerSelector(selector) {\n        return this._selectors.register(selector);\n    }\n};\nSuggestController.ID = 'editor.contrib.suggestController';\nSuggestController = __decorate([\n    __param(1, ISuggestMemoryService),\n    __param(2, ICommandService),\n    __param(3, IContextKeyService),\n    __param(4, IInstantiationService),\n    __param(5, ILogService)\n], SuggestController);\nexport { SuggestController };\nclass PriorityRegistry {\n    constructor(prioritySelector) {\n        this.prioritySelector = prioritySelector;\n        this._items = new Array();\n    }\n    register(value) {\n        if (this._items.indexOf(value) !== -1) {\n            throw new Error('Value is already registered');\n        }\n        this._items.push(value);\n        this._items.sort((s1, s2) => this.prioritySelector(s2) - this.prioritySelector(s1));\n        return {\n            dispose: () => {\n                const idx = this._items.indexOf(value);\n                if (idx >= 0) {\n                    this._items.splice(idx, 1);\n                }\n            }\n        };\n    }\n    get itemsOrderedByPriorityDesc() {\n        return this._items;\n    }\n}\nexport class TriggerSuggestAction extends EditorAction {\n    constructor() {\n        super({\n            id: TriggerSuggestAction.id,\n            label: nls.localize('suggest.trigger.label', \"Trigger Suggest\"),\n            alias: 'Trigger Suggest',\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasCompletionItemProvider),\n            kbOpts: {\n                kbExpr: EditorContextKeys.textInputFocus,\n                primary: 2048 /* CtrlCmd */ | 10 /* Space */,\n                secondary: [2048 /* CtrlCmd */ | 39 /* KeyI */],\n                mac: { primary: 256 /* WinCtrl */ | 10 /* Space */, secondary: [512 /* Alt */ | 9 /* Escape */, 2048 /* CtrlCmd */ | 39 /* KeyI */] },\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    run(accessor, editor) {\n        const controller = SuggestController.get(editor);\n        if (!controller) {\n            return;\n        }\n        controller.triggerSuggest();\n    }\n}\nTriggerSuggestAction.id = 'editor.action.triggerSuggest';\nregisterEditorContribution(SuggestController.ID, SuggestController);\nregisterEditorAction(TriggerSuggestAction);\nconst weight = 100 /* EditorContrib */ + 90;\nconst SuggestCommand = EditorCommand.bindToContribution(SuggestController.get);\nregisterEditorCommand(new SuggestCommand({\n    id: 'acceptSelectedSuggestion',\n    precondition: SuggestContext.Visible,\n    handler(x) {\n        x.acceptSelectedSuggestion(true, false);\n    }\n}));\n// normal tab\nKeybindingsRegistry.registerKeybindingRule({\n    id: 'acceptSelectedSuggestion',\n    when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\n    primary: 2 /* Tab */,\n    weight\n});\n// accept on enter has special rules\nKeybindingsRegistry.registerKeybindingRule({\n    id: 'acceptSelectedSuggestion',\n    when: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus, SuggestContext.AcceptSuggestionsOnEnter, SuggestContext.MakesTextEdit),\n    primary: 3 /* Enter */,\n    weight,\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n    command: { id: 'acceptSelectedSuggestion', title: nls.localize('accept.insert', \"Insert\") },\n    group: 'left',\n    order: 1,\n    when: SuggestContext.HasInsertAndReplaceRange.toNegated()\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n    command: { id: 'acceptSelectedSuggestion', title: nls.localize('accept.insert', \"Insert\") },\n    group: 'left',\n    order: 1,\n    when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('insert'))\n});\nMenuRegistry.appendMenuItem(suggestWidgetStatusbarMenu, {\n    command: { id: 'acceptSelectedSuggestion', title: nls.localize('accept.replace', \"Replace\") },\n    group: 'left',\n    order: 1,\n    when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('replace'))\n});\nregisterEditorCommand(new SuggestCommand({\n    id: 'acceptAlternativeSelectedSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, EditorContextKeys.textInputFocus),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 1024 /* Shift */ | 3 /* Enter */,\n        secondary: [1024 /* Shift */ | 2 /* Tab */],\n    },\n    handler(x) {\n        x.acceptSelectedSuggestion(false, true);\n    },\n    menuOpts: [{\n            menuId: suggestWidgetStatusbarMenu,\n            group: 'left',\n            order: 2,\n            when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('insert')),\n            title: nls.localize('accept.replace', \"Replace\")\n        }, {\n            menuId: suggestWidgetStatusbarMenu,\n            group: 'left',\n            order: 2,\n            when: ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange, SuggestContext.InsertMode.isEqualTo('replace')),\n            title: nls.localize('accept.insert', \"Insert\")\n        }]\n}));\n// continue to support the old command\nCommandsRegistry.registerCommandAlias('acceptSelectedSuggestionOnEnter', 'acceptSelectedSuggestion');\nregisterEditorCommand(new SuggestCommand({\n    id: 'hideSuggestWidget',\n    precondition: SuggestContext.Visible,\n    handler: x => x.cancelSuggestWidget(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 9 /* Escape */,\n        secondary: [1024 /* Shift */ | 9 /* Escape */]\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectNextSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectNextSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 18 /* DownArrow */,\n        secondary: [2048 /* CtrlCmd */ | 18 /* DownArrow */],\n        mac: { primary: 18 /* DownArrow */, secondary: [2048 /* CtrlCmd */ | 18 /* DownArrow */, 256 /* WinCtrl */ | 44 /* KeyN */] }\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectNextPageSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectNextPageSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 12 /* PageDown */,\n        secondary: [2048 /* CtrlCmd */ | 12 /* PageDown */]\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectLastSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectLastSuggestion()\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectPrevSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectPrevSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 16 /* UpArrow */,\n        secondary: [2048 /* CtrlCmd */ | 16 /* UpArrow */],\n        mac: { primary: 16 /* UpArrow */, secondary: [2048 /* CtrlCmd */ | 16 /* UpArrow */, 256 /* WinCtrl */ | 46 /* KeyP */] }\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectPrevPageSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectPrevPageSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 11 /* PageUp */,\n        secondary: [2048 /* CtrlCmd */ | 11 /* PageUp */]\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'selectFirstSuggestion',\n    precondition: ContextKeyExpr.and(SuggestContext.Visible, SuggestContext.MultipleSuggestions),\n    handler: c => c.selectFirstSuggestion()\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'toggleSuggestionDetails',\n    precondition: SuggestContext.Visible,\n    handler: x => x.toggleSuggestionDetails(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 2048 /* CtrlCmd */ | 10 /* Space */,\n        secondary: [2048 /* CtrlCmd */ | 39 /* KeyI */],\n        mac: { primary: 256 /* WinCtrl */ | 10 /* Space */, secondary: [2048 /* CtrlCmd */ | 39 /* KeyI */] }\n    },\n    menuOpts: [{\n            menuId: suggestWidgetStatusbarMenu,\n            group: 'right',\n            order: 1,\n            when: ContextKeyExpr.and(SuggestContext.DetailsVisible, SuggestContext.CanResolve),\n            title: nls.localize('detail.more', \"show less\")\n        }, {\n            menuId: suggestWidgetStatusbarMenu,\n            group: 'right',\n            order: 1,\n            when: ContextKeyExpr.and(SuggestContext.DetailsVisible.toNegated(), SuggestContext.CanResolve),\n            title: nls.localize('detail.less', \"show more\")\n        }]\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'toggleExplainMode',\n    precondition: SuggestContext.Visible,\n    handler: x => x.toggleExplainMode(),\n    kbOpts: {\n        weight: 100 /* EditorContrib */,\n        primary: 2048 /* CtrlCmd */ | 85 /* Slash */,\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'toggleSuggestionFocus',\n    precondition: SuggestContext.Visible,\n    handler: x => x.toggleSuggestionFocus(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 10 /* Space */,\n        mac: { primary: 256 /* WinCtrl */ | 512 /* Alt */ | 10 /* Space */ }\n    }\n}));\n//#region tab completions\nregisterEditorCommand(new SuggestCommand({\n    id: 'insertBestCompletion',\n    precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), WordContextKey.AtEnd, SuggestContext.Visible.toNegated(), SuggestAlternatives.OtherSuggestions.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n    handler: (x, arg) => {\n        x.triggerSuggestAndAcceptBest(isObject(arg) ? Object.assign({ fallback: 'tab' }, arg) : { fallback: 'tab' });\n    },\n    kbOpts: {\n        weight,\n        primary: 2 /* Tab */\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'insertNextSuggestion',\n    precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n    handler: x => x.acceptNextSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 2 /* Tab */\n    }\n}));\nregisterEditorCommand(new SuggestCommand({\n    id: 'insertPrevSuggestion',\n    precondition: ContextKeyExpr.and(EditorContextKeys.textInputFocus, ContextKeyExpr.equals('config.editor.tabCompletion', 'on'), SuggestAlternatives.OtherSuggestions, SuggestContext.Visible.toNegated(), SnippetController2.InSnippetMode.toNegated()),\n    handler: x => x.acceptPrevSuggestion(),\n    kbOpts: {\n        weight: weight,\n        kbExpr: EditorContextKeys.textInputFocus,\n        primary: 1024 /* Shift */ | 2 /* Tab */\n    }\n}));\nregisterEditorAction(class extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.resetSuggestSize',\n            label: nls.localize('suggest.reset.label', \"Reset Suggest Widget Size\"),\n            alias: 'Reset Suggest Widget Size',\n            precondition: undefined\n        });\n    }\n    run(_accessor, editor) {\n        SuggestController.get(editor).resetWidgetSize();\n    }\n});\n"]},"metadata":{},"sourceType":"module"}