{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport * as dom from '../../../base/browser/dom.js';\nimport '../../../base/browser/ui/codicons/codiconStyles.js'; // The codicon symbol styles are defined here and must be loaded\n\nimport { List } from '../../../base/browser/ui/list/listWidget.js';\nimport { createCancelablePromise, disposableTimeout, TimeoutTimer } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { clamp } from '../../../base/common/numbers.js';\nimport * as strings from '../../../base/common/strings.js';\nimport './media/suggest.css';\nimport { EmbeddedCodeEditorWidget } from '../../browser/widget/embeddedCodeEditorWidget.js';\nimport { SuggestWidgetStatus } from './suggestWidgetStatus.js';\nimport '../symbolIcons/symbolIcons.js'; // The codicon symbol colors are defined here and must be loaded to get colors\n\nimport * as nls from '../../../nls.js';\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\nimport { activeContrastBorder, editorForeground, editorWidgetBackground, editorWidgetBorder, focusBorder, listFocusHighlightForeground, listHighlightForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, registerColor, textCodeBlockBackground, textLinkActiveForeground, textLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { attachListStyler } from '../../../platform/theme/common/styler.js';\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { ResizableHTMLElement } from './resizable.js';\nimport { Context as SuggestContext } from './suggest.js';\nimport { canExpandCompletionItem, SuggestDetailsOverlay, SuggestDetailsWidget } from './suggestWidgetDetails.js';\nimport { getAriaId, ItemRenderer } from './suggestWidgetRenderer.js';\n/**\n * Suggest widget colors\n */\n\nexport const editorSuggestWidgetBackground = registerColor('editorSuggestWidget.background', {\n  dark: editorWidgetBackground,\n  light: editorWidgetBackground,\n  hc: editorWidgetBackground\n}, nls.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));\nexport const editorSuggestWidgetBorder = registerColor('editorSuggestWidget.border', {\n  dark: editorWidgetBorder,\n  light: editorWidgetBorder,\n  hc: editorWidgetBorder\n}, nls.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));\nexport const editorSuggestWidgetForeground = registerColor('editorSuggestWidget.foreground', {\n  dark: editorForeground,\n  light: editorForeground,\n  hc: editorForeground\n}, nls.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));\nexport const editorSuggestWidgetSelectedForeground = registerColor('editorSuggestWidget.selectedForeground', {\n  dark: quickInputListFocusForeground,\n  light: quickInputListFocusForeground,\n  hc: quickInputListFocusForeground\n}, nls.localize('editorSuggestWidgetSelectedForeground', 'Foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedIconForeground = registerColor('editorSuggestWidget.selectedIconForeground', {\n  dark: quickInputListFocusIconForeground,\n  light: quickInputListFocusIconForeground,\n  hc: quickInputListFocusIconForeground\n}, nls.localize('editorSuggestWidgetSelectedIconForeground', 'Icon foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedBackground = registerColor('editorSuggestWidget.selectedBackground', {\n  dark: quickInputListFocusBackground,\n  light: quickInputListFocusBackground,\n  hc: quickInputListFocusBackground\n}, nls.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetHighlightForeground = registerColor('editorSuggestWidget.highlightForeground', {\n  dark: listHighlightForeground,\n  light: listHighlightForeground,\n  hc: listHighlightForeground\n}, nls.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));\nexport const editorSuggestWidgetHighlightFocusForeground = registerColor('editorSuggestWidget.focusHighlightForeground', {\n  dark: listFocusHighlightForeground,\n  light: listFocusHighlightForeground,\n  hc: listFocusHighlightForeground\n}, nls.localize('editorSuggestWidgetFocusHighlightForeground', 'Color of the match highlights in the suggest widget when an item is focused.'));\n\nclass PersistedWidgetSize {\n  constructor(_service, editor) {\n    this._service = _service;\n    this._key = `suggestWidget.size/${editor.getEditorType()}/${editor instanceof EmbeddedCodeEditorWidget}`;\n  }\n\n  restore() {\n    var _a;\n\n    const raw = (_a = this._service.get(this._key, 0\n    /* GLOBAL */\n    )) !== null && _a !== void 0 ? _a : '';\n\n    try {\n      const obj = JSON.parse(raw);\n\n      if (dom.Dimension.is(obj)) {\n        return dom.Dimension.lift(obj);\n      }\n    } catch (_b) {// ignore\n    }\n\n    return undefined;\n  }\n\n  store(size) {\n    this._service.store(this._key, JSON.stringify(size), 0\n    /* GLOBAL */\n    , 1\n    /* MACHINE */\n    );\n  }\n\n  reset() {\n    this._service.remove(this._key, 0\n    /* GLOBAL */\n    );\n  }\n\n}\n\nlet SuggestWidget = class SuggestWidget {\n  constructor(editor, _storageService, _contextKeyService, _themeService, instantiationService) {\n    this.editor = editor;\n    this._storageService = _storageService;\n    this._state = 0\n    /* Hidden */\n    ;\n    this._isAuto = false;\n    this._ignoreFocusEvents = false;\n    this._forceRenderingAbove = false;\n    this._explainMode = false;\n    this._showTimeout = new TimeoutTimer();\n    this._disposables = new DisposableStore();\n    this._onDidSelect = new Emitter();\n    this._onDidFocus = new Emitter();\n    this._onDidHide = new Emitter();\n    this._onDidShow = new Emitter();\n    this.onDidSelect = this._onDidSelect.event;\n    this.onDidFocus = this._onDidFocus.event;\n    this.onDidHide = this._onDidHide.event;\n    this.onDidShow = this._onDidShow.event;\n    this._onDetailsKeydown = new Emitter();\n    this.onDetailsKeyDown = this._onDetailsKeydown.event;\n    this.element = new ResizableHTMLElement();\n    this.element.domNode.classList.add('editor-widget', 'suggest-widget');\n    this._contentWidget = new SuggestContentWidget(this, editor);\n    this._persistedSize = new PersistedWidgetSize(_storageService, editor);\n\n    class ResizeState {\n      constructor(persistedSize, currentSize) {\n        let persistHeight = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n        let persistWidth = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n        this.persistedSize = persistedSize;\n        this.currentSize = currentSize;\n        this.persistHeight = persistHeight;\n        this.persistWidth = persistWidth;\n      }\n\n    }\n\n    let state;\n\n    this._disposables.add(this.element.onDidWillResize(() => {\n      this._contentWidget.lockPreference();\n\n      state = new ResizeState(this._persistedSize.restore(), this.element.size);\n    }));\n\n    this._disposables.add(this.element.onDidResize(e => {\n      var _a, _b, _c, _d;\n\n      this._resize(e.dimension.width, e.dimension.height);\n\n      if (state) {\n        state.persistHeight = state.persistHeight || !!e.north || !!e.south;\n        state.persistWidth = state.persistWidth || !!e.east || !!e.west;\n      }\n\n      if (!e.done) {\n        return;\n      }\n\n      if (state) {\n        // only store width or height value that have changed and also\n        // only store changes that are above a certain threshold\n        const {\n          itemHeight,\n          defaultSize\n        } = this.getLayoutInfo();\n        const threshold = Math.round(itemHeight / 2);\n        let {\n          width,\n          height\n        } = this.element.size;\n\n        if (!state.persistHeight || Math.abs(state.currentSize.height - height) <= threshold) {\n          height = (_b = (_a = state.persistedSize) === null || _a === void 0 ? void 0 : _a.height) !== null && _b !== void 0 ? _b : defaultSize.height;\n        }\n\n        if (!state.persistWidth || Math.abs(state.currentSize.width - width) <= threshold) {\n          width = (_d = (_c = state.persistedSize) === null || _c === void 0 ? void 0 : _c.width) !== null && _d !== void 0 ? _d : defaultSize.width;\n        }\n\n        this._persistedSize.store(new dom.Dimension(width, height));\n      } // reset working state\n\n\n      this._contentWidget.unlockPreference();\n\n      state = undefined;\n    }));\n\n    this._messageElement = dom.append(this.element.domNode, dom.$('.message'));\n    this._listElement = dom.append(this.element.domNode, dom.$('.tree'));\n    const details = instantiationService.createInstance(SuggestDetailsWidget, this.editor);\n    details.onDidClose(this.toggleDetails, this, this._disposables);\n    this._details = new SuggestDetailsOverlay(details, this.editor);\n\n    const applyIconStyle = () => this.element.domNode.classList.toggle('no-icons', !this.editor.getOption(105\n    /* suggest */\n    ).showIcons);\n\n    applyIconStyle();\n    const renderer = instantiationService.createInstance(ItemRenderer, this.editor);\n\n    this._disposables.add(renderer);\n\n    this._disposables.add(renderer.onDidToggleDetails(() => this.toggleDetails()));\n\n    this._list = new List('SuggestWidget', this._listElement, {\n      getHeight: _element => this.getLayoutInfo().itemHeight,\n      getTemplateId: _element => 'suggestion'\n    }, [renderer], {\n      alwaysConsumeMouseWheel: true,\n      useShadows: false,\n      mouseSupport: false,\n      accessibilityProvider: {\n        getRole: () => 'option',\n        getAriaLabel: item => {\n          if (item.isResolved && this._isDetailsVisible()) {\n            const {\n              documentation,\n              detail\n            } = item.completion;\n            const docs = strings.format('{0}{1}', detail || '', documentation ? typeof documentation === 'string' ? documentation : documentation.value : '');\n            return nls.localize('ariaCurrenttSuggestionReadDetails', \"{0}, docs: {1}\", item.textLabel, docs);\n          } else {\n            return item.textLabel;\n          }\n        },\n        getWidgetAriaLabel: () => nls.localize('suggest', \"Suggest\"),\n        getWidgetRole: () => 'listbox'\n      }\n    });\n    this._status = instantiationService.createInstance(SuggestWidgetStatus, this.element.domNode);\n\n    const applyStatusBarStyle = () => this.element.domNode.classList.toggle('with-status-bar', this.editor.getOption(105\n    /* suggest */\n    ).showStatusBar);\n\n    applyStatusBarStyle();\n\n    this._disposables.add(attachListStyler(this._list, _themeService, {\n      listInactiveFocusBackground: editorSuggestWidgetSelectedBackground,\n      listInactiveFocusOutline: activeContrastBorder\n    }));\n\n    this._disposables.add(_themeService.onDidColorThemeChange(t => this._onThemeChange(t)));\n\n    this._onThemeChange(_themeService.getColorTheme());\n\n    this._disposables.add(this._list.onMouseDown(e => this._onListMouseDownOrTap(e)));\n\n    this._disposables.add(this._list.onTap(e => this._onListMouseDownOrTap(e)));\n\n    this._disposables.add(this._list.onDidChangeSelection(e => this._onListSelection(e)));\n\n    this._disposables.add(this._list.onDidChangeFocus(e => this._onListFocus(e)));\n\n    this._disposables.add(this.editor.onDidChangeCursorSelection(() => this._onCursorSelectionChanged()));\n\n    this._disposables.add(this.editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(105\n      /* suggest */\n      )) {\n        applyStatusBarStyle();\n        applyIconStyle();\n      }\n    }));\n\n    this._ctxSuggestWidgetVisible = SuggestContext.Visible.bindTo(_contextKeyService);\n    this._ctxSuggestWidgetDetailsVisible = SuggestContext.DetailsVisible.bindTo(_contextKeyService);\n    this._ctxSuggestWidgetMultipleSuggestions = SuggestContext.MultipleSuggestions.bindTo(_contextKeyService);\n\n    this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode, 'keydown', e => {\n      this._onDetailsKeydown.fire(e);\n    }));\n\n    this._disposables.add(this.editor.onMouseDown(e => this._onEditorMouseDown(e)));\n  }\n\n  dispose() {\n    var _a;\n\n    this._details.widget.dispose();\n\n    this._details.dispose();\n\n    this._list.dispose();\n\n    this._status.dispose();\n\n    this._disposables.dispose();\n\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n\n    this._showTimeout.dispose();\n\n    this._contentWidget.dispose();\n\n    this.element.dispose();\n  }\n\n  _onEditorMouseDown(mouseEvent) {\n    if (this._details.widget.domNode.contains(mouseEvent.target.element)) {\n      // Clicking inside details\n      this._details.widget.domNode.focus();\n    } else {\n      // Clicking outside details and inside suggest\n      if (this.element.domNode.contains(mouseEvent.target.element)) {\n        this.editor.focus();\n      }\n    }\n  }\n\n  _onCursorSelectionChanged() {\n    if (this._state !== 0\n    /* Hidden */\n    ) {\n      this._contentWidget.layout();\n    }\n  }\n\n  _onListMouseDownOrTap(e) {\n    if (typeof e.element === 'undefined' || typeof e.index === 'undefined') {\n      return;\n    } // prevent stealing browser focus from the editor\n\n\n    e.browserEvent.preventDefault();\n    e.browserEvent.stopPropagation();\n\n    this._select(e.element, e.index);\n  }\n\n  _onListSelection(e) {\n    if (e.elements.length) {\n      this._select(e.elements[0], e.indexes[0]);\n    }\n  }\n\n  _select(item, index) {\n    const completionModel = this._completionModel;\n\n    if (completionModel) {\n      this._onDidSelect.fire({\n        item,\n        index,\n        model: completionModel\n      });\n\n      this.editor.focus();\n    }\n  }\n\n  _onThemeChange(theme) {\n    const backgroundColor = theme.getColor(editorSuggestWidgetBackground);\n\n    if (backgroundColor) {\n      this.element.domNode.style.backgroundColor = backgroundColor.toString();\n      this._messageElement.style.backgroundColor = backgroundColor.toString();\n      this._details.widget.domNode.style.backgroundColor = backgroundColor.toString();\n    }\n\n    const borderColor = theme.getColor(editorSuggestWidgetBorder);\n\n    if (borderColor) {\n      this.element.domNode.style.borderColor = borderColor.toString();\n      this._messageElement.style.borderColor = borderColor.toString();\n      this._status.element.style.borderTopColor = borderColor.toString();\n      this._details.widget.domNode.style.borderColor = borderColor.toString();\n      this._detailsBorderColor = borderColor.toString();\n    }\n\n    const focusBorderColor = theme.getColor(focusBorder);\n\n    if (focusBorderColor) {\n      this._detailsFocusBorderColor = focusBorderColor.toString();\n    }\n\n    this._details.widget.borderWidth = theme.type === 'hc' ? 2 : 1;\n  }\n\n  _onListFocus(e) {\n    var _a;\n\n    if (this._ignoreFocusEvents) {\n      return;\n    }\n\n    if (!e.elements.length) {\n      if (this._currentSuggestionDetails) {\n        this._currentSuggestionDetails.cancel();\n\n        this._currentSuggestionDetails = undefined;\n        this._focusedItem = undefined;\n      }\n\n      this.editor.setAriaOptions({\n        activeDescendant: undefined\n      });\n      return;\n    }\n\n    if (!this._completionModel) {\n      return;\n    }\n\n    const item = e.elements[0];\n    const index = e.indexes[0];\n\n    if (item !== this._focusedItem) {\n      (_a = this._currentSuggestionDetails) === null || _a === void 0 ? void 0 : _a.cancel();\n      this._currentSuggestionDetails = undefined;\n      this._focusedItem = item;\n\n      this._list.reveal(index);\n\n      this._currentSuggestionDetails = createCancelablePromise(token => __awaiter(this, void 0, void 0, function* () {\n        const loading = disposableTimeout(() => {\n          if (this._isDetailsVisible()) {\n            this.showDetails(true);\n          }\n        }, 250);\n        token.onCancellationRequested(() => loading.dispose());\n        const result = yield item.resolve(token);\n        loading.dispose();\n        return result;\n      }));\n\n      this._currentSuggestionDetails.then(() => {\n        if (index >= this._list.length || item !== this._list.element(index)) {\n          return;\n        } // item can have extra information, so re-render\n\n\n        this._ignoreFocusEvents = true;\n\n        this._list.splice(index, 1, [item]);\n\n        this._list.setFocus([index]);\n\n        this._ignoreFocusEvents = false;\n\n        if (this._isDetailsVisible()) {\n          this.showDetails(false);\n        } else {\n          this.element.domNode.classList.remove('docs-side');\n        }\n\n        this.editor.setAriaOptions({\n          activeDescendant: getAriaId(index)\n        });\n      }).catch(onUnexpectedError);\n    } // emit an event\n\n\n    this._onDidFocus.fire({\n      item,\n      index,\n      model: this._completionModel\n    });\n  }\n\n  _setState(state) {\n    if (this._state === state) {\n      return;\n    }\n\n    this._state = state;\n    this.element.domNode.classList.toggle('frozen', state === 4\n    /* Frozen */\n    );\n    this.element.domNode.classList.remove('message');\n\n    switch (state) {\n      case 0\n      /* Hidden */\n      :\n        dom.hide(this._messageElement, this._listElement, this._status.element);\n\n        this._details.hide(true);\n\n        this._status.hide();\n\n        this._contentWidget.hide();\n\n        this._ctxSuggestWidgetVisible.reset();\n\n        this._ctxSuggestWidgetMultipleSuggestions.reset();\n\n        this._showTimeout.cancel();\n\n        this.element.domNode.classList.remove('visible');\n\n        this._list.splice(0, this._list.length);\n\n        this._focusedItem = undefined;\n        this._cappedHeight = undefined;\n        this._explainMode = false;\n        break;\n\n      case 1\n      /* Loading */\n      :\n        this.element.domNode.classList.add('message');\n        this._messageElement.textContent = SuggestWidget.LOADING_MESSAGE;\n        dom.hide(this._listElement, this._status.element);\n        dom.show(this._messageElement);\n\n        this._details.hide();\n\n        this._show();\n\n        this._focusedItem = undefined;\n        break;\n\n      case 2\n      /* Empty */\n      :\n        this.element.domNode.classList.add('message');\n        this._messageElement.textContent = SuggestWidget.NO_SUGGESTIONS_MESSAGE;\n        dom.hide(this._listElement, this._status.element);\n        dom.show(this._messageElement);\n\n        this._details.hide();\n\n        this._show();\n\n        this._focusedItem = undefined;\n        break;\n\n      case 3\n      /* Open */\n      :\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n\n        this._show();\n\n        break;\n\n      case 4\n      /* Frozen */\n      :\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n\n        this._show();\n\n        break;\n\n      case 5\n      /* Details */\n      :\n        dom.hide(this._messageElement);\n        dom.show(this._listElement, this._status.element);\n\n        this._details.show();\n\n        this._show();\n\n        break;\n    }\n  }\n\n  _show() {\n    this._status.show();\n\n    this._contentWidget.show();\n\n    this._layout(this._persistedSize.restore());\n\n    this._ctxSuggestWidgetVisible.set(true);\n\n    this._showTimeout.cancelAndSet(() => {\n      this.element.domNode.classList.add('visible');\n\n      this._onDidShow.fire(this);\n    }, 100);\n  }\n\n  showTriggered(auto, delay) {\n    if (this._state !== 0\n    /* Hidden */\n    ) {\n      return;\n    }\n\n    this._contentWidget.setPosition(this.editor.getPosition());\n\n    this._isAuto = !!auto;\n\n    if (!this._isAuto) {\n      this._loadingTimeout = disposableTimeout(() => this._setState(1\n      /* Loading */\n      ), delay);\n    }\n  }\n\n  showSuggestions(completionModel, selectionIndex, isFrozen, isAuto) {\n    var _a, _b;\n\n    this._contentWidget.setPosition(this.editor.getPosition());\n\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n    (_b = this._currentSuggestionDetails) === null || _b === void 0 ? void 0 : _b.cancel();\n    this._currentSuggestionDetails = undefined;\n\n    if (this._completionModel !== completionModel) {\n      this._completionModel = completionModel;\n    }\n\n    if (isFrozen && this._state !== 2\n    /* Empty */\n    && this._state !== 0\n    /* Hidden */\n    ) {\n      this._setState(4\n      /* Frozen */\n      );\n\n      return;\n    }\n\n    const visibleCount = this._completionModel.items.length;\n    const isEmpty = visibleCount === 0;\n\n    this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount > 1);\n\n    if (isEmpty) {\n      this._setState(isAuto ? 0\n      /* Hidden */\n      : 2\n      /* Empty */\n      );\n\n      this._completionModel = undefined;\n      return;\n    }\n\n    this._focusedItem = undefined;\n\n    this._list.splice(0, this._list.length, this._completionModel.items);\n\n    this._setState(isFrozen ? 4\n    /* Frozen */\n    : 3\n    /* Open */\n    );\n\n    this._list.reveal(selectionIndex, 0);\n\n    this._list.setFocus([selectionIndex]);\n\n    this._layout(this.element.size); // Reset focus border\n\n\n    if (this._detailsBorderColor) {\n      this._details.widget.domNode.style.borderColor = this._detailsBorderColor;\n    }\n  }\n\n  selectNextPage() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 5\n      /* Details */\n      :\n        this._details.widget.pageDown();\n\n        return true;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusNextPage();\n\n        return true;\n    }\n  }\n\n  selectNext() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusNext(1, true);\n\n        return true;\n    }\n  }\n\n  selectLast() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 5\n      /* Details */\n      :\n        this._details.widget.scrollBottom();\n\n        return true;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusLast();\n\n        return true;\n    }\n  }\n\n  selectPreviousPage() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 5\n      /* Details */\n      :\n        this._details.widget.pageUp();\n\n        return true;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusPreviousPage();\n\n        return true;\n    }\n  }\n\n  selectPrevious() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusPrevious(1, true);\n\n        return false;\n    }\n  }\n\n  selectFirst() {\n    switch (this._state) {\n      case 0\n      /* Hidden */\n      :\n        return false;\n\n      case 5\n      /* Details */\n      :\n        this._details.widget.scrollTop();\n\n        return true;\n\n      case 1\n      /* Loading */\n      :\n        return !this._isAuto;\n\n      default:\n        this._list.focusFirst();\n\n        return true;\n    }\n  }\n\n  getFocusedItem() {\n    if (this._state !== 0\n    /* Hidden */\n    && this._state !== 2\n    /* Empty */\n    && this._state !== 1\n    /* Loading */\n    && this._completionModel) {\n      return {\n        item: this._list.getFocusedElements()[0],\n        index: this._list.getFocus()[0],\n        model: this._completionModel\n      };\n    }\n\n    return undefined;\n  }\n\n  toggleDetailsFocus() {\n    if (this._state === 5\n    /* Details */\n    ) {\n      this._setState(3\n      /* Open */\n      );\n\n      if (this._detailsBorderColor) {\n        this._details.widget.domNode.style.borderColor = this._detailsBorderColor;\n      }\n    } else if (this._state === 3\n    /* Open */\n    && this._isDetailsVisible()) {\n      this._setState(5\n      /* Details */\n      );\n\n      if (this._detailsFocusBorderColor) {\n        this._details.widget.domNode.style.borderColor = this._detailsFocusBorderColor;\n      }\n    }\n  }\n\n  toggleDetails() {\n    if (this._isDetailsVisible()) {\n      // hide details widget\n      this._ctxSuggestWidgetDetailsVisible.set(false);\n\n      this._setDetailsVisible(false);\n\n      this._details.hide();\n\n      this.element.domNode.classList.remove('shows-details');\n    } else if ((canExpandCompletionItem(this._list.getFocusedElements()[0]) || this._explainMode) && (this._state === 3\n    /* Open */\n    || this._state === 5\n    /* Details */\n    || this._state === 4\n    /* Frozen */\n    )) {\n      // show details widget (iff possible)\n      this._ctxSuggestWidgetDetailsVisible.set(true);\n\n      this._setDetailsVisible(true);\n\n      this.showDetails(false);\n    }\n  }\n\n  showDetails(loading) {\n    this._details.show();\n\n    if (loading) {\n      this._details.widget.renderLoading();\n    } else {\n      this._details.widget.renderItem(this._list.getFocusedElements()[0], this._explainMode);\n    }\n\n    this._positionDetails();\n\n    this.editor.focus();\n    this.element.domNode.classList.add('shows-details');\n  }\n\n  toggleExplainMode() {\n    if (this._list.getFocusedElements()[0]) {\n      this._explainMode = !this._explainMode;\n\n      if (!this._isDetailsVisible()) {\n        this.toggleDetails();\n      } else {\n        this.showDetails(false);\n      }\n    }\n  }\n\n  resetPersistedSize() {\n    this._persistedSize.reset();\n  }\n\n  hideWidget() {\n    var _a;\n\n    (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n\n    this._setState(0\n    /* Hidden */\n    );\n\n    this._onDidHide.fire(this);\n\n    this.element.clearSashHoverState(); // ensure that a reasonable widget height is persisted so that\n    // accidential \"resize-to-single-items\" cases aren't happening\n\n    const dim = this._persistedSize.restore();\n\n    const minPersistedHeight = Math.ceil(this.getLayoutInfo().itemHeight * 4.3);\n\n    if (dim && dim.height < minPersistedHeight) {\n      this._persistedSize.store(dim.with(undefined, minPersistedHeight));\n    }\n  }\n\n  isFrozen() {\n    return this._state === 4\n    /* Frozen */\n    ;\n  }\n\n  _afterRender(position) {\n    if (position === null) {\n      if (this._isDetailsVisible()) {\n        this._details.hide(); //todo@jrieken soft-hide\n\n      }\n\n      return;\n    }\n\n    if (this._state === 2\n    /* Empty */\n    || this._state === 1\n    /* Loading */\n    ) {\n      // no special positioning when widget isn't showing list\n      return;\n    }\n\n    if (this._isDetailsVisible()) {\n      this._details.show();\n    }\n\n    this._positionDetails();\n  }\n\n  _layout(size) {\n    var _a, _b, _c;\n\n    if (!this.editor.hasModel()) {\n      return;\n    }\n\n    if (!this.editor.getDomNode()) {\n      // happens when running tests\n      return;\n    }\n\n    const bodyBox = dom.getClientArea(document.body);\n    const info = this.getLayoutInfo();\n\n    if (!size) {\n      size = info.defaultSize;\n    }\n\n    let height = size.height;\n    let width = size.width; // status bar\n\n    this._status.element.style.lineHeight = `${info.itemHeight}px`;\n\n    if (this._state === 2\n    /* Empty */\n    || this._state === 1\n    /* Loading */\n    ) {\n      // showing a message only\n      height = info.itemHeight + info.borderHeight;\n      width = info.defaultSize.width / 2;\n      this.element.enableSashes(false, false, false, false);\n      this.element.minSize = this.element.maxSize = new dom.Dimension(width, height);\n\n      this._contentWidget.setPreference(2\n      /* BELOW */\n      );\n    } else {\n      // showing items\n      // width math\n      const maxWidth = bodyBox.width - info.borderHeight - 2 * info.horizontalPadding;\n\n      if (width > maxWidth) {\n        width = maxWidth;\n      }\n\n      const preferredWidth = this._completionModel ? this._completionModel.stats.pLabelLen * info.typicalHalfwidthCharacterWidth : width; // height math\n\n      const fullHeight = info.statusBarHeight + this._list.contentHeight + info.borderHeight;\n      const minHeight = info.itemHeight + info.statusBarHeight;\n      const editorBox = dom.getDomNodePagePosition(this.editor.getDomNode());\n      const cursorBox = this.editor.getScrolledVisiblePosition(this.editor.getPosition());\n      const cursorBottom = editorBox.top + cursorBox.top + cursorBox.height;\n      const maxHeightBelow = Math.min(bodyBox.height - cursorBottom - info.verticalPadding, fullHeight);\n      const availableSpaceAbove = editorBox.top + cursorBox.top - info.verticalPadding;\n      const maxHeightAbove = Math.min(availableSpaceAbove, fullHeight);\n      let maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow) + info.borderHeight, fullHeight);\n\n      if (height === ((_a = this._cappedHeight) === null || _a === void 0 ? void 0 : _a.capped)) {\n        // Restore the old (wanted) height when the current\n        // height is capped to fit\n        height = this._cappedHeight.wanted;\n      }\n\n      if (height < minHeight) {\n        height = minHeight;\n      }\n\n      if (height > maxHeight) {\n        height = maxHeight;\n      }\n\n      const forceRenderingAboveRequiredSpace = 150;\n\n      if (height > maxHeightBelow || this._forceRenderingAbove && availableSpaceAbove > forceRenderingAboveRequiredSpace) {\n        this._contentWidget.setPreference(1\n        /* ABOVE */\n        );\n\n        this.element.enableSashes(true, true, false, false);\n        maxHeight = maxHeightAbove;\n      } else {\n        this._contentWidget.setPreference(2\n        /* BELOW */\n        );\n\n        this.element.enableSashes(false, true, true, false);\n        maxHeight = maxHeightBelow;\n      }\n\n      this.element.preferredSize = new dom.Dimension(preferredWidth, info.defaultSize.height);\n      this.element.maxSize = new dom.Dimension(maxWidth, maxHeight);\n      this.element.minSize = new dom.Dimension(220, minHeight); // Know when the height was capped to fit and remember\n      // the wanted height for later. This is required when going\n      // left to widen suggestions.\n\n      this._cappedHeight = height === fullHeight ? {\n        wanted: (_c = (_b = this._cappedHeight) === null || _b === void 0 ? void 0 : _b.wanted) !== null && _c !== void 0 ? _c : size.height,\n        capped: height\n      } : undefined;\n    }\n\n    this._resize(width, height);\n  }\n\n  _resize(width, height) {\n    const {\n      width: maxWidth,\n      height: maxHeight\n    } = this.element.maxSize;\n    width = Math.min(maxWidth, width);\n    height = Math.min(maxHeight, height);\n    const {\n      statusBarHeight\n    } = this.getLayoutInfo();\n\n    this._list.layout(height - statusBarHeight, width);\n\n    this._listElement.style.height = `${height - statusBarHeight}px`;\n    this.element.layout(height, width);\n\n    this._contentWidget.layout();\n\n    this._positionDetails();\n  }\n\n  _positionDetails() {\n    if (this._isDetailsVisible()) {\n      this._details.placeAtAnchor(this.element.domNode);\n    }\n  }\n\n  getLayoutInfo() {\n    const fontInfo = this.editor.getOption(43\n    /* fontInfo */\n    );\n    const itemHeight = clamp(this.editor.getOption(107\n    /* suggestLineHeight */\n    ) || fontInfo.lineHeight, 8, 1000);\n    const statusBarHeight = !this.editor.getOption(105\n    /* suggest */\n    ).showStatusBar || this._state === 2\n    /* Empty */\n    || this._state === 1\n    /* Loading */\n    ? 0 : itemHeight;\n    const borderWidth = this._details.widget.borderWidth;\n    const borderHeight = 2 * borderWidth;\n    return {\n      itemHeight,\n      statusBarHeight,\n      borderWidth,\n      borderHeight,\n      typicalHalfwidthCharacterWidth: fontInfo.typicalHalfwidthCharacterWidth,\n      verticalPadding: 22,\n      horizontalPadding: 14,\n      defaultSize: new dom.Dimension(430, statusBarHeight + 12 * itemHeight + borderHeight)\n    };\n  }\n\n  _isDetailsVisible() {\n    return this._storageService.getBoolean('expandSuggestionDocs', 0\n    /* GLOBAL */\n    , false);\n  }\n\n  _setDetailsVisible(value) {\n    this._storageService.store('expandSuggestionDocs', value, 0\n    /* GLOBAL */\n    , 0\n    /* USER */\n    );\n  }\n\n  forceRenderingAbove() {\n    if (!this._forceRenderingAbove) {\n      this._forceRenderingAbove = true;\n\n      this._layout(this._persistedSize.restore());\n    }\n  }\n\n  stopForceRenderingAbove() {\n    this._forceRenderingAbove = false;\n  }\n\n};\nSuggestWidget.LOADING_MESSAGE = nls.localize('suggestWidget.loading', \"Loading...\");\nSuggestWidget.NO_SUGGESTIONS_MESSAGE = nls.localize('suggestWidget.noSuggestions', \"No suggestions.\");\nSuggestWidget = __decorate([__param(1, IStorageService), __param(2, IContextKeyService), __param(3, IThemeService), __param(4, IInstantiationService)], SuggestWidget);\nexport { SuggestWidget };\nexport class SuggestContentWidget {\n  constructor(_widget, _editor) {\n    this._widget = _widget;\n    this._editor = _editor;\n    this.allowEditorOverflow = true;\n    this.suppressMouseDown = false;\n    this._preferenceLocked = false;\n    this._added = false;\n    this._hidden = false;\n  }\n\n  dispose() {\n    if (this._added) {\n      this._added = false;\n\n      this._editor.removeContentWidget(this);\n    }\n  }\n\n  getId() {\n    return 'editor.widget.suggestWidget';\n  }\n\n  getDomNode() {\n    return this._widget.element.domNode;\n  }\n\n  show() {\n    this._hidden = false;\n\n    if (!this._added) {\n      this._added = true;\n\n      this._editor.addContentWidget(this);\n    }\n  }\n\n  hide() {\n    if (!this._hidden) {\n      this._hidden = true;\n      this.layout();\n    }\n  }\n\n  layout() {\n    this._editor.layoutContentWidget(this);\n  }\n\n  getPosition() {\n    if (this._hidden || !this._position || !this._preference) {\n      return null;\n    }\n\n    return {\n      position: this._position,\n      preference: [this._preference]\n    };\n  }\n\n  beforeRender() {\n    const {\n      height,\n      width\n    } = this._widget.element.size;\n\n    const {\n      borderWidth,\n      horizontalPadding\n    } = this._widget.getLayoutInfo();\n\n    return new dom.Dimension(width + 2 * borderWidth + horizontalPadding, height + 2 * borderWidth);\n  }\n\n  afterRender(position) {\n    this._widget._afterRender(position);\n  }\n\n  setPreference(preference) {\n    if (!this._preferenceLocked) {\n      this._preference = preference;\n    }\n  }\n\n  lockPreference() {\n    this._preferenceLocked = true;\n  }\n\n  unlockPreference() {\n    this._preferenceLocked = false;\n  }\n\n  setPosition(position) {\n    this._position = position;\n  }\n\n}\nregisterThemingParticipant((theme, collector) => {\n  const matchHighlight = theme.getColor(editorSuggestWidgetHighlightForeground);\n\n  if (matchHighlight) {\n    collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row .monaco-highlighted-label .highlight { color: ${matchHighlight}; }`);\n  }\n\n  const matchHighlightFocus = theme.getColor(editorSuggestWidgetHighlightFocusForeground);\n\n  if (matchHighlight) {\n    collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused .monaco-highlighted-label .highlight { color: ${matchHighlightFocus}; }`);\n  }\n\n  const foreground = theme.getColor(editorSuggestWidgetForeground);\n\n  if (foreground) {\n    collector.addRule(`.monaco-editor .suggest-widget, .monaco-editor .suggest-details { color: ${foreground}; }`);\n  }\n\n  const selectedForeground = theme.getColor(editorSuggestWidgetSelectedForeground);\n\n  if (selectedForeground) {\n    collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused { color: ${selectedForeground}; }`);\n  }\n\n  const selectedIconForeground = theme.getColor(editorSuggestWidgetSelectedIconForeground);\n\n  if (selectedIconForeground) {\n    collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused .codicon { color: ${selectedIconForeground}; }`);\n  }\n\n  const link = theme.getColor(textLinkForeground);\n\n  if (link) {\n    collector.addRule(`.monaco-editor .suggest-details a { color: ${link}; }`);\n  }\n\n  const linkHover = theme.getColor(textLinkActiveForeground);\n\n  if (linkHover) {\n    collector.addRule(`.monaco-editor .suggest-details a:hover { color: ${linkHover}; }`);\n  }\n\n  const codeBackground = theme.getColor(textCodeBlockBackground);\n\n  if (codeBackground) {\n    collector.addRule(`.monaco-editor .suggest-details code { background-color: ${codeBackground}; }`);\n  }\n});","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/suggest/suggestWidget.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","dom","List","createCancelablePromise","disposableTimeout","TimeoutTimer","onUnexpectedError","Emitter","DisposableStore","clamp","strings","EmbeddedCodeEditorWidget","SuggestWidgetStatus","nls","IContextKeyService","IInstantiationService","IStorageService","activeContrastBorder","editorForeground","editorWidgetBackground","editorWidgetBorder","focusBorder","listFocusHighlightForeground","listHighlightForeground","quickInputListFocusBackground","quickInputListFocusForeground","quickInputListFocusIconForeground","registerColor","textCodeBlockBackground","textLinkActiveForeground","textLinkForeground","attachListStyler","IThemeService","registerThemingParticipant","ResizableHTMLElement","Context","SuggestContext","canExpandCompletionItem","SuggestDetailsOverlay","SuggestDetailsWidget","getAriaId","ItemRenderer","editorSuggestWidgetBackground","dark","light","hc","localize","editorSuggestWidgetBorder","editorSuggestWidgetForeground","editorSuggestWidgetSelectedForeground","editorSuggestWidgetSelectedIconForeground","editorSuggestWidgetSelectedBackground","editorSuggestWidgetHighlightForeground","editorSuggestWidgetHighlightFocusForeground","PersistedWidgetSize","constructor","_service","editor","_key","getEditorType","restore","_a","raw","get","obj","JSON","parse","Dimension","is","lift","_b","undefined","store","size","stringify","reset","remove","SuggestWidget","_storageService","_contextKeyService","_themeService","instantiationService","_state","_isAuto","_ignoreFocusEvents","_forceRenderingAbove","_explainMode","_showTimeout","_disposables","_onDidSelect","_onDidFocus","_onDidHide","_onDidShow","onDidSelect","event","onDidFocus","onDidHide","onDidShow","_onDetailsKeydown","onDetailsKeyDown","element","domNode","classList","add","_contentWidget","SuggestContentWidget","_persistedSize","ResizeState","persistedSize","currentSize","persistHeight","persistWidth","state","onDidWillResize","lockPreference","onDidResize","_c","_d","_resize","dimension","width","height","north","south","east","west","itemHeight","defaultSize","getLayoutInfo","threshold","Math","round","abs","unlockPreference","_messageElement","append","$","_listElement","details","createInstance","onDidClose","toggleDetails","_details","applyIconStyle","toggle","getOption","showIcons","renderer","onDidToggleDetails","_list","getHeight","_element","getTemplateId","alwaysConsumeMouseWheel","useShadows","mouseSupport","accessibilityProvider","getRole","getAriaLabel","item","isResolved","_isDetailsVisible","documentation","detail","completion","docs","format","textLabel","getWidgetAriaLabel","getWidgetRole","_status","applyStatusBarStyle","showStatusBar","listInactiveFocusBackground","listInactiveFocusOutline","onDidColorThemeChange","t","_onThemeChange","getColorTheme","onMouseDown","_onListMouseDownOrTap","onTap","onDidChangeSelection","_onListSelection","onDidChangeFocus","_onListFocus","onDidChangeCursorSelection","_onCursorSelectionChanged","onDidChangeConfiguration","hasChanged","_ctxSuggestWidgetVisible","Visible","bindTo","_ctxSuggestWidgetDetailsVisible","DetailsVisible","_ctxSuggestWidgetMultipleSuggestions","MultipleSuggestions","addStandardDisposableListener","widget","fire","_onEditorMouseDown","dispose","_loadingTimeout","mouseEvent","contains","focus","layout","index","browserEvent","preventDefault","stopPropagation","_select","elements","indexes","completionModel","_completionModel","model","theme","backgroundColor","getColor","style","toString","borderColor","borderTopColor","_detailsBorderColor","focusBorderColor","_detailsFocusBorderColor","borderWidth","type","_currentSuggestionDetails","cancel","_focusedItem","setAriaOptions","activeDescendant","reveal","token","loading","showDetails","onCancellationRequested","splice","setFocus","catch","_setState","hide","_cappedHeight","textContent","LOADING_MESSAGE","show","_show","NO_SUGGESTIONS_MESSAGE","_layout","set","cancelAndSet","showTriggered","auto","delay","setPosition","getPosition","showSuggestions","selectionIndex","isFrozen","isAuto","visibleCount","items","isEmpty","selectNextPage","pageDown","focusNextPage","selectNext","focusNext","selectLast","scrollBottom","focusLast","selectPreviousPage","pageUp","focusPreviousPage","selectPrevious","focusPrevious","selectFirst","scrollTop","focusFirst","getFocusedItem","getFocusedElements","getFocus","toggleDetailsFocus","_setDetailsVisible","renderLoading","renderItem","_positionDetails","toggleExplainMode","resetPersistedSize","hideWidget","clearSashHoverState","dim","minPersistedHeight","ceil","with","_afterRender","position","hasModel","getDomNode","bodyBox","getClientArea","document","body","info","lineHeight","borderHeight","enableSashes","minSize","maxSize","setPreference","maxWidth","horizontalPadding","preferredWidth","stats","pLabelLen","typicalHalfwidthCharacterWidth","fullHeight","statusBarHeight","contentHeight","minHeight","editorBox","getDomNodePagePosition","cursorBox","getScrolledVisiblePosition","cursorBottom","top","maxHeightBelow","min","verticalPadding","availableSpaceAbove","maxHeightAbove","maxHeight","max","capped","wanted","forceRenderingAboveRequiredSpace","preferredSize","placeAtAnchor","fontInfo","getBoolean","forceRenderingAbove","stopForceRenderingAbove","_widget","_editor","allowEditorOverflow","suppressMouseDown","_preferenceLocked","_added","_hidden","removeContentWidget","getId","addContentWidget","layoutContentWidget","_position","_preference","preference","beforeRender","afterRender","collector","matchHighlight","addRule","matchHighlightFocus","foreground","selectedForeground","selectedIconForeground","link","linkHover","codeBackground"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,IAAIQ,OAAO,GAAI,QAAQ,KAAKA,OAAd,IAA0B,UAAUC,UAAV,EAAsBC,SAAtB,EAAiC;AACrE,SAAO,UAAUhB,MAAV,EAAkBC,GAAlB,EAAuB;AAAEe,IAAAA,SAAS,CAAChB,MAAD,EAASC,GAAT,EAAcc,UAAd,CAAT;AAAqC,GAArE;AACH,CAFD;;AAGA,IAAIE,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAASC,KAAT,CAAeC,KAAf,EAAsB;AAAE,WAAOA,KAAK,YAAYH,CAAjB,GAAqBG,KAArB,GAA6B,IAAIH,CAAJ,CAAM,UAAUI,OAAV,EAAmB;AAAEA,MAAAA,OAAO,CAACD,KAAD,CAAP;AAAiB,KAA5C,CAApC;AAAoF;;AAC5G,SAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAT,CAAN,EAAyB,UAAUD,OAAV,EAAmBE,MAAnB,EAA2B;AACvD,aAASC,SAAT,CAAmBJ,KAAnB,EAA0B;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAACQ,IAAV,CAAeN,KAAf,CAAD,CAAJ;AAA8B,OAApC,CAAqC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC3F,aAASC,QAAT,CAAkBR,KAAlB,EAAyB;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAAC,OAAD,CAAT,CAAmBE,KAAnB,CAAD,CAAJ;AAAkC,OAAxC,CAAyC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC9F,aAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,MAAAA,MAAM,CAACC,IAAP,GAAcT,OAAO,CAACQ,MAAM,CAACT,KAAR,CAArB,GAAsCD,KAAK,CAACU,MAAM,CAACT,KAAR,CAAL,CAAoBW,IAApB,CAAyBP,SAAzB,EAAoCI,QAApC,CAAtC;AAAsF;;AAC9GH,IAAAA,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAV,CAAgBjB,OAAhB,EAAyBC,UAAU,IAAI,EAAvC,CAAb,EAAyDU,IAAzD,EAAD,CAAJ;AACH,GALM,CAAP;AAMH,CARD;;AASA,OAAO,KAAKO,GAAZ,MAAqB,8BAArB;AACA,OAAO,oDAAP,C,CAA6D;;AAC7D,SAASC,IAAT,QAAqB,6CAArB;AACA,SAASC,uBAAT,EAAkCC,iBAAlC,EAAqDC,YAArD,QAAyE,+BAAzE;AACA,SAASC,iBAAT,QAAkC,gCAAlC;AACA,SAASC,OAAT,QAAwB,+BAAxB;AACA,SAASC,eAAT,QAAgC,mCAAhC;AACA,SAASC,KAAT,QAAsB,iCAAtB;AACA,OAAO,KAAKC,OAAZ,MAAyB,iCAAzB;AACA,OAAO,qBAAP;AACA,SAASC,wBAAT,QAAyC,kDAAzC;AACA,SAASC,mBAAT,QAAoC,0BAApC;AACA,OAAO,+BAAP,C,CAAwC;;AACxC,OAAO,KAAKC,GAAZ,MAAqB,iBAArB;AACA,SAASC,kBAAT,QAAmC,mDAAnC;AACA,SAASC,qBAAT,QAAsC,yDAAtC;AACA,SAASC,eAAT,QAAgC,6CAAhC;AACA,SAASC,oBAAT,EAA+BC,gBAA/B,EAAiDC,sBAAjD,EAAyEC,kBAAzE,EAA6FC,WAA7F,EAA0GC,4BAA1G,EAAwIC,uBAAxI,EAAiKC,6BAAjK,EAAgMC,6BAAhM,EAA+NC,iCAA/N,EAAkQC,aAAlQ,EAAiRC,uBAAjR,EAA0SC,wBAA1S,EAAoUC,kBAApU,QAA8V,iDAA9V;AACA,SAASC,gBAAT,QAAiC,0CAAjC;AACA,SAASC,aAAT,EAAwBC,0BAAxB,QAA0D,gDAA1D;AACA,SAASC,oBAAT,QAAqC,gBAArC;AACA,SAASC,OAAO,IAAIC,cAApB,QAA0C,cAA1C;AACA,SAASC,uBAAT,EAAkCC,qBAAlC,EAAyDC,oBAAzD,QAAqF,2BAArF;AACA,SAASC,SAAT,EAAoBC,YAApB,QAAwC,4BAAxC;AACA;AACA;AACA;;AACA,OAAO,MAAMC,6BAA6B,GAAGf,aAAa,CAAC,gCAAD,EAAmC;AAAEgB,EAAAA,IAAI,EAAExB,sBAAR;AAAgCyB,EAAAA,KAAK,EAAEzB,sBAAvC;AAA+D0B,EAAAA,EAAE,EAAE1B;AAAnE,CAAnC,EAAgIN,GAAG,CAACiC,QAAJ,CAAa,+BAAb,EAA8C,yCAA9C,CAAhI,CAAnD;AACP,OAAO,MAAMC,yBAAyB,GAAGpB,aAAa,CAAC,4BAAD,EAA+B;AAAEgB,EAAAA,IAAI,EAAEvB,kBAAR;AAA4BwB,EAAAA,KAAK,EAAExB,kBAAnC;AAAuDyB,EAAAA,EAAE,EAAEzB;AAA3D,CAA/B,EAAgHP,GAAG,CAACiC,QAAJ,CAAa,2BAAb,EAA0C,qCAA1C,CAAhH,CAA/C;AACP,OAAO,MAAME,6BAA6B,GAAGrB,aAAa,CAAC,gCAAD,EAAmC;AAAEgB,EAAAA,IAAI,EAAEzB,gBAAR;AAA0B0B,EAAAA,KAAK,EAAE1B,gBAAjC;AAAmD2B,EAAAA,EAAE,EAAE3B;AAAvD,CAAnC,EAA8GL,GAAG,CAACiC,QAAJ,CAAa,+BAAb,EAA8C,yCAA9C,CAA9G,CAAnD;AACP,OAAO,MAAMG,qCAAqC,GAAGtB,aAAa,CAAC,wCAAD,EAA2C;AAAEgB,EAAAA,IAAI,EAAElB,6BAAR;AAAuCmB,EAAAA,KAAK,EAAEnB,6BAA9C;AAA6EoB,EAAAA,EAAE,EAAEpB;AAAjF,CAA3C,EAA6JZ,GAAG,CAACiC,QAAJ,CAAa,uCAAb,EAAsD,+DAAtD,CAA7J,CAA3D;AACP,OAAO,MAAMI,yCAAyC,GAAGvB,aAAa,CAAC,4CAAD,EAA+C;AAAEgB,EAAAA,IAAI,EAAEjB,iCAAR;AAA2CkB,EAAAA,KAAK,EAAElB,iCAAlD;AAAqFmB,EAAAA,EAAE,EAAEnB;AAAzF,CAA/C,EAA6Kb,GAAG,CAACiC,QAAJ,CAAa,2CAAb,EAA0D,oEAA1D,CAA7K,CAA/D;AACP,OAAO,MAAMK,qCAAqC,GAAGxB,aAAa,CAAC,wCAAD,EAA2C;AAAEgB,EAAAA,IAAI,EAAEnB,6BAAR;AAAuCoB,EAAAA,KAAK,EAAEpB,6BAA9C;AAA6EqB,EAAAA,EAAE,EAAErB;AAAjF,CAA3C,EAA6JX,GAAG,CAACiC,QAAJ,CAAa,uCAAb,EAAsD,+DAAtD,CAA7J,CAA3D;AACP,OAAO,MAAMM,sCAAsC,GAAGzB,aAAa,CAAC,yCAAD,EAA4C;AAAEgB,EAAAA,IAAI,EAAEpB,uBAAR;AAAiCqB,EAAAA,KAAK,EAAErB,uBAAxC;AAAiEsB,EAAAA,EAAE,EAAEtB;AAArE,CAA5C,EAA4IV,GAAG,CAACiC,QAAJ,CAAa,wCAAb,EAAuD,sDAAvD,CAA5I,CAA5D;AACP,OAAO,MAAMO,2CAA2C,GAAG1B,aAAa,CAAC,8CAAD,EAAiD;AAAEgB,EAAAA,IAAI,EAAErB,4BAAR;AAAsCsB,EAAAA,KAAK,EAAEtB,4BAA7C;AAA2EuB,EAAAA,EAAE,EAAEvB;AAA/E,CAAjD,EAAgKT,GAAG,CAACiC,QAAJ,CAAa,6CAAb,EAA4D,8EAA5D,CAAhK,CAAjE;;AACP,MAAMQ,mBAAN,CAA0B;AACtBC,EAAAA,WAAW,CAACC,QAAD,EAAWC,MAAX,EAAmB;AAC1B,SAAKD,QAAL,GAAgBA,QAAhB;AACA,SAAKE,IAAL,GAAa,sBAAqBD,MAAM,CAACE,aAAP,EAAuB,IAAGF,MAAM,YAAY9C,wBAAyB,EAAvG;AACH;;AACDiD,EAAAA,OAAO,GAAG;AACN,QAAIC,EAAJ;;AACA,UAAMC,GAAG,GAAG,CAACD,EAAE,GAAG,KAAKL,QAAL,CAAcO,GAAd,CAAkB,KAAKL,IAAvB,EAA6B;AAAE;AAA/B,KAAN,MAAwD,IAAxD,IAAgEG,EAAE,KAAK,KAAK,CAA5E,GAAgFA,EAAhF,GAAqF,EAAjG;;AACA,QAAI;AACA,YAAMG,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWJ,GAAX,CAAZ;;AACA,UAAI7D,GAAG,CAACkE,SAAJ,CAAcC,EAAd,CAAiBJ,GAAjB,CAAJ,EAA2B;AACvB,eAAO/D,GAAG,CAACkE,SAAJ,CAAcE,IAAd,CAAmBL,GAAnB,CAAP;AACH;AACJ,KALD,CAMA,OAAOM,EAAP,EAAW,CACP;AACH;;AACD,WAAOC,SAAP;AACH;;AACDC,EAAAA,KAAK,CAACC,IAAD,EAAO;AACR,SAAKjB,QAAL,CAAcgB,KAAd,CAAoB,KAAKd,IAAzB,EAA+BO,IAAI,CAACS,SAAL,CAAeD,IAAf,CAA/B,EAAqD;AAAE;AAAvD,MAAqE;AAAE;AAAvE;AACH;;AACDE,EAAAA,KAAK,GAAG;AACJ,SAAKnB,QAAL,CAAcoB,MAAd,CAAqB,KAAKlB,IAA1B,EAAgC;AAAE;AAAlC;AACH;;AAxBqB;;AA0B1B,IAAImB,aAAa,GAAG,MAAMA,aAAN,CAAoB;AACpCtB,EAAAA,WAAW,CAACE,MAAD,EAASqB,eAAT,EAA0BC,kBAA1B,EAA8CC,aAA9C,EAA6DC,oBAA7D,EAAmF;AAC1F,SAAKxB,MAAL,GAAcA,MAAd;AACA,SAAKqB,eAAL,GAAuBA,eAAvB;AACA,SAAKI,MAAL,GAAc;AAAE;AAAhB;AACA,SAAKC,OAAL,GAAe,KAAf;AACA,SAAKC,kBAAL,GAA0B,KAA1B;AACA,SAAKC,oBAAL,GAA4B,KAA5B;AACA,SAAKC,YAAL,GAAoB,KAApB;AACA,SAAKC,YAAL,GAAoB,IAAIlF,YAAJ,EAApB;AACA,SAAKmF,YAAL,GAAoB,IAAIhF,eAAJ,EAApB;AACA,SAAKiF,YAAL,GAAoB,IAAIlF,OAAJ,EAApB;AACA,SAAKmF,WAAL,GAAmB,IAAInF,OAAJ,EAAnB;AACA,SAAKoF,UAAL,GAAkB,IAAIpF,OAAJ,EAAlB;AACA,SAAKqF,UAAL,GAAkB,IAAIrF,OAAJ,EAAlB;AACA,SAAKsF,WAAL,GAAmB,KAAKJ,YAAL,CAAkBK,KAArC;AACA,SAAKC,UAAL,GAAkB,KAAKL,WAAL,CAAiBI,KAAnC;AACA,SAAKE,SAAL,GAAiB,KAAKL,UAAL,CAAgBG,KAAjC;AACA,SAAKG,SAAL,GAAiB,KAAKL,UAAL,CAAgBE,KAAjC;AACA,SAAKI,iBAAL,GAAyB,IAAI3F,OAAJ,EAAzB;AACA,SAAK4F,gBAAL,GAAwB,KAAKD,iBAAL,CAAuBJ,KAA/C;AACA,SAAKM,OAAL,GAAe,IAAIlE,oBAAJ,EAAf;AACA,SAAKkE,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,eAAnC,EAAoD,gBAApD;AACA,SAAKC,cAAL,GAAsB,IAAIC,oBAAJ,CAAyB,IAAzB,EAA+BhD,MAA/B,CAAtB;AACA,SAAKiD,cAAL,GAAsB,IAAIpD,mBAAJ,CAAwBwB,eAAxB,EAAyCrB,MAAzC,CAAtB;;AACA,UAAMkD,WAAN,CAAkB;AACdpD,MAAAA,WAAW,CAACqD,aAAD,EAAgBC,WAAhB,EAA0E;AAAA,YAA7CC,aAA6C,uEAA7B,KAA6B;AAAA,YAAtBC,YAAsB,uEAAP,KAAO;AACjF,aAAKH,aAAL,GAAqBA,aAArB;AACA,aAAKC,WAAL,GAAmBA,WAAnB;AACA,aAAKC,aAAL,GAAqBA,aAArB;AACA,aAAKC,YAAL,GAAoBA,YAApB;AACH;;AANa;;AAQlB,QAAIC,KAAJ;;AACA,SAAKxB,YAAL,CAAkBe,GAAlB,CAAsB,KAAKH,OAAL,CAAaa,eAAb,CAA6B,MAAM;AACrD,WAAKT,cAAL,CAAoBU,cAApB;;AACAF,MAAAA,KAAK,GAAG,IAAIL,WAAJ,CAAgB,KAAKD,cAAL,CAAoB9C,OAApB,EAAhB,EAA+C,KAAKwC,OAAL,CAAa3B,IAA5D,CAAR;AACH,KAHqB,CAAtB;;AAIA,SAAKe,YAAL,CAAkBe,GAAlB,CAAsB,KAAKH,OAAL,CAAae,WAAb,CAAyBxH,CAAC,IAAI;AAChD,UAAIkE,EAAJ,EAAQS,EAAR,EAAY8C,EAAZ,EAAgBC,EAAhB;;AACA,WAAKC,OAAL,CAAa3H,CAAC,CAAC4H,SAAF,CAAYC,KAAzB,EAAgC7H,CAAC,CAAC4H,SAAF,CAAYE,MAA5C;;AACA,UAAIT,KAAJ,EAAW;AACPA,QAAAA,KAAK,CAACF,aAAN,GAAsBE,KAAK,CAACF,aAAN,IAAuB,CAAC,CAACnH,CAAC,CAAC+H,KAA3B,IAAoC,CAAC,CAAC/H,CAAC,CAACgI,KAA9D;AACAX,QAAAA,KAAK,CAACD,YAAN,GAAqBC,KAAK,CAACD,YAAN,IAAsB,CAAC,CAACpH,CAAC,CAACiI,IAA1B,IAAkC,CAAC,CAACjI,CAAC,CAACkI,IAA3D;AACH;;AACD,UAAI,CAAClI,CAAC,CAACG,IAAP,EAAa;AACT;AACH;;AACD,UAAIkH,KAAJ,EAAW;AACP;AACA;AACA,cAAM;AAAEc,UAAAA,UAAF;AAAcC,UAAAA;AAAd,YAA8B,KAAKC,aAAL,EAApC;AACA,cAAMC,SAAS,GAAGC,IAAI,CAACC,KAAL,CAAWL,UAAU,GAAG,CAAxB,CAAlB;AACA,YAAI;AAAEN,UAAAA,KAAF;AAASC,UAAAA;AAAT,YAAoB,KAAKrB,OAAL,CAAa3B,IAArC;;AACA,YAAI,CAACuC,KAAK,CAACF,aAAP,IAAwBoB,IAAI,CAACE,GAAL,CAASpB,KAAK,CAACH,WAAN,CAAkBY,MAAlB,GAA2BA,MAApC,KAA+CQ,SAA3E,EAAsF;AAClFR,UAAAA,MAAM,GAAG,CAACnD,EAAE,GAAG,CAACT,EAAE,GAAGmD,KAAK,CAACJ,aAAZ,MAA+B,IAA/B,IAAuC/C,EAAE,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,EAAE,CAAC4D,MAAzE,MAAqF,IAArF,IAA6FnD,EAAE,KAAK,KAAK,CAAzG,GAA6GA,EAA7G,GAAkHyD,WAAW,CAACN,MAAvI;AACH;;AACD,YAAI,CAACT,KAAK,CAACD,YAAP,IAAuBmB,IAAI,CAACE,GAAL,CAASpB,KAAK,CAACH,WAAN,CAAkBW,KAAlB,GAA0BA,KAAnC,KAA6CS,SAAxE,EAAmF;AAC/ET,UAAAA,KAAK,GAAG,CAACH,EAAE,GAAG,CAACD,EAAE,GAAGJ,KAAK,CAACJ,aAAZ,MAA+B,IAA/B,IAAuCQ,EAAE,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,EAAE,CAACI,KAAzE,MAAoF,IAApF,IAA4FH,EAAE,KAAK,KAAK,CAAxG,GAA4GA,EAA5G,GAAiHU,WAAW,CAACP,KAArI;AACH;;AACD,aAAKd,cAAL,CAAoBlC,KAApB,CAA0B,IAAIvE,GAAG,CAACkE,SAAR,CAAkBqD,KAAlB,EAAyBC,MAAzB,CAA1B;AACH,OAvB+C,CAwBhD;;;AACA,WAAKjB,cAAL,CAAoB6B,gBAApB;;AACArB,MAAAA,KAAK,GAAGzC,SAAR;AACH,KA3BqB,CAAtB;;AA4BA,SAAK+D,eAAL,GAAuBrI,GAAG,CAACsI,MAAJ,CAAW,KAAKnC,OAAL,CAAaC,OAAxB,EAAiCpG,GAAG,CAACuI,CAAJ,CAAM,UAAN,CAAjC,CAAvB;AACA,SAAKC,YAAL,GAAoBxI,GAAG,CAACsI,MAAJ,CAAW,KAAKnC,OAAL,CAAaC,OAAxB,EAAiCpG,GAAG,CAACuI,CAAJ,CAAM,OAAN,CAAjC,CAApB;AACA,UAAME,OAAO,GAAGzD,oBAAoB,CAAC0D,cAArB,CAAoCpG,oBAApC,EAA0D,KAAKkB,MAA/D,CAAhB;AACAiF,IAAAA,OAAO,CAACE,UAAR,CAAmB,KAAKC,aAAxB,EAAuC,IAAvC,EAA6C,KAAKrD,YAAlD;AACA,SAAKsD,QAAL,GAAgB,IAAIxG,qBAAJ,CAA0BoG,OAA1B,EAAmC,KAAKjF,MAAxC,CAAhB;;AACA,UAAMsF,cAAc,GAAG,MAAM,KAAK3C,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B0C,MAA/B,CAAsC,UAAtC,EAAkD,CAAC,KAAKvF,MAAL,CAAYwF,SAAZ,CAAsB;AAAI;AAA1B,MAAyCC,SAA5F,CAA7B;;AACAH,IAAAA,cAAc;AACd,UAAMI,QAAQ,GAAGlE,oBAAoB,CAAC0D,cAArB,CAAoClG,YAApC,EAAkD,KAAKgB,MAAvD,CAAjB;;AACA,SAAK+B,YAAL,CAAkBe,GAAlB,CAAsB4C,QAAtB;;AACA,SAAK3D,YAAL,CAAkBe,GAAlB,CAAsB4C,QAAQ,CAACC,kBAAT,CAA4B,MAAM,KAAKP,aAAL,EAAlC,CAAtB;;AACA,SAAKQ,KAAL,GAAa,IAAInJ,IAAJ,CAAS,eAAT,EAA0B,KAAKuI,YAA/B,EAA6C;AACtDa,MAAAA,SAAS,EAAGC,QAAD,IAAc,KAAKvB,aAAL,GAAqBF,UADQ;AAEtD0B,MAAAA,aAAa,EAAGD,QAAD,IAAc;AAFyB,KAA7C,EAGV,CAACJ,QAAD,CAHU,EAGE;AACXM,MAAAA,uBAAuB,EAAE,IADd;AAEXC,MAAAA,UAAU,EAAE,KAFD;AAGXC,MAAAA,YAAY,EAAE,KAHH;AAIXC,MAAAA,qBAAqB,EAAE;AACnBC,QAAAA,OAAO,EAAE,MAAM,QADI;AAEnBC,QAAAA,YAAY,EAAGC,IAAD,IAAU;AACpB,cAAIA,IAAI,CAACC,UAAL,IAAmB,KAAKC,iBAAL,EAAvB,EAAiD;AAC7C,kBAAM;AAAEC,cAAAA,aAAF;AAAiBC,cAAAA;AAAjB,gBAA4BJ,IAAI,CAACK,UAAvC;AACA,kBAAMC,IAAI,GAAG3J,OAAO,CAAC4J,MAAR,CAAe,QAAf,EAAyBH,MAAM,IAAI,EAAnC,EAAuCD,aAAa,GAAI,OAAOA,aAAP,KAAyB,QAAzB,GAAoCA,aAApC,GAAoDA,aAAa,CAAC9K,KAAtE,GAA+E,EAAnI,CAAb;AACA,mBAAOyB,GAAG,CAACiC,QAAJ,CAAa,mCAAb,EAAkD,gBAAlD,EAAoEiH,IAAI,CAACQ,SAAzE,EAAoFF,IAApF,CAAP;AACH,WAJD,MAKK;AACD,mBAAON,IAAI,CAACQ,SAAZ;AACH;AACJ,SAXkB;AAYnBC,QAAAA,kBAAkB,EAAE,MAAM3J,GAAG,CAACiC,QAAJ,CAAa,SAAb,EAAwB,SAAxB,CAZP;AAanB2H,QAAAA,aAAa,EAAE,MAAM;AAbF;AAJZ,KAHF,CAAb;AAuBA,SAAKC,OAAL,GAAezF,oBAAoB,CAAC0D,cAArB,CAAoC/H,mBAApC,EAAyD,KAAKwF,OAAL,CAAaC,OAAtE,CAAf;;AACA,UAAMsE,mBAAmB,GAAG,MAAM,KAAKvE,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B0C,MAA/B,CAAsC,iBAAtC,EAAyD,KAAKvF,MAAL,CAAYwF,SAAZ,CAAsB;AAAI;AAA1B,MAAyC2B,aAAlG,CAAlC;;AACAD,IAAAA,mBAAmB;;AACnB,SAAKnF,YAAL,CAAkBe,GAAlB,CAAsBxE,gBAAgB,CAAC,KAAKsH,KAAN,EAAarE,aAAb,EAA4B;AAC9D6F,MAAAA,2BAA2B,EAAE1H,qCADiC;AAE9D2H,MAAAA,wBAAwB,EAAE7J;AAFoC,KAA5B,CAAtC;;AAIA,SAAKuE,YAAL,CAAkBe,GAAlB,CAAsBvB,aAAa,CAAC+F,qBAAd,CAAoCC,CAAC,IAAI,KAAKC,cAAL,CAAoBD,CAApB,CAAzC,CAAtB;;AACA,SAAKC,cAAL,CAAoBjG,aAAa,CAACkG,aAAd,EAApB;;AACA,SAAK1F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK8C,KAAL,CAAW8B,WAAX,CAAuBxL,CAAC,IAAI,KAAKyL,qBAAL,CAA2BzL,CAA3B,CAA5B,CAAtB;;AACA,SAAK6F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK8C,KAAL,CAAWgC,KAAX,CAAiB1L,CAAC,IAAI,KAAKyL,qBAAL,CAA2BzL,CAA3B,CAAtB,CAAtB;;AACA,SAAK6F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK8C,KAAL,CAAWiC,oBAAX,CAAgC3L,CAAC,IAAI,KAAK4L,gBAAL,CAAsB5L,CAAtB,CAArC,CAAtB;;AACA,SAAK6F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK8C,KAAL,CAAWmC,gBAAX,CAA4B7L,CAAC,IAAI,KAAK8L,YAAL,CAAkB9L,CAAlB,CAAjC,CAAtB;;AACA,SAAK6F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK9C,MAAL,CAAYiI,0BAAZ,CAAuC,MAAM,KAAKC,yBAAL,EAA7C,CAAtB;;AACA,SAAKnG,YAAL,CAAkBe,GAAlB,CAAsB,KAAK9C,MAAL,CAAYmI,wBAAZ,CAAqCjM,CAAC,IAAI;AAC5D,UAAIA,CAAC,CAACkM,UAAF,CAAa;AAAI;AAAjB,OAAJ,EAAqC;AACjClB,QAAAA,mBAAmB;AACnB5B,QAAAA,cAAc;AACjB;AACJ,KALqB,CAAtB;;AAMA,SAAK+C,wBAAL,GAAgC1J,cAAc,CAAC2J,OAAf,CAAuBC,MAAvB,CAA8BjH,kBAA9B,CAAhC;AACA,SAAKkH,+BAAL,GAAuC7J,cAAc,CAAC8J,cAAf,CAA8BF,MAA9B,CAAqCjH,kBAArC,CAAvC;AACA,SAAKoH,oCAAL,GAA4C/J,cAAc,CAACgK,mBAAf,CAAmCJ,MAAnC,CAA0CjH,kBAA1C,CAA5C;;AACA,SAAKS,YAAL,CAAkBe,GAAlB,CAAsBtG,GAAG,CAACoM,6BAAJ,CAAkC,KAAKvD,QAAL,CAAcwD,MAAd,CAAqBjG,OAAvD,EAAgE,SAAhE,EAA2E1G,CAAC,IAAI;AAClG,WAAKuG,iBAAL,CAAuBqG,IAAvB,CAA4B5M,CAA5B;AACH,KAFqB,CAAtB;;AAGA,SAAK6F,YAAL,CAAkBe,GAAlB,CAAsB,KAAK9C,MAAL,CAAY0H,WAAZ,CAAyBxL,CAAD,IAAO,KAAK6M,kBAAL,CAAwB7M,CAAxB,CAA/B,CAAtB;AACH;;AACD8M,EAAAA,OAAO,GAAG;AACN,QAAI5I,EAAJ;;AACA,SAAKiF,QAAL,CAAcwD,MAAd,CAAqBG,OAArB;;AACA,SAAK3D,QAAL,CAAc2D,OAAd;;AACA,SAAKpD,KAAL,CAAWoD,OAAX;;AACA,SAAK/B,OAAL,CAAa+B,OAAb;;AACA,SAAKjH,YAAL,CAAkBiH,OAAlB;;AACA,KAAC5I,EAAE,GAAG,KAAK6I,eAAX,MAAgC,IAAhC,IAAwC7I,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC4I,OAAH,EAAjE;;AACA,SAAKlH,YAAL,CAAkBkH,OAAlB;;AACA,SAAKjG,cAAL,CAAoBiG,OAApB;;AACA,SAAKrG,OAAL,CAAaqG,OAAb;AACH;;AACDD,EAAAA,kBAAkB,CAACG,UAAD,EAAa;AAC3B,QAAI,KAAK7D,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuG,QAA7B,CAAsCD,UAAU,CAAC9O,MAAX,CAAkBuI,OAAxD,CAAJ,EAAsE;AAClE;AACA,WAAK0C,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BwG,KAA7B;AACH,KAHD,MAIK;AACD;AACA,UAAI,KAAKzG,OAAL,CAAaC,OAAb,CAAqBuG,QAArB,CAA8BD,UAAU,CAAC9O,MAAX,CAAkBuI,OAAhD,CAAJ,EAA8D;AAC1D,aAAK3C,MAAL,CAAYoJ,KAAZ;AACH;AACJ;AACJ;;AACDlB,EAAAA,yBAAyB,GAAG;AACxB,QAAI,KAAKzG,MAAL,KAAgB;AAAE;AAAtB,MAAoC;AAChC,WAAKsB,cAAL,CAAoBsG,MAApB;AACH;AACJ;;AACD1B,EAAAA,qBAAqB,CAACzL,CAAD,EAAI;AACrB,QAAI,OAAOA,CAAC,CAACyG,OAAT,KAAqB,WAArB,IAAoC,OAAOzG,CAAC,CAACoN,KAAT,KAAmB,WAA3D,EAAwE;AACpE;AACH,KAHoB,CAIrB;;;AACApN,IAAAA,CAAC,CAACqN,YAAF,CAAeC,cAAf;AACAtN,IAAAA,CAAC,CAACqN,YAAF,CAAeE,eAAf;;AACA,SAAKC,OAAL,CAAaxN,CAAC,CAACyG,OAAf,EAAwBzG,CAAC,CAACoN,KAA1B;AACH;;AACDxB,EAAAA,gBAAgB,CAAC5L,CAAD,EAAI;AAChB,QAAIA,CAAC,CAACyN,QAAF,CAAWlP,MAAf,EAAuB;AACnB,WAAKiP,OAAL,CAAaxN,CAAC,CAACyN,QAAF,CAAW,CAAX,CAAb,EAA4BzN,CAAC,CAAC0N,OAAF,CAAU,CAAV,CAA5B;AACH;AACJ;;AACDF,EAAAA,OAAO,CAACpD,IAAD,EAAOgD,KAAP,EAAc;AACjB,UAAMO,eAAe,GAAG,KAAKC,gBAA7B;;AACA,QAAID,eAAJ,EAAqB;AACjB,WAAK7H,YAAL,CAAkB8G,IAAlB,CAAuB;AAAExC,QAAAA,IAAF;AAAQgD,QAAAA,KAAR;AAAeS,QAAAA,KAAK,EAAEF;AAAtB,OAAvB;;AACA,WAAK7J,MAAL,CAAYoJ,KAAZ;AACH;AACJ;;AACD5B,EAAAA,cAAc,CAACwC,KAAD,EAAQ;AAClB,UAAMC,eAAe,GAAGD,KAAK,CAACE,QAAN,CAAejL,6BAAf,CAAxB;;AACA,QAAIgL,eAAJ,EAAqB;AACjB,WAAKtH,OAAL,CAAaC,OAAb,CAAqBuH,KAArB,CAA2BF,eAA3B,GAA6CA,eAAe,CAACG,QAAhB,EAA7C;AACA,WAAKvF,eAAL,CAAqBsF,KAArB,CAA2BF,eAA3B,GAA6CA,eAAe,CAACG,QAAhB,EAA7C;AACA,WAAK/E,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuH,KAA7B,CAAmCF,eAAnC,GAAqDA,eAAe,CAACG,QAAhB,EAArD;AACH;;AACD,UAAMC,WAAW,GAAGL,KAAK,CAACE,QAAN,CAAe5K,yBAAf,CAApB;;AACA,QAAI+K,WAAJ,EAAiB;AACb,WAAK1H,OAAL,CAAaC,OAAb,CAAqBuH,KAArB,CAA2BE,WAA3B,GAAyCA,WAAW,CAACD,QAAZ,EAAzC;AACA,WAAKvF,eAAL,CAAqBsF,KAArB,CAA2BE,WAA3B,GAAyCA,WAAW,CAACD,QAAZ,EAAzC;AACA,WAAKnD,OAAL,CAAatE,OAAb,CAAqBwH,KAArB,CAA2BG,cAA3B,GAA4CD,WAAW,CAACD,QAAZ,EAA5C;AACA,WAAK/E,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuH,KAA7B,CAAmCE,WAAnC,GAAiDA,WAAW,CAACD,QAAZ,EAAjD;AACA,WAAKG,mBAAL,GAA2BF,WAAW,CAACD,QAAZ,EAA3B;AACH;;AACD,UAAMI,gBAAgB,GAAGR,KAAK,CAACE,QAAN,CAAetM,WAAf,CAAzB;;AACA,QAAI4M,gBAAJ,EAAsB;AAClB,WAAKC,wBAAL,GAAgCD,gBAAgB,CAACJ,QAAjB,EAAhC;AACH;;AACD,SAAK/E,QAAL,CAAcwD,MAAd,CAAqB6B,WAArB,GAAmCV,KAAK,CAACW,IAAN,KAAe,IAAf,GAAsB,CAAtB,GAA0B,CAA7D;AACH;;AACD3C,EAAAA,YAAY,CAAC9L,CAAD,EAAI;AACZ,QAAIkE,EAAJ;;AACA,QAAI,KAAKuB,kBAAT,EAA6B;AACzB;AACH;;AACD,QAAI,CAACzF,CAAC,CAACyN,QAAF,CAAWlP,MAAhB,EAAwB;AACpB,UAAI,KAAKmQ,yBAAT,EAAoC;AAChC,aAAKA,yBAAL,CAA+BC,MAA/B;;AACA,aAAKD,yBAAL,GAAiC9J,SAAjC;AACA,aAAKgK,YAAL,GAAoBhK,SAApB;AACH;;AACD,WAAKd,MAAL,CAAY+K,cAAZ,CAA2B;AAAEC,QAAAA,gBAAgB,EAAElK;AAApB,OAA3B;AACA;AACH;;AACD,QAAI,CAAC,KAAKgJ,gBAAV,EAA4B;AACxB;AACH;;AACD,UAAMxD,IAAI,GAAGpK,CAAC,CAACyN,QAAF,CAAW,CAAX,CAAb;AACA,UAAML,KAAK,GAAGpN,CAAC,CAAC0N,OAAF,CAAU,CAAV,CAAd;;AACA,QAAItD,IAAI,KAAK,KAAKwE,YAAlB,EAAgC;AAC5B,OAAC1K,EAAE,GAAG,KAAKwK,yBAAX,MAA0C,IAA1C,IAAkDxK,EAAE,KAAK,KAAK,CAA9D,GAAkE,KAAK,CAAvE,GAA2EA,EAAE,CAACyK,MAAH,EAA3E;AACA,WAAKD,yBAAL,GAAiC9J,SAAjC;AACA,WAAKgK,YAAL,GAAoBxE,IAApB;;AACA,WAAKV,KAAL,CAAWqF,MAAX,CAAkB3B,KAAlB;;AACA,WAAKsB,yBAAL,GAAiClO,uBAAuB,CAAEwO,KAAD,IAAW7P,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAC7G,cAAM8P,OAAO,GAAGxO,iBAAiB,CAAC,MAAM;AACpC,cAAI,KAAK6J,iBAAL,EAAJ,EAA8B;AAC1B,iBAAK4E,WAAL,CAAiB,IAAjB;AACH;AACJ,SAJgC,EAI9B,GAJ8B,CAAjC;AAKAF,QAAAA,KAAK,CAACG,uBAAN,CAA8B,MAAMF,OAAO,CAACnC,OAAR,EAApC;AACA,cAAM5M,MAAM,GAAG,MAAMkK,IAAI,CAAC1K,OAAL,CAAasP,KAAb,CAArB;AACAC,QAAAA,OAAO,CAACnC,OAAR;AACA,eAAO5M,MAAP;AACH,OAV4E,CAArB,CAAxD;;AAWA,WAAKwO,yBAAL,CAA+BtO,IAA/B,CAAoC,MAAM;AACtC,YAAIgN,KAAK,IAAI,KAAK1D,KAAL,CAAWnL,MAApB,IAA8B6L,IAAI,KAAK,KAAKV,KAAL,CAAWjD,OAAX,CAAmB2G,KAAnB,CAA3C,EAAsE;AAClE;AACH,SAHqC,CAItC;;;AACA,aAAK3H,kBAAL,GAA0B,IAA1B;;AACA,aAAKiE,KAAL,CAAW0F,MAAX,CAAkBhC,KAAlB,EAAyB,CAAzB,EAA4B,CAAChD,IAAD,CAA5B;;AACA,aAAKV,KAAL,CAAW2F,QAAX,CAAoB,CAACjC,KAAD,CAApB;;AACA,aAAK3H,kBAAL,GAA0B,KAA1B;;AACA,YAAI,KAAK6E,iBAAL,EAAJ,EAA8B;AAC1B,eAAK4E,WAAL,CAAiB,KAAjB;AACH,SAFD,MAGK;AACD,eAAKzI,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B1B,MAA/B,CAAsC,WAAtC;AACH;;AACD,aAAKnB,MAAL,CAAY+K,cAAZ,CAA2B;AAAEC,UAAAA,gBAAgB,EAAEjM,SAAS,CAACuK,KAAD;AAA7B,SAA3B;AACH,OAhBD,EAgBGkC,KAhBH,CAgBS3O,iBAhBT;AAiBH,KApDW,CAqDZ;;;AACA,SAAKoF,WAAL,CAAiB6G,IAAjB,CAAsB;AAAExC,MAAAA,IAAF;AAAQgD,MAAAA,KAAR;AAAeS,MAAAA,KAAK,EAAE,KAAKD;AAA3B,KAAtB;AACH;;AACD2B,EAAAA,SAAS,CAAClI,KAAD,EAAQ;AACb,QAAI,KAAK9B,MAAL,KAAgB8B,KAApB,EAA2B;AACvB;AACH;;AACD,SAAK9B,MAAL,GAAc8B,KAAd;AACA,SAAKZ,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B0C,MAA/B,CAAsC,QAAtC,EAAgDhC,KAAK,KAAK;AAAE;AAA5D;AACA,SAAKZ,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B1B,MAA/B,CAAsC,SAAtC;;AACA,YAAQoC,KAAR;AACI,WAAK;AAAE;AAAP;AACI/G,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK7G,eAAd,EAA+B,KAAKG,YAApC,EAAkD,KAAKiC,OAAL,CAAatE,OAA/D;;AACA,aAAK0C,QAAL,CAAcqG,IAAd,CAAmB,IAAnB;;AACA,aAAKzE,OAAL,CAAayE,IAAb;;AACA,aAAK3I,cAAL,CAAoB2I,IAApB;;AACA,aAAKrD,wBAAL,CAA8BnH,KAA9B;;AACA,aAAKwH,oCAAL,CAA0CxH,KAA1C;;AACA,aAAKY,YAAL,CAAkB+I,MAAlB;;AACA,aAAKlI,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B1B,MAA/B,CAAsC,SAAtC;;AACA,aAAKyE,KAAL,CAAW0F,MAAX,CAAkB,CAAlB,EAAqB,KAAK1F,KAAL,CAAWnL,MAAhC;;AACA,aAAKqQ,YAAL,GAAoBhK,SAApB;AACA,aAAK6K,aAAL,GAAqB7K,SAArB;AACA,aAAKe,YAAL,GAAoB,KAApB;AACA;;AACJ,WAAK;AAAE;AAAP;AACI,aAAKc,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,SAAnC;AACA,aAAK+B,eAAL,CAAqB+G,WAArB,GAAmCxK,aAAa,CAACyK,eAAjD;AACArP,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK1G,YAAd,EAA4B,KAAKiC,OAAL,CAAatE,OAAzC;AACAnG,QAAAA,GAAG,CAACsP,IAAJ,CAAS,KAAKjH,eAAd;;AACA,aAAKQ,QAAL,CAAcqG,IAAd;;AACA,aAAKK,KAAL;;AACA,aAAKjB,YAAL,GAAoBhK,SAApB;AACA;;AACJ,WAAK;AAAE;AAAP;AACI,aAAK6B,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,SAAnC;AACA,aAAK+B,eAAL,CAAqB+G,WAArB,GAAmCxK,aAAa,CAAC4K,sBAAjD;AACAxP,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK1G,YAAd,EAA4B,KAAKiC,OAAL,CAAatE,OAAzC;AACAnG,QAAAA,GAAG,CAACsP,IAAJ,CAAS,KAAKjH,eAAd;;AACA,aAAKQ,QAAL,CAAcqG,IAAd;;AACA,aAAKK,KAAL;;AACA,aAAKjB,YAAL,GAAoBhK,SAApB;AACA;;AACJ,WAAK;AAAE;AAAP;AACItE,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK7G,eAAd;AACArI,QAAAA,GAAG,CAACsP,IAAJ,CAAS,KAAK9G,YAAd,EAA4B,KAAKiC,OAAL,CAAatE,OAAzC;;AACA,aAAKoJ,KAAL;;AACA;;AACJ,WAAK;AAAE;AAAP;AACIvP,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK7G,eAAd;AACArI,QAAAA,GAAG,CAACsP,IAAJ,CAAS,KAAK9G,YAAd,EAA4B,KAAKiC,OAAL,CAAatE,OAAzC;;AACA,aAAKoJ,KAAL;;AACA;;AACJ,WAAK;AAAE;AAAP;AACIvP,QAAAA,GAAG,CAACkP,IAAJ,CAAS,KAAK7G,eAAd;AACArI,QAAAA,GAAG,CAACsP,IAAJ,CAAS,KAAK9G,YAAd,EAA4B,KAAKiC,OAAL,CAAatE,OAAzC;;AACA,aAAK0C,QAAL,CAAcyG,IAAd;;AACA,aAAKC,KAAL;;AACA;AAhDR;AAkDH;;AACDA,EAAAA,KAAK,GAAG;AACJ,SAAK9E,OAAL,CAAa6E,IAAb;;AACA,SAAK/I,cAAL,CAAoB+I,IAApB;;AACA,SAAKG,OAAL,CAAa,KAAKhJ,cAAL,CAAoB9C,OAApB,EAAb;;AACA,SAAKkI,wBAAL,CAA8B6D,GAA9B,CAAkC,IAAlC;;AACA,SAAKpK,YAAL,CAAkBqK,YAAlB,CAA+B,MAAM;AACjC,WAAKxJ,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,SAAnC;;AACA,WAAKX,UAAL,CAAgB2G,IAAhB,CAAqB,IAArB;AACH,KAHD,EAGG,GAHH;AAIH;;AACDsD,EAAAA,aAAa,CAACC,IAAD,EAAOC,KAAP,EAAc;AACvB,QAAI,KAAK7K,MAAL,KAAgB;AAAE;AAAtB,MAAoC;AAChC;AACH;;AACD,SAAKsB,cAAL,CAAoBwJ,WAApB,CAAgC,KAAKvM,MAAL,CAAYwM,WAAZ,EAAhC;;AACA,SAAK9K,OAAL,GAAe,CAAC,CAAC2K,IAAjB;;AACA,QAAI,CAAC,KAAK3K,OAAV,EAAmB;AACf,WAAKuH,eAAL,GAAuBtM,iBAAiB,CAAC,MAAM,KAAK8O,SAAL,CAAe;AAAE;AAAjB,OAAP,EAAwCa,KAAxC,CAAxC;AACH;AACJ;;AACDG,EAAAA,eAAe,CAAC5C,eAAD,EAAkB6C,cAAlB,EAAkCC,QAAlC,EAA4CC,MAA5C,EAAoD;AAC/D,QAAIxM,EAAJ,EAAQS,EAAR;;AACA,SAAKkC,cAAL,CAAoBwJ,WAApB,CAAgC,KAAKvM,MAAL,CAAYwM,WAAZ,EAAhC;;AACA,KAACpM,EAAE,GAAG,KAAK6I,eAAX,MAAgC,IAAhC,IAAwC7I,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC4I,OAAH,EAAjE;AACA,KAACnI,EAAE,GAAG,KAAK+J,yBAAX,MAA0C,IAA1C,IAAkD/J,EAAE,KAAK,KAAK,CAA9D,GAAkE,KAAK,CAAvE,GAA2EA,EAAE,CAACgK,MAAH,EAA3E;AACA,SAAKD,yBAAL,GAAiC9J,SAAjC;;AACA,QAAI,KAAKgJ,gBAAL,KAA0BD,eAA9B,EAA+C;AAC3C,WAAKC,gBAAL,GAAwBD,eAAxB;AACH;;AACD,QAAI8C,QAAQ,IAAI,KAAKlL,MAAL,KAAgB;AAAE;AAA9B,OAA6C,KAAKA,MAAL,KAAgB;AAAE;AAAnE,MAAiF;AAC7E,WAAKgK,SAAL,CAAe;AAAE;AAAjB;;AACA;AACH;;AACD,UAAMoB,YAAY,GAAG,KAAK/C,gBAAL,CAAsBgD,KAAtB,CAA4BrS,MAAjD;AACA,UAAMsS,OAAO,GAAGF,YAAY,KAAK,CAAjC;;AACA,SAAKnE,oCAAL,CAA0CwD,GAA1C,CAA8CW,YAAY,GAAG,CAA7D;;AACA,QAAIE,OAAJ,EAAa;AACT,WAAKtB,SAAL,CAAemB,MAAM,GAAG;AAAE;AAAL,QAAoB;AAAE;AAA3C;;AACA,WAAK9C,gBAAL,GAAwBhJ,SAAxB;AACA;AACH;;AACD,SAAKgK,YAAL,GAAoBhK,SAApB;;AACA,SAAK8E,KAAL,CAAW0F,MAAX,CAAkB,CAAlB,EAAqB,KAAK1F,KAAL,CAAWnL,MAAhC,EAAwC,KAAKqP,gBAAL,CAAsBgD,KAA9D;;AACA,SAAKrB,SAAL,CAAekB,QAAQ,GAAG;AAAE;AAAL,MAAoB;AAAE;AAA7C;;AACA,SAAK/G,KAAL,CAAWqF,MAAX,CAAkByB,cAAlB,EAAkC,CAAlC;;AACA,SAAK9G,KAAL,CAAW2F,QAAX,CAAoB,CAACmB,cAAD,CAApB;;AACA,SAAKT,OAAL,CAAa,KAAKtJ,OAAL,CAAa3B,IAA1B,EA1B+D,CA2B/D;;;AACA,QAAI,KAAKuJ,mBAAT,EAA8B;AAC1B,WAAKlF,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuH,KAA7B,CAAmCE,WAAnC,GAAiD,KAAKE,mBAAtD;AACH;AACJ;;AACDyC,EAAAA,cAAc,GAAG;AACb,YAAQ,KAAKvL,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,aAAK4D,QAAL,CAAcwD,MAAd,CAAqBoE,QAArB;;AACA,eAAO,IAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAKvL,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAWsH,aAAX;;AACA,eAAO,IAAP;AAVR;AAYH;;AACDC,EAAAA,UAAU,GAAG;AACT,YAAQ,KAAK1L,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAKC,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAWwH,SAAX,CAAqB,CAArB,EAAwB,IAAxB;;AACA,eAAO,IAAP;AAPR;AASH;;AACDC,EAAAA,UAAU,GAAG;AACT,YAAQ,KAAK5L,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,aAAK4D,QAAL,CAAcwD,MAAd,CAAqByE,YAArB;;AACA,eAAO,IAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAK5L,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAW2H,SAAX;;AACA,eAAO,IAAP;AAVR;AAYH;;AACDC,EAAAA,kBAAkB,GAAG;AACjB,YAAQ,KAAK/L,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,aAAK4D,QAAL,CAAcwD,MAAd,CAAqB4E,MAArB;;AACA,eAAO,IAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAK/L,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAW8H,iBAAX;;AACA,eAAO,IAAP;AAVR;AAYH;;AACDC,EAAAA,cAAc,GAAG;AACb,YAAQ,KAAKlM,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAKC,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAWgI,aAAX,CAAyB,CAAzB,EAA4B,IAA5B;;AACA,eAAO,KAAP;AAPR;AASH;;AACDC,EAAAA,WAAW,GAAG;AACV,YAAQ,KAAKpM,MAAb;AACI,WAAK;AAAE;AAAP;AACI,eAAO,KAAP;;AACJ,WAAK;AAAE;AAAP;AACI,aAAK4D,QAAL,CAAcwD,MAAd,CAAqBiF,SAArB;;AACA,eAAO,IAAP;;AACJ,WAAK;AAAE;AAAP;AACI,eAAO,CAAC,KAAKpM,OAAb;;AACJ;AACI,aAAKkE,KAAL,CAAWmI,UAAX;;AACA,eAAO,IAAP;AAVR;AAYH;;AACDC,EAAAA,cAAc,GAAG;AACb,QAAI,KAAKvM,MAAL,KAAgB;AAAE;AAAlB,OACG,KAAKA,MAAL,KAAgB;AAAE;AADrB,OAEG,KAAKA,MAAL,KAAgB;AAAE;AAFrB,OAGG,KAAKqI,gBAHZ,EAG8B;AAC1B,aAAO;AACHxD,QAAAA,IAAI,EAAE,KAAKV,KAAL,CAAWqI,kBAAX,GAAgC,CAAhC,CADH;AAEH3E,QAAAA,KAAK,EAAE,KAAK1D,KAAL,CAAWsI,QAAX,GAAsB,CAAtB,CAFJ;AAGHnE,QAAAA,KAAK,EAAE,KAAKD;AAHT,OAAP;AAKH;;AACD,WAAOhJ,SAAP;AACH;;AACDqN,EAAAA,kBAAkB,GAAG;AACjB,QAAI,KAAK1M,MAAL,KAAgB;AAAE;AAAtB,MAAqC;AACjC,WAAKgK,SAAL,CAAe;AAAE;AAAjB;;AACA,UAAI,KAAKlB,mBAAT,EAA8B;AAC1B,aAAKlF,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuH,KAA7B,CAAmCE,WAAnC,GAAiD,KAAKE,mBAAtD;AACH;AACJ,KALD,MAMK,IAAI,KAAK9I,MAAL,KAAgB;AAAE;AAAlB,OAAgC,KAAK+E,iBAAL,EAApC,EAA8D;AAC/D,WAAKiF,SAAL,CAAe;AAAE;AAAjB;;AACA,UAAI,KAAKhB,wBAAT,EAAmC;AAC/B,aAAKpF,QAAL,CAAcwD,MAAd,CAAqBjG,OAArB,CAA6BuH,KAA7B,CAAmCE,WAAnC,GAAiD,KAAKI,wBAAtD;AACH;AACJ;AACJ;;AACDrF,EAAAA,aAAa,GAAG;AACZ,QAAI,KAAKoB,iBAAL,EAAJ,EAA8B;AAC1B;AACA,WAAKgC,+BAAL,CAAqC0D,GAArC,CAAyC,KAAzC;;AACA,WAAKkC,kBAAL,CAAwB,KAAxB;;AACA,WAAK/I,QAAL,CAAcqG,IAAd;;AACA,WAAK/I,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+B1B,MAA/B,CAAsC,eAAtC;AACH,KAND,MAOK,IAAI,CAACvC,uBAAuB,CAAC,KAAKgH,KAAL,CAAWqI,kBAAX,GAAgC,CAAhC,CAAD,CAAvB,IAA+D,KAAKpM,YAArE,MAAuF,KAAKJ,MAAL,KAAgB;AAAE;AAAlB,OAAgC,KAAKA,MAAL,KAAgB;AAAE;AAAlD,OAAmE,KAAKA,MAAL,KAAgB;AAAE;AAA5K,KAAJ,EAA+L;AAChM;AACA,WAAK+G,+BAAL,CAAqC0D,GAArC,CAAyC,IAAzC;;AACA,WAAKkC,kBAAL,CAAwB,IAAxB;;AACA,WAAKhD,WAAL,CAAiB,KAAjB;AACH;AACJ;;AACDA,EAAAA,WAAW,CAACD,OAAD,EAAU;AACjB,SAAK9F,QAAL,CAAcyG,IAAd;;AACA,QAAIX,OAAJ,EAAa;AACT,WAAK9F,QAAL,CAAcwD,MAAd,CAAqBwF,aAArB;AACH,KAFD,MAGK;AACD,WAAKhJ,QAAL,CAAcwD,MAAd,CAAqByF,UAArB,CAAgC,KAAK1I,KAAL,CAAWqI,kBAAX,GAAgC,CAAhC,CAAhC,EAAoE,KAAKpM,YAAzE;AACH;;AACD,SAAK0M,gBAAL;;AACA,SAAKvO,MAAL,CAAYoJ,KAAZ;AACA,SAAKzG,OAAL,CAAaC,OAAb,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,eAAnC;AACH;;AACD0L,EAAAA,iBAAiB,GAAG;AAChB,QAAI,KAAK5I,KAAL,CAAWqI,kBAAX,GAAgC,CAAhC,CAAJ,EAAwC;AACpC,WAAKpM,YAAL,GAAoB,CAAC,KAAKA,YAA1B;;AACA,UAAI,CAAC,KAAK2E,iBAAL,EAAL,EAA+B;AAC3B,aAAKpB,aAAL;AACH,OAFD,MAGK;AACD,aAAKgG,WAAL,CAAiB,KAAjB;AACH;AACJ;AACJ;;AACDqD,EAAAA,kBAAkB,GAAG;AACjB,SAAKxL,cAAL,CAAoB/B,KAApB;AACH;;AACDwN,EAAAA,UAAU,GAAG;AACT,QAAItO,EAAJ;;AACA,KAACA,EAAE,GAAG,KAAK6I,eAAX,MAAgC,IAAhC,IAAwC7I,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC4I,OAAH,EAAjE;;AACA,SAAKyC,SAAL,CAAe;AAAE;AAAjB;;AACA,SAAKvJ,UAAL,CAAgB4G,IAAhB,CAAqB,IAArB;;AACA,SAAKnG,OAAL,CAAagM,mBAAb,GALS,CAMT;AACA;;AACA,UAAMC,GAAG,GAAG,KAAK3L,cAAL,CAAoB9C,OAApB,EAAZ;;AACA,UAAM0O,kBAAkB,GAAGpK,IAAI,CAACqK,IAAL,CAAU,KAAKvK,aAAL,GAAqBF,UAArB,GAAkC,GAA5C,CAA3B;;AACA,QAAIuK,GAAG,IAAIA,GAAG,CAAC5K,MAAJ,GAAa6K,kBAAxB,EAA4C;AACxC,WAAK5L,cAAL,CAAoBlC,KAApB,CAA0B6N,GAAG,CAACG,IAAJ,CAASjO,SAAT,EAAoB+N,kBAApB,CAA1B;AACH;AACJ;;AACDlC,EAAAA,QAAQ,GAAG;AACP,WAAO,KAAKlL,MAAL,KAAgB;AAAE;AAAzB;AACH;;AACDuN,EAAAA,YAAY,CAACC,QAAD,EAAW;AACnB,QAAIA,QAAQ,KAAK,IAAjB,EAAuB;AACnB,UAAI,KAAKzI,iBAAL,EAAJ,EAA8B;AAC1B,aAAKnB,QAAL,CAAcqG,IAAd,GAD0B,CACJ;;AACzB;;AACD;AACH;;AACD,QAAI,KAAKjK,MAAL,KAAgB;AAAE;AAAlB,OAAiC,KAAKA,MAAL,KAAgB;AAAE;AAAvD,MAAsE;AAClE;AACA;AACH;;AACD,QAAI,KAAK+E,iBAAL,EAAJ,EAA8B;AAC1B,WAAKnB,QAAL,CAAcyG,IAAd;AACH;;AACD,SAAKyC,gBAAL;AACH;;AACDtC,EAAAA,OAAO,CAACjL,IAAD,EAAO;AACV,QAAIZ,EAAJ,EAAQS,EAAR,EAAY8C,EAAZ;;AACA,QAAI,CAAC,KAAK3D,MAAL,CAAYkP,QAAZ,EAAL,EAA6B;AACzB;AACH;;AACD,QAAI,CAAC,KAAKlP,MAAL,CAAYmP,UAAZ,EAAL,EAA+B;AAC3B;AACA;AACH;;AACD,UAAMC,OAAO,GAAG5S,GAAG,CAAC6S,aAAJ,CAAkBC,QAAQ,CAACC,IAA3B,CAAhB;AACA,UAAMC,IAAI,GAAG,KAAKjL,aAAL,EAAb;;AACA,QAAI,CAACvD,IAAL,EAAW;AACPA,MAAAA,IAAI,GAAGwO,IAAI,CAAClL,WAAZ;AACH;;AACD,QAAIN,MAAM,GAAGhD,IAAI,CAACgD,MAAlB;AACA,QAAID,KAAK,GAAG/C,IAAI,CAAC+C,KAAjB,CAfU,CAgBV;;AACA,SAAKkD,OAAL,CAAatE,OAAb,CAAqBwH,KAArB,CAA2BsF,UAA3B,GAAyC,GAAED,IAAI,CAACnL,UAAW,IAA3D;;AACA,QAAI,KAAK5C,MAAL,KAAgB;AAAE;AAAlB,OAAiC,KAAKA,MAAL,KAAgB;AAAE;AAAvD,MAAsE;AAClE;AACAuC,MAAAA,MAAM,GAAGwL,IAAI,CAACnL,UAAL,GAAkBmL,IAAI,CAACE,YAAhC;AACA3L,MAAAA,KAAK,GAAGyL,IAAI,CAAClL,WAAL,CAAiBP,KAAjB,GAAyB,CAAjC;AACA,WAAKpB,OAAL,CAAagN,YAAb,CAA0B,KAA1B,EAAiC,KAAjC,EAAwC,KAAxC,EAA+C,KAA/C;AACA,WAAKhN,OAAL,CAAaiN,OAAb,GAAuB,KAAKjN,OAAL,CAAakN,OAAb,GAAuB,IAAIrT,GAAG,CAACkE,SAAR,CAAkBqD,KAAlB,EAAyBC,MAAzB,CAA9C;;AACA,WAAKjB,cAAL,CAAoB+M,aAApB,CAAkC;AAAE;AAApC;AACH,KAPD,MAQK;AACD;AACA;AACA,YAAMC,QAAQ,GAAGX,OAAO,CAACrL,KAAR,GAAgByL,IAAI,CAACE,YAArB,GAAoC,IAAIF,IAAI,CAACQ,iBAA9D;;AACA,UAAIjM,KAAK,GAAGgM,QAAZ,EAAsB;AAClBhM,QAAAA,KAAK,GAAGgM,QAAR;AACH;;AACD,YAAME,cAAc,GAAG,KAAKnG,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBoG,KAAtB,CAA4BC,SAA5B,GAAwCX,IAAI,CAACY,8BAArE,GAAsGrM,KAA7H,CAPC,CAQD;;AACA,YAAMsM,UAAU,GAAGb,IAAI,CAACc,eAAL,GAAuB,KAAK1K,KAAL,CAAW2K,aAAlC,GAAkDf,IAAI,CAACE,YAA1E;AACA,YAAMc,SAAS,GAAGhB,IAAI,CAACnL,UAAL,GAAkBmL,IAAI,CAACc,eAAzC;AACA,YAAMG,SAAS,GAAGjU,GAAG,CAACkU,sBAAJ,CAA2B,KAAK1Q,MAAL,CAAYmP,UAAZ,EAA3B,CAAlB;AACA,YAAMwB,SAAS,GAAG,KAAK3Q,MAAL,CAAY4Q,0BAAZ,CAAuC,KAAK5Q,MAAL,CAAYwM,WAAZ,EAAvC,CAAlB;AACA,YAAMqE,YAAY,GAAGJ,SAAS,CAACK,GAAV,GAAgBH,SAAS,CAACG,GAA1B,GAAgCH,SAAS,CAAC3M,MAA/D;AACA,YAAM+M,cAAc,GAAGtM,IAAI,CAACuM,GAAL,CAAS5B,OAAO,CAACpL,MAAR,GAAiB6M,YAAjB,GAAgCrB,IAAI,CAACyB,eAA9C,EAA+DZ,UAA/D,CAAvB;AACA,YAAMa,mBAAmB,GAAGT,SAAS,CAACK,GAAV,GAAgBH,SAAS,CAACG,GAA1B,GAAgCtB,IAAI,CAACyB,eAAjE;AACA,YAAME,cAAc,GAAG1M,IAAI,CAACuM,GAAL,CAASE,mBAAT,EAA8Bb,UAA9B,CAAvB;AACA,UAAIe,SAAS,GAAG3M,IAAI,CAACuM,GAAL,CAASvM,IAAI,CAAC4M,GAAL,CAASF,cAAT,EAAyBJ,cAAzB,IAA2CvB,IAAI,CAACE,YAAzD,EAAuEW,UAAvE,CAAhB;;AACA,UAAIrM,MAAM,MAAM,CAAC5D,EAAE,GAAG,KAAKuL,aAAX,MAA8B,IAA9B,IAAsCvL,EAAE,KAAK,KAAK,CAAlD,GAAsD,KAAK,CAA3D,GAA+DA,EAAE,CAACkR,MAAxE,CAAV,EAA2F;AACvF;AACA;AACAtN,QAAAA,MAAM,GAAG,KAAK2H,aAAL,CAAmB4F,MAA5B;AACH;;AACD,UAAIvN,MAAM,GAAGwM,SAAb,EAAwB;AACpBxM,QAAAA,MAAM,GAAGwM,SAAT;AACH;;AACD,UAAIxM,MAAM,GAAGoN,SAAb,EAAwB;AACpBpN,QAAAA,MAAM,GAAGoN,SAAT;AACH;;AACD,YAAMI,gCAAgC,GAAG,GAAzC;;AACA,UAAIxN,MAAM,GAAG+M,cAAT,IAA4B,KAAKnP,oBAAL,IAA6BsP,mBAAmB,GAAGM,gCAAnF,EAAsH;AAClH,aAAKzO,cAAL,CAAoB+M,aAApB,CAAkC;AAAE;AAApC;;AACA,aAAKnN,OAAL,CAAagN,YAAb,CAA0B,IAA1B,EAAgC,IAAhC,EAAsC,KAAtC,EAA6C,KAA7C;AACAyB,QAAAA,SAAS,GAAGD,cAAZ;AACH,OAJD,MAKK;AACD,aAAKpO,cAAL,CAAoB+M,aAApB,CAAkC;AAAE;AAApC;;AACA,aAAKnN,OAAL,CAAagN,YAAb,CAA0B,KAA1B,EAAiC,IAAjC,EAAuC,IAAvC,EAA6C,KAA7C;AACAyB,QAAAA,SAAS,GAAGL,cAAZ;AACH;;AACD,WAAKpO,OAAL,CAAa8O,aAAb,GAA6B,IAAIjV,GAAG,CAACkE,SAAR,CAAkBuP,cAAlB,EAAkCT,IAAI,CAAClL,WAAL,CAAiBN,MAAnD,CAA7B;AACA,WAAKrB,OAAL,CAAakN,OAAb,GAAuB,IAAIrT,GAAG,CAACkE,SAAR,CAAkBqP,QAAlB,EAA4BqB,SAA5B,CAAvB;AACA,WAAKzO,OAAL,CAAaiN,OAAb,GAAuB,IAAIpT,GAAG,CAACkE,SAAR,CAAkB,GAAlB,EAAuB8P,SAAvB,CAAvB,CA1CC,CA2CD;AACA;AACA;;AACA,WAAK7E,aAAL,GAAqB3H,MAAM,KAAKqM,UAAX,GACf;AAAEkB,QAAAA,MAAM,EAAE,CAAC5N,EAAE,GAAG,CAAC9C,EAAE,GAAG,KAAK8K,aAAX,MAA8B,IAA9B,IAAsC9K,EAAE,KAAK,KAAK,CAAlD,GAAsD,KAAK,CAA3D,GAA+DA,EAAE,CAAC0Q,MAAxE,MAAoF,IAApF,IAA4F5N,EAAE,KAAK,KAAK,CAAxG,GAA4GA,EAA5G,GAAiH3C,IAAI,CAACgD,MAAhI;AAAwIsN,QAAAA,MAAM,EAAEtN;AAAhJ,OADe,GAEflD,SAFN;AAGH;;AACD,SAAK+C,OAAL,CAAaE,KAAb,EAAoBC,MAApB;AACH;;AACDH,EAAAA,OAAO,CAACE,KAAD,EAAQC,MAAR,EAAgB;AACnB,UAAM;AAAED,MAAAA,KAAK,EAAEgM,QAAT;AAAmB/L,MAAAA,MAAM,EAAEoN;AAA3B,QAAyC,KAAKzO,OAAL,CAAakN,OAA5D;AACA9L,IAAAA,KAAK,GAAGU,IAAI,CAACuM,GAAL,CAASjB,QAAT,EAAmBhM,KAAnB,CAAR;AACAC,IAAAA,MAAM,GAAGS,IAAI,CAACuM,GAAL,CAASI,SAAT,EAAoBpN,MAApB,CAAT;AACA,UAAM;AAAEsM,MAAAA;AAAF,QAAsB,KAAK/L,aAAL,EAA5B;;AACA,SAAKqB,KAAL,CAAWyD,MAAX,CAAkBrF,MAAM,GAAGsM,eAA3B,EAA4CvM,KAA5C;;AACA,SAAKiB,YAAL,CAAkBmF,KAAlB,CAAwBnG,MAAxB,GAAkC,GAAEA,MAAM,GAAGsM,eAAgB,IAA7D;AACA,SAAK3N,OAAL,CAAa0G,MAAb,CAAoBrF,MAApB,EAA4BD,KAA5B;;AACA,SAAKhB,cAAL,CAAoBsG,MAApB;;AACA,SAAKkF,gBAAL;AACH;;AACDA,EAAAA,gBAAgB,GAAG;AACf,QAAI,KAAK/H,iBAAL,EAAJ,EAA8B;AAC1B,WAAKnB,QAAL,CAAcqM,aAAd,CAA4B,KAAK/O,OAAL,CAAaC,OAAzC;AACH;AACJ;;AACD2B,EAAAA,aAAa,GAAG;AACZ,UAAMoN,QAAQ,GAAG,KAAK3R,MAAL,CAAYwF,SAAZ,CAAsB;AAAG;AAAzB,KAAjB;AACA,UAAMnB,UAAU,GAAGrH,KAAK,CAAC,KAAKgD,MAAL,CAAYwF,SAAZ,CAAsB;AAAI;AAA1B,SAAsDmM,QAAQ,CAAClC,UAAhE,EAA4E,CAA5E,EAA+E,IAA/E,CAAxB;AACA,UAAMa,eAAe,GAAG,CAAC,KAAKtQ,MAAL,CAAYwF,SAAZ,CAAsB;AAAI;AAA1B,MAAyC2B,aAA1C,IAA2D,KAAK1F,MAAL,KAAgB;AAAE;AAA7E,OAA4F,KAAKA,MAAL,KAAgB;AAAE;AAA9G,MAA8H,CAA9H,GAAkI4C,UAA1J;AACA,UAAMqG,WAAW,GAAG,KAAKrF,QAAL,CAAcwD,MAAd,CAAqB6B,WAAzC;AACA,UAAMgF,YAAY,GAAG,IAAIhF,WAAzB;AACA,WAAO;AACHrG,MAAAA,UADG;AAEHiM,MAAAA,eAFG;AAGH5F,MAAAA,WAHG;AAIHgF,MAAAA,YAJG;AAKHU,MAAAA,8BAA8B,EAAEuB,QAAQ,CAACvB,8BALtC;AAMHa,MAAAA,eAAe,EAAE,EANd;AAOHjB,MAAAA,iBAAiB,EAAE,EAPhB;AAQH1L,MAAAA,WAAW,EAAE,IAAI9H,GAAG,CAACkE,SAAR,CAAkB,GAAlB,EAAuB4P,eAAe,GAAG,KAAKjM,UAAvB,GAAoCqL,YAA3D;AARV,KAAP;AAUH;;AACDlJ,EAAAA,iBAAiB,GAAG;AAChB,WAAO,KAAKnF,eAAL,CAAqBuQ,UAArB,CAAgC,sBAAhC,EAAwD;AAAE;AAA1D,MAAwE,KAAxE,CAAP;AACH;;AACDxD,EAAAA,kBAAkB,CAACzS,KAAD,EAAQ;AACtB,SAAK0F,eAAL,CAAqBN,KAArB,CAA2B,sBAA3B,EAAmDpF,KAAnD,EAA0D;AAAE;AAA5D,MAA0E;AAAE;AAA5E;AACH;;AACDkW,EAAAA,mBAAmB,GAAG;AAClB,QAAI,CAAC,KAAKjQ,oBAAV,EAAgC;AAC5B,WAAKA,oBAAL,GAA4B,IAA5B;;AACA,WAAKqK,OAAL,CAAa,KAAKhJ,cAAL,CAAoB9C,OAApB,EAAb;AACH;AACJ;;AACD2R,EAAAA,uBAAuB,GAAG;AACtB,SAAKlQ,oBAAL,GAA4B,KAA5B;AACH;;AA5pBmC,CAAxC;AA8pBAR,aAAa,CAACyK,eAAd,GAAgCzO,GAAG,CAACiC,QAAJ,CAAa,uBAAb,EAAsC,YAAtC,CAAhC;AACA+B,aAAa,CAAC4K,sBAAd,GAAuC5O,GAAG,CAACiC,QAAJ,CAAa,6BAAb,EAA4C,iBAA5C,CAAvC;AACA+B,aAAa,GAAGlH,UAAU,CAAC,CACvBgB,OAAO,CAAC,CAAD,EAAIqC,eAAJ,CADgB,EAEvBrC,OAAO,CAAC,CAAD,EAAImC,kBAAJ,CAFgB,EAGvBnC,OAAO,CAAC,CAAD,EAAIqD,aAAJ,CAHgB,EAIvBrD,OAAO,CAAC,CAAD,EAAIoC,qBAAJ,CAJgB,CAAD,EAKvB8D,aALuB,CAA1B;AAMA,SAASA,aAAT;AACA,OAAO,MAAM4B,oBAAN,CAA2B;AAC9BlD,EAAAA,WAAW,CAACiS,OAAD,EAAUC,OAAV,EAAmB;AAC1B,SAAKD,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,mBAAL,GAA2B,IAA3B;AACA,SAAKC,iBAAL,GAAyB,KAAzB;AACA,SAAKC,iBAAL,GAAyB,KAAzB;AACA,SAAKC,MAAL,GAAc,KAAd;AACA,SAAKC,OAAL,GAAe,KAAf;AACH;;AACDrJ,EAAAA,OAAO,GAAG;AACN,QAAI,KAAKoJ,MAAT,EAAiB;AACb,WAAKA,MAAL,GAAc,KAAd;;AACA,WAAKJ,OAAL,CAAaM,mBAAb,CAAiC,IAAjC;AACH;AACJ;;AACDC,EAAAA,KAAK,GAAG;AACJ,WAAO,6BAAP;AACH;;AACDpD,EAAAA,UAAU,GAAG;AACT,WAAO,KAAK4C,OAAL,CAAapP,OAAb,CAAqBC,OAA5B;AACH;;AACDkJ,EAAAA,IAAI,GAAG;AACH,SAAKuG,OAAL,GAAe,KAAf;;AACA,QAAI,CAAC,KAAKD,MAAV,EAAkB;AACd,WAAKA,MAAL,GAAc,IAAd;;AACA,WAAKJ,OAAL,CAAaQ,gBAAb,CAA8B,IAA9B;AACH;AACJ;;AACD9G,EAAAA,IAAI,GAAG;AACH,QAAI,CAAC,KAAK2G,OAAV,EAAmB;AACf,WAAKA,OAAL,GAAe,IAAf;AACA,WAAKhJ,MAAL;AACH;AACJ;;AACDA,EAAAA,MAAM,GAAG;AACL,SAAK2I,OAAL,CAAaS,mBAAb,CAAiC,IAAjC;AACH;;AACDjG,EAAAA,WAAW,GAAG;AACV,QAAI,KAAK6F,OAAL,IAAgB,CAAC,KAAKK,SAAtB,IAAmC,CAAC,KAAKC,WAA7C,EAA0D;AACtD,aAAO,IAAP;AACH;;AACD,WAAO;AACH1D,MAAAA,QAAQ,EAAE,KAAKyD,SADZ;AAEHE,MAAAA,UAAU,EAAE,CAAC,KAAKD,WAAN;AAFT,KAAP;AAIH;;AACDE,EAAAA,YAAY,GAAG;AACX,UAAM;AAAE7O,MAAAA,MAAF;AAAUD,MAAAA;AAAV,QAAoB,KAAKgO,OAAL,CAAapP,OAAb,CAAqB3B,IAA/C;;AACA,UAAM;AAAE0J,MAAAA,WAAF;AAAesF,MAAAA;AAAf,QAAqC,KAAK+B,OAAL,CAAaxN,aAAb,EAA3C;;AACA,WAAO,IAAI/H,GAAG,CAACkE,SAAR,CAAkBqD,KAAK,GAAG,IAAI2G,WAAZ,GAA0BsF,iBAA5C,EAA+DhM,MAAM,GAAG,IAAI0G,WAA5E,CAAP;AACH;;AACDoI,EAAAA,WAAW,CAAC7D,QAAD,EAAW;AAClB,SAAK8C,OAAL,CAAa/C,YAAb,CAA0BC,QAA1B;AACH;;AACDa,EAAAA,aAAa,CAAC8C,UAAD,EAAa;AACtB,QAAI,CAAC,KAAKT,iBAAV,EAA6B;AACzB,WAAKQ,WAAL,GAAmBC,UAAnB;AACH;AACJ;;AACDnP,EAAAA,cAAc,GAAG;AACb,SAAK0O,iBAAL,GAAyB,IAAzB;AACH;;AACDvN,EAAAA,gBAAgB,GAAG;AACf,SAAKuN,iBAAL,GAAyB,KAAzB;AACH;;AACD5F,EAAAA,WAAW,CAAC0C,QAAD,EAAW;AAClB,SAAKyD,SAAL,GAAiBzD,QAAjB;AACH;;AApE6B;AAsElCzQ,0BAA0B,CAAC,CAACwL,KAAD,EAAQ+I,SAAR,KAAsB;AAC7C,QAAMC,cAAc,GAAGhJ,KAAK,CAACE,QAAN,CAAevK,sCAAf,CAAvB;;AACA,MAAIqT,cAAJ,EAAoB;AAChBD,IAAAA,SAAS,CAACE,OAAV,CAAmB,8GAA6GD,cAAe,KAA/I;AACH;;AACD,QAAME,mBAAmB,GAAGlJ,KAAK,CAACE,QAAN,CAAetK,2CAAf,CAA5B;;AACA,MAAIoT,cAAJ,EAAoB;AAChBD,IAAAA,SAAS,CAACE,OAAV,CAAmB,sHAAqHC,mBAAoB,KAA5J;AACH;;AACD,QAAMC,UAAU,GAAGnJ,KAAK,CAACE,QAAN,CAAe3K,6BAAf,CAAnB;;AACA,MAAI4T,UAAJ,EAAgB;AACZJ,IAAAA,SAAS,CAACE,OAAV,CAAmB,4EAA2EE,UAAW,KAAzG;AACH;;AACD,QAAMC,kBAAkB,GAAGpJ,KAAK,CAACE,QAAN,CAAe1K,qCAAf,CAA3B;;AACA,MAAI4T,kBAAJ,EAAwB;AACpBL,IAAAA,SAAS,CAACE,OAAV,CAAmB,iFAAgFG,kBAAmB,KAAtH;AACH;;AACD,QAAMC,sBAAsB,GAAGrJ,KAAK,CAACE,QAAN,CAAezK,yCAAf,CAA/B;;AACA,MAAI4T,sBAAJ,EAA4B;AACxBN,IAAAA,SAAS,CAACE,OAAV,CAAmB,0FAAyFI,sBAAuB,KAAnI;AACH;;AACD,QAAMC,IAAI,GAAGtJ,KAAK,CAACE,QAAN,CAAe7L,kBAAf,CAAb;;AACA,MAAIiV,IAAJ,EAAU;AACNP,IAAAA,SAAS,CAACE,OAAV,CAAmB,8CAA6CK,IAAK,KAArE;AACH;;AACD,QAAMC,SAAS,GAAGvJ,KAAK,CAACE,QAAN,CAAe9L,wBAAf,CAAlB;;AACA,MAAImV,SAAJ,EAAe;AACXR,IAAAA,SAAS,CAACE,OAAV,CAAmB,oDAAmDM,SAAU,KAAhF;AACH;;AACD,QAAMC,cAAc,GAAGxJ,KAAK,CAACE,QAAN,CAAe/L,uBAAf,CAAvB;;AACA,MAAIqV,cAAJ,EAAoB;AAChBT,IAAAA,SAAS,CAACE,OAAV,CAAmB,4DAA2DO,cAAe,KAA7F;AACH;AACJ,CAjCyB,CAA1B","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport * as dom from '../../../base/browser/dom.js';\nimport '../../../base/browser/ui/codicons/codiconStyles.js'; // The codicon symbol styles are defined here and must be loaded\nimport { List } from '../../../base/browser/ui/list/listWidget.js';\nimport { createCancelablePromise, disposableTimeout, TimeoutTimer } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { clamp } from '../../../base/common/numbers.js';\nimport * as strings from '../../../base/common/strings.js';\nimport './media/suggest.css';\nimport { EmbeddedCodeEditorWidget } from '../../browser/widget/embeddedCodeEditorWidget.js';\nimport { SuggestWidgetStatus } from './suggestWidgetStatus.js';\nimport '../symbolIcons/symbolIcons.js'; // The codicon symbol colors are defined here and must be loaded to get colors\nimport * as nls from '../../../nls.js';\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\nimport { activeContrastBorder, editorForeground, editorWidgetBackground, editorWidgetBorder, focusBorder, listFocusHighlightForeground, listHighlightForeground, quickInputListFocusBackground, quickInputListFocusForeground, quickInputListFocusIconForeground, registerColor, textCodeBlockBackground, textLinkActiveForeground, textLinkForeground } from '../../../platform/theme/common/colorRegistry.js';\nimport { attachListStyler } from '../../../platform/theme/common/styler.js';\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nimport { ResizableHTMLElement } from './resizable.js';\nimport { Context as SuggestContext } from './suggest.js';\nimport { canExpandCompletionItem, SuggestDetailsOverlay, SuggestDetailsWidget } from './suggestWidgetDetails.js';\nimport { getAriaId, ItemRenderer } from './suggestWidgetRenderer.js';\n/**\n * Suggest widget colors\n */\nexport const editorSuggestWidgetBackground = registerColor('editorSuggestWidget.background', { dark: editorWidgetBackground, light: editorWidgetBackground, hc: editorWidgetBackground }, nls.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));\nexport const editorSuggestWidgetBorder = registerColor('editorSuggestWidget.border', { dark: editorWidgetBorder, light: editorWidgetBorder, hc: editorWidgetBorder }, nls.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));\nexport const editorSuggestWidgetForeground = registerColor('editorSuggestWidget.foreground', { dark: editorForeground, light: editorForeground, hc: editorForeground }, nls.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));\nexport const editorSuggestWidgetSelectedForeground = registerColor('editorSuggestWidget.selectedForeground', { dark: quickInputListFocusForeground, light: quickInputListFocusForeground, hc: quickInputListFocusForeground }, nls.localize('editorSuggestWidgetSelectedForeground', 'Foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedIconForeground = registerColor('editorSuggestWidget.selectedIconForeground', { dark: quickInputListFocusIconForeground, light: quickInputListFocusIconForeground, hc: quickInputListFocusIconForeground }, nls.localize('editorSuggestWidgetSelectedIconForeground', 'Icon foreground color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetSelectedBackground = registerColor('editorSuggestWidget.selectedBackground', { dark: quickInputListFocusBackground, light: quickInputListFocusBackground, hc: quickInputListFocusBackground }, nls.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));\nexport const editorSuggestWidgetHighlightForeground = registerColor('editorSuggestWidget.highlightForeground', { dark: listHighlightForeground, light: listHighlightForeground, hc: listHighlightForeground }, nls.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));\nexport const editorSuggestWidgetHighlightFocusForeground = registerColor('editorSuggestWidget.focusHighlightForeground', { dark: listFocusHighlightForeground, light: listFocusHighlightForeground, hc: listFocusHighlightForeground }, nls.localize('editorSuggestWidgetFocusHighlightForeground', 'Color of the match highlights in the suggest widget when an item is focused.'));\nclass PersistedWidgetSize {\n    constructor(_service, editor) {\n        this._service = _service;\n        this._key = `suggestWidget.size/${editor.getEditorType()}/${editor instanceof EmbeddedCodeEditorWidget}`;\n    }\n    restore() {\n        var _a;\n        const raw = (_a = this._service.get(this._key, 0 /* GLOBAL */)) !== null && _a !== void 0 ? _a : '';\n        try {\n            const obj = JSON.parse(raw);\n            if (dom.Dimension.is(obj)) {\n                return dom.Dimension.lift(obj);\n            }\n        }\n        catch (_b) {\n            // ignore\n        }\n        return undefined;\n    }\n    store(size) {\n        this._service.store(this._key, JSON.stringify(size), 0 /* GLOBAL */, 1 /* MACHINE */);\n    }\n    reset() {\n        this._service.remove(this._key, 0 /* GLOBAL */);\n    }\n}\nlet SuggestWidget = class SuggestWidget {\n    constructor(editor, _storageService, _contextKeyService, _themeService, instantiationService) {\n        this.editor = editor;\n        this._storageService = _storageService;\n        this._state = 0 /* Hidden */;\n        this._isAuto = false;\n        this._ignoreFocusEvents = false;\n        this._forceRenderingAbove = false;\n        this._explainMode = false;\n        this._showTimeout = new TimeoutTimer();\n        this._disposables = new DisposableStore();\n        this._onDidSelect = new Emitter();\n        this._onDidFocus = new Emitter();\n        this._onDidHide = new Emitter();\n        this._onDidShow = new Emitter();\n        this.onDidSelect = this._onDidSelect.event;\n        this.onDidFocus = this._onDidFocus.event;\n        this.onDidHide = this._onDidHide.event;\n        this.onDidShow = this._onDidShow.event;\n        this._onDetailsKeydown = new Emitter();\n        this.onDetailsKeyDown = this._onDetailsKeydown.event;\n        this.element = new ResizableHTMLElement();\n        this.element.domNode.classList.add('editor-widget', 'suggest-widget');\n        this._contentWidget = new SuggestContentWidget(this, editor);\n        this._persistedSize = new PersistedWidgetSize(_storageService, editor);\n        class ResizeState {\n            constructor(persistedSize, currentSize, persistHeight = false, persistWidth = false) {\n                this.persistedSize = persistedSize;\n                this.currentSize = currentSize;\n                this.persistHeight = persistHeight;\n                this.persistWidth = persistWidth;\n            }\n        }\n        let state;\n        this._disposables.add(this.element.onDidWillResize(() => {\n            this._contentWidget.lockPreference();\n            state = new ResizeState(this._persistedSize.restore(), this.element.size);\n        }));\n        this._disposables.add(this.element.onDidResize(e => {\n            var _a, _b, _c, _d;\n            this._resize(e.dimension.width, e.dimension.height);\n            if (state) {\n                state.persistHeight = state.persistHeight || !!e.north || !!e.south;\n                state.persistWidth = state.persistWidth || !!e.east || !!e.west;\n            }\n            if (!e.done) {\n                return;\n            }\n            if (state) {\n                // only store width or height value that have changed and also\n                // only store changes that are above a certain threshold\n                const { itemHeight, defaultSize } = this.getLayoutInfo();\n                const threshold = Math.round(itemHeight / 2);\n                let { width, height } = this.element.size;\n                if (!state.persistHeight || Math.abs(state.currentSize.height - height) <= threshold) {\n                    height = (_b = (_a = state.persistedSize) === null || _a === void 0 ? void 0 : _a.height) !== null && _b !== void 0 ? _b : defaultSize.height;\n                }\n                if (!state.persistWidth || Math.abs(state.currentSize.width - width) <= threshold) {\n                    width = (_d = (_c = state.persistedSize) === null || _c === void 0 ? void 0 : _c.width) !== null && _d !== void 0 ? _d : defaultSize.width;\n                }\n                this._persistedSize.store(new dom.Dimension(width, height));\n            }\n            // reset working state\n            this._contentWidget.unlockPreference();\n            state = undefined;\n        }));\n        this._messageElement = dom.append(this.element.domNode, dom.$('.message'));\n        this._listElement = dom.append(this.element.domNode, dom.$('.tree'));\n        const details = instantiationService.createInstance(SuggestDetailsWidget, this.editor);\n        details.onDidClose(this.toggleDetails, this, this._disposables);\n        this._details = new SuggestDetailsOverlay(details, this.editor);\n        const applyIconStyle = () => this.element.domNode.classList.toggle('no-icons', !this.editor.getOption(105 /* suggest */).showIcons);\n        applyIconStyle();\n        const renderer = instantiationService.createInstance(ItemRenderer, this.editor);\n        this._disposables.add(renderer);\n        this._disposables.add(renderer.onDidToggleDetails(() => this.toggleDetails()));\n        this._list = new List('SuggestWidget', this._listElement, {\n            getHeight: (_element) => this.getLayoutInfo().itemHeight,\n            getTemplateId: (_element) => 'suggestion'\n        }, [renderer], {\n            alwaysConsumeMouseWheel: true,\n            useShadows: false,\n            mouseSupport: false,\n            accessibilityProvider: {\n                getRole: () => 'option',\n                getAriaLabel: (item) => {\n                    if (item.isResolved && this._isDetailsVisible()) {\n                        const { documentation, detail } = item.completion;\n                        const docs = strings.format('{0}{1}', detail || '', documentation ? (typeof documentation === 'string' ? documentation : documentation.value) : '');\n                        return nls.localize('ariaCurrenttSuggestionReadDetails', \"{0}, docs: {1}\", item.textLabel, docs);\n                    }\n                    else {\n                        return item.textLabel;\n                    }\n                },\n                getWidgetAriaLabel: () => nls.localize('suggest', \"Suggest\"),\n                getWidgetRole: () => 'listbox'\n            }\n        });\n        this._status = instantiationService.createInstance(SuggestWidgetStatus, this.element.domNode);\n        const applyStatusBarStyle = () => this.element.domNode.classList.toggle('with-status-bar', this.editor.getOption(105 /* suggest */).showStatusBar);\n        applyStatusBarStyle();\n        this._disposables.add(attachListStyler(this._list, _themeService, {\n            listInactiveFocusBackground: editorSuggestWidgetSelectedBackground,\n            listInactiveFocusOutline: activeContrastBorder\n        }));\n        this._disposables.add(_themeService.onDidColorThemeChange(t => this._onThemeChange(t)));\n        this._onThemeChange(_themeService.getColorTheme());\n        this._disposables.add(this._list.onMouseDown(e => this._onListMouseDownOrTap(e)));\n        this._disposables.add(this._list.onTap(e => this._onListMouseDownOrTap(e)));\n        this._disposables.add(this._list.onDidChangeSelection(e => this._onListSelection(e)));\n        this._disposables.add(this._list.onDidChangeFocus(e => this._onListFocus(e)));\n        this._disposables.add(this.editor.onDidChangeCursorSelection(() => this._onCursorSelectionChanged()));\n        this._disposables.add(this.editor.onDidChangeConfiguration(e => {\n            if (e.hasChanged(105 /* suggest */)) {\n                applyStatusBarStyle();\n                applyIconStyle();\n            }\n        }));\n        this._ctxSuggestWidgetVisible = SuggestContext.Visible.bindTo(_contextKeyService);\n        this._ctxSuggestWidgetDetailsVisible = SuggestContext.DetailsVisible.bindTo(_contextKeyService);\n        this._ctxSuggestWidgetMultipleSuggestions = SuggestContext.MultipleSuggestions.bindTo(_contextKeyService);\n        this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode, 'keydown', e => {\n            this._onDetailsKeydown.fire(e);\n        }));\n        this._disposables.add(this.editor.onMouseDown((e) => this._onEditorMouseDown(e)));\n    }\n    dispose() {\n        var _a;\n        this._details.widget.dispose();\n        this._details.dispose();\n        this._list.dispose();\n        this._status.dispose();\n        this._disposables.dispose();\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._showTimeout.dispose();\n        this._contentWidget.dispose();\n        this.element.dispose();\n    }\n    _onEditorMouseDown(mouseEvent) {\n        if (this._details.widget.domNode.contains(mouseEvent.target.element)) {\n            // Clicking inside details\n            this._details.widget.domNode.focus();\n        }\n        else {\n            // Clicking outside details and inside suggest\n            if (this.element.domNode.contains(mouseEvent.target.element)) {\n                this.editor.focus();\n            }\n        }\n    }\n    _onCursorSelectionChanged() {\n        if (this._state !== 0 /* Hidden */) {\n            this._contentWidget.layout();\n        }\n    }\n    _onListMouseDownOrTap(e) {\n        if (typeof e.element === 'undefined' || typeof e.index === 'undefined') {\n            return;\n        }\n        // prevent stealing browser focus from the editor\n        e.browserEvent.preventDefault();\n        e.browserEvent.stopPropagation();\n        this._select(e.element, e.index);\n    }\n    _onListSelection(e) {\n        if (e.elements.length) {\n            this._select(e.elements[0], e.indexes[0]);\n        }\n    }\n    _select(item, index) {\n        const completionModel = this._completionModel;\n        if (completionModel) {\n            this._onDidSelect.fire({ item, index, model: completionModel });\n            this.editor.focus();\n        }\n    }\n    _onThemeChange(theme) {\n        const backgroundColor = theme.getColor(editorSuggestWidgetBackground);\n        if (backgroundColor) {\n            this.element.domNode.style.backgroundColor = backgroundColor.toString();\n            this._messageElement.style.backgroundColor = backgroundColor.toString();\n            this._details.widget.domNode.style.backgroundColor = backgroundColor.toString();\n        }\n        const borderColor = theme.getColor(editorSuggestWidgetBorder);\n        if (borderColor) {\n            this.element.domNode.style.borderColor = borderColor.toString();\n            this._messageElement.style.borderColor = borderColor.toString();\n            this._status.element.style.borderTopColor = borderColor.toString();\n            this._details.widget.domNode.style.borderColor = borderColor.toString();\n            this._detailsBorderColor = borderColor.toString();\n        }\n        const focusBorderColor = theme.getColor(focusBorder);\n        if (focusBorderColor) {\n            this._detailsFocusBorderColor = focusBorderColor.toString();\n        }\n        this._details.widget.borderWidth = theme.type === 'hc' ? 2 : 1;\n    }\n    _onListFocus(e) {\n        var _a;\n        if (this._ignoreFocusEvents) {\n            return;\n        }\n        if (!e.elements.length) {\n            if (this._currentSuggestionDetails) {\n                this._currentSuggestionDetails.cancel();\n                this._currentSuggestionDetails = undefined;\n                this._focusedItem = undefined;\n            }\n            this.editor.setAriaOptions({ activeDescendant: undefined });\n            return;\n        }\n        if (!this._completionModel) {\n            return;\n        }\n        const item = e.elements[0];\n        const index = e.indexes[0];\n        if (item !== this._focusedItem) {\n            (_a = this._currentSuggestionDetails) === null || _a === void 0 ? void 0 : _a.cancel();\n            this._currentSuggestionDetails = undefined;\n            this._focusedItem = item;\n            this._list.reveal(index);\n            this._currentSuggestionDetails = createCancelablePromise((token) => __awaiter(this, void 0, void 0, function* () {\n                const loading = disposableTimeout(() => {\n                    if (this._isDetailsVisible()) {\n                        this.showDetails(true);\n                    }\n                }, 250);\n                token.onCancellationRequested(() => loading.dispose());\n                const result = yield item.resolve(token);\n                loading.dispose();\n                return result;\n            }));\n            this._currentSuggestionDetails.then(() => {\n                if (index >= this._list.length || item !== this._list.element(index)) {\n                    return;\n                }\n                // item can have extra information, so re-render\n                this._ignoreFocusEvents = true;\n                this._list.splice(index, 1, [item]);\n                this._list.setFocus([index]);\n                this._ignoreFocusEvents = false;\n                if (this._isDetailsVisible()) {\n                    this.showDetails(false);\n                }\n                else {\n                    this.element.domNode.classList.remove('docs-side');\n                }\n                this.editor.setAriaOptions({ activeDescendant: getAriaId(index) });\n            }).catch(onUnexpectedError);\n        }\n        // emit an event\n        this._onDidFocus.fire({ item, index, model: this._completionModel });\n    }\n    _setState(state) {\n        if (this._state === state) {\n            return;\n        }\n        this._state = state;\n        this.element.domNode.classList.toggle('frozen', state === 4 /* Frozen */);\n        this.element.domNode.classList.remove('message');\n        switch (state) {\n            case 0 /* Hidden */:\n                dom.hide(this._messageElement, this._listElement, this._status.element);\n                this._details.hide(true);\n                this._status.hide();\n                this._contentWidget.hide();\n                this._ctxSuggestWidgetVisible.reset();\n                this._ctxSuggestWidgetMultipleSuggestions.reset();\n                this._showTimeout.cancel();\n                this.element.domNode.classList.remove('visible');\n                this._list.splice(0, this._list.length);\n                this._focusedItem = undefined;\n                this._cappedHeight = undefined;\n                this._explainMode = false;\n                break;\n            case 1 /* Loading */:\n                this.element.domNode.classList.add('message');\n                this._messageElement.textContent = SuggestWidget.LOADING_MESSAGE;\n                dom.hide(this._listElement, this._status.element);\n                dom.show(this._messageElement);\n                this._details.hide();\n                this._show();\n                this._focusedItem = undefined;\n                break;\n            case 2 /* Empty */:\n                this.element.domNode.classList.add('message');\n                this._messageElement.textContent = SuggestWidget.NO_SUGGESTIONS_MESSAGE;\n                dom.hide(this._listElement, this._status.element);\n                dom.show(this._messageElement);\n                this._details.hide();\n                this._show();\n                this._focusedItem = undefined;\n                break;\n            case 3 /* Open */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._show();\n                break;\n            case 4 /* Frozen */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._show();\n                break;\n            case 5 /* Details */:\n                dom.hide(this._messageElement);\n                dom.show(this._listElement, this._status.element);\n                this._details.show();\n                this._show();\n                break;\n        }\n    }\n    _show() {\n        this._status.show();\n        this._contentWidget.show();\n        this._layout(this._persistedSize.restore());\n        this._ctxSuggestWidgetVisible.set(true);\n        this._showTimeout.cancelAndSet(() => {\n            this.element.domNode.classList.add('visible');\n            this._onDidShow.fire(this);\n        }, 100);\n    }\n    showTriggered(auto, delay) {\n        if (this._state !== 0 /* Hidden */) {\n            return;\n        }\n        this._contentWidget.setPosition(this.editor.getPosition());\n        this._isAuto = !!auto;\n        if (!this._isAuto) {\n            this._loadingTimeout = disposableTimeout(() => this._setState(1 /* Loading */), delay);\n        }\n    }\n    showSuggestions(completionModel, selectionIndex, isFrozen, isAuto) {\n        var _a, _b;\n        this._contentWidget.setPosition(this.editor.getPosition());\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        (_b = this._currentSuggestionDetails) === null || _b === void 0 ? void 0 : _b.cancel();\n        this._currentSuggestionDetails = undefined;\n        if (this._completionModel !== completionModel) {\n            this._completionModel = completionModel;\n        }\n        if (isFrozen && this._state !== 2 /* Empty */ && this._state !== 0 /* Hidden */) {\n            this._setState(4 /* Frozen */);\n            return;\n        }\n        const visibleCount = this._completionModel.items.length;\n        const isEmpty = visibleCount === 0;\n        this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount > 1);\n        if (isEmpty) {\n            this._setState(isAuto ? 0 /* Hidden */ : 2 /* Empty */);\n            this._completionModel = undefined;\n            return;\n        }\n        this._focusedItem = undefined;\n        this._list.splice(0, this._list.length, this._completionModel.items);\n        this._setState(isFrozen ? 4 /* Frozen */ : 3 /* Open */);\n        this._list.reveal(selectionIndex, 0);\n        this._list.setFocus([selectionIndex]);\n        this._layout(this.element.size);\n        // Reset focus border\n        if (this._detailsBorderColor) {\n            this._details.widget.domNode.style.borderColor = this._detailsBorderColor;\n        }\n    }\n    selectNextPage() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 5 /* Details */:\n                this._details.widget.pageDown();\n                return true;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusNextPage();\n                return true;\n        }\n    }\n    selectNext() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusNext(1, true);\n                return true;\n        }\n    }\n    selectLast() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 5 /* Details */:\n                this._details.widget.scrollBottom();\n                return true;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusLast();\n                return true;\n        }\n    }\n    selectPreviousPage() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 5 /* Details */:\n                this._details.widget.pageUp();\n                return true;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusPreviousPage();\n                return true;\n        }\n    }\n    selectPrevious() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusPrevious(1, true);\n                return false;\n        }\n    }\n    selectFirst() {\n        switch (this._state) {\n            case 0 /* Hidden */:\n                return false;\n            case 5 /* Details */:\n                this._details.widget.scrollTop();\n                return true;\n            case 1 /* Loading */:\n                return !this._isAuto;\n            default:\n                this._list.focusFirst();\n                return true;\n        }\n    }\n    getFocusedItem() {\n        if (this._state !== 0 /* Hidden */\n            && this._state !== 2 /* Empty */\n            && this._state !== 1 /* Loading */\n            && this._completionModel) {\n            return {\n                item: this._list.getFocusedElements()[0],\n                index: this._list.getFocus()[0],\n                model: this._completionModel\n            };\n        }\n        return undefined;\n    }\n    toggleDetailsFocus() {\n        if (this._state === 5 /* Details */) {\n            this._setState(3 /* Open */);\n            if (this._detailsBorderColor) {\n                this._details.widget.domNode.style.borderColor = this._detailsBorderColor;\n            }\n        }\n        else if (this._state === 3 /* Open */ && this._isDetailsVisible()) {\n            this._setState(5 /* Details */);\n            if (this._detailsFocusBorderColor) {\n                this._details.widget.domNode.style.borderColor = this._detailsFocusBorderColor;\n            }\n        }\n    }\n    toggleDetails() {\n        if (this._isDetailsVisible()) {\n            // hide details widget\n            this._ctxSuggestWidgetDetailsVisible.set(false);\n            this._setDetailsVisible(false);\n            this._details.hide();\n            this.element.domNode.classList.remove('shows-details');\n        }\n        else if ((canExpandCompletionItem(this._list.getFocusedElements()[0]) || this._explainMode) && (this._state === 3 /* Open */ || this._state === 5 /* Details */ || this._state === 4 /* Frozen */)) {\n            // show details widget (iff possible)\n            this._ctxSuggestWidgetDetailsVisible.set(true);\n            this._setDetailsVisible(true);\n            this.showDetails(false);\n        }\n    }\n    showDetails(loading) {\n        this._details.show();\n        if (loading) {\n            this._details.widget.renderLoading();\n        }\n        else {\n            this._details.widget.renderItem(this._list.getFocusedElements()[0], this._explainMode);\n        }\n        this._positionDetails();\n        this.editor.focus();\n        this.element.domNode.classList.add('shows-details');\n    }\n    toggleExplainMode() {\n        if (this._list.getFocusedElements()[0]) {\n            this._explainMode = !this._explainMode;\n            if (!this._isDetailsVisible()) {\n                this.toggleDetails();\n            }\n            else {\n                this.showDetails(false);\n            }\n        }\n    }\n    resetPersistedSize() {\n        this._persistedSize.reset();\n    }\n    hideWidget() {\n        var _a;\n        (_a = this._loadingTimeout) === null || _a === void 0 ? void 0 : _a.dispose();\n        this._setState(0 /* Hidden */);\n        this._onDidHide.fire(this);\n        this.element.clearSashHoverState();\n        // ensure that a reasonable widget height is persisted so that\n        // accidential \"resize-to-single-items\" cases aren't happening\n        const dim = this._persistedSize.restore();\n        const minPersistedHeight = Math.ceil(this.getLayoutInfo().itemHeight * 4.3);\n        if (dim && dim.height < minPersistedHeight) {\n            this._persistedSize.store(dim.with(undefined, minPersistedHeight));\n        }\n    }\n    isFrozen() {\n        return this._state === 4 /* Frozen */;\n    }\n    _afterRender(position) {\n        if (position === null) {\n            if (this._isDetailsVisible()) {\n                this._details.hide(); //todo@jrieken soft-hide\n            }\n            return;\n        }\n        if (this._state === 2 /* Empty */ || this._state === 1 /* Loading */) {\n            // no special positioning when widget isn't showing list\n            return;\n        }\n        if (this._isDetailsVisible()) {\n            this._details.show();\n        }\n        this._positionDetails();\n    }\n    _layout(size) {\n        var _a, _b, _c;\n        if (!this.editor.hasModel()) {\n            return;\n        }\n        if (!this.editor.getDomNode()) {\n            // happens when running tests\n            return;\n        }\n        const bodyBox = dom.getClientArea(document.body);\n        const info = this.getLayoutInfo();\n        if (!size) {\n            size = info.defaultSize;\n        }\n        let height = size.height;\n        let width = size.width;\n        // status bar\n        this._status.element.style.lineHeight = `${info.itemHeight}px`;\n        if (this._state === 2 /* Empty */ || this._state === 1 /* Loading */) {\n            // showing a message only\n            height = info.itemHeight + info.borderHeight;\n            width = info.defaultSize.width / 2;\n            this.element.enableSashes(false, false, false, false);\n            this.element.minSize = this.element.maxSize = new dom.Dimension(width, height);\n            this._contentWidget.setPreference(2 /* BELOW */);\n        }\n        else {\n            // showing items\n            // width math\n            const maxWidth = bodyBox.width - info.borderHeight - 2 * info.horizontalPadding;\n            if (width > maxWidth) {\n                width = maxWidth;\n            }\n            const preferredWidth = this._completionModel ? this._completionModel.stats.pLabelLen * info.typicalHalfwidthCharacterWidth : width;\n            // height math\n            const fullHeight = info.statusBarHeight + this._list.contentHeight + info.borderHeight;\n            const minHeight = info.itemHeight + info.statusBarHeight;\n            const editorBox = dom.getDomNodePagePosition(this.editor.getDomNode());\n            const cursorBox = this.editor.getScrolledVisiblePosition(this.editor.getPosition());\n            const cursorBottom = editorBox.top + cursorBox.top + cursorBox.height;\n            const maxHeightBelow = Math.min(bodyBox.height - cursorBottom - info.verticalPadding, fullHeight);\n            const availableSpaceAbove = editorBox.top + cursorBox.top - info.verticalPadding;\n            const maxHeightAbove = Math.min(availableSpaceAbove, fullHeight);\n            let maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow) + info.borderHeight, fullHeight);\n            if (height === ((_a = this._cappedHeight) === null || _a === void 0 ? void 0 : _a.capped)) {\n                // Restore the old (wanted) height when the current\n                // height is capped to fit\n                height = this._cappedHeight.wanted;\n            }\n            if (height < minHeight) {\n                height = minHeight;\n            }\n            if (height > maxHeight) {\n                height = maxHeight;\n            }\n            const forceRenderingAboveRequiredSpace = 150;\n            if (height > maxHeightBelow || (this._forceRenderingAbove && availableSpaceAbove > forceRenderingAboveRequiredSpace)) {\n                this._contentWidget.setPreference(1 /* ABOVE */);\n                this.element.enableSashes(true, true, false, false);\n                maxHeight = maxHeightAbove;\n            }\n            else {\n                this._contentWidget.setPreference(2 /* BELOW */);\n                this.element.enableSashes(false, true, true, false);\n                maxHeight = maxHeightBelow;\n            }\n            this.element.preferredSize = new dom.Dimension(preferredWidth, info.defaultSize.height);\n            this.element.maxSize = new dom.Dimension(maxWidth, maxHeight);\n            this.element.minSize = new dom.Dimension(220, minHeight);\n            // Know when the height was capped to fit and remember\n            // the wanted height for later. This is required when going\n            // left to widen suggestions.\n            this._cappedHeight = height === fullHeight\n                ? { wanted: (_c = (_b = this._cappedHeight) === null || _b === void 0 ? void 0 : _b.wanted) !== null && _c !== void 0 ? _c : size.height, capped: height }\n                : undefined;\n        }\n        this._resize(width, height);\n    }\n    _resize(width, height) {\n        const { width: maxWidth, height: maxHeight } = this.element.maxSize;\n        width = Math.min(maxWidth, width);\n        height = Math.min(maxHeight, height);\n        const { statusBarHeight } = this.getLayoutInfo();\n        this._list.layout(height - statusBarHeight, width);\n        this._listElement.style.height = `${height - statusBarHeight}px`;\n        this.element.layout(height, width);\n        this._contentWidget.layout();\n        this._positionDetails();\n    }\n    _positionDetails() {\n        if (this._isDetailsVisible()) {\n            this._details.placeAtAnchor(this.element.domNode);\n        }\n    }\n    getLayoutInfo() {\n        const fontInfo = this.editor.getOption(43 /* fontInfo */);\n        const itemHeight = clamp(this.editor.getOption(107 /* suggestLineHeight */) || fontInfo.lineHeight, 8, 1000);\n        const statusBarHeight = !this.editor.getOption(105 /* suggest */).showStatusBar || this._state === 2 /* Empty */ || this._state === 1 /* Loading */ ? 0 : itemHeight;\n        const borderWidth = this._details.widget.borderWidth;\n        const borderHeight = 2 * borderWidth;\n        return {\n            itemHeight,\n            statusBarHeight,\n            borderWidth,\n            borderHeight,\n            typicalHalfwidthCharacterWidth: fontInfo.typicalHalfwidthCharacterWidth,\n            verticalPadding: 22,\n            horizontalPadding: 14,\n            defaultSize: new dom.Dimension(430, statusBarHeight + 12 * itemHeight + borderHeight)\n        };\n    }\n    _isDetailsVisible() {\n        return this._storageService.getBoolean('expandSuggestionDocs', 0 /* GLOBAL */, false);\n    }\n    _setDetailsVisible(value) {\n        this._storageService.store('expandSuggestionDocs', value, 0 /* GLOBAL */, 0 /* USER */);\n    }\n    forceRenderingAbove() {\n        if (!this._forceRenderingAbove) {\n            this._forceRenderingAbove = true;\n            this._layout(this._persistedSize.restore());\n        }\n    }\n    stopForceRenderingAbove() {\n        this._forceRenderingAbove = false;\n    }\n};\nSuggestWidget.LOADING_MESSAGE = nls.localize('suggestWidget.loading', \"Loading...\");\nSuggestWidget.NO_SUGGESTIONS_MESSAGE = nls.localize('suggestWidget.noSuggestions', \"No suggestions.\");\nSuggestWidget = __decorate([\n    __param(1, IStorageService),\n    __param(2, IContextKeyService),\n    __param(3, IThemeService),\n    __param(4, IInstantiationService)\n], SuggestWidget);\nexport { SuggestWidget };\nexport class SuggestContentWidget {\n    constructor(_widget, _editor) {\n        this._widget = _widget;\n        this._editor = _editor;\n        this.allowEditorOverflow = true;\n        this.suppressMouseDown = false;\n        this._preferenceLocked = false;\n        this._added = false;\n        this._hidden = false;\n    }\n    dispose() {\n        if (this._added) {\n            this._added = false;\n            this._editor.removeContentWidget(this);\n        }\n    }\n    getId() {\n        return 'editor.widget.suggestWidget';\n    }\n    getDomNode() {\n        return this._widget.element.domNode;\n    }\n    show() {\n        this._hidden = false;\n        if (!this._added) {\n            this._added = true;\n            this._editor.addContentWidget(this);\n        }\n    }\n    hide() {\n        if (!this._hidden) {\n            this._hidden = true;\n            this.layout();\n        }\n    }\n    layout() {\n        this._editor.layoutContentWidget(this);\n    }\n    getPosition() {\n        if (this._hidden || !this._position || !this._preference) {\n            return null;\n        }\n        return {\n            position: this._position,\n            preference: [this._preference]\n        };\n    }\n    beforeRender() {\n        const { height, width } = this._widget.element.size;\n        const { borderWidth, horizontalPadding } = this._widget.getLayoutInfo();\n        return new dom.Dimension(width + 2 * borderWidth + horizontalPadding, height + 2 * borderWidth);\n    }\n    afterRender(position) {\n        this._widget._afterRender(position);\n    }\n    setPreference(preference) {\n        if (!this._preferenceLocked) {\n            this._preference = preference;\n        }\n    }\n    lockPreference() {\n        this._preferenceLocked = true;\n    }\n    unlockPreference() {\n        this._preferenceLocked = false;\n    }\n    setPosition(position) {\n        this._position = position;\n    }\n}\nregisterThemingParticipant((theme, collector) => {\n    const matchHighlight = theme.getColor(editorSuggestWidgetHighlightForeground);\n    if (matchHighlight) {\n        collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row .monaco-highlighted-label .highlight { color: ${matchHighlight}; }`);\n    }\n    const matchHighlightFocus = theme.getColor(editorSuggestWidgetHighlightFocusForeground);\n    if (matchHighlight) {\n        collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused .monaco-highlighted-label .highlight { color: ${matchHighlightFocus}; }`);\n    }\n    const foreground = theme.getColor(editorSuggestWidgetForeground);\n    if (foreground) {\n        collector.addRule(`.monaco-editor .suggest-widget, .monaco-editor .suggest-details { color: ${foreground}; }`);\n    }\n    const selectedForeground = theme.getColor(editorSuggestWidgetSelectedForeground);\n    if (selectedForeground) {\n        collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused { color: ${selectedForeground}; }`);\n    }\n    const selectedIconForeground = theme.getColor(editorSuggestWidgetSelectedIconForeground);\n    if (selectedIconForeground) {\n        collector.addRule(`.monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused .codicon { color: ${selectedIconForeground}; }`);\n    }\n    const link = theme.getColor(textLinkForeground);\n    if (link) {\n        collector.addRule(`.monaco-editor .suggest-details a { color: ${link}; }`);\n    }\n    const linkHover = theme.getColor(textLinkActiveForeground);\n    if (linkHover) {\n        collector.addRule(`.monaco-editor .suggest-details a:hover { color: ${linkHover}; }`);\n    }\n    const codeBackground = theme.getColor(textCodeBlockBackground);\n    if (codeBackground) {\n        collector.addRule(`.monaco-editor .suggest-details code { background-color: ${codeBackground}; }`);\n    }\n});\n"]},"metadata":{},"sourceType":"module"}