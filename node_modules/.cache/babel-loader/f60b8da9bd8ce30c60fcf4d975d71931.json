{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { createCancelablePromise, Delayer, RunOnceScheduler } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { KeyChord } from '../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\nimport * as types from '../../../base/common/types.js';\nimport './folding.css';\nimport { StableEditorScrollState } from '../../browser/core/editorState.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerInstantiatedEditorAction } from '../../browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { FoldingRangeKind, FoldingRangeProviderRegistry } from '../../common/modes.js';\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\nimport { FoldingModel, getNextFoldLine, getParentFoldLine, getPreviousFoldLine, setCollapseStateAtLevel, setCollapseStateForMatchingLines, setCollapseStateForRest, setCollapseStateForType, setCollapseStateLevelsDown, setCollapseStateLevelsUp, setCollapseStateUp, toggleCollapseState } from './foldingModel.js';\nimport { HiddenRangeModel } from './hiddenRangeModel.js';\nimport { IndentRangeProvider } from './indentRangeProvider.js';\nimport { ID_INIT_PROVIDER, InitializingRangeProvider } from './intializingRangeProvider.js';\nimport * as nls from '../../../nls.js';\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { editorSelectionBackground, iconForeground, registerColor, transparent } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant, ThemeIcon } from '../../../platform/theme/common/themeService.js';\nimport { foldingCollapsedIcon, FoldingDecorationProvider, foldingExpandedIcon } from './foldingDecorations.js';\nimport { ID_SYNTAX_PROVIDER, SyntaxRangeProvider } from './syntaxRangeProvider.js';\nconst CONTEXT_FOLDING_ENABLED = new RawContextKey('foldingEnabled', false);\nlet FoldingController = class FoldingController extends Disposable {\n  constructor(editor, contextKeyService) {\n    super();\n    this.contextKeyService = contextKeyService;\n    this.localToDispose = this._register(new DisposableStore());\n    this.editor = editor;\n    const options = this.editor.getOptions();\n    this._isEnabled = options.get(37\n    /* folding */\n    );\n    this._useFoldingProviders = options.get(38\n    /* foldingStrategy */\n    ) !== 'indentation';\n    this._unfoldOnClickAfterEndOfLine = options.get(41\n    /* unfoldOnClickAfterEndOfLine */\n    );\n    this._restoringViewState = false;\n    this._currentModelHasFoldedImports = false;\n    this._foldingImportsByDefault = options.get(40\n    /* foldingImportsByDefault */\n    );\n    this.foldingModel = null;\n    this.hiddenRangeModel = null;\n    this.rangeProvider = null;\n    this.foldingRegionPromise = null;\n    this.foldingStateMemento = null;\n    this.foldingModelPromise = null;\n    this.updateScheduler = null;\n    this.cursorChangedScheduler = null;\n    this.mouseDownInfo = null;\n    this.foldingDecorationProvider = new FoldingDecorationProvider(editor);\n    this.foldingDecorationProvider.autoHideFoldingControls = options.get(98\n    /* showFoldingControls */\n    ) === 'mouseover';\n    this.foldingDecorationProvider.showFoldingHighlights = options.get(39\n    /* foldingHighlight */\n    );\n    this.foldingEnabled = CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService);\n    this.foldingEnabled.set(this._isEnabled);\n\n    this._register(this.editor.onDidChangeModel(() => this.onModelChanged()));\n\n    this._register(this.editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(37\n      /* folding */\n      )) {\n        this._isEnabled = this.editor.getOptions().get(37\n        /* folding */\n        );\n        this.foldingEnabled.set(this._isEnabled);\n        this.onModelChanged();\n      }\n\n      if (e.hasChanged(98\n      /* showFoldingControls */\n      ) || e.hasChanged(39\n      /* foldingHighlight */\n      )) {\n        const options = this.editor.getOptions();\n        this.foldingDecorationProvider.autoHideFoldingControls = options.get(98\n        /* showFoldingControls */\n        ) === 'mouseover';\n        this.foldingDecorationProvider.showFoldingHighlights = options.get(39\n        /* foldingHighlight */\n        );\n        this.onModelContentChanged();\n      }\n\n      if (e.hasChanged(38\n      /* foldingStrategy */\n      )) {\n        this._useFoldingProviders = this.editor.getOptions().get(38\n        /* foldingStrategy */\n        ) !== 'indentation';\n        this.onFoldingStrategyChanged();\n      }\n\n      if (e.hasChanged(41\n      /* unfoldOnClickAfterEndOfLine */\n      )) {\n        this._unfoldOnClickAfterEndOfLine = this.editor.getOptions().get(41\n        /* unfoldOnClickAfterEndOfLine */\n        );\n      }\n\n      if (e.hasChanged(40\n      /* foldingImportsByDefault */\n      )) {\n        this._foldingImportsByDefault = this.editor.getOptions().get(40\n        /* foldingImportsByDefault */\n        );\n      }\n    }));\n\n    this.onModelChanged();\n  }\n\n  static get(editor) {\n    return editor.getContribution(FoldingController.ID);\n  }\n  /**\n   * Store view state.\n   */\n\n\n  saveViewState() {\n    let model = this.editor.getModel();\n\n    if (!model || !this._isEnabled || model.isTooLargeForTokenization()) {\n      return {};\n    }\n\n    if (this.foldingModel) {\n      // disposed ?\n      let collapsedRegions = this.foldingModel.isInitialized ? this.foldingModel.getMemento() : this.hiddenRangeModel.getMemento();\n      let provider = this.rangeProvider ? this.rangeProvider.id : undefined;\n      return {\n        collapsedRegions,\n        lineCount: model.getLineCount(),\n        provider,\n        foldedImports: this._currentModelHasFoldedImports\n      };\n    }\n\n    return undefined;\n  }\n  /**\n   * Restore view state.\n   */\n\n\n  restoreViewState(state) {\n    let model = this.editor.getModel();\n\n    if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) {\n      return;\n    }\n\n    if (!state || state.lineCount !== model.getLineCount()) {\n      return;\n    }\n\n    this._currentModelHasFoldedImports = !!state.foldedImports;\n\n    if (!state.collapsedRegions) {\n      return;\n    }\n\n    if (state.provider === ID_SYNTAX_PROVIDER || state.provider === ID_INIT_PROVIDER) {\n      this.foldingStateMemento = state;\n    }\n\n    const collapsedRegions = state.collapsedRegions; // set the hidden ranges right away, before waiting for the folding model.\n\n    if (this.hiddenRangeModel.applyMemento(collapsedRegions)) {\n      const foldingModel = this.getFoldingModel();\n\n      if (foldingModel) {\n        foldingModel.then(foldingModel => {\n          if (foldingModel) {\n            this._restoringViewState = true;\n\n            try {\n              foldingModel.applyMemento(collapsedRegions);\n            } finally {\n              this._restoringViewState = false;\n            }\n          }\n        }).then(undefined, onUnexpectedError);\n      }\n    }\n  }\n\n  onModelChanged() {\n    this.localToDispose.clear();\n    let model = this.editor.getModel();\n\n    if (!this._isEnabled || !model || model.isTooLargeForTokenization()) {\n      // huge files get no view model, so they cannot support hidden areas\n      return;\n    }\n\n    this._currentModelHasFoldedImports = false;\n    this.foldingModel = new FoldingModel(model, this.foldingDecorationProvider);\n    this.localToDispose.add(this.foldingModel);\n    this.hiddenRangeModel = new HiddenRangeModel(this.foldingModel);\n    this.localToDispose.add(this.hiddenRangeModel);\n    this.localToDispose.add(this.hiddenRangeModel.onDidChange(hr => this.onHiddenRangesChanges(hr)));\n    this.updateScheduler = new Delayer(200);\n    this.cursorChangedScheduler = new RunOnceScheduler(() => this.revealCursor(), 200);\n    this.localToDispose.add(this.cursorChangedScheduler);\n    this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange(() => this.onFoldingStrategyChanged()));\n    this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(() => this.onFoldingStrategyChanged())); // covers model language changes as well\n\n    this.localToDispose.add(this.editor.onDidChangeModelContent(() => this.onModelContentChanged()));\n    this.localToDispose.add(this.editor.onDidChangeCursorPosition(() => this.onCursorPositionChanged()));\n    this.localToDispose.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n    this.localToDispose.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n    this.localToDispose.add({\n      dispose: () => {\n        if (this.foldingRegionPromise) {\n          this.foldingRegionPromise.cancel();\n          this.foldingRegionPromise = null;\n        }\n\n        if (this.updateScheduler) {\n          this.updateScheduler.cancel();\n        }\n\n        this.updateScheduler = null;\n        this.foldingModel = null;\n        this.foldingModelPromise = null;\n        this.hiddenRangeModel = null;\n        this.cursorChangedScheduler = null;\n        this.foldingStateMemento = null;\n\n        if (this.rangeProvider) {\n          this.rangeProvider.dispose();\n        }\n\n        this.rangeProvider = null;\n      }\n    });\n    this.onModelContentChanged();\n  }\n\n  onFoldingStrategyChanged() {\n    if (this.rangeProvider) {\n      this.rangeProvider.dispose();\n    }\n\n    this.rangeProvider = null;\n    this.onModelContentChanged();\n  }\n\n  getRangeProvider(editorModel) {\n    if (this.rangeProvider) {\n      return this.rangeProvider;\n    }\n\n    this.rangeProvider = new IndentRangeProvider(editorModel); // fallback\n\n    if (this._useFoldingProviders && this.foldingModel) {\n      let foldingProviders = FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);\n\n      if (foldingProviders.length === 0 && this.foldingStateMemento && this.foldingStateMemento.collapsedRegions) {\n        const rangeProvider = this.rangeProvider = new InitializingRangeProvider(editorModel, this.foldingStateMemento.collapsedRegions, () => {\n          // if after 30 the InitializingRangeProvider is still not replaced, force a refresh\n          this.foldingStateMemento = null;\n          this.onFoldingStrategyChanged();\n        }, 30000);\n        return rangeProvider; // keep memento in case there are still no foldingProviders on the next request.\n      } else if (foldingProviders.length > 0) {\n        this.rangeProvider = new SyntaxRangeProvider(editorModel, foldingProviders, () => this.onModelContentChanged());\n      }\n    }\n\n    this.foldingStateMemento = null;\n    return this.rangeProvider;\n  }\n\n  getFoldingModel() {\n    return this.foldingModelPromise;\n  }\n\n  onModelContentChanged() {\n    if (this.updateScheduler) {\n      if (this.foldingRegionPromise) {\n        this.foldingRegionPromise.cancel();\n        this.foldingRegionPromise = null;\n      }\n\n      this.foldingModelPromise = this.updateScheduler.trigger(() => {\n        const foldingModel = this.foldingModel;\n\n        if (!foldingModel) {\n          // null if editor has been disposed, or folding turned off\n          return null;\n        }\n\n        const provider = this.getRangeProvider(foldingModel.textModel);\n        let foldingRegionPromise = this.foldingRegionPromise = createCancelablePromise(token => provider.compute(token));\n        return foldingRegionPromise.then(foldingRanges => {\n          if (foldingRanges && foldingRegionPromise === this.foldingRegionPromise) {\n            // new request or cancelled in the meantime?\n            let scrollState;\n\n            if (this._foldingImportsByDefault && !this._currentModelHasFoldedImports) {\n              const hasChanges = foldingRanges.setCollapsedAllOfType(FoldingRangeKind.Imports.value, true);\n\n              if (hasChanges) {\n                scrollState = StableEditorScrollState.capture(this.editor);\n                this._currentModelHasFoldedImports = hasChanges;\n              }\n            } // some cursors might have moved into hidden regions, make sure they are in expanded regions\n\n\n            let selections = this.editor.getSelections();\n            let selectionLineNumbers = selections ? selections.map(s => s.startLineNumber) : [];\n            foldingModel.update(foldingRanges, selectionLineNumbers);\n\n            if (scrollState) {\n              scrollState.restore(this.editor);\n            }\n          }\n\n          return foldingModel;\n        });\n      }).then(undefined, err => {\n        onUnexpectedError(err);\n        return null;\n      });\n    }\n  }\n\n  onHiddenRangesChanges(hiddenRanges) {\n    if (this.hiddenRangeModel && hiddenRanges.length && !this._restoringViewState) {\n      let selections = this.editor.getSelections();\n\n      if (selections) {\n        if (this.hiddenRangeModel.adjustSelections(selections)) {\n          this.editor.setSelections(selections);\n        }\n      }\n    }\n\n    this.editor.setHiddenAreas(hiddenRanges);\n  }\n\n  onCursorPositionChanged() {\n    if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) {\n      this.cursorChangedScheduler.schedule();\n    }\n  }\n\n  revealCursor() {\n    const foldingModel = this.getFoldingModel();\n\n    if (!foldingModel) {\n      return;\n    }\n\n    foldingModel.then(foldingModel => {\n      if (foldingModel) {\n        let selections = this.editor.getSelections();\n\n        if (selections && selections.length > 0) {\n          let toToggle = [];\n\n          for (let selection of selections) {\n            let lineNumber = selection.selectionStartLineNumber;\n\n            if (this.hiddenRangeModel && this.hiddenRangeModel.isHidden(lineNumber)) {\n              toToggle.push(...foldingModel.getAllRegionsAtLine(lineNumber, r => r.isCollapsed && lineNumber > r.startLineNumber));\n            }\n          }\n\n          if (toToggle.length) {\n            foldingModel.toggleCollapseState(toToggle);\n            this.reveal(selections[0].getPosition());\n          }\n        }\n      }\n    }).then(undefined, onUnexpectedError);\n  }\n\n  onEditorMouseDown(e) {\n    this.mouseDownInfo = null;\n\n    if (!this.hiddenRangeModel || !e.target || !e.target.range) {\n      return;\n    }\n\n    if (!e.event.leftButton && !e.event.middleButton) {\n      return;\n    }\n\n    const range = e.target.range;\n    let iconClicked = false;\n\n    switch (e.target.type) {\n      case 4\n      /* GUTTER_LINE_DECORATIONS */\n      :\n        const data = e.target.detail;\n        const offsetLeftInGutter = e.target.element.offsetLeft;\n        const gutterOffsetX = data.offsetX - offsetLeftInGutter; // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n        // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff\n\n        if (gutterOffsetX < 5) {\n          // the whitespace between the border and the real folding icon border is 5px\n          return;\n        }\n\n        iconClicked = true;\n        break;\n\n      case 7\n      /* CONTENT_EMPTY */\n      :\n        {\n          if (this._unfoldOnClickAfterEndOfLine && this.hiddenRangeModel.hasRanges()) {\n            const data = e.target.detail;\n\n            if (!data.isAfterLines) {\n              break;\n            }\n          }\n\n          return;\n        }\n\n      case 6\n      /* CONTENT_TEXT */\n      :\n        {\n          if (this.hiddenRangeModel.hasRanges()) {\n            let model = this.editor.getModel();\n\n            if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) {\n              break;\n            }\n          }\n\n          return;\n        }\n\n      default:\n        return;\n    }\n\n    this.mouseDownInfo = {\n      lineNumber: range.startLineNumber,\n      iconClicked\n    };\n  }\n\n  onEditorMouseUp(e) {\n    const foldingModel = this.getFoldingModel();\n\n    if (!foldingModel || !this.mouseDownInfo || !e.target) {\n      return;\n    }\n\n    let lineNumber = this.mouseDownInfo.lineNumber;\n    let iconClicked = this.mouseDownInfo.iconClicked;\n    let range = e.target.range;\n\n    if (!range || range.startLineNumber !== lineNumber) {\n      return;\n    }\n\n    if (iconClicked) {\n      if (e.target.type !== 4\n      /* GUTTER_LINE_DECORATIONS */\n      ) {\n        return;\n      }\n    } else {\n      let model = this.editor.getModel();\n\n      if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) {\n        return;\n      }\n    }\n\n    foldingModel.then(foldingModel => {\n      if (foldingModel) {\n        let region = foldingModel.getRegionAtLine(lineNumber);\n\n        if (region && region.startLineNumber === lineNumber) {\n          let isCollapsed = region.isCollapsed;\n\n          if (iconClicked || isCollapsed) {\n            let surrounding = e.event.altKey;\n            let toToggle = [];\n\n            if (surrounding) {\n              let filter = otherRegion => !otherRegion.containedBy(region) && !region.containedBy(otherRegion);\n\n              let toMaybeToggle = foldingModel.getRegionsInside(null, filter);\n\n              for (const r of toMaybeToggle) {\n                if (r.isCollapsed) {\n                  toToggle.push(r);\n                }\n              } // if any surrounding regions are folded, unfold those. Otherwise, fold all surrounding\n\n\n              if (toToggle.length === 0) {\n                toToggle = toMaybeToggle;\n              }\n            } else {\n              let recursive = e.event.middleButton || e.event.shiftKey;\n\n              if (recursive) {\n                for (const r of foldingModel.getRegionsInside(region)) {\n                  if (r.isCollapsed === isCollapsed) {\n                    toToggle.push(r);\n                  }\n                }\n              } // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.\n\n\n              if (isCollapsed || !recursive || toToggle.length === 0) {\n                toToggle.push(region);\n              }\n            }\n\n            foldingModel.toggleCollapseState(toToggle);\n            this.reveal({\n              lineNumber,\n              column: 1\n            });\n          }\n        }\n      }\n    }).then(undefined, onUnexpectedError);\n  }\n\n  reveal(position) {\n    this.editor.revealPositionInCenterIfOutsideViewport(position, 0\n    /* Smooth */\n    );\n  }\n\n};\nFoldingController.ID = 'editor.contrib.folding';\nFoldingController = __decorate([__param(1, IContextKeyService)], FoldingController);\nexport { FoldingController };\n\nclass FoldingAction extends EditorAction {\n  runEditorCommand(accessor, editor, args) {\n    let foldingController = FoldingController.get(editor);\n\n    if (!foldingController) {\n      return;\n    }\n\n    let foldingModelPromise = foldingController.getFoldingModel();\n\n    if (foldingModelPromise) {\n      this.reportTelemetry(accessor, editor);\n      return foldingModelPromise.then(foldingModel => {\n        if (foldingModel) {\n          this.invoke(foldingController, foldingModel, editor, args);\n          const selection = editor.getSelection();\n\n          if (selection) {\n            foldingController.reveal(selection.getStartPosition());\n          }\n        }\n      });\n    }\n  }\n\n  getSelectedLines(editor) {\n    let selections = editor.getSelections();\n    return selections ? selections.map(s => s.startLineNumber) : [];\n  }\n\n  getLineNumbers(args, editor) {\n    if (args && args.selectionLines) {\n      return args.selectionLines.map(l => l + 1); // to 0-bases line numbers\n    }\n\n    return this.getSelectedLines(editor);\n  }\n\n  run(_accessor, _editor) {}\n\n}\n\nfunction foldingArgumentsConstraint(args) {\n  if (!types.isUndefined(args)) {\n    if (!types.isObject(args)) {\n      return false;\n    }\n\n    const foldingArgs = args;\n\n    if (!types.isUndefined(foldingArgs.levels) && !types.isNumber(foldingArgs.levels)) {\n      return false;\n    }\n\n    if (!types.isUndefined(foldingArgs.direction) && !types.isString(foldingArgs.direction)) {\n      return false;\n    }\n\n    if (!types.isUndefined(foldingArgs.selectionLines) && (!types.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every(types.isNumber))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nclass UnfoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.unfold',\n      label: nls.localize('unfoldAction.label', \"Unfold\"),\n      alias: 'Unfold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 89\n        /* BracketRight */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 512\n          /* Alt */\n          | 89\n          /* BracketRight */\n\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      description: {\n        description: 'Unfold the content in the editor',\n        args: [{\n          name: 'Unfold editor argument',\n          description: `Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\n\t\t\t\t\t\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\n\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t`,\n          constraint: foldingArgumentsConstraint,\n          schema: {\n            'type': 'object',\n            'properties': {\n              'levels': {\n                'type': 'number',\n                'default': 1\n              },\n              'direction': {\n                'type': 'string',\n                'enum': ['up', 'down'],\n                'default': 'down'\n              },\n              'selectionLines': {\n                'type': 'array',\n                'items': {\n                  'type': 'number'\n                }\n              }\n            }\n          }\n        }]\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor, args) {\n    let levels = args && args.levels || 1;\n    let lineNumbers = this.getLineNumbers(args, editor);\n\n    if (args && args.direction === 'up') {\n      setCollapseStateLevelsUp(foldingModel, false, levels, lineNumbers);\n    } else {\n      setCollapseStateLevelsDown(foldingModel, false, levels, lineNumbers);\n    }\n  }\n\n}\n\nclass UnFoldRecursivelyAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.unfoldRecursively',\n      label: nls.localize('unFoldRecursivelyAction.label', \"Unfold Recursively\"),\n      alias: 'Unfold Recursively',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 89\n        /* BracketRight */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor, _args) {\n    setCollapseStateLevelsDown(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));\n  }\n\n}\n\nclass FoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.fold',\n      label: nls.localize('foldAction.label', \"Fold\"),\n      alias: 'Fold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 2048\n        /* CtrlCmd */\n        | 1024\n        /* Shift */\n        | 87\n        /* BracketLeft */\n        ,\n        mac: {\n          primary: 2048\n          /* CtrlCmd */\n          | 512\n          /* Alt */\n          | 87\n          /* BracketLeft */\n\n        },\n        weight: 100\n        /* EditorContrib */\n\n      },\n      description: {\n        description: 'Fold the content in the editor',\n        args: [{\n          name: 'Fold editor argument',\n          description: `Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t\t* 'levels': Number of levels to fold.\n\t\t\t\t\t\t\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\n\t\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\n\t\t\t\t\t\t`,\n          constraint: foldingArgumentsConstraint,\n          schema: {\n            'type': 'object',\n            'properties': {\n              'levels': {\n                'type': 'number'\n              },\n              'direction': {\n                'type': 'string',\n                'enum': ['up', 'down']\n              },\n              'selectionLines': {\n                'type': 'array',\n                'items': {\n                  'type': 'number'\n                }\n              }\n            }\n          }\n        }]\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor, args) {\n    let lineNumbers = this.getLineNumbers(args, editor);\n    const levels = args && args.levels;\n    const direction = args && args.direction;\n\n    if (typeof levels !== 'number' && typeof direction !== 'string') {\n      // fold the region at the location or if already collapsed, the first uncollapsed parent instead.\n      setCollapseStateUp(foldingModel, true, lineNumbers);\n    } else {\n      if (direction === 'up') {\n        setCollapseStateLevelsUp(foldingModel, true, levels || 1, lineNumbers);\n      } else {\n        setCollapseStateLevelsDown(foldingModel, true, levels || 1, lineNumbers);\n      }\n    }\n  }\n\n}\n\nclass ToggleFoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.toggleFold',\n      label: nls.localize('toggleFoldAction.label', \"Toggle Fold\"),\n      alias: 'Toggle Fold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 42\n        /* KeyL */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n    toggleCollapseState(foldingModel, 1, selectedLines);\n  }\n\n}\n\nclass FoldRecursivelyAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.foldRecursively',\n      label: nls.localize('foldRecursivelyAction.label', \"Fold Recursively\"),\n      alias: 'Fold Recursively',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 87\n        /* BracketLeft */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n    setCollapseStateLevelsDown(foldingModel, true, Number.MAX_VALUE, selectedLines);\n  }\n\n}\n\nclass FoldAllBlockCommentsAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.foldAllBlockComments',\n      label: nls.localize('foldAllBlockComments.label', \"Fold All Block Comments\"),\n      alias: 'Fold All Block Comments',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 85\n        /* Slash */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Comment.value, true);\n    } else {\n      const editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      const comments = LanguageConfigurationRegistry.getComments(editorModel.getLanguageId());\n\n      if (comments && comments.blockCommentStartToken) {\n        let regExp = new RegExp('^\\\\s*' + escapeRegExpCharacters(comments.blockCommentStartToken));\n        setCollapseStateForMatchingLines(foldingModel, regExp, true);\n      }\n    }\n  }\n\n}\n\nclass FoldAllRegionsAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.foldAllMarkerRegions',\n      label: nls.localize('foldAllMarkerRegions.label', \"Fold All Regions\"),\n      alias: 'Fold All Regions',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 29\n        /* Digit8 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, true);\n    } else {\n      const editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      const foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageId());\n\n      if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n        let regExp = new RegExp(foldingRules.markers.start);\n        setCollapseStateForMatchingLines(foldingModel, regExp, true);\n      }\n    }\n  }\n\n}\n\nclass UnfoldAllRegionsAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.unfoldAllMarkerRegions',\n      label: nls.localize('unfoldAllMarkerRegions.label', \"Unfold All Regions\"),\n      alias: 'Unfold All Regions',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 30\n        /* Digit9 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    if (foldingModel.regions.hasTypes()) {\n      setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, false);\n    } else {\n      const editorModel = editor.getModel();\n\n      if (!editorModel) {\n        return;\n      }\n\n      const foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageId());\n\n      if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n        let regExp = new RegExp(foldingRules.markers.start);\n        setCollapseStateForMatchingLines(foldingModel, regExp, false);\n      }\n    }\n  }\n\n}\n\nclass FoldAllRegionsExceptAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.foldAllExcept',\n      label: nls.localize('foldAllExcept.label', \"Fold All Regions Except Selected\"),\n      alias: 'Fold All Regions Except Selected',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 83\n        /* Minus */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n    setCollapseStateForRest(foldingModel, true, selectedLines);\n  }\n\n}\n\nclass UnfoldAllRegionsExceptAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.unfoldAllExcept',\n      label: nls.localize('unfoldAllExcept.label', \"Unfold All Regions Except Selected\"),\n      alias: 'Unfold All Regions Except Selected',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 81\n        /* Equal */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n    setCollapseStateForRest(foldingModel, false, selectedLines);\n  }\n\n}\n\nclass FoldAllAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.foldAll',\n      label: nls.localize('foldAllAction.label', \"Fold All\"),\n      alias: 'Fold All',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 21\n        /* Digit0 */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, _editor) {\n    setCollapseStateLevelsDown(foldingModel, true);\n  }\n\n}\n\nclass UnfoldAllAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.unfoldAll',\n      label: nls.localize('unfoldAllAction.label', \"Unfold All\"),\n      alias: 'Unfold All',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: KeyChord(2048\n        /* CtrlCmd */\n        | 41\n        /* KeyK */\n        , 2048\n        /* CtrlCmd */\n        | 40\n        /* KeyJ */\n        ),\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, _editor) {\n    setCollapseStateLevelsDown(foldingModel, false);\n  }\n\n}\n\nclass FoldLevelAction extends FoldingAction {\n  getFoldingLevel() {\n    return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length));\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    setCollapseStateAtLevel(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));\n  }\n\n}\n\nFoldLevelAction.ID_PREFIX = 'editor.foldLevel';\n\nFoldLevelAction.ID = level => FoldLevelAction.ID_PREFIX + level;\n/** Action to go to the parent fold of current line */\n\n\nclass GotoParentFoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.gotoParentFold',\n      label: nls.localize('gotoParentFold.label', \"Go to Parent Fold\"),\n      alias: 'Go to Parent Fold',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n\n    if (selectedLines.length > 0) {\n      let startLineNumber = getParentFoldLine(selectedLines[0], foldingModel);\n\n      if (startLineNumber !== null) {\n        editor.setSelection({\n          startLineNumber: startLineNumber,\n          startColumn: 1,\n          endLineNumber: startLineNumber,\n          endColumn: 1\n        });\n      }\n    }\n  }\n\n}\n/** Action to go to the previous fold of current line */\n\n\nclass GotoPreviousFoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.gotoPreviousFold',\n      label: nls.localize('gotoPreviousFold.label', \"Go to Previous Folding Range\"),\n      alias: 'Go to Previous Folding Range',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n\n    if (selectedLines.length > 0) {\n      let startLineNumber = getPreviousFoldLine(selectedLines[0], foldingModel);\n\n      if (startLineNumber !== null) {\n        editor.setSelection({\n          startLineNumber: startLineNumber,\n          startColumn: 1,\n          endLineNumber: startLineNumber,\n          endColumn: 1\n        });\n      }\n    }\n  }\n\n}\n/** Action to go to the next fold of current line */\n\n\nclass GotoNextFoldAction extends FoldingAction {\n  constructor() {\n    super({\n      id: 'editor.gotoNextFold',\n      label: nls.localize('gotoNextFold.label', \"Go to Next Folding Range\"),\n      alias: 'Go to Next Folding Range',\n      precondition: CONTEXT_FOLDING_ENABLED,\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        weight: 100\n        /* EditorContrib */\n\n      }\n    });\n  }\n\n  invoke(_foldingController, foldingModel, editor) {\n    let selectedLines = this.getSelectedLines(editor);\n\n    if (selectedLines.length > 0) {\n      let startLineNumber = getNextFoldLine(selectedLines[0], foldingModel);\n\n      if (startLineNumber !== null) {\n        editor.setSelection({\n          startLineNumber: startLineNumber,\n          startColumn: 1,\n          endLineNumber: startLineNumber,\n          endColumn: 1\n        });\n      }\n    }\n  }\n\n}\n\nregisterEditorContribution(FoldingController.ID, FoldingController);\nregisterEditorAction(UnfoldAction);\nregisterEditorAction(UnFoldRecursivelyAction);\nregisterEditorAction(FoldAction);\nregisterEditorAction(FoldRecursivelyAction);\nregisterEditorAction(FoldAllAction);\nregisterEditorAction(UnfoldAllAction);\nregisterEditorAction(FoldAllBlockCommentsAction);\nregisterEditorAction(FoldAllRegionsAction);\nregisterEditorAction(UnfoldAllRegionsAction);\nregisterEditorAction(FoldAllRegionsExceptAction);\nregisterEditorAction(UnfoldAllRegionsExceptAction);\nregisterEditorAction(ToggleFoldAction);\nregisterEditorAction(GotoParentFoldAction);\nregisterEditorAction(GotoPreviousFoldAction);\nregisterEditorAction(GotoNextFoldAction);\n\nfor (let i = 1; i <= 7; i++) {\n  registerInstantiatedEditorAction(new FoldLevelAction({\n    id: FoldLevelAction.ID(i),\n    label: nls.localize('foldLevelAction.label', \"Fold Level {0}\", i),\n    alias: `Fold Level ${i}`,\n    precondition: CONTEXT_FOLDING_ENABLED,\n    kbOpts: {\n      kbExpr: EditorContextKeys.editorTextFocus,\n      primary: KeyChord(2048\n      /* CtrlCmd */\n      | 41\n      /* KeyK */\n      , 2048\n      /* CtrlCmd */\n      | 21\n      /* Digit0 */\n      + i),\n      weight: 100\n      /* EditorContrib */\n\n    }\n  }));\n}\n\nexport const foldBackgroundBackground = registerColor('editor.foldBackground', {\n  light: transparent(editorSelectionBackground, 0.3),\n  dark: transparent(editorSelectionBackground, 0.3),\n  hc: null\n}, nls.localize('foldBackgroundBackground', \"Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations.\"), true);\nexport const editorFoldForeground = registerColor('editorGutter.foldingControlForeground', {\n  dark: iconForeground,\n  light: iconForeground,\n  hc: iconForeground\n}, nls.localize('editorGutter.foldingControlForeground', 'Color of the folding control in the editor gutter.'));\nregisterThemingParticipant((theme, collector) => {\n  const foldBackground = theme.getColor(foldBackgroundBackground);\n\n  if (foldBackground) {\n    collector.addRule(`.monaco-editor .folded-background { background-color: ${foldBackground}; }`);\n  }\n\n  const editorFoldColor = theme.getColor(editorFoldForeground);\n\n  if (editorFoldColor) {\n    collector.addRule(`\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingExpandedIcon)},\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingCollapsedIcon)} {\n\t\t\tcolor: ${editorFoldColor} !important;\n\t\t}\n\t\t`);\n  }\n});","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/folding/folding.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","createCancelablePromise","Delayer","RunOnceScheduler","onUnexpectedError","KeyChord","Disposable","DisposableStore","escapeRegExpCharacters","types","StableEditorScrollState","EditorAction","registerEditorAction","registerEditorContribution","registerInstantiatedEditorAction","EditorContextKeys","FoldingRangeKind","FoldingRangeProviderRegistry","LanguageConfigurationRegistry","FoldingModel","getNextFoldLine","getParentFoldLine","getPreviousFoldLine","setCollapseStateAtLevel","setCollapseStateForMatchingLines","setCollapseStateForRest","setCollapseStateForType","setCollapseStateLevelsDown","setCollapseStateLevelsUp","setCollapseStateUp","toggleCollapseState","HiddenRangeModel","IndentRangeProvider","ID_INIT_PROVIDER","InitializingRangeProvider","nls","IContextKeyService","RawContextKey","editorSelectionBackground","iconForeground","registerColor","transparent","registerThemingParticipant","ThemeIcon","foldingCollapsedIcon","FoldingDecorationProvider","foldingExpandedIcon","ID_SYNTAX_PROVIDER","SyntaxRangeProvider","CONTEXT_FOLDING_ENABLED","FoldingController","constructor","editor","contextKeyService","localToDispose","_register","options","getOptions","_isEnabled","get","_useFoldingProviders","_unfoldOnClickAfterEndOfLine","_restoringViewState","_currentModelHasFoldedImports","_foldingImportsByDefault","foldingModel","hiddenRangeModel","rangeProvider","foldingRegionPromise","foldingStateMemento","foldingModelPromise","updateScheduler","cursorChangedScheduler","mouseDownInfo","foldingDecorationProvider","autoHideFoldingControls","showFoldingHighlights","foldingEnabled","bindTo","set","onDidChangeModel","onModelChanged","onDidChangeConfiguration","e","hasChanged","onModelContentChanged","onFoldingStrategyChanged","getContribution","ID","saveViewState","model","getModel","isTooLargeForTokenization","collapsedRegions","isInitialized","getMemento","provider","id","undefined","lineCount","getLineCount","foldedImports","restoreViewState","state","applyMemento","getFoldingModel","then","clear","add","onDidChange","hr","onHiddenRangesChanges","revealCursor","onDidChangeModelLanguageConfiguration","onDidChangeModelContent","onDidChangeCursorPosition","onCursorPositionChanged","onMouseDown","onEditorMouseDown","onMouseUp","onEditorMouseUp","dispose","cancel","getRangeProvider","editorModel","foldingProviders","ordered","textModel","trigger","token","compute","foldingRanges","scrollState","hasChanges","setCollapsedAllOfType","Imports","value","capture","selections","getSelections","selectionLineNumbers","map","s","startLineNumber","update","restore","err","hiddenRanges","adjustSelections","setSelections","setHiddenAreas","hasRanges","schedule","toToggle","selection","lineNumber","selectionStartLineNumber","isHidden","push","getAllRegionsAtLine","isCollapsed","reveal","getPosition","range","event","leftButton","middleButton","iconClicked","type","data","detail","offsetLeftInGutter","element","offsetLeft","gutterOffsetX","offsetX","isAfterLines","startColumn","getLineMaxColumn","region","getRegionAtLine","surrounding","altKey","filter","otherRegion","containedBy","toMaybeToggle","getRegionsInside","recursive","shiftKey","column","position","revealPositionInCenterIfOutsideViewport","FoldingAction","runEditorCommand","accessor","args","foldingController","reportTelemetry","invoke","getSelection","getStartPosition","getSelectedLines","getLineNumbers","selectionLines","l","run","_accessor","_editor","foldingArgumentsConstraint","isUndefined","isObject","foldingArgs","levels","isNumber","direction","isString","isArray","every","UnfoldAction","label","localize","alias","precondition","kbOpts","kbExpr","editorTextFocus","primary","mac","weight","description","name","constraint","schema","_foldingController","lineNumbers","UnFoldRecursivelyAction","_args","Number","MAX_VALUE","FoldAction","ToggleFoldAction","selectedLines","FoldRecursivelyAction","FoldAllBlockCommentsAction","regions","hasTypes","Comment","comments","getComments","getLanguageId","blockCommentStartToken","regExp","RegExp","FoldAllRegionsAction","Region","foldingRules","getFoldingRules","markers","start","UnfoldAllRegionsAction","FoldAllRegionsExceptAction","UnfoldAllRegionsExceptAction","FoldAllAction","UnfoldAllAction","FoldLevelAction","getFoldingLevel","parseInt","substr","ID_PREFIX","level","GotoParentFoldAction","setSelection","endLineNumber","endColumn","GotoPreviousFoldAction","GotoNextFoldAction","foldBackgroundBackground","light","dark","hc","editorFoldForeground","theme","collector","foldBackground","getColor","addRule","editorFoldColor","asCSSSelector"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { createCancelablePromise, Delayer, RunOnceScheduler } from '../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { KeyChord } from '../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\nimport { escapeRegExpCharacters } from '../../../base/common/strings.js';\nimport * as types from '../../../base/common/types.js';\nimport './folding.css';\nimport { StableEditorScrollState } from '../../browser/core/editorState.js';\nimport { EditorAction, registerEditorAction, registerEditorContribution, registerInstantiatedEditorAction } from '../../browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { FoldingRangeKind, FoldingRangeProviderRegistry } from '../../common/modes.js';\nimport { LanguageConfigurationRegistry } from '../../common/modes/languageConfigurationRegistry.js';\nimport { FoldingModel, getNextFoldLine, getParentFoldLine as getParentFoldLine, getPreviousFoldLine, setCollapseStateAtLevel, setCollapseStateForMatchingLines, setCollapseStateForRest, setCollapseStateForType, setCollapseStateLevelsDown, setCollapseStateLevelsUp, setCollapseStateUp, toggleCollapseState } from './foldingModel.js';\nimport { HiddenRangeModel } from './hiddenRangeModel.js';\nimport { IndentRangeProvider } from './indentRangeProvider.js';\nimport { ID_INIT_PROVIDER, InitializingRangeProvider } from './intializingRangeProvider.js';\nimport * as nls from '../../../nls.js';\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { editorSelectionBackground, iconForeground, registerColor, transparent } from '../../../platform/theme/common/colorRegistry.js';\nimport { registerThemingParticipant, ThemeIcon } from '../../../platform/theme/common/themeService.js';\nimport { foldingCollapsedIcon, FoldingDecorationProvider, foldingExpandedIcon } from './foldingDecorations.js';\nimport { ID_SYNTAX_PROVIDER, SyntaxRangeProvider } from './syntaxRangeProvider.js';\nconst CONTEXT_FOLDING_ENABLED = new RawContextKey('foldingEnabled', false);\nlet FoldingController = class FoldingController extends Disposable {\n    constructor(editor, contextKeyService) {\n        super();\n        this.contextKeyService = contextKeyService;\n        this.localToDispose = this._register(new DisposableStore());\n        this.editor = editor;\n        const options = this.editor.getOptions();\n        this._isEnabled = options.get(37 /* folding */);\n        this._useFoldingProviders = options.get(38 /* foldingStrategy */) !== 'indentation';\n        this._unfoldOnClickAfterEndOfLine = options.get(41 /* unfoldOnClickAfterEndOfLine */);\n        this._restoringViewState = false;\n        this._currentModelHasFoldedImports = false;\n        this._foldingImportsByDefault = options.get(40 /* foldingImportsByDefault */);\n        this.foldingModel = null;\n        this.hiddenRangeModel = null;\n        this.rangeProvider = null;\n        this.foldingRegionPromise = null;\n        this.foldingStateMemento = null;\n        this.foldingModelPromise = null;\n        this.updateScheduler = null;\n        this.cursorChangedScheduler = null;\n        this.mouseDownInfo = null;\n        this.foldingDecorationProvider = new FoldingDecorationProvider(editor);\n        this.foldingDecorationProvider.autoHideFoldingControls = options.get(98 /* showFoldingControls */) === 'mouseover';\n        this.foldingDecorationProvider.showFoldingHighlights = options.get(39 /* foldingHighlight */);\n        this.foldingEnabled = CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService);\n        this.foldingEnabled.set(this._isEnabled);\n        this._register(this.editor.onDidChangeModel(() => this.onModelChanged()));\n        this._register(this.editor.onDidChangeConfiguration((e) => {\n            if (e.hasChanged(37 /* folding */)) {\n                this._isEnabled = this.editor.getOptions().get(37 /* folding */);\n                this.foldingEnabled.set(this._isEnabled);\n                this.onModelChanged();\n            }\n            if (e.hasChanged(98 /* showFoldingControls */) || e.hasChanged(39 /* foldingHighlight */)) {\n                const options = this.editor.getOptions();\n                this.foldingDecorationProvider.autoHideFoldingControls = options.get(98 /* showFoldingControls */) === 'mouseover';\n                this.foldingDecorationProvider.showFoldingHighlights = options.get(39 /* foldingHighlight */);\n                this.onModelContentChanged();\n            }\n            if (e.hasChanged(38 /* foldingStrategy */)) {\n                this._useFoldingProviders = this.editor.getOptions().get(38 /* foldingStrategy */) !== 'indentation';\n                this.onFoldingStrategyChanged();\n            }\n            if (e.hasChanged(41 /* unfoldOnClickAfterEndOfLine */)) {\n                this._unfoldOnClickAfterEndOfLine = this.editor.getOptions().get(41 /* unfoldOnClickAfterEndOfLine */);\n            }\n            if (e.hasChanged(40 /* foldingImportsByDefault */)) {\n                this._foldingImportsByDefault = this.editor.getOptions().get(40 /* foldingImportsByDefault */);\n            }\n        }));\n        this.onModelChanged();\n    }\n    static get(editor) {\n        return editor.getContribution(FoldingController.ID);\n    }\n    /**\n     * Store view state.\n     */\n    saveViewState() {\n        let model = this.editor.getModel();\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization()) {\n            return {};\n        }\n        if (this.foldingModel) { // disposed ?\n            let collapsedRegions = this.foldingModel.isInitialized ? this.foldingModel.getMemento() : this.hiddenRangeModel.getMemento();\n            let provider = this.rangeProvider ? this.rangeProvider.id : undefined;\n            return { collapsedRegions, lineCount: model.getLineCount(), provider, foldedImports: this._currentModelHasFoldedImports };\n        }\n        return undefined;\n    }\n    /**\n     * Restore view state.\n     */\n    restoreViewState(state) {\n        let model = this.editor.getModel();\n        if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) {\n            return;\n        }\n        if (!state || state.lineCount !== model.getLineCount()) {\n            return;\n        }\n        this._currentModelHasFoldedImports = !!state.foldedImports;\n        if (!state.collapsedRegions) {\n            return;\n        }\n        if (state.provider === ID_SYNTAX_PROVIDER || state.provider === ID_INIT_PROVIDER) {\n            this.foldingStateMemento = state;\n        }\n        const collapsedRegions = state.collapsedRegions;\n        // set the hidden ranges right away, before waiting for the folding model.\n        if (this.hiddenRangeModel.applyMemento(collapsedRegions)) {\n            const foldingModel = this.getFoldingModel();\n            if (foldingModel) {\n                foldingModel.then(foldingModel => {\n                    if (foldingModel) {\n                        this._restoringViewState = true;\n                        try {\n                            foldingModel.applyMemento(collapsedRegions);\n                        }\n                        finally {\n                            this._restoringViewState = false;\n                        }\n                    }\n                }).then(undefined, onUnexpectedError);\n            }\n        }\n    }\n    onModelChanged() {\n        this.localToDispose.clear();\n        let model = this.editor.getModel();\n        if (!this._isEnabled || !model || model.isTooLargeForTokenization()) {\n            // huge files get no view model, so they cannot support hidden areas\n            return;\n        }\n        this._currentModelHasFoldedImports = false;\n        this.foldingModel = new FoldingModel(model, this.foldingDecorationProvider);\n        this.localToDispose.add(this.foldingModel);\n        this.hiddenRangeModel = new HiddenRangeModel(this.foldingModel);\n        this.localToDispose.add(this.hiddenRangeModel);\n        this.localToDispose.add(this.hiddenRangeModel.onDidChange(hr => this.onHiddenRangesChanges(hr)));\n        this.updateScheduler = new Delayer(200);\n        this.cursorChangedScheduler = new RunOnceScheduler(() => this.revealCursor(), 200);\n        this.localToDispose.add(this.cursorChangedScheduler);\n        this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange(() => this.onFoldingStrategyChanged()));\n        this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(() => this.onFoldingStrategyChanged())); // covers model language changes as well\n        this.localToDispose.add(this.editor.onDidChangeModelContent(() => this.onModelContentChanged()));\n        this.localToDispose.add(this.editor.onDidChangeCursorPosition(() => this.onCursorPositionChanged()));\n        this.localToDispose.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n        this.localToDispose.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n        this.localToDispose.add({\n            dispose: () => {\n                if (this.foldingRegionPromise) {\n                    this.foldingRegionPromise.cancel();\n                    this.foldingRegionPromise = null;\n                }\n                if (this.updateScheduler) {\n                    this.updateScheduler.cancel();\n                }\n                this.updateScheduler = null;\n                this.foldingModel = null;\n                this.foldingModelPromise = null;\n                this.hiddenRangeModel = null;\n                this.cursorChangedScheduler = null;\n                this.foldingStateMemento = null;\n                if (this.rangeProvider) {\n                    this.rangeProvider.dispose();\n                }\n                this.rangeProvider = null;\n            }\n        });\n        this.onModelContentChanged();\n    }\n    onFoldingStrategyChanged() {\n        if (this.rangeProvider) {\n            this.rangeProvider.dispose();\n        }\n        this.rangeProvider = null;\n        this.onModelContentChanged();\n    }\n    getRangeProvider(editorModel) {\n        if (this.rangeProvider) {\n            return this.rangeProvider;\n        }\n        this.rangeProvider = new IndentRangeProvider(editorModel); // fallback\n        if (this._useFoldingProviders && this.foldingModel) {\n            let foldingProviders = FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);\n            if (foldingProviders.length === 0 && this.foldingStateMemento && this.foldingStateMemento.collapsedRegions) {\n                const rangeProvider = this.rangeProvider = new InitializingRangeProvider(editorModel, this.foldingStateMemento.collapsedRegions, () => {\n                    // if after 30 the InitializingRangeProvider is still not replaced, force a refresh\n                    this.foldingStateMemento = null;\n                    this.onFoldingStrategyChanged();\n                }, 30000);\n                return rangeProvider; // keep memento in case there are still no foldingProviders on the next request.\n            }\n            else if (foldingProviders.length > 0) {\n                this.rangeProvider = new SyntaxRangeProvider(editorModel, foldingProviders, () => this.onModelContentChanged());\n            }\n        }\n        this.foldingStateMemento = null;\n        return this.rangeProvider;\n    }\n    getFoldingModel() {\n        return this.foldingModelPromise;\n    }\n    onModelContentChanged() {\n        if (this.updateScheduler) {\n            if (this.foldingRegionPromise) {\n                this.foldingRegionPromise.cancel();\n                this.foldingRegionPromise = null;\n            }\n            this.foldingModelPromise = this.updateScheduler.trigger(() => {\n                const foldingModel = this.foldingModel;\n                if (!foldingModel) { // null if editor has been disposed, or folding turned off\n                    return null;\n                }\n                const provider = this.getRangeProvider(foldingModel.textModel);\n                let foldingRegionPromise = this.foldingRegionPromise = createCancelablePromise(token => provider.compute(token));\n                return foldingRegionPromise.then(foldingRanges => {\n                    if (foldingRanges && foldingRegionPromise === this.foldingRegionPromise) { // new request or cancelled in the meantime?\n                        let scrollState;\n                        if (this._foldingImportsByDefault && !this._currentModelHasFoldedImports) {\n                            const hasChanges = foldingRanges.setCollapsedAllOfType(FoldingRangeKind.Imports.value, true);\n                            if (hasChanges) {\n                                scrollState = StableEditorScrollState.capture(this.editor);\n                                this._currentModelHasFoldedImports = hasChanges;\n                            }\n                        }\n                        // some cursors might have moved into hidden regions, make sure they are in expanded regions\n                        let selections = this.editor.getSelections();\n                        let selectionLineNumbers = selections ? selections.map(s => s.startLineNumber) : [];\n                        foldingModel.update(foldingRanges, selectionLineNumbers);\n                        if (scrollState) {\n                            scrollState.restore(this.editor);\n                        }\n                    }\n                    return foldingModel;\n                });\n            }).then(undefined, (err) => {\n                onUnexpectedError(err);\n                return null;\n            });\n        }\n    }\n    onHiddenRangesChanges(hiddenRanges) {\n        if (this.hiddenRangeModel && hiddenRanges.length && !this._restoringViewState) {\n            let selections = this.editor.getSelections();\n            if (selections) {\n                if (this.hiddenRangeModel.adjustSelections(selections)) {\n                    this.editor.setSelections(selections);\n                }\n            }\n        }\n        this.editor.setHiddenAreas(hiddenRanges);\n    }\n    onCursorPositionChanged() {\n        if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) {\n            this.cursorChangedScheduler.schedule();\n        }\n    }\n    revealCursor() {\n        const foldingModel = this.getFoldingModel();\n        if (!foldingModel) {\n            return;\n        }\n        foldingModel.then(foldingModel => {\n            if (foldingModel) {\n                let selections = this.editor.getSelections();\n                if (selections && selections.length > 0) {\n                    let toToggle = [];\n                    for (let selection of selections) {\n                        let lineNumber = selection.selectionStartLineNumber;\n                        if (this.hiddenRangeModel && this.hiddenRangeModel.isHidden(lineNumber)) {\n                            toToggle.push(...foldingModel.getAllRegionsAtLine(lineNumber, r => r.isCollapsed && lineNumber > r.startLineNumber));\n                        }\n                    }\n                    if (toToggle.length) {\n                        foldingModel.toggleCollapseState(toToggle);\n                        this.reveal(selections[0].getPosition());\n                    }\n                }\n            }\n        }).then(undefined, onUnexpectedError);\n    }\n    onEditorMouseDown(e) {\n        this.mouseDownInfo = null;\n        if (!this.hiddenRangeModel || !e.target || !e.target.range) {\n            return;\n        }\n        if (!e.event.leftButton && !e.event.middleButton) {\n            return;\n        }\n        const range = e.target.range;\n        let iconClicked = false;\n        switch (e.target.type) {\n            case 4 /* GUTTER_LINE_DECORATIONS */:\n                const data = e.target.detail;\n                const offsetLeftInGutter = e.target.element.offsetLeft;\n                const gutterOffsetX = data.offsetX - offsetLeftInGutter;\n                // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;\n                // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff\n                if (gutterOffsetX < 5) { // the whitespace between the border and the real folding icon border is 5px\n                    return;\n                }\n                iconClicked = true;\n                break;\n            case 7 /* CONTENT_EMPTY */: {\n                if (this._unfoldOnClickAfterEndOfLine && this.hiddenRangeModel.hasRanges()) {\n                    const data = e.target.detail;\n                    if (!data.isAfterLines) {\n                        break;\n                    }\n                }\n                return;\n            }\n            case 6 /* CONTENT_TEXT */: {\n                if (this.hiddenRangeModel.hasRanges()) {\n                    let model = this.editor.getModel();\n                    if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) {\n                        break;\n                    }\n                }\n                return;\n            }\n            default:\n                return;\n        }\n        this.mouseDownInfo = { lineNumber: range.startLineNumber, iconClicked };\n    }\n    onEditorMouseUp(e) {\n        const foldingModel = this.getFoldingModel();\n        if (!foldingModel || !this.mouseDownInfo || !e.target) {\n            return;\n        }\n        let lineNumber = this.mouseDownInfo.lineNumber;\n        let iconClicked = this.mouseDownInfo.iconClicked;\n        let range = e.target.range;\n        if (!range || range.startLineNumber !== lineNumber) {\n            return;\n        }\n        if (iconClicked) {\n            if (e.target.type !== 4 /* GUTTER_LINE_DECORATIONS */) {\n                return;\n            }\n        }\n        else {\n            let model = this.editor.getModel();\n            if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) {\n                return;\n            }\n        }\n        foldingModel.then(foldingModel => {\n            if (foldingModel) {\n                let region = foldingModel.getRegionAtLine(lineNumber);\n                if (region && region.startLineNumber === lineNumber) {\n                    let isCollapsed = region.isCollapsed;\n                    if (iconClicked || isCollapsed) {\n                        let surrounding = e.event.altKey;\n                        let toToggle = [];\n                        if (surrounding) {\n                            let filter = (otherRegion) => !otherRegion.containedBy(region) && !region.containedBy(otherRegion);\n                            let toMaybeToggle = foldingModel.getRegionsInside(null, filter);\n                            for (const r of toMaybeToggle) {\n                                if (r.isCollapsed) {\n                                    toToggle.push(r);\n                                }\n                            }\n                            // if any surrounding regions are folded, unfold those. Otherwise, fold all surrounding\n                            if (toToggle.length === 0) {\n                                toToggle = toMaybeToggle;\n                            }\n                        }\n                        else {\n                            let recursive = e.event.middleButton || e.event.shiftKey;\n                            if (recursive) {\n                                for (const r of foldingModel.getRegionsInside(region)) {\n                                    if (r.isCollapsed === isCollapsed) {\n                                        toToggle.push(r);\n                                    }\n                                }\n                            }\n                            // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.\n                            if (isCollapsed || !recursive || toToggle.length === 0) {\n                                toToggle.push(region);\n                            }\n                        }\n                        foldingModel.toggleCollapseState(toToggle);\n                        this.reveal({ lineNumber, column: 1 });\n                    }\n                }\n            }\n        }).then(undefined, onUnexpectedError);\n    }\n    reveal(position) {\n        this.editor.revealPositionInCenterIfOutsideViewport(position, 0 /* Smooth */);\n    }\n};\nFoldingController.ID = 'editor.contrib.folding';\nFoldingController = __decorate([\n    __param(1, IContextKeyService)\n], FoldingController);\nexport { FoldingController };\nclass FoldingAction extends EditorAction {\n    runEditorCommand(accessor, editor, args) {\n        let foldingController = FoldingController.get(editor);\n        if (!foldingController) {\n            return;\n        }\n        let foldingModelPromise = foldingController.getFoldingModel();\n        if (foldingModelPromise) {\n            this.reportTelemetry(accessor, editor);\n            return foldingModelPromise.then(foldingModel => {\n                if (foldingModel) {\n                    this.invoke(foldingController, foldingModel, editor, args);\n                    const selection = editor.getSelection();\n                    if (selection) {\n                        foldingController.reveal(selection.getStartPosition());\n                    }\n                }\n            });\n        }\n    }\n    getSelectedLines(editor) {\n        let selections = editor.getSelections();\n        return selections ? selections.map(s => s.startLineNumber) : [];\n    }\n    getLineNumbers(args, editor) {\n        if (args && args.selectionLines) {\n            return args.selectionLines.map(l => l + 1); // to 0-bases line numbers\n        }\n        return this.getSelectedLines(editor);\n    }\n    run(_accessor, _editor) {\n    }\n}\nfunction foldingArgumentsConstraint(args) {\n    if (!types.isUndefined(args)) {\n        if (!types.isObject(args)) {\n            return false;\n        }\n        const foldingArgs = args;\n        if (!types.isUndefined(foldingArgs.levels) && !types.isNumber(foldingArgs.levels)) {\n            return false;\n        }\n        if (!types.isUndefined(foldingArgs.direction) && !types.isString(foldingArgs.direction)) {\n            return false;\n        }\n        if (!types.isUndefined(foldingArgs.selectionLines) && (!types.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every(types.isNumber))) {\n            return false;\n        }\n    }\n    return true;\n}\nclass UnfoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.unfold',\n            label: nls.localize('unfoldAction.label', \"Unfold\"),\n            alias: 'Unfold',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 89 /* BracketRight */,\n                mac: {\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 89 /* BracketRight */\n                },\n                weight: 100 /* EditorContrib */\n            },\n            description: {\n                description: 'Unfold the content in the editor',\n                args: [\n                    {\n                        name: 'Unfold editor argument',\n                        description: `Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\n\t\t\t\t\t\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\n\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t`,\n                        constraint: foldingArgumentsConstraint,\n                        schema: {\n                            'type': 'object',\n                            'properties': {\n                                'levels': {\n                                    'type': 'number',\n                                    'default': 1\n                                },\n                                'direction': {\n                                    'type': 'string',\n                                    'enum': ['up', 'down'],\n                                    'default': 'down'\n                                },\n                                'selectionLines': {\n                                    'type': 'array',\n                                    'items': {\n                                        'type': 'number'\n                                    }\n                                }\n                            }\n                        }\n                    }\n                ]\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor, args) {\n        let levels = args && args.levels || 1;\n        let lineNumbers = this.getLineNumbers(args, editor);\n        if (args && args.direction === 'up') {\n            setCollapseStateLevelsUp(foldingModel, false, levels, lineNumbers);\n        }\n        else {\n            setCollapseStateLevelsDown(foldingModel, false, levels, lineNumbers);\n        }\n    }\n}\nclass UnFoldRecursivelyAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.unfoldRecursively',\n            label: nls.localize('unFoldRecursivelyAction.label', \"Unfold Recursively\"),\n            alias: 'Unfold Recursively',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 89 /* BracketRight */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor, _args) {\n        setCollapseStateLevelsDown(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));\n    }\n}\nclass FoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.fold',\n            label: nls.localize('foldAction.label', \"Fold\"),\n            alias: 'Fold',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 2048 /* CtrlCmd */ | 1024 /* Shift */ | 87 /* BracketLeft */,\n                mac: {\n                    primary: 2048 /* CtrlCmd */ | 512 /* Alt */ | 87 /* BracketLeft */\n                },\n                weight: 100 /* EditorContrib */\n            },\n            description: {\n                description: 'Fold the content in the editor',\n                args: [\n                    {\n                        name: 'Fold editor argument',\n                        description: `Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t\t* 'levels': Number of levels to fold.\n\t\t\t\t\t\t\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\n\t\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\n\t\t\t\t\t\t`,\n                        constraint: foldingArgumentsConstraint,\n                        schema: {\n                            'type': 'object',\n                            'properties': {\n                                'levels': {\n                                    'type': 'number',\n                                },\n                                'direction': {\n                                    'type': 'string',\n                                    'enum': ['up', 'down'],\n                                },\n                                'selectionLines': {\n                                    'type': 'array',\n                                    'items': {\n                                        'type': 'number'\n                                    }\n                                }\n                            }\n                        }\n                    }\n                ]\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor, args) {\n        let lineNumbers = this.getLineNumbers(args, editor);\n        const levels = args && args.levels;\n        const direction = args && args.direction;\n        if (typeof levels !== 'number' && typeof direction !== 'string') {\n            // fold the region at the location or if already collapsed, the first uncollapsed parent instead.\n            setCollapseStateUp(foldingModel, true, lineNumbers);\n        }\n        else {\n            if (direction === 'up') {\n                setCollapseStateLevelsUp(foldingModel, true, levels || 1, lineNumbers);\n            }\n            else {\n                setCollapseStateLevelsDown(foldingModel, true, levels || 1, lineNumbers);\n            }\n        }\n    }\n}\nclass ToggleFoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.toggleFold',\n            label: nls.localize('toggleFoldAction.label', \"Toggle Fold\"),\n            alias: 'Toggle Fold',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 42 /* KeyL */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        toggleCollapseState(foldingModel, 1, selectedLines);\n    }\n}\nclass FoldRecursivelyAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.foldRecursively',\n            label: nls.localize('foldRecursivelyAction.label', \"Fold Recursively\"),\n            alias: 'Fold Recursively',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 87 /* BracketLeft */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        setCollapseStateLevelsDown(foldingModel, true, Number.MAX_VALUE, selectedLines);\n    }\n}\nclass FoldAllBlockCommentsAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.foldAllBlockComments',\n            label: nls.localize('foldAllBlockComments.label', \"Fold All Block Comments\"),\n            alias: 'Fold All Block Comments',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 85 /* Slash */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        if (foldingModel.regions.hasTypes()) {\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Comment.value, true);\n        }\n        else {\n            const editorModel = editor.getModel();\n            if (!editorModel) {\n                return;\n            }\n            const comments = LanguageConfigurationRegistry.getComments(editorModel.getLanguageId());\n            if (comments && comments.blockCommentStartToken) {\n                let regExp = new RegExp('^\\\\s*' + escapeRegExpCharacters(comments.blockCommentStartToken));\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\n            }\n        }\n    }\n}\nclass FoldAllRegionsAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.foldAllMarkerRegions',\n            label: nls.localize('foldAllMarkerRegions.label', \"Fold All Regions\"),\n            alias: 'Fold All Regions',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 29 /* Digit8 */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        if (foldingModel.regions.hasTypes()) {\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, true);\n        }\n        else {\n            const editorModel = editor.getModel();\n            if (!editorModel) {\n                return;\n            }\n            const foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageId());\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n                let regExp = new RegExp(foldingRules.markers.start);\n                setCollapseStateForMatchingLines(foldingModel, regExp, true);\n            }\n        }\n    }\n}\nclass UnfoldAllRegionsAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.unfoldAllMarkerRegions',\n            label: nls.localize('unfoldAllMarkerRegions.label', \"Unfold All Regions\"),\n            alias: 'Unfold All Regions',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 30 /* Digit9 */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        if (foldingModel.regions.hasTypes()) {\n            setCollapseStateForType(foldingModel, FoldingRangeKind.Region.value, false);\n        }\n        else {\n            const editorModel = editor.getModel();\n            if (!editorModel) {\n                return;\n            }\n            const foldingRules = LanguageConfigurationRegistry.getFoldingRules(editorModel.getLanguageId());\n            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {\n                let regExp = new RegExp(foldingRules.markers.start);\n                setCollapseStateForMatchingLines(foldingModel, regExp, false);\n            }\n        }\n    }\n}\nclass FoldAllRegionsExceptAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.foldAllExcept',\n            label: nls.localize('foldAllExcept.label', \"Fold All Regions Except Selected\"),\n            alias: 'Fold All Regions Except Selected',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 83 /* Minus */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        setCollapseStateForRest(foldingModel, true, selectedLines);\n    }\n}\nclass UnfoldAllRegionsExceptAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.unfoldAllExcept',\n            label: nls.localize('unfoldAllExcept.label', \"Unfold All Regions Except Selected\"),\n            alias: 'Unfold All Regions Except Selected',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 81 /* Equal */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        setCollapseStateForRest(foldingModel, false, selectedLines);\n    }\n}\nclass FoldAllAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.foldAll',\n            label: nls.localize('foldAllAction.label', \"Fold All\"),\n            alias: 'Fold All',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 21 /* Digit0 */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, _editor) {\n        setCollapseStateLevelsDown(foldingModel, true);\n    }\n}\nclass UnfoldAllAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.unfoldAll',\n            label: nls.localize('unfoldAllAction.label', \"Unfold All\"),\n            alias: 'Unfold All',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | 40 /* KeyJ */),\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, _editor) {\n        setCollapseStateLevelsDown(foldingModel, false);\n    }\n}\nclass FoldLevelAction extends FoldingAction {\n    getFoldingLevel() {\n        return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length));\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        setCollapseStateAtLevel(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));\n    }\n}\nFoldLevelAction.ID_PREFIX = 'editor.foldLevel';\nFoldLevelAction.ID = (level) => FoldLevelAction.ID_PREFIX + level;\n/** Action to go to the parent fold of current line */\nclass GotoParentFoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.gotoParentFold',\n            label: nls.localize('gotoParentFold.label', \"Go to Parent Fold\"),\n            alias: 'Go to Parent Fold',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        if (selectedLines.length > 0) {\n            let startLineNumber = getParentFoldLine(selectedLines[0], foldingModel);\n            if (startLineNumber !== null) {\n                editor.setSelection({\n                    startLineNumber: startLineNumber,\n                    startColumn: 1,\n                    endLineNumber: startLineNumber,\n                    endColumn: 1\n                });\n            }\n        }\n    }\n}\n/** Action to go to the previous fold of current line */\nclass GotoPreviousFoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.gotoPreviousFold',\n            label: nls.localize('gotoPreviousFold.label', \"Go to Previous Folding Range\"),\n            alias: 'Go to Previous Folding Range',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        if (selectedLines.length > 0) {\n            let startLineNumber = getPreviousFoldLine(selectedLines[0], foldingModel);\n            if (startLineNumber !== null) {\n                editor.setSelection({\n                    startLineNumber: startLineNumber,\n                    startColumn: 1,\n                    endLineNumber: startLineNumber,\n                    endColumn: 1\n                });\n            }\n        }\n    }\n}\n/** Action to go to the next fold of current line */\nclass GotoNextFoldAction extends FoldingAction {\n    constructor() {\n        super({\n            id: 'editor.gotoNextFold',\n            label: nls.localize('gotoNextFold.label', \"Go to Next Folding Range\"),\n            alias: 'Go to Next Folding Range',\n            precondition: CONTEXT_FOLDING_ENABLED,\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                weight: 100 /* EditorContrib */\n            }\n        });\n    }\n    invoke(_foldingController, foldingModel, editor) {\n        let selectedLines = this.getSelectedLines(editor);\n        if (selectedLines.length > 0) {\n            let startLineNumber = getNextFoldLine(selectedLines[0], foldingModel);\n            if (startLineNumber !== null) {\n                editor.setSelection({\n                    startLineNumber: startLineNumber,\n                    startColumn: 1,\n                    endLineNumber: startLineNumber,\n                    endColumn: 1\n                });\n            }\n        }\n    }\n}\nregisterEditorContribution(FoldingController.ID, FoldingController);\nregisterEditorAction(UnfoldAction);\nregisterEditorAction(UnFoldRecursivelyAction);\nregisterEditorAction(FoldAction);\nregisterEditorAction(FoldRecursivelyAction);\nregisterEditorAction(FoldAllAction);\nregisterEditorAction(UnfoldAllAction);\nregisterEditorAction(FoldAllBlockCommentsAction);\nregisterEditorAction(FoldAllRegionsAction);\nregisterEditorAction(UnfoldAllRegionsAction);\nregisterEditorAction(FoldAllRegionsExceptAction);\nregisterEditorAction(UnfoldAllRegionsExceptAction);\nregisterEditorAction(ToggleFoldAction);\nregisterEditorAction(GotoParentFoldAction);\nregisterEditorAction(GotoPreviousFoldAction);\nregisterEditorAction(GotoNextFoldAction);\nfor (let i = 1; i <= 7; i++) {\n    registerInstantiatedEditorAction(new FoldLevelAction({\n        id: FoldLevelAction.ID(i),\n        label: nls.localize('foldLevelAction.label', \"Fold Level {0}\", i),\n        alias: `Fold Level ${i}`,\n        precondition: CONTEXT_FOLDING_ENABLED,\n        kbOpts: {\n            kbExpr: EditorContextKeys.editorTextFocus,\n            primary: KeyChord(2048 /* CtrlCmd */ | 41 /* KeyK */, 2048 /* CtrlCmd */ | (21 /* Digit0 */ + i)),\n            weight: 100 /* EditorContrib */\n        }\n    }));\n}\nexport const foldBackgroundBackground = registerColor('editor.foldBackground', { light: transparent(editorSelectionBackground, 0.3), dark: transparent(editorSelectionBackground, 0.3), hc: null }, nls.localize('foldBackgroundBackground', \"Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations.\"), true);\nexport const editorFoldForeground = registerColor('editorGutter.foldingControlForeground', { dark: iconForeground, light: iconForeground, hc: iconForeground }, nls.localize('editorGutter.foldingControlForeground', 'Color of the folding control in the editor gutter.'));\nregisterThemingParticipant((theme, collector) => {\n    const foldBackground = theme.getColor(foldBackgroundBackground);\n    if (foldBackground) {\n        collector.addRule(`.monaco-editor .folded-background { background-color: ${foldBackground}; }`);\n    }\n    const editorFoldColor = theme.getColor(editorFoldForeground);\n    if (editorFoldColor) {\n        collector.addRule(`\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingExpandedIcon)},\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingCollapsedIcon)} {\n\t\t\tcolor: ${editorFoldColor} !important;\n\t\t}\n\t\t`);\n    }\n});\n"]},"metadata":{},"sourceType":"module"}