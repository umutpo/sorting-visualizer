{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar _a;\n\nimport * as dom from '../../../base/browser/dom.js';\nimport { Color, RGBA } from '../../../base/common/color.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as strings from '../../../base/common/strings.js';\nimport './ghostText.css';\nimport { Configuration } from '../../browser/config/configuration.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\nimport { CursorColumns } from '../../common/controller/cursorCommon.js';\nimport { LineTokens } from '../../common/core/lineTokens.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { createStringBuilder } from '../../common/core/stringBuilder.js';\nimport { IModeService } from '../../common/services/modeService.js';\nimport { ghostTextBorder, ghostTextForeground } from '../../common/view/editorColorRegistry.js';\nimport { LineDecoration } from '../../common/viewLayout/lineDecorations.js';\nimport { RenderLineInput, renderViewLine } from '../../common/viewLayout/viewLineRenderer.js';\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nconst ttPolicy = (_a = window.trustedTypes) === null || _a === void 0 ? void 0 : _a.createPolicy('editorGhostText', {\n  createHTML: value => value\n});\nlet GhostTextWidget = class GhostTextWidget extends Disposable {\n  constructor(editor, model, instantiationService, modeService) {\n    super();\n    this.editor = editor;\n    this.model = model;\n    this.instantiationService = instantiationService;\n    this.modeService = modeService;\n    this.disposed = false;\n    this.partsWidget = this._register(this.instantiationService.createInstance(DecorationsWidget, this.editor));\n    this.additionalLinesWidget = this._register(new AdditionalLinesWidget(this.editor, this.modeService.languageIdCodec));\n    this.viewMoreContentWidget = undefined;\n\n    this._register(this.editor.onDidChangeConfiguration(e => {\n      if (e.hasChanged(29\n      /* disableMonospaceOptimizations */\n      ) || e.hasChanged(104\n      /* stopRenderingLineAfter */\n      ) || e.hasChanged(87\n      /* renderWhitespace */\n      ) || e.hasChanged(82\n      /* renderControlCharacters */\n      ) || e.hasChanged(44\n      /* fontLigatures */\n      ) || e.hasChanged(43\n      /* fontInfo */\n      ) || e.hasChanged(58\n      /* lineHeight */\n      )) {\n        this.update();\n      }\n    }));\n\n    this._register(toDisposable(() => {\n      var _a;\n\n      this.disposed = true;\n      this.update();\n      (_a = this.viewMoreContentWidget) === null || _a === void 0 ? void 0 : _a.dispose();\n      this.viewMoreContentWidget = undefined;\n    }));\n\n    this._register(model.onDidChange(() => {\n      this.update();\n    }));\n\n    this.update();\n  }\n\n  shouldShowHoverAtViewZone(viewZoneId) {\n    return this.additionalLinesWidget.viewZoneId === viewZoneId;\n  }\n\n  update() {\n    var _a;\n\n    const ghostText = this.model.ghostText;\n\n    if (!this.editor.hasModel() || !ghostText || this.disposed) {\n      this.partsWidget.clear();\n      this.additionalLinesWidget.clear();\n      return;\n    }\n\n    const inlineTexts = new Array();\n    const additionalLines = new Array();\n\n    function addToAdditionalLines(lines, className) {\n      if (additionalLines.length > 0) {\n        const lastLine = additionalLines[additionalLines.length - 1];\n\n        if (className) {\n          lastLine.decorations.push(new LineDecoration(lastLine.content.length + 1, lastLine.content.length + 1 + lines[0].length, className, 0\n          /* Regular */\n          ));\n        }\n\n        lastLine.content += lines[0];\n        lines = lines.slice(1);\n      }\n\n      for (const line of lines) {\n        additionalLines.push({\n          content: line,\n          decorations: className ? [new LineDecoration(1, line.length + 1, className, 0\n          /* Regular */\n          )] : []\n        });\n      }\n    }\n\n    const textBufferLine = this.editor.getModel().getLineContent(ghostText.lineNumber);\n    this.editor.getModel().getLineTokens(ghostText.lineNumber);\n    let hiddenTextStartColumn = undefined;\n    let lastIdx = 0;\n\n    for (const part of ghostText.parts) {\n      let lines = part.lines;\n\n      if (hiddenTextStartColumn === undefined) {\n        inlineTexts.push({\n          column: part.column,\n          text: lines[0],\n          preview: part.preview\n        });\n        lines = lines.slice(1);\n      } else {\n        addToAdditionalLines([textBufferLine.substring(lastIdx, part.column - 1)], undefined);\n      }\n\n      if (lines.length > 0) {\n        addToAdditionalLines(lines, 'ghost-text');\n\n        if (hiddenTextStartColumn === undefined && part.column <= textBufferLine.length) {\n          hiddenTextStartColumn = part.column;\n        }\n      }\n\n      lastIdx = part.column - 1;\n    }\n\n    if (hiddenTextStartColumn !== undefined) {\n      addToAdditionalLines([textBufferLine.substring(lastIdx)], undefined);\n    }\n\n    this.partsWidget.setParts(ghostText.lineNumber, inlineTexts, hiddenTextStartColumn !== undefined ? {\n      column: hiddenTextStartColumn,\n      length: textBufferLine.length + 1 - hiddenTextStartColumn\n    } : undefined);\n    this.additionalLinesWidget.updateLines(ghostText.lineNumber, additionalLines, ghostText.additionalReservedLineCount);\n\n    if (ghostText.parts.some(p => p.lines.length < 0)) {\n      // Not supported at the moment, condition is always false.\n      this.viewMoreContentWidget = this.renderViewMoreLines(new Position(ghostText.lineNumber, this.editor.getModel().getLineMaxColumn(ghostText.lineNumber)), '', 0);\n    } else {\n      (_a = this.viewMoreContentWidget) === null || _a === void 0 ? void 0 : _a.dispose();\n      this.viewMoreContentWidget = undefined;\n    }\n  }\n\n  renderViewMoreLines(position, firstLineText, remainingLinesLength) {\n    const fontInfo = this.editor.getOption(43\n    /* fontInfo */\n    );\n    const domNode = document.createElement('div');\n    domNode.className = 'suggest-preview-additional-widget';\n    Configuration.applyFontInfoSlow(domNode, fontInfo);\n    const spacer = document.createElement('span');\n    spacer.className = 'content-spacer';\n    spacer.append(firstLineText);\n    domNode.append(spacer);\n    const newline = document.createElement('span');\n    newline.className = 'content-newline suggest-preview-text';\n    newline.append('⏎  ');\n    domNode.append(newline);\n    const disposableStore = new DisposableStore();\n    const button = document.createElement('div');\n    button.className = 'button suggest-preview-text';\n    button.append(`+${remainingLinesLength} lines…`);\n    disposableStore.add(dom.addStandardDisposableListener(button, 'mousedown', e => {\n      var _a;\n\n      (_a = this.model) === null || _a === void 0 ? void 0 : _a.setExpanded(true);\n      e.preventDefault();\n      this.editor.focus();\n    }));\n    domNode.append(button);\n    return new ViewMoreLinesContentWidget(this.editor, position, domNode, disposableStore);\n  }\n\n};\nGhostTextWidget = __decorate([__param(2, IInstantiationService), __param(3, IModeService)], GhostTextWidget);\nexport { GhostTextWidget };\nlet DecorationsWidget = class DecorationsWidget {\n  constructor(editor, codeEditorService, themeService, contextKeyService) {\n    this.editor = editor;\n    this.codeEditorService = codeEditorService;\n    this.themeService = themeService;\n    this.contextKeyService = contextKeyService;\n    this.decorationIds = [];\n    this.disposableStore = new DisposableStore();\n  }\n\n  dispose() {\n    this.clear();\n    this.disposableStore.dispose();\n  }\n\n  clear() {\n    this.editor.deltaDecorations(this.decorationIds, []);\n    this.disposableStore.clear();\n  }\n\n  setParts(lineNumber, parts, hiddenText) {\n    this.disposableStore.clear();\n    const colorTheme = this.themeService.getColorTheme();\n    const foreground = colorTheme.getColor(ghostTextForeground);\n    let opacity = undefined;\n    let color = undefined;\n\n    if (foreground) {\n      opacity = String(foreground.rgba.a);\n      color = Color.Format.CSS.format(opaque(foreground));\n    }\n\n    const borderColor = colorTheme.getColor(ghostTextBorder);\n    let border = undefined;\n\n    if (borderColor) {\n      border = `2px dashed ${borderColor}`;\n    }\n\n    const textModel = this.editor.getModel();\n\n    if (!textModel) {\n      return;\n    }\n\n    const {\n      tabSize\n    } = textModel.getOptions();\n    const line = textModel.getLineContent(lineNumber) || '';\n    let lastIndex = 0;\n    let currentLinePrefix = '';\n    const hiddenTextDecorations = new Array();\n\n    if (hiddenText) {\n      hiddenTextDecorations.push({\n        range: Range.fromPositions(new Position(lineNumber, hiddenText.column), new Position(lineNumber, hiddenText.column + hiddenText.length)),\n        options: {\n          inlineClassName: 'ghost-text-hidden',\n          description: 'ghost-text-hidden'\n        }\n      });\n    }\n\n    const key = this.contextKeyService.getContextKeyValue('config.editor.useInjectedText');\n    const shouldUseInjectedText = key === undefined ? true : !!key;\n    this.decorationIds = this.editor.deltaDecorations(this.decorationIds, parts.map(p => {\n      currentLinePrefix += line.substring(lastIndex, p.column - 1);\n      lastIndex = p.column - 1; // To avoid visual confusion, we don't want to render visible whitespace\n\n      const contentText = shouldUseInjectedText ? p.text : this.renderSingleLineText(p.text, currentLinePrefix, tabSize, false);\n      const decorationType = this.disposableStore.add(registerDecorationType(this.codeEditorService, 'ghost-text', '0-ghost-text-', {\n        after: {\n          // TODO: escape?\n          contentText,\n          opacity,\n          color,\n          border,\n          fontWeight: p.preview ? 'bold' : 'normal'\n        }\n      }));\n      return {\n        range: Range.fromPositions(new Position(lineNumber, p.column)),\n        options: shouldUseInjectedText ? {\n          description: 'ghost-text',\n          after: {\n            content: contentText,\n            inlineClassName: p.preview ? 'ghost-text-decoration-preview' : 'ghost-text-decoration'\n          },\n          showIfCollapsed: true\n        } : Object.assign({}, decorationType.resolve())\n      };\n    }).concat(hiddenTextDecorations));\n  }\n\n  renderSingleLineText(text, lineStart, tabSize, renderWhitespace) {\n    const newLine = lineStart + text;\n    const visibleColumnsByColumns = CursorColumns.visibleColumnsByColumns(newLine, tabSize);\n    let contentText = '';\n    let curCol = lineStart.length + 1;\n\n    for (const c of text) {\n      if (c === '\\t') {\n        const width = visibleColumnsByColumns[curCol + 1] - visibleColumnsByColumns[curCol];\n\n        if (renderWhitespace) {\n          contentText += '→';\n\n          for (let i = 1; i < width; i++) {\n            contentText += '\\xa0';\n          }\n        } else {\n          for (let i = 0; i < width; i++) {\n            contentText += '\\xa0';\n          }\n        }\n      } else if (c === ' ') {\n        if (renderWhitespace) {\n          contentText += '·';\n        } else {\n          contentText += '\\xa0';\n        }\n      } else {\n        contentText += c;\n      }\n\n      curCol += 1;\n    }\n\n    return contentText;\n  }\n\n};\nDecorationsWidget = __decorate([__param(1, ICodeEditorService), __param(2, IThemeService), __param(3, IContextKeyService)], DecorationsWidget);\n\nfunction opaque(color) {\n  const {\n    r,\n    b,\n    g\n  } = color.rgba;\n  return new Color(new RGBA(r, g, b, 255));\n}\n\nclass AdditionalLinesWidget {\n  constructor(editor, languageIdCodec) {\n    this.editor = editor;\n    this.languageIdCodec = languageIdCodec;\n    this._viewZoneId = undefined;\n  }\n\n  get viewZoneId() {\n    return this._viewZoneId;\n  }\n\n  dispose() {\n    this.clear();\n  }\n\n  clear() {\n    this.editor.changeViewZones(changeAccessor => {\n      if (this._viewZoneId) {\n        changeAccessor.removeZone(this._viewZoneId);\n        this._viewZoneId = undefined;\n      }\n    });\n  }\n\n  updateLines(lineNumber, additionalLines, minReservedLineCount) {\n    const textModel = this.editor.getModel();\n\n    if (!textModel) {\n      return;\n    }\n\n    const {\n      tabSize\n    } = textModel.getOptions();\n    this.editor.changeViewZones(changeAccessor => {\n      if (this._viewZoneId) {\n        changeAccessor.removeZone(this._viewZoneId);\n        this._viewZoneId = undefined;\n      }\n\n      const heightInLines = Math.max(additionalLines.length, minReservedLineCount);\n\n      if (heightInLines > 0) {\n        const domNode = document.createElement('div');\n        renderLines(domNode, tabSize, additionalLines, this.editor.getOptions(), this.languageIdCodec);\n        this._viewZoneId = changeAccessor.addZone({\n          afterLineNumber: lineNumber,\n          heightInLines: heightInLines,\n          domNode\n        });\n      }\n    });\n  }\n\n}\n\nfunction renderLines(domNode, tabSize, lines, opts, languageIdCodec) {\n  const disableMonospaceOptimizations = opts.get(29\n  /* disableMonospaceOptimizations */\n  );\n  const stopRenderingLineAfter = opts.get(104\n  /* stopRenderingLineAfter */\n  ); // To avoid visual confusion, we don't want to render visible whitespace\n\n  const renderWhitespace = 'none';\n  const renderControlCharacters = opts.get(82\n  /* renderControlCharacters */\n  );\n  const fontLigatures = opts.get(44\n  /* fontLigatures */\n  );\n  const fontInfo = opts.get(43\n  /* fontInfo */\n  );\n  const lineHeight = opts.get(58\n  /* lineHeight */\n  );\n  const sb = createStringBuilder(10000);\n  sb.appendASCIIString('<div class=\"suggest-preview-text\">');\n\n  for (let i = 0, len = lines.length; i < len; i++) {\n    const lineData = lines[i];\n    const line = lineData.content;\n    sb.appendASCIIString('<div class=\"view-line');\n    sb.appendASCIIString('\" style=\"top:');\n    sb.appendASCIIString(String(i * lineHeight));\n    sb.appendASCIIString('px;width:1000000px;\">');\n    const isBasicASCII = strings.isBasicASCII(line);\n    const containsRTL = strings.containsRTL(line);\n    const lineTokens = LineTokens.createEmpty(line, languageIdCodec);\n    renderViewLine(new RenderLineInput(fontInfo.isMonospace && !disableMonospaceOptimizations, fontInfo.canUseHalfwidthRightwardsArrow, line, false, isBasicASCII, containsRTL, 0, lineTokens, lineData.decorations, tabSize, 0, fontInfo.spaceWidth, fontInfo.middotWidth, fontInfo.wsmiddotWidth, stopRenderingLineAfter, renderWhitespace, renderControlCharacters, fontLigatures !== EditorFontLigatures.OFF, null), sb);\n    sb.appendASCIIString('</div>');\n  }\n\n  sb.appendASCIIString('</div>');\n  Configuration.applyFontInfoSlow(domNode, fontInfo);\n  const html = sb.build();\n  const trustedhtml = ttPolicy ? ttPolicy.createHTML(html) : html;\n  domNode.innerHTML = trustedhtml;\n}\n\nlet keyCounter = 0;\n\nfunction registerDecorationType(service, description, keyPrefix, options) {\n  const key = keyPrefix + keyCounter++;\n  service.registerDecorationType(description, key, options);\n  return {\n    dispose() {\n      service.removeDecorationType(key);\n    },\n\n    resolve() {\n      return service.resolveDecorationOptions(key, true);\n    }\n\n  };\n}\n\nclass ViewMoreLinesContentWidget extends Disposable {\n  constructor(editor, position, domNode, disposableStore) {\n    super();\n    this.editor = editor;\n    this.position = position;\n    this.domNode = domNode;\n    this.allowEditorOverflow = false;\n    this.suppressMouseDown = false;\n\n    this._register(disposableStore);\n\n    this._register(toDisposable(() => {\n      this.editor.removeContentWidget(this);\n    }));\n\n    this.editor.addContentWidget(this);\n  }\n\n  getId() {\n    return 'editor.widget.viewMoreLinesWidget';\n  }\n\n  getDomNode() {\n    return this.domNode;\n  }\n\n  getPosition() {\n    return {\n      position: this.position,\n      preference: [0\n      /* EXACT */\n      ]\n    };\n  }\n\n}\n\nregisterThemingParticipant((theme, collector) => {\n  const foreground = theme.getColor(ghostTextForeground);\n\n  if (foreground) {\n    const opacity = String(foreground.rgba.a);\n    const color = Color.Format.CSS.format(opaque(foreground)); // `!important` ensures that other decorations don't cause a style conflict (#132017).\n\n    collector.addRule(`.monaco-editor .ghost-text-decoration { opacity: ${opacity} !important; color: ${color} !important; }`);\n    collector.addRule(`.monaco-editor .ghost-text-decoration-preview { color: ${foreground.toString()} !important; }`);\n    collector.addRule(`.monaco-editor .suggest-preview-text .ghost-text { opacity: ${opacity} !important; color: ${color} !important; }`);\n  }\n\n  const border = theme.getColor(ghostTextBorder);\n\n  if (border) {\n    collector.addRule(`.monaco-editor .suggest-preview-text .ghost-text { border: 1px solid ${border}; }`);\n    collector.addRule(`.monaco-editor .ghost-text-decoration { border: 1px solid ${border}; }`);\n    collector.addRule(`.monaco-editor .ghost-text-decoration-preview { border: 1px solid ${border}; }`);\n  }\n});","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/inlineCompletions/ghostTextWidget.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","_a","dom","Color","RGBA","Disposable","DisposableStore","toDisposable","strings","Configuration","ICodeEditorService","EditorFontLigatures","CursorColumns","LineTokens","Position","Range","createStringBuilder","IModeService","ghostTextBorder","ghostTextForeground","LineDecoration","RenderLineInput","renderViewLine","IContextKeyService","IInstantiationService","IThemeService","registerThemingParticipant","ttPolicy","window","trustedTypes","createPolicy","createHTML","value","GhostTextWidget","constructor","editor","model","instantiationService","modeService","disposed","partsWidget","_register","createInstance","DecorationsWidget","additionalLinesWidget","AdditionalLinesWidget","languageIdCodec","viewMoreContentWidget","undefined","onDidChangeConfiguration","e","hasChanged","update","dispose","onDidChange","shouldShowHoverAtViewZone","viewZoneId","ghostText","hasModel","clear","inlineTexts","Array","additionalLines","addToAdditionalLines","lines","className","lastLine","decorations","push","content","slice","line","textBufferLine","getModel","getLineContent","lineNumber","getLineTokens","hiddenTextStartColumn","lastIdx","part","parts","column","text","preview","substring","setParts","updateLines","additionalReservedLineCount","some","p","renderViewMoreLines","getLineMaxColumn","position","firstLineText","remainingLinesLength","fontInfo","getOption","domNode","document","createElement","applyFontInfoSlow","spacer","append","newline","disposableStore","button","add","addStandardDisposableListener","setExpanded","preventDefault","focus","ViewMoreLinesContentWidget","codeEditorService","themeService","contextKeyService","decorationIds","deltaDecorations","hiddenText","colorTheme","getColorTheme","foreground","getColor","opacity","color","String","rgba","a","Format","CSS","format","opaque","borderColor","border","textModel","tabSize","getOptions","lastIndex","currentLinePrefix","hiddenTextDecorations","range","fromPositions","options","inlineClassName","description","getContextKeyValue","shouldUseInjectedText","map","contentText","renderSingleLineText","decorationType","registerDecorationType","after","fontWeight","showIfCollapsed","assign","resolve","concat","lineStart","renderWhitespace","newLine","visibleColumnsByColumns","curCol","width","b","g","_viewZoneId","changeViewZones","changeAccessor","removeZone","minReservedLineCount","heightInLines","Math","max","renderLines","addZone","afterLineNumber","opts","disableMonospaceOptimizations","get","stopRenderingLineAfter","renderControlCharacters","fontLigatures","lineHeight","sb","appendASCIIString","len","lineData","isBasicASCII","containsRTL","lineTokens","createEmpty","isMonospace","canUseHalfwidthRightwardsArrow","spaceWidth","middotWidth","wsmiddotWidth","OFF","html","build","trustedhtml","innerHTML","keyCounter","service","keyPrefix","removeDecorationType","resolveDecorationOptions","allowEditorOverflow","suppressMouseDown","removeContentWidget","addContentWidget","getId","getDomNode","getPosition","preference","theme","collector","addRule","toString"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar _a;\nimport * as dom from '../../../base/browser/dom.js';\nimport { Color, RGBA } from '../../../base/common/color.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as strings from '../../../base/common/strings.js';\nimport './ghostText.css';\nimport { Configuration } from '../../browser/config/configuration.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\nimport { CursorColumns } from '../../common/controller/cursorCommon.js';\nimport { LineTokens } from '../../common/core/lineTokens.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { createStringBuilder } from '../../common/core/stringBuilder.js';\nimport { IModeService } from '../../common/services/modeService.js';\nimport { ghostTextBorder, ghostTextForeground } from '../../common/view/editorColorRegistry.js';\nimport { LineDecoration } from '../../common/viewLayout/lineDecorations.js';\nimport { RenderLineInput, renderViewLine } from '../../common/viewLayout/viewLineRenderer.js';\nimport { IContextKeyService } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService, registerThemingParticipant } from '../../../platform/theme/common/themeService.js';\nconst ttPolicy = (_a = window.trustedTypes) === null || _a === void 0 ? void 0 : _a.createPolicy('editorGhostText', { createHTML: value => value });\nlet GhostTextWidget = class GhostTextWidget extends Disposable {\n    constructor(editor, model, instantiationService, modeService) {\n        super();\n        this.editor = editor;\n        this.model = model;\n        this.instantiationService = instantiationService;\n        this.modeService = modeService;\n        this.disposed = false;\n        this.partsWidget = this._register(this.instantiationService.createInstance(DecorationsWidget, this.editor));\n        this.additionalLinesWidget = this._register(new AdditionalLinesWidget(this.editor, this.modeService.languageIdCodec));\n        this.viewMoreContentWidget = undefined;\n        this._register(this.editor.onDidChangeConfiguration((e) => {\n            if (e.hasChanged(29 /* disableMonospaceOptimizations */)\n                || e.hasChanged(104 /* stopRenderingLineAfter */)\n                || e.hasChanged(87 /* renderWhitespace */)\n                || e.hasChanged(82 /* renderControlCharacters */)\n                || e.hasChanged(44 /* fontLigatures */)\n                || e.hasChanged(43 /* fontInfo */)\n                || e.hasChanged(58 /* lineHeight */)) {\n                this.update();\n            }\n        }));\n        this._register(toDisposable(() => {\n            var _a;\n            this.disposed = true;\n            this.update();\n            (_a = this.viewMoreContentWidget) === null || _a === void 0 ? void 0 : _a.dispose();\n            this.viewMoreContentWidget = undefined;\n        }));\n        this._register(model.onDidChange(() => {\n            this.update();\n        }));\n        this.update();\n    }\n    shouldShowHoverAtViewZone(viewZoneId) {\n        return (this.additionalLinesWidget.viewZoneId === viewZoneId);\n    }\n    update() {\n        var _a;\n        const ghostText = this.model.ghostText;\n        if (!this.editor.hasModel() || !ghostText || this.disposed) {\n            this.partsWidget.clear();\n            this.additionalLinesWidget.clear();\n            return;\n        }\n        const inlineTexts = new Array();\n        const additionalLines = new Array();\n        function addToAdditionalLines(lines, className) {\n            if (additionalLines.length > 0) {\n                const lastLine = additionalLines[additionalLines.length - 1];\n                if (className) {\n                    lastLine.decorations.push(new LineDecoration(lastLine.content.length + 1, lastLine.content.length + 1 + lines[0].length, className, 0 /* Regular */));\n                }\n                lastLine.content += lines[0];\n                lines = lines.slice(1);\n            }\n            for (const line of lines) {\n                additionalLines.push({\n                    content: line,\n                    decorations: className ? [new LineDecoration(1, line.length + 1, className, 0 /* Regular */)] : []\n                });\n            }\n        }\n        const textBufferLine = this.editor.getModel().getLineContent(ghostText.lineNumber);\n        this.editor.getModel().getLineTokens(ghostText.lineNumber);\n        let hiddenTextStartColumn = undefined;\n        let lastIdx = 0;\n        for (const part of ghostText.parts) {\n            let lines = part.lines;\n            if (hiddenTextStartColumn === undefined) {\n                inlineTexts.push({\n                    column: part.column,\n                    text: lines[0],\n                    preview: part.preview,\n                });\n                lines = lines.slice(1);\n            }\n            else {\n                addToAdditionalLines([textBufferLine.substring(lastIdx, part.column - 1)], undefined);\n            }\n            if (lines.length > 0) {\n                addToAdditionalLines(lines, 'ghost-text');\n                if (hiddenTextStartColumn === undefined && part.column <= textBufferLine.length) {\n                    hiddenTextStartColumn = part.column;\n                }\n            }\n            lastIdx = part.column - 1;\n        }\n        if (hiddenTextStartColumn !== undefined) {\n            addToAdditionalLines([textBufferLine.substring(lastIdx)], undefined);\n        }\n        this.partsWidget.setParts(ghostText.lineNumber, inlineTexts, hiddenTextStartColumn !== undefined ? { column: hiddenTextStartColumn, length: textBufferLine.length + 1 - hiddenTextStartColumn } : undefined);\n        this.additionalLinesWidget.updateLines(ghostText.lineNumber, additionalLines, ghostText.additionalReservedLineCount);\n        if (ghostText.parts.some(p => p.lines.length < 0)) {\n            // Not supported at the moment, condition is always false.\n            this.viewMoreContentWidget = this.renderViewMoreLines(new Position(ghostText.lineNumber, this.editor.getModel().getLineMaxColumn(ghostText.lineNumber)), '', 0);\n        }\n        else {\n            (_a = this.viewMoreContentWidget) === null || _a === void 0 ? void 0 : _a.dispose();\n            this.viewMoreContentWidget = undefined;\n        }\n    }\n    renderViewMoreLines(position, firstLineText, remainingLinesLength) {\n        const fontInfo = this.editor.getOption(43 /* fontInfo */);\n        const domNode = document.createElement('div');\n        domNode.className = 'suggest-preview-additional-widget';\n        Configuration.applyFontInfoSlow(domNode, fontInfo);\n        const spacer = document.createElement('span');\n        spacer.className = 'content-spacer';\n        spacer.append(firstLineText);\n        domNode.append(spacer);\n        const newline = document.createElement('span');\n        newline.className = 'content-newline suggest-preview-text';\n        newline.append('⏎  ');\n        domNode.append(newline);\n        const disposableStore = new DisposableStore();\n        const button = document.createElement('div');\n        button.className = 'button suggest-preview-text';\n        button.append(`+${remainingLinesLength} lines…`);\n        disposableStore.add(dom.addStandardDisposableListener(button, 'mousedown', (e) => {\n            var _a;\n            (_a = this.model) === null || _a === void 0 ? void 0 : _a.setExpanded(true);\n            e.preventDefault();\n            this.editor.focus();\n        }));\n        domNode.append(button);\n        return new ViewMoreLinesContentWidget(this.editor, position, domNode, disposableStore);\n    }\n};\nGhostTextWidget = __decorate([\n    __param(2, IInstantiationService),\n    __param(3, IModeService)\n], GhostTextWidget);\nexport { GhostTextWidget };\nlet DecorationsWidget = class DecorationsWidget {\n    constructor(editor, codeEditorService, themeService, contextKeyService) {\n        this.editor = editor;\n        this.codeEditorService = codeEditorService;\n        this.themeService = themeService;\n        this.contextKeyService = contextKeyService;\n        this.decorationIds = [];\n        this.disposableStore = new DisposableStore();\n    }\n    dispose() {\n        this.clear();\n        this.disposableStore.dispose();\n    }\n    clear() {\n        this.editor.deltaDecorations(this.decorationIds, []);\n        this.disposableStore.clear();\n    }\n    setParts(lineNumber, parts, hiddenText) {\n        this.disposableStore.clear();\n        const colorTheme = this.themeService.getColorTheme();\n        const foreground = colorTheme.getColor(ghostTextForeground);\n        let opacity = undefined;\n        let color = undefined;\n        if (foreground) {\n            opacity = String(foreground.rgba.a);\n            color = Color.Format.CSS.format(opaque(foreground));\n        }\n        const borderColor = colorTheme.getColor(ghostTextBorder);\n        let border = undefined;\n        if (borderColor) {\n            border = `2px dashed ${borderColor}`;\n        }\n        const textModel = this.editor.getModel();\n        if (!textModel) {\n            return;\n        }\n        const { tabSize } = textModel.getOptions();\n        const line = textModel.getLineContent(lineNumber) || '';\n        let lastIndex = 0;\n        let currentLinePrefix = '';\n        const hiddenTextDecorations = new Array();\n        if (hiddenText) {\n            hiddenTextDecorations.push({\n                range: Range.fromPositions(new Position(lineNumber, hiddenText.column), new Position(lineNumber, hiddenText.column + hiddenText.length)),\n                options: {\n                    inlineClassName: 'ghost-text-hidden',\n                    description: 'ghost-text-hidden'\n                }\n            });\n        }\n        const key = this.contextKeyService.getContextKeyValue('config.editor.useInjectedText');\n        const shouldUseInjectedText = key === undefined ? true : !!key;\n        this.decorationIds = this.editor.deltaDecorations(this.decorationIds, parts.map(p => {\n            currentLinePrefix += line.substring(lastIndex, p.column - 1);\n            lastIndex = p.column - 1;\n            // To avoid visual confusion, we don't want to render visible whitespace\n            const contentText = shouldUseInjectedText ? p.text : this.renderSingleLineText(p.text, currentLinePrefix, tabSize, false);\n            const decorationType = this.disposableStore.add(registerDecorationType(this.codeEditorService, 'ghost-text', '0-ghost-text-', {\n                after: {\n                    // TODO: escape?\n                    contentText,\n                    opacity,\n                    color,\n                    border,\n                    fontWeight: p.preview ? 'bold' : 'normal',\n                },\n            }));\n            return ({\n                range: Range.fromPositions(new Position(lineNumber, p.column)),\n                options: shouldUseInjectedText ? {\n                    description: 'ghost-text',\n                    after: { content: contentText, inlineClassName: p.preview ? 'ghost-text-decoration-preview' : 'ghost-text-decoration' },\n                    showIfCollapsed: true,\n                } : Object.assign({}, decorationType.resolve())\n            });\n        }).concat(hiddenTextDecorations));\n    }\n    renderSingleLineText(text, lineStart, tabSize, renderWhitespace) {\n        const newLine = lineStart + text;\n        const visibleColumnsByColumns = CursorColumns.visibleColumnsByColumns(newLine, tabSize);\n        let contentText = '';\n        let curCol = lineStart.length + 1;\n        for (const c of text) {\n            if (c === '\\t') {\n                const width = visibleColumnsByColumns[curCol + 1] - visibleColumnsByColumns[curCol];\n                if (renderWhitespace) {\n                    contentText += '→';\n                    for (let i = 1; i < width; i++) {\n                        contentText += '\\xa0';\n                    }\n                }\n                else {\n                    for (let i = 0; i < width; i++) {\n                        contentText += '\\xa0';\n                    }\n                }\n            }\n            else if (c === ' ') {\n                if (renderWhitespace) {\n                    contentText += '·';\n                }\n                else {\n                    contentText += '\\xa0';\n                }\n            }\n            else {\n                contentText += c;\n            }\n            curCol += 1;\n        }\n        return contentText;\n    }\n};\nDecorationsWidget = __decorate([\n    __param(1, ICodeEditorService),\n    __param(2, IThemeService),\n    __param(3, IContextKeyService)\n], DecorationsWidget);\nfunction opaque(color) {\n    const { r, b, g } = color.rgba;\n    return new Color(new RGBA(r, g, b, 255));\n}\nclass AdditionalLinesWidget {\n    constructor(editor, languageIdCodec) {\n        this.editor = editor;\n        this.languageIdCodec = languageIdCodec;\n        this._viewZoneId = undefined;\n    }\n    get viewZoneId() { return this._viewZoneId; }\n    dispose() {\n        this.clear();\n    }\n    clear() {\n        this.editor.changeViewZones((changeAccessor) => {\n            if (this._viewZoneId) {\n                changeAccessor.removeZone(this._viewZoneId);\n                this._viewZoneId = undefined;\n            }\n        });\n    }\n    updateLines(lineNumber, additionalLines, minReservedLineCount) {\n        const textModel = this.editor.getModel();\n        if (!textModel) {\n            return;\n        }\n        const { tabSize } = textModel.getOptions();\n        this.editor.changeViewZones((changeAccessor) => {\n            if (this._viewZoneId) {\n                changeAccessor.removeZone(this._viewZoneId);\n                this._viewZoneId = undefined;\n            }\n            const heightInLines = Math.max(additionalLines.length, minReservedLineCount);\n            if (heightInLines > 0) {\n                const domNode = document.createElement('div');\n                renderLines(domNode, tabSize, additionalLines, this.editor.getOptions(), this.languageIdCodec);\n                this._viewZoneId = changeAccessor.addZone({\n                    afterLineNumber: lineNumber,\n                    heightInLines: heightInLines,\n                    domNode,\n                });\n            }\n        });\n    }\n}\nfunction renderLines(domNode, tabSize, lines, opts, languageIdCodec) {\n    const disableMonospaceOptimizations = opts.get(29 /* disableMonospaceOptimizations */);\n    const stopRenderingLineAfter = opts.get(104 /* stopRenderingLineAfter */);\n    // To avoid visual confusion, we don't want to render visible whitespace\n    const renderWhitespace = 'none';\n    const renderControlCharacters = opts.get(82 /* renderControlCharacters */);\n    const fontLigatures = opts.get(44 /* fontLigatures */);\n    const fontInfo = opts.get(43 /* fontInfo */);\n    const lineHeight = opts.get(58 /* lineHeight */);\n    const sb = createStringBuilder(10000);\n    sb.appendASCIIString('<div class=\"suggest-preview-text\">');\n    for (let i = 0, len = lines.length; i < len; i++) {\n        const lineData = lines[i];\n        const line = lineData.content;\n        sb.appendASCIIString('<div class=\"view-line');\n        sb.appendASCIIString('\" style=\"top:');\n        sb.appendASCIIString(String(i * lineHeight));\n        sb.appendASCIIString('px;width:1000000px;\">');\n        const isBasicASCII = strings.isBasicASCII(line);\n        const containsRTL = strings.containsRTL(line);\n        const lineTokens = LineTokens.createEmpty(line, languageIdCodec);\n        renderViewLine(new RenderLineInput((fontInfo.isMonospace && !disableMonospaceOptimizations), fontInfo.canUseHalfwidthRightwardsArrow, line, false, isBasicASCII, containsRTL, 0, lineTokens, lineData.decorations, tabSize, 0, fontInfo.spaceWidth, fontInfo.middotWidth, fontInfo.wsmiddotWidth, stopRenderingLineAfter, renderWhitespace, renderControlCharacters, fontLigatures !== EditorFontLigatures.OFF, null), sb);\n        sb.appendASCIIString('</div>');\n    }\n    sb.appendASCIIString('</div>');\n    Configuration.applyFontInfoSlow(domNode, fontInfo);\n    const html = sb.build();\n    const trustedhtml = ttPolicy ? ttPolicy.createHTML(html) : html;\n    domNode.innerHTML = trustedhtml;\n}\nlet keyCounter = 0;\nfunction registerDecorationType(service, description, keyPrefix, options) {\n    const key = keyPrefix + (keyCounter++);\n    service.registerDecorationType(description, key, options);\n    return {\n        dispose() {\n            service.removeDecorationType(key);\n        },\n        resolve() {\n            return service.resolveDecorationOptions(key, true);\n        }\n    };\n}\nclass ViewMoreLinesContentWidget extends Disposable {\n    constructor(editor, position, domNode, disposableStore) {\n        super();\n        this.editor = editor;\n        this.position = position;\n        this.domNode = domNode;\n        this.allowEditorOverflow = false;\n        this.suppressMouseDown = false;\n        this._register(disposableStore);\n        this._register(toDisposable(() => {\n            this.editor.removeContentWidget(this);\n        }));\n        this.editor.addContentWidget(this);\n    }\n    getId() {\n        return 'editor.widget.viewMoreLinesWidget';\n    }\n    getDomNode() {\n        return this.domNode;\n    }\n    getPosition() {\n        return {\n            position: this.position,\n            preference: [0 /* EXACT */]\n        };\n    }\n}\nregisterThemingParticipant((theme, collector) => {\n    const foreground = theme.getColor(ghostTextForeground);\n    if (foreground) {\n        const opacity = String(foreground.rgba.a);\n        const color = Color.Format.CSS.format(opaque(foreground));\n        // `!important` ensures that other decorations don't cause a style conflict (#132017).\n        collector.addRule(`.monaco-editor .ghost-text-decoration { opacity: ${opacity} !important; color: ${color} !important; }`);\n        collector.addRule(`.monaco-editor .ghost-text-decoration-preview { color: ${foreground.toString()} !important; }`);\n        collector.addRule(`.monaco-editor .suggest-preview-text .ghost-text { opacity: ${opacity} !important; color: ${color} !important; }`);\n    }\n    const border = theme.getColor(ghostTextBorder);\n    if (border) {\n        collector.addRule(`.monaco-editor .suggest-preview-text .ghost-text { border: 1px solid ${border}; }`);\n        collector.addRule(`.monaco-editor .ghost-text-decoration { border: 1px solid ${border}; }`);\n        collector.addRule(`.monaco-editor .ghost-text-decoration-preview { border: 1px solid ${border}; }`);\n    }\n});\n"]},"metadata":{},"sourceType":"module"}