{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { $, addDisposableListener, append, scheduleAtNextAnimationFrame } from '../../dom.js';\nimport { Sash } from '../sash/sash.js';\nimport { SmoothScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { pushToEnd, pushToStart, range } from '../../../common/arrays.js';\nimport { Color } from '../../../common/color.js';\nimport { Emitter, Event } from '../../../common/event.js';\nimport { combinedDisposable, Disposable, toDisposable } from '../../../common/lifecycle.js';\nimport { clamp } from '../../../common/numbers.js';\nimport { Scrollable } from '../../../common/scrollable.js';\nimport * as types from '../../../common/types.js';\nimport './splitview.css';\nconst defaultStyles = {\n  separatorBorder: Color.transparent\n};\n\nclass ViewItem {\n  constructor(container, view, size, disposable) {\n    this.container = container;\n    this.view = view;\n    this.disposable = disposable;\n    this._cachedVisibleSize = undefined;\n\n    if (typeof size === 'number') {\n      this._size = size;\n      this._cachedVisibleSize = undefined;\n      container.classList.add('visible');\n    } else {\n      this._size = 0;\n      this._cachedVisibleSize = size.cachedVisibleSize;\n    }\n  }\n\n  set size(size) {\n    this._size = size;\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get visible() {\n    return typeof this._cachedVisibleSize === 'undefined';\n  }\n\n  setVisible(visible, size) {\n    if (visible === this.visible) {\n      return;\n    }\n\n    if (visible) {\n      this.size = clamp(this._cachedVisibleSize, this.viewMinimumSize, this.viewMaximumSize);\n      this._cachedVisibleSize = undefined;\n    } else {\n      this._cachedVisibleSize = typeof size === 'number' ? size : this.size;\n      this.size = 0;\n    }\n\n    this.container.classList.toggle('visible', visible);\n\n    if (this.view.setVisible) {\n      this.view.setVisible(visible);\n    }\n  }\n\n  get minimumSize() {\n    return this.visible ? this.view.minimumSize : 0;\n  }\n\n  get viewMinimumSize() {\n    return this.view.minimumSize;\n  }\n\n  get maximumSize() {\n    return this.visible ? this.view.maximumSize : 0;\n  }\n\n  get viewMaximumSize() {\n    return this.view.maximumSize;\n  }\n\n  get priority() {\n    return this.view.priority;\n  }\n\n  get snap() {\n    return !!this.view.snap;\n  }\n\n  set enabled(enabled) {\n    this.container.style.pointerEvents = enabled ? '' : 'none';\n  }\n\n  layout(offset, layoutContext) {\n    this.layoutContainer(offset);\n    this.view.layout(this.size, offset, layoutContext);\n  }\n\n  dispose() {\n    this.disposable.dispose();\n    return this.view;\n  }\n\n}\n\nclass VerticalViewItem extends ViewItem {\n  layoutContainer(offset) {\n    this.container.style.top = `${offset}px`;\n    this.container.style.height = `${this.size}px`;\n  }\n\n}\n\nclass HorizontalViewItem extends ViewItem {\n  layoutContainer(offset) {\n    this.container.style.left = `${offset}px`;\n    this.container.style.width = `${this.size}px`;\n  }\n\n}\n\nvar State;\n\n(function (State) {\n  State[State[\"Idle\"] = 0] = \"Idle\";\n  State[State[\"Busy\"] = 1] = \"Busy\";\n})(State || (State = {}));\n\nexport var Sizing;\n\n(function (Sizing) {\n  Sizing.Distribute = {\n    type: 'distribute'\n  };\n\n  function Split(index) {\n    return {\n      type: 'split',\n      index\n    };\n  }\n\n  Sizing.Split = Split;\n\n  function Invisible(cachedVisibleSize) {\n    return {\n      type: 'invisible',\n      cachedVisibleSize\n    };\n  }\n\n  Sizing.Invisible = Invisible;\n})(Sizing || (Sizing = {}));\n\nexport class SplitView extends Disposable {\n  constructor(container) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _a, _b;\n\n    super();\n    this.size = 0;\n    this.contentSize = 0;\n    this.proportions = undefined;\n    this.viewItems = [];\n    this.sashItems = [];\n    this.state = State.Idle;\n    this._onDidSashChange = this._register(new Emitter());\n    this.onDidSashChange = this._onDidSashChange.event;\n    this._onDidSashReset = this._register(new Emitter());\n    this._startSnappingEnabled = true;\n    this._endSnappingEnabled = true;\n    this.orientation = types.isUndefined(options.orientation) ? 0\n    /* VERTICAL */\n    : options.orientation;\n    this.inverseAltBehavior = !!options.inverseAltBehavior;\n    this.proportionalLayout = types.isUndefined(options.proportionalLayout) ? true : !!options.proportionalLayout;\n    this.getSashOrthogonalSize = options.getSashOrthogonalSize;\n    this.el = document.createElement('div');\n    this.el.classList.add('monaco-split-view2');\n    this.el.classList.add(this.orientation === 0\n    /* VERTICAL */\n    ? 'vertical' : 'horizontal');\n    container.appendChild(this.el);\n    this.sashContainer = append(this.el, $('.sash-container'));\n    this.viewContainer = $('.split-view-container');\n    this.scrollable = new Scrollable(125, scheduleAtNextAnimationFrame);\n    this.scrollableElement = this._register(new SmoothScrollableElement(this.viewContainer, {\n      vertical: this.orientation === 0\n      /* VERTICAL */\n      ? (_a = options.scrollbarVisibility) !== null && _a !== void 0 ? _a : 1\n      /* Auto */\n      : 2\n      /* Hidden */\n      ,\n      horizontal: this.orientation === 1\n      /* HORIZONTAL */\n      ? (_b = options.scrollbarVisibility) !== null && _b !== void 0 ? _b : 1\n      /* Auto */\n      : 2\n      /* Hidden */\n\n    }, this.scrollable));\n    this.onDidScroll = this.scrollableElement.onScroll;\n\n    this._register(this.onDidScroll(e => {\n      this.viewContainer.scrollTop = e.scrollTop;\n      this.viewContainer.scrollLeft = e.scrollLeft;\n    }));\n\n    append(this.el, this.scrollableElement.getDomNode());\n    this.style(options.styles || defaultStyles); // We have an existing set of view, add them now\n\n    if (options.descriptor) {\n      this.size = options.descriptor.size;\n      options.descriptor.views.forEach((viewDescriptor, index) => {\n        const sizing = types.isUndefined(viewDescriptor.visible) || viewDescriptor.visible ? viewDescriptor.size : {\n          type: 'invisible',\n          cachedVisibleSize: viewDescriptor.size\n        };\n        const view = viewDescriptor.view;\n        this.doAddView(view, sizing, index, true);\n      }); // Initialize content size and proportions for first layout\n\n      this.contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n      this.saveProportions();\n    }\n  }\n\n  get orthogonalStartSash() {\n    return this._orthogonalStartSash;\n  }\n\n  set orthogonalStartSash(sash) {\n    for (const sashItem of this.sashItems) {\n      sashItem.sash.orthogonalStartSash = sash;\n    }\n\n    this._orthogonalStartSash = sash;\n  }\n\n  get orthogonalEndSash() {\n    return this._orthogonalEndSash;\n  }\n\n  set orthogonalEndSash(sash) {\n    for (const sashItem of this.sashItems) {\n      sashItem.sash.orthogonalEndSash = sash;\n    }\n\n    this._orthogonalEndSash = sash;\n  }\n\n  get startSnappingEnabled() {\n    return this._startSnappingEnabled;\n  }\n\n  set startSnappingEnabled(startSnappingEnabled) {\n    if (this._startSnappingEnabled === startSnappingEnabled) {\n      return;\n    }\n\n    this._startSnappingEnabled = startSnappingEnabled;\n    this.updateSashEnablement();\n  }\n\n  get endSnappingEnabled() {\n    return this._endSnappingEnabled;\n  }\n\n  set endSnappingEnabled(endSnappingEnabled) {\n    if (this._endSnappingEnabled === endSnappingEnabled) {\n      return;\n    }\n\n    this._endSnappingEnabled = endSnappingEnabled;\n    this.updateSashEnablement();\n  }\n\n  style(styles) {\n    if (styles.separatorBorder.isTransparent()) {\n      this.el.classList.remove('separator-border');\n      this.el.style.removeProperty('--separator-border');\n    } else {\n      this.el.classList.add('separator-border');\n      this.el.style.setProperty('--separator-border', styles.separatorBorder.toString());\n    }\n  }\n\n  addView(view, size) {\n    let index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.viewItems.length;\n    let skipLayout = arguments.length > 3 ? arguments[3] : undefined;\n    this.doAddView(view, size, index, skipLayout);\n  }\n\n  layout(size, layoutContext) {\n    const previousSize = Math.max(this.size, this.contentSize);\n    this.size = size;\n    this.layoutContext = layoutContext;\n\n    if (!this.proportions) {\n      const indexes = range(this.viewItems.length);\n      const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1\n      /* Low */\n      );\n      const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2\n      /* High */\n      );\n      this.resize(this.viewItems.length - 1, size - previousSize, undefined, lowPriorityIndexes, highPriorityIndexes);\n    } else {\n      for (let i = 0; i < this.viewItems.length; i++) {\n        const item = this.viewItems[i];\n        item.size = clamp(Math.round(this.proportions[i] * size), item.minimumSize, item.maximumSize);\n      }\n    }\n\n    this.distributeEmptySpace();\n    this.layoutViews();\n  }\n\n  saveProportions() {\n    if (this.proportionalLayout && this.contentSize > 0) {\n      this.proportions = this.viewItems.map(i => i.size / this.contentSize);\n    }\n  }\n\n  onSashStart(_ref) {\n    let {\n      sash,\n      start,\n      alt\n    } = _ref;\n\n    for (const item of this.viewItems) {\n      item.enabled = false;\n    }\n\n    const index = this.sashItems.findIndex(item => item.sash === sash); // This way, we can press Alt while we resize a sash, macOS style!\n\n    const disposable = combinedDisposable(addDisposableListener(document.body, 'keydown', e => resetSashDragState(this.sashDragState.current, e.altKey)), addDisposableListener(document.body, 'keyup', () => resetSashDragState(this.sashDragState.current, false)));\n\n    const resetSashDragState = (start, alt) => {\n      const sizes = this.viewItems.map(i => i.size);\n      let minDelta = Number.NEGATIVE_INFINITY;\n      let maxDelta = Number.POSITIVE_INFINITY;\n\n      if (this.inverseAltBehavior) {\n        alt = !alt;\n      }\n\n      if (alt) {\n        // When we're using the last sash with Alt, we're resizing\n        // the view to the left/up, instead of right/down as usual\n        // Thus, we must do the inverse of the usual\n        const isLastSash = index === this.sashItems.length - 1;\n\n        if (isLastSash) {\n          const viewItem = this.viewItems[index];\n          minDelta = (viewItem.minimumSize - viewItem.size) / 2;\n          maxDelta = (viewItem.maximumSize - viewItem.size) / 2;\n        } else {\n          const viewItem = this.viewItems[index + 1];\n          minDelta = (viewItem.size - viewItem.maximumSize) / 2;\n          maxDelta = (viewItem.size - viewItem.minimumSize) / 2;\n        }\n      }\n\n      let snapBefore;\n      let snapAfter;\n\n      if (!alt) {\n        const upIndexes = range(index, -1);\n        const downIndexes = range(index + 1, this.viewItems.length);\n        const minDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].minimumSize - sizes[i]), 0);\n        const maxDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].viewMaximumSize - sizes[i]), 0);\n        const maxDeltaDown = downIndexes.length === 0 ? Number.POSITIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].minimumSize), 0);\n        const minDeltaDown = downIndexes.length === 0 ? Number.NEGATIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].viewMaximumSize), 0);\n        const minDelta = Math.max(minDeltaUp, minDeltaDown);\n        const maxDelta = Math.min(maxDeltaDown, maxDeltaUp);\n        const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n        const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n\n        if (typeof snapBeforeIndex === 'number') {\n          const viewItem = this.viewItems[snapBeforeIndex];\n          const halfSize = Math.floor(viewItem.viewMinimumSize / 2);\n          snapBefore = {\n            index: snapBeforeIndex,\n            limitDelta: viewItem.visible ? minDelta - halfSize : minDelta + halfSize,\n            size: viewItem.size\n          };\n        }\n\n        if (typeof snapAfterIndex === 'number') {\n          const viewItem = this.viewItems[snapAfterIndex];\n          const halfSize = Math.floor(viewItem.viewMinimumSize / 2);\n          snapAfter = {\n            index: snapAfterIndex,\n            limitDelta: viewItem.visible ? maxDelta + halfSize : maxDelta - halfSize,\n            size: viewItem.size\n          };\n        }\n      }\n\n      this.sashDragState = {\n        start,\n        current: start,\n        index,\n        sizes,\n        minDelta,\n        maxDelta,\n        alt,\n        snapBefore,\n        snapAfter,\n        disposable\n      };\n    };\n\n    resetSashDragState(start, alt);\n  }\n\n  onSashChange(_ref2) {\n    let {\n      current\n    } = _ref2;\n    const {\n      index,\n      start,\n      sizes,\n      alt,\n      minDelta,\n      maxDelta,\n      snapBefore,\n      snapAfter\n    } = this.sashDragState;\n    this.sashDragState.current = current;\n    const delta = current - start;\n    const newDelta = this.resize(index, delta, sizes, undefined, undefined, minDelta, maxDelta, snapBefore, snapAfter);\n\n    if (alt) {\n      const isLastSash = index === this.sashItems.length - 1;\n      const newSizes = this.viewItems.map(i => i.size);\n      const viewItemIndex = isLastSash ? index : index + 1;\n      const viewItem = this.viewItems[viewItemIndex];\n      const newMinDelta = viewItem.size - viewItem.maximumSize;\n      const newMaxDelta = viewItem.size - viewItem.minimumSize;\n      const resizeIndex = isLastSash ? index - 1 : index + 1;\n      this.resize(resizeIndex, -newDelta, newSizes, undefined, undefined, newMinDelta, newMaxDelta);\n    }\n\n    this.distributeEmptySpace();\n    this.layoutViews();\n  }\n\n  onSashEnd(index) {\n    this._onDidSashChange.fire(index);\n\n    this.sashDragState.disposable.dispose();\n    this.saveProportions();\n\n    for (const item of this.viewItems) {\n      item.enabled = true;\n    }\n  }\n\n  onViewChange(item, size) {\n    const index = this.viewItems.indexOf(item);\n\n    if (index < 0 || index >= this.viewItems.length) {\n      return;\n    }\n\n    size = typeof size === 'number' ? size : item.size;\n    size = clamp(size, item.minimumSize, item.maximumSize);\n\n    if (this.inverseAltBehavior && index > 0) {\n      // In this case, we want the view to grow or shrink both sides equally\n      // so we just resize the \"left\" side by half and let `resize` do the clamping magic\n      this.resize(index - 1, Math.floor((item.size - size) / 2));\n      this.distributeEmptySpace();\n      this.layoutViews();\n    } else {\n      item.size = size;\n      this.relayout([index], undefined);\n    }\n  }\n\n  resizeView(index, size) {\n    if (this.state !== State.Idle) {\n      throw new Error('Cant modify splitview');\n    }\n\n    this.state = State.Busy;\n\n    if (index < 0 || index >= this.viewItems.length) {\n      return;\n    }\n\n    const indexes = range(this.viewItems.length).filter(i => i !== index);\n    const lowPriorityIndexes = [...indexes.filter(i => this.viewItems[i].priority === 1\n    /* Low */\n    ), index];\n    const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2\n    /* High */\n    );\n    const item = this.viewItems[index];\n    size = Math.round(size);\n    size = clamp(size, item.minimumSize, Math.min(item.maximumSize, this.size));\n    item.size = size;\n    this.relayout(lowPriorityIndexes, highPriorityIndexes);\n    this.state = State.Idle;\n  }\n\n  distributeViewSizes() {\n    const flexibleViewItems = [];\n    let flexibleSize = 0;\n\n    for (const item of this.viewItems) {\n      if (item.maximumSize - item.minimumSize > 0) {\n        flexibleViewItems.push(item);\n        flexibleSize += item.size;\n      }\n    }\n\n    const size = Math.floor(flexibleSize / flexibleViewItems.length);\n\n    for (const item of flexibleViewItems) {\n      item.size = clamp(size, item.minimumSize, item.maximumSize);\n    }\n\n    const indexes = range(this.viewItems.length);\n    const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1\n    /* Low */\n    );\n    const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2\n    /* High */\n    );\n    this.relayout(lowPriorityIndexes, highPriorityIndexes);\n  }\n\n  getViewSize(index) {\n    if (index < 0 || index >= this.viewItems.length) {\n      return -1;\n    }\n\n    return this.viewItems[index].size;\n  }\n\n  doAddView(view, size) {\n    let index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.viewItems.length;\n    let skipLayout = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (this.state !== State.Idle) {\n      throw new Error('Cant modify splitview');\n    }\n\n    this.state = State.Busy; // Add view\n\n    const container = $('.split-view-view');\n\n    if (index === this.viewItems.length) {\n      this.viewContainer.appendChild(container);\n    } else {\n      this.viewContainer.insertBefore(container, this.viewContainer.children.item(index));\n    }\n\n    const onChangeDisposable = view.onDidChange(size => this.onViewChange(item, size));\n    const containerDisposable = toDisposable(() => this.viewContainer.removeChild(container));\n    const disposable = combinedDisposable(onChangeDisposable, containerDisposable);\n    let viewSize;\n\n    if (typeof size === 'number') {\n      viewSize = size;\n    } else if (size.type === 'split') {\n      viewSize = this.getViewSize(size.index) / 2;\n    } else if (size.type === 'invisible') {\n      viewSize = {\n        cachedVisibleSize: size.cachedVisibleSize\n      };\n    } else {\n      viewSize = view.minimumSize;\n    }\n\n    const item = this.orientation === 0\n    /* VERTICAL */\n    ? new VerticalViewItem(container, view, viewSize, disposable) : new HorizontalViewItem(container, view, viewSize, disposable);\n    this.viewItems.splice(index, 0, item); // Add sash\n\n    if (this.viewItems.length > 1) {\n      let opts = {\n        orthogonalStartSash: this.orthogonalStartSash,\n        orthogonalEndSash: this.orthogonalEndSash\n      };\n      const sash = this.orientation === 0\n      /* VERTICAL */\n      ? new Sash(this.sashContainer, {\n        getHorizontalSashTop: s => this.getSashPosition(s),\n        getHorizontalSashWidth: this.getSashOrthogonalSize\n      }, Object.assign(Object.assign({}, opts), {\n        orientation: 1\n        /* HORIZONTAL */\n\n      })) : new Sash(this.sashContainer, {\n        getVerticalSashLeft: s => this.getSashPosition(s),\n        getVerticalSashHeight: this.getSashOrthogonalSize\n      }, Object.assign(Object.assign({}, opts), {\n        orientation: 0\n        /* VERTICAL */\n\n      }));\n      const sashEventMapper = this.orientation === 0\n      /* VERTICAL */\n      ? e => ({\n        sash,\n        start: e.startY,\n        current: e.currentY,\n        alt: e.altKey\n      }) : e => ({\n        sash,\n        start: e.startX,\n        current: e.currentX,\n        alt: e.altKey\n      });\n      const onStart = Event.map(sash.onDidStart, sashEventMapper);\n      const onStartDisposable = onStart(this.onSashStart, this);\n      const onChange = Event.map(sash.onDidChange, sashEventMapper);\n      const onChangeDisposable = onChange(this.onSashChange, this);\n      const onEnd = Event.map(sash.onDidEnd, () => this.sashItems.findIndex(item => item.sash === sash));\n      const onEndDisposable = onEnd(this.onSashEnd, this);\n      const onDidResetDisposable = sash.onDidReset(() => {\n        const index = this.sashItems.findIndex(item => item.sash === sash);\n        const upIndexes = range(index, -1);\n        const downIndexes = range(index + 1, this.viewItems.length);\n        const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n        const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n\n        if (typeof snapBeforeIndex === 'number' && !this.viewItems[snapBeforeIndex].visible) {\n          return;\n        }\n\n        if (typeof snapAfterIndex === 'number' && !this.viewItems[snapAfterIndex].visible) {\n          return;\n        }\n\n        this._onDidSashReset.fire(index);\n      });\n      const disposable = combinedDisposable(onStartDisposable, onChangeDisposable, onEndDisposable, onDidResetDisposable, sash);\n      const sashItem = {\n        sash,\n        disposable\n      };\n      this.sashItems.splice(index - 1, 0, sashItem);\n    }\n\n    container.appendChild(view.element);\n    let highPriorityIndexes;\n\n    if (typeof size !== 'number' && size.type === 'split') {\n      highPriorityIndexes = [size.index];\n    }\n\n    if (!skipLayout) {\n      this.relayout([index], highPriorityIndexes);\n    }\n\n    this.state = State.Idle;\n\n    if (!skipLayout && typeof size !== 'number' && size.type === 'distribute') {\n      this.distributeViewSizes();\n    }\n  }\n\n  relayout(lowPriorityIndexes, highPriorityIndexes) {\n    const contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n    this.resize(this.viewItems.length - 1, this.size - contentSize, undefined, lowPriorityIndexes, highPriorityIndexes);\n    this.distributeEmptySpace();\n    this.layoutViews();\n    this.saveProportions();\n  }\n\n  resize(index, delta) {\n    let sizes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.viewItems.map(i => i.size);\n    let lowPriorityIndexes = arguments.length > 3 ? arguments[3] : undefined;\n    let highPriorityIndexes = arguments.length > 4 ? arguments[4] : undefined;\n    let overloadMinDelta = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : Number.NEGATIVE_INFINITY;\n    let overloadMaxDelta = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : Number.POSITIVE_INFINITY;\n    let snapBefore = arguments.length > 7 ? arguments[7] : undefined;\n    let snapAfter = arguments.length > 8 ? arguments[8] : undefined;\n\n    if (index < 0 || index >= this.viewItems.length) {\n      return 0;\n    }\n\n    const upIndexes = range(index, -1);\n    const downIndexes = range(index + 1, this.viewItems.length);\n\n    if (highPriorityIndexes) {\n      for (const index of highPriorityIndexes) {\n        pushToStart(upIndexes, index);\n        pushToStart(downIndexes, index);\n      }\n    }\n\n    if (lowPriorityIndexes) {\n      for (const index of lowPriorityIndexes) {\n        pushToEnd(upIndexes, index);\n        pushToEnd(downIndexes, index);\n      }\n    }\n\n    const upItems = upIndexes.map(i => this.viewItems[i]);\n    const upSizes = upIndexes.map(i => sizes[i]);\n    const downItems = downIndexes.map(i => this.viewItems[i]);\n    const downSizes = downIndexes.map(i => sizes[i]);\n    const minDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].minimumSize - sizes[i]), 0);\n    const maxDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].maximumSize - sizes[i]), 0);\n    const maxDeltaDown = downIndexes.length === 0 ? Number.POSITIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].minimumSize), 0);\n    const minDeltaDown = downIndexes.length === 0 ? Number.NEGATIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].maximumSize), 0);\n    const minDelta = Math.max(minDeltaUp, minDeltaDown, overloadMinDelta);\n    const maxDelta = Math.min(maxDeltaDown, maxDeltaUp, overloadMaxDelta);\n    let snapped = false;\n\n    if (snapBefore) {\n      const snapView = this.viewItems[snapBefore.index];\n      const visible = delta >= snapBefore.limitDelta;\n      snapped = visible !== snapView.visible;\n      snapView.setVisible(visible, snapBefore.size);\n    }\n\n    if (!snapped && snapAfter) {\n      const snapView = this.viewItems[snapAfter.index];\n      const visible = delta < snapAfter.limitDelta;\n      snapped = visible !== snapView.visible;\n      snapView.setVisible(visible, snapAfter.size);\n    }\n\n    if (snapped) {\n      return this.resize(index, delta, sizes, lowPriorityIndexes, highPriorityIndexes, overloadMinDelta, overloadMaxDelta);\n    }\n\n    delta = clamp(delta, minDelta, maxDelta);\n\n    for (let i = 0, deltaUp = delta; i < upItems.length; i++) {\n      const item = upItems[i];\n      const size = clamp(upSizes[i] + deltaUp, item.minimumSize, item.maximumSize);\n      const viewDelta = size - upSizes[i];\n      deltaUp -= viewDelta;\n      item.size = size;\n    }\n\n    for (let i = 0, deltaDown = delta; i < downItems.length; i++) {\n      const item = downItems[i];\n      const size = clamp(downSizes[i] - deltaDown, item.minimumSize, item.maximumSize);\n      const viewDelta = size - downSizes[i];\n      deltaDown += viewDelta;\n      item.size = size;\n    }\n\n    return delta;\n  }\n\n  distributeEmptySpace(lowPriorityIndex) {\n    const contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n    let emptyDelta = this.size - contentSize;\n    const indexes = range(this.viewItems.length - 1, -1);\n    const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1\n    /* Low */\n    );\n    const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2\n    /* High */\n    );\n\n    for (const index of highPriorityIndexes) {\n      pushToStart(indexes, index);\n    }\n\n    for (const index of lowPriorityIndexes) {\n      pushToEnd(indexes, index);\n    }\n\n    if (typeof lowPriorityIndex === 'number') {\n      pushToEnd(indexes, lowPriorityIndex);\n    }\n\n    for (let i = 0; emptyDelta !== 0 && i < indexes.length; i++) {\n      const item = this.viewItems[indexes[i]];\n      const size = clamp(item.size + emptyDelta, item.minimumSize, item.maximumSize);\n      const viewDelta = size - item.size;\n      emptyDelta -= viewDelta;\n      item.size = size;\n    }\n  }\n\n  layoutViews() {\n    // Save new content size\n    this.contentSize = this.viewItems.reduce((r, i) => r + i.size, 0); // Layout views\n\n    let offset = 0;\n\n    for (const viewItem of this.viewItems) {\n      viewItem.layout(offset, this.layoutContext);\n      offset += viewItem.size;\n    } // Layout sashes\n\n\n    this.sashItems.forEach(item => item.sash.layout());\n    this.updateSashEnablement();\n    this.updateScrollableElement();\n  }\n\n  updateScrollableElement() {\n    if (this.orientation === 0\n    /* VERTICAL */\n    ) {\n      this.scrollableElement.setScrollDimensions({\n        height: this.size,\n        scrollHeight: this.contentSize\n      });\n    } else {\n      this.scrollableElement.setScrollDimensions({\n        width: this.size,\n        scrollWidth: this.contentSize\n      });\n    }\n  }\n\n  updateSashEnablement() {\n    let previous = false;\n    const collapsesDown = this.viewItems.map(i => previous = i.size - i.minimumSize > 0 || previous);\n    previous = false;\n    const expandsDown = this.viewItems.map(i => previous = i.maximumSize - i.size > 0 || previous);\n    const reverseViews = [...this.viewItems].reverse();\n    previous = false;\n    const collapsesUp = reverseViews.map(i => previous = i.size - i.minimumSize > 0 || previous).reverse();\n    previous = false;\n    const expandsUp = reverseViews.map(i => previous = i.maximumSize - i.size > 0 || previous).reverse();\n    let position = 0;\n\n    for (let index = 0; index < this.sashItems.length; index++) {\n      const {\n        sash\n      } = this.sashItems[index];\n      const viewItem = this.viewItems[index];\n      position += viewItem.size;\n      const min = !(collapsesDown[index] && expandsUp[index + 1]);\n      const max = !(expandsDown[index] && collapsesUp[index + 1]);\n\n      if (min && max) {\n        const upIndexes = range(index, -1);\n        const downIndexes = range(index + 1, this.viewItems.length);\n        const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n        const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n        const snappedBefore = typeof snapBeforeIndex === 'number' && !this.viewItems[snapBeforeIndex].visible;\n        const snappedAfter = typeof snapAfterIndex === 'number' && !this.viewItems[snapAfterIndex].visible;\n\n        if (snappedBefore && collapsesUp[index] && (position > 0 || this.startSnappingEnabled)) {\n          sash.state = 1\n          /* Minimum */\n          ;\n        } else if (snappedAfter && collapsesDown[index] && (position < this.contentSize || this.endSnappingEnabled)) {\n          sash.state = 2\n          /* Maximum */\n          ;\n        } else {\n          sash.state = 0\n          /* Disabled */\n          ;\n        }\n      } else if (min && !max) {\n        sash.state = 1\n        /* Minimum */\n        ;\n      } else if (!min && max) {\n        sash.state = 2\n        /* Maximum */\n        ;\n      } else {\n        sash.state = 3\n        /* Enabled */\n        ;\n      }\n    }\n  }\n\n  getSashPosition(sash) {\n    let position = 0;\n\n    for (let i = 0; i < this.sashItems.length; i++) {\n      position += this.viewItems[i].size;\n\n      if (this.sashItems[i].sash === sash) {\n        return position;\n      }\n    }\n\n    return 0;\n  }\n\n  findFirstSnapIndex(indexes) {\n    // visible views first\n    for (const index of indexes) {\n      const viewItem = this.viewItems[index];\n\n      if (!viewItem.visible) {\n        continue;\n      }\n\n      if (viewItem.snap) {\n        return index;\n      }\n    } // then, hidden views\n\n\n    for (const index of indexes) {\n      const viewItem = this.viewItems[index];\n\n      if (viewItem.visible && viewItem.maximumSize - viewItem.minimumSize > 0) {\n        return undefined;\n      }\n\n      if (!viewItem.visible && viewItem.snap) {\n        return index;\n      }\n    }\n\n    return undefined;\n  }\n\n  dispose() {\n    super.dispose();\n    this.viewItems.forEach(i => i.dispose());\n    this.viewItems = [];\n    this.sashItems.forEach(i => i.disposable.dispose());\n    this.sashItems = [];\n  }\n\n}","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/base/browser/ui/splitview/splitview.js"],"names":["$","addDisposableListener","append","scheduleAtNextAnimationFrame","Sash","SmoothScrollableElement","pushToEnd","pushToStart","range","Color","Emitter","Event","combinedDisposable","Disposable","toDisposable","clamp","Scrollable","types","defaultStyles","separatorBorder","transparent","ViewItem","constructor","container","view","size","disposable","_cachedVisibleSize","undefined","_size","classList","add","cachedVisibleSize","visible","setVisible","viewMinimumSize","viewMaximumSize","toggle","minimumSize","maximumSize","priority","snap","enabled","style","pointerEvents","layout","offset","layoutContext","layoutContainer","dispose","VerticalViewItem","top","height","HorizontalViewItem","left","width","State","Sizing","Distribute","type","Split","index","Invisible","SplitView","options","_a","_b","contentSize","proportions","viewItems","sashItems","state","Idle","_onDidSashChange","_register","onDidSashChange","event","_onDidSashReset","_startSnappingEnabled","_endSnappingEnabled","orientation","isUndefined","inverseAltBehavior","proportionalLayout","getSashOrthogonalSize","el","document","createElement","appendChild","sashContainer","viewContainer","scrollable","scrollableElement","vertical","scrollbarVisibility","horizontal","onDidScroll","onScroll","e","scrollTop","scrollLeft","getDomNode","styles","descriptor","views","forEach","viewDescriptor","sizing","doAddView","reduce","r","i","saveProportions","orthogonalStartSash","_orthogonalStartSash","sash","sashItem","orthogonalEndSash","_orthogonalEndSash","startSnappingEnabled","updateSashEnablement","endSnappingEnabled","isTransparent","remove","removeProperty","setProperty","toString","addView","length","skipLayout","previousSize","Math","max","indexes","lowPriorityIndexes","filter","highPriorityIndexes","resize","item","round","distributeEmptySpace","layoutViews","map","onSashStart","start","alt","findIndex","body","resetSashDragState","sashDragState","current","altKey","sizes","minDelta","Number","NEGATIVE_INFINITY","maxDelta","POSITIVE_INFINITY","isLastSash","viewItem","snapBefore","snapAfter","upIndexes","downIndexes","minDeltaUp","maxDeltaUp","maxDeltaDown","minDeltaDown","min","snapBeforeIndex","findFirstSnapIndex","snapAfterIndex","halfSize","floor","limitDelta","onSashChange","delta","newDelta","newSizes","viewItemIndex","newMinDelta","newMaxDelta","resizeIndex","onSashEnd","fire","onViewChange","indexOf","relayout","resizeView","Error","Busy","distributeViewSizes","flexibleViewItems","flexibleSize","push","getViewSize","insertBefore","children","onChangeDisposable","onDidChange","containerDisposable","removeChild","viewSize","splice","opts","getHorizontalSashTop","s","getSashPosition","getHorizontalSashWidth","Object","assign","getVerticalSashLeft","getVerticalSashHeight","sashEventMapper","startY","currentY","startX","currentX","onStart","onDidStart","onStartDisposable","onChange","onEnd","onDidEnd","onEndDisposable","onDidResetDisposable","onDidReset","element","overloadMinDelta","overloadMaxDelta","upItems","upSizes","downItems","downSizes","snapped","snapView","deltaUp","viewDelta","deltaDown","lowPriorityIndex","emptyDelta","updateScrollableElement","setScrollDimensions","scrollHeight","scrollWidth","previous","collapsesDown","expandsDown","reverseViews","reverse","collapsesUp","expandsUp","position","snappedBefore","snappedAfter"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { $, addDisposableListener, append, scheduleAtNextAnimationFrame } from '../../dom.js';\nimport { Sash } from '../sash/sash.js';\nimport { SmoothScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { pushToEnd, pushToStart, range } from '../../../common/arrays.js';\nimport { Color } from '../../../common/color.js';\nimport { Emitter, Event } from '../../../common/event.js';\nimport { combinedDisposable, Disposable, toDisposable } from '../../../common/lifecycle.js';\nimport { clamp } from '../../../common/numbers.js';\nimport { Scrollable } from '../../../common/scrollable.js';\nimport * as types from '../../../common/types.js';\nimport './splitview.css';\nconst defaultStyles = {\n    separatorBorder: Color.transparent\n};\nclass ViewItem {\n    constructor(container, view, size, disposable) {\n        this.container = container;\n        this.view = view;\n        this.disposable = disposable;\n        this._cachedVisibleSize = undefined;\n        if (typeof size === 'number') {\n            this._size = size;\n            this._cachedVisibleSize = undefined;\n            container.classList.add('visible');\n        }\n        else {\n            this._size = 0;\n            this._cachedVisibleSize = size.cachedVisibleSize;\n        }\n    }\n    set size(size) {\n        this._size = size;\n    }\n    get size() {\n        return this._size;\n    }\n    get visible() {\n        return typeof this._cachedVisibleSize === 'undefined';\n    }\n    setVisible(visible, size) {\n        if (visible === this.visible) {\n            return;\n        }\n        if (visible) {\n            this.size = clamp(this._cachedVisibleSize, this.viewMinimumSize, this.viewMaximumSize);\n            this._cachedVisibleSize = undefined;\n        }\n        else {\n            this._cachedVisibleSize = typeof size === 'number' ? size : this.size;\n            this.size = 0;\n        }\n        this.container.classList.toggle('visible', visible);\n        if (this.view.setVisible) {\n            this.view.setVisible(visible);\n        }\n    }\n    get minimumSize() { return this.visible ? this.view.minimumSize : 0; }\n    get viewMinimumSize() { return this.view.minimumSize; }\n    get maximumSize() { return this.visible ? this.view.maximumSize : 0; }\n    get viewMaximumSize() { return this.view.maximumSize; }\n    get priority() { return this.view.priority; }\n    get snap() { return !!this.view.snap; }\n    set enabled(enabled) {\n        this.container.style.pointerEvents = enabled ? '' : 'none';\n    }\n    layout(offset, layoutContext) {\n        this.layoutContainer(offset);\n        this.view.layout(this.size, offset, layoutContext);\n    }\n    dispose() {\n        this.disposable.dispose();\n        return this.view;\n    }\n}\nclass VerticalViewItem extends ViewItem {\n    layoutContainer(offset) {\n        this.container.style.top = `${offset}px`;\n        this.container.style.height = `${this.size}px`;\n    }\n}\nclass HorizontalViewItem extends ViewItem {\n    layoutContainer(offset) {\n        this.container.style.left = `${offset}px`;\n        this.container.style.width = `${this.size}px`;\n    }\n}\nvar State;\n(function (State) {\n    State[State[\"Idle\"] = 0] = \"Idle\";\n    State[State[\"Busy\"] = 1] = \"Busy\";\n})(State || (State = {}));\nexport var Sizing;\n(function (Sizing) {\n    Sizing.Distribute = { type: 'distribute' };\n    function Split(index) { return { type: 'split', index }; }\n    Sizing.Split = Split;\n    function Invisible(cachedVisibleSize) { return { type: 'invisible', cachedVisibleSize }; }\n    Sizing.Invisible = Invisible;\n})(Sizing || (Sizing = {}));\nexport class SplitView extends Disposable {\n    constructor(container, options = {}) {\n        var _a, _b;\n        super();\n        this.size = 0;\n        this.contentSize = 0;\n        this.proportions = undefined;\n        this.viewItems = [];\n        this.sashItems = [];\n        this.state = State.Idle;\n        this._onDidSashChange = this._register(new Emitter());\n        this.onDidSashChange = this._onDidSashChange.event;\n        this._onDidSashReset = this._register(new Emitter());\n        this._startSnappingEnabled = true;\n        this._endSnappingEnabled = true;\n        this.orientation = types.isUndefined(options.orientation) ? 0 /* VERTICAL */ : options.orientation;\n        this.inverseAltBehavior = !!options.inverseAltBehavior;\n        this.proportionalLayout = types.isUndefined(options.proportionalLayout) ? true : !!options.proportionalLayout;\n        this.getSashOrthogonalSize = options.getSashOrthogonalSize;\n        this.el = document.createElement('div');\n        this.el.classList.add('monaco-split-view2');\n        this.el.classList.add(this.orientation === 0 /* VERTICAL */ ? 'vertical' : 'horizontal');\n        container.appendChild(this.el);\n        this.sashContainer = append(this.el, $('.sash-container'));\n        this.viewContainer = $('.split-view-container');\n        this.scrollable = new Scrollable(125, scheduleAtNextAnimationFrame);\n        this.scrollableElement = this._register(new SmoothScrollableElement(this.viewContainer, {\n            vertical: this.orientation === 0 /* VERTICAL */ ? ((_a = options.scrollbarVisibility) !== null && _a !== void 0 ? _a : 1 /* Auto */) : 2 /* Hidden */,\n            horizontal: this.orientation === 1 /* HORIZONTAL */ ? ((_b = options.scrollbarVisibility) !== null && _b !== void 0 ? _b : 1 /* Auto */) : 2 /* Hidden */\n        }, this.scrollable));\n        this.onDidScroll = this.scrollableElement.onScroll;\n        this._register(this.onDidScroll(e => {\n            this.viewContainer.scrollTop = e.scrollTop;\n            this.viewContainer.scrollLeft = e.scrollLeft;\n        }));\n        append(this.el, this.scrollableElement.getDomNode());\n        this.style(options.styles || defaultStyles);\n        // We have an existing set of view, add them now\n        if (options.descriptor) {\n            this.size = options.descriptor.size;\n            options.descriptor.views.forEach((viewDescriptor, index) => {\n                const sizing = types.isUndefined(viewDescriptor.visible) || viewDescriptor.visible ? viewDescriptor.size : { type: 'invisible', cachedVisibleSize: viewDescriptor.size };\n                const view = viewDescriptor.view;\n                this.doAddView(view, sizing, index, true);\n            });\n            // Initialize content size and proportions for first layout\n            this.contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n            this.saveProportions();\n        }\n    }\n    get orthogonalStartSash() { return this._orthogonalStartSash; }\n    set orthogonalStartSash(sash) {\n        for (const sashItem of this.sashItems) {\n            sashItem.sash.orthogonalStartSash = sash;\n        }\n        this._orthogonalStartSash = sash;\n    }\n    get orthogonalEndSash() { return this._orthogonalEndSash; }\n    set orthogonalEndSash(sash) {\n        for (const sashItem of this.sashItems) {\n            sashItem.sash.orthogonalEndSash = sash;\n        }\n        this._orthogonalEndSash = sash;\n    }\n    get startSnappingEnabled() { return this._startSnappingEnabled; }\n    set startSnappingEnabled(startSnappingEnabled) {\n        if (this._startSnappingEnabled === startSnappingEnabled) {\n            return;\n        }\n        this._startSnappingEnabled = startSnappingEnabled;\n        this.updateSashEnablement();\n    }\n    get endSnappingEnabled() { return this._endSnappingEnabled; }\n    set endSnappingEnabled(endSnappingEnabled) {\n        if (this._endSnappingEnabled === endSnappingEnabled) {\n            return;\n        }\n        this._endSnappingEnabled = endSnappingEnabled;\n        this.updateSashEnablement();\n    }\n    style(styles) {\n        if (styles.separatorBorder.isTransparent()) {\n            this.el.classList.remove('separator-border');\n            this.el.style.removeProperty('--separator-border');\n        }\n        else {\n            this.el.classList.add('separator-border');\n            this.el.style.setProperty('--separator-border', styles.separatorBorder.toString());\n        }\n    }\n    addView(view, size, index = this.viewItems.length, skipLayout) {\n        this.doAddView(view, size, index, skipLayout);\n    }\n    layout(size, layoutContext) {\n        const previousSize = Math.max(this.size, this.contentSize);\n        this.size = size;\n        this.layoutContext = layoutContext;\n        if (!this.proportions) {\n            const indexes = range(this.viewItems.length);\n            const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1 /* Low */);\n            const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2 /* High */);\n            this.resize(this.viewItems.length - 1, size - previousSize, undefined, lowPriorityIndexes, highPriorityIndexes);\n        }\n        else {\n            for (let i = 0; i < this.viewItems.length; i++) {\n                const item = this.viewItems[i];\n                item.size = clamp(Math.round(this.proportions[i] * size), item.minimumSize, item.maximumSize);\n            }\n        }\n        this.distributeEmptySpace();\n        this.layoutViews();\n    }\n    saveProportions() {\n        if (this.proportionalLayout && this.contentSize > 0) {\n            this.proportions = this.viewItems.map(i => i.size / this.contentSize);\n        }\n    }\n    onSashStart({ sash, start, alt }) {\n        for (const item of this.viewItems) {\n            item.enabled = false;\n        }\n        const index = this.sashItems.findIndex(item => item.sash === sash);\n        // This way, we can press Alt while we resize a sash, macOS style!\n        const disposable = combinedDisposable(addDisposableListener(document.body, 'keydown', e => resetSashDragState(this.sashDragState.current, e.altKey)), addDisposableListener(document.body, 'keyup', () => resetSashDragState(this.sashDragState.current, false)));\n        const resetSashDragState = (start, alt) => {\n            const sizes = this.viewItems.map(i => i.size);\n            let minDelta = Number.NEGATIVE_INFINITY;\n            let maxDelta = Number.POSITIVE_INFINITY;\n            if (this.inverseAltBehavior) {\n                alt = !alt;\n            }\n            if (alt) {\n                // When we're using the last sash with Alt, we're resizing\n                // the view to the left/up, instead of right/down as usual\n                // Thus, we must do the inverse of the usual\n                const isLastSash = index === this.sashItems.length - 1;\n                if (isLastSash) {\n                    const viewItem = this.viewItems[index];\n                    minDelta = (viewItem.minimumSize - viewItem.size) / 2;\n                    maxDelta = (viewItem.maximumSize - viewItem.size) / 2;\n                }\n                else {\n                    const viewItem = this.viewItems[index + 1];\n                    minDelta = (viewItem.size - viewItem.maximumSize) / 2;\n                    maxDelta = (viewItem.size - viewItem.minimumSize) / 2;\n                }\n            }\n            let snapBefore;\n            let snapAfter;\n            if (!alt) {\n                const upIndexes = range(index, -1);\n                const downIndexes = range(index + 1, this.viewItems.length);\n                const minDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].minimumSize - sizes[i]), 0);\n                const maxDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].viewMaximumSize - sizes[i]), 0);\n                const maxDeltaDown = downIndexes.length === 0 ? Number.POSITIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].minimumSize), 0);\n                const minDeltaDown = downIndexes.length === 0 ? Number.NEGATIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].viewMaximumSize), 0);\n                const minDelta = Math.max(minDeltaUp, minDeltaDown);\n                const maxDelta = Math.min(maxDeltaDown, maxDeltaUp);\n                const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n                const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n                if (typeof snapBeforeIndex === 'number') {\n                    const viewItem = this.viewItems[snapBeforeIndex];\n                    const halfSize = Math.floor(viewItem.viewMinimumSize / 2);\n                    snapBefore = {\n                        index: snapBeforeIndex,\n                        limitDelta: viewItem.visible ? minDelta - halfSize : minDelta + halfSize,\n                        size: viewItem.size\n                    };\n                }\n                if (typeof snapAfterIndex === 'number') {\n                    const viewItem = this.viewItems[snapAfterIndex];\n                    const halfSize = Math.floor(viewItem.viewMinimumSize / 2);\n                    snapAfter = {\n                        index: snapAfterIndex,\n                        limitDelta: viewItem.visible ? maxDelta + halfSize : maxDelta - halfSize,\n                        size: viewItem.size\n                    };\n                }\n            }\n            this.sashDragState = { start, current: start, index, sizes, minDelta, maxDelta, alt, snapBefore, snapAfter, disposable };\n        };\n        resetSashDragState(start, alt);\n    }\n    onSashChange({ current }) {\n        const { index, start, sizes, alt, minDelta, maxDelta, snapBefore, snapAfter } = this.sashDragState;\n        this.sashDragState.current = current;\n        const delta = current - start;\n        const newDelta = this.resize(index, delta, sizes, undefined, undefined, minDelta, maxDelta, snapBefore, snapAfter);\n        if (alt) {\n            const isLastSash = index === this.sashItems.length - 1;\n            const newSizes = this.viewItems.map(i => i.size);\n            const viewItemIndex = isLastSash ? index : index + 1;\n            const viewItem = this.viewItems[viewItemIndex];\n            const newMinDelta = viewItem.size - viewItem.maximumSize;\n            const newMaxDelta = viewItem.size - viewItem.minimumSize;\n            const resizeIndex = isLastSash ? index - 1 : index + 1;\n            this.resize(resizeIndex, -newDelta, newSizes, undefined, undefined, newMinDelta, newMaxDelta);\n        }\n        this.distributeEmptySpace();\n        this.layoutViews();\n    }\n    onSashEnd(index) {\n        this._onDidSashChange.fire(index);\n        this.sashDragState.disposable.dispose();\n        this.saveProportions();\n        for (const item of this.viewItems) {\n            item.enabled = true;\n        }\n    }\n    onViewChange(item, size) {\n        const index = this.viewItems.indexOf(item);\n        if (index < 0 || index >= this.viewItems.length) {\n            return;\n        }\n        size = typeof size === 'number' ? size : item.size;\n        size = clamp(size, item.minimumSize, item.maximumSize);\n        if (this.inverseAltBehavior && index > 0) {\n            // In this case, we want the view to grow or shrink both sides equally\n            // so we just resize the \"left\" side by half and let `resize` do the clamping magic\n            this.resize(index - 1, Math.floor((item.size - size) / 2));\n            this.distributeEmptySpace();\n            this.layoutViews();\n        }\n        else {\n            item.size = size;\n            this.relayout([index], undefined);\n        }\n    }\n    resizeView(index, size) {\n        if (this.state !== State.Idle) {\n            throw new Error('Cant modify splitview');\n        }\n        this.state = State.Busy;\n        if (index < 0 || index >= this.viewItems.length) {\n            return;\n        }\n        const indexes = range(this.viewItems.length).filter(i => i !== index);\n        const lowPriorityIndexes = [...indexes.filter(i => this.viewItems[i].priority === 1 /* Low */), index];\n        const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2 /* High */);\n        const item = this.viewItems[index];\n        size = Math.round(size);\n        size = clamp(size, item.minimumSize, Math.min(item.maximumSize, this.size));\n        item.size = size;\n        this.relayout(lowPriorityIndexes, highPriorityIndexes);\n        this.state = State.Idle;\n    }\n    distributeViewSizes() {\n        const flexibleViewItems = [];\n        let flexibleSize = 0;\n        for (const item of this.viewItems) {\n            if (item.maximumSize - item.minimumSize > 0) {\n                flexibleViewItems.push(item);\n                flexibleSize += item.size;\n            }\n        }\n        const size = Math.floor(flexibleSize / flexibleViewItems.length);\n        for (const item of flexibleViewItems) {\n            item.size = clamp(size, item.minimumSize, item.maximumSize);\n        }\n        const indexes = range(this.viewItems.length);\n        const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1 /* Low */);\n        const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2 /* High */);\n        this.relayout(lowPriorityIndexes, highPriorityIndexes);\n    }\n    getViewSize(index) {\n        if (index < 0 || index >= this.viewItems.length) {\n            return -1;\n        }\n        return this.viewItems[index].size;\n    }\n    doAddView(view, size, index = this.viewItems.length, skipLayout) {\n        if (this.state !== State.Idle) {\n            throw new Error('Cant modify splitview');\n        }\n        this.state = State.Busy;\n        // Add view\n        const container = $('.split-view-view');\n        if (index === this.viewItems.length) {\n            this.viewContainer.appendChild(container);\n        }\n        else {\n            this.viewContainer.insertBefore(container, this.viewContainer.children.item(index));\n        }\n        const onChangeDisposable = view.onDidChange(size => this.onViewChange(item, size));\n        const containerDisposable = toDisposable(() => this.viewContainer.removeChild(container));\n        const disposable = combinedDisposable(onChangeDisposable, containerDisposable);\n        let viewSize;\n        if (typeof size === 'number') {\n            viewSize = size;\n        }\n        else if (size.type === 'split') {\n            viewSize = this.getViewSize(size.index) / 2;\n        }\n        else if (size.type === 'invisible') {\n            viewSize = { cachedVisibleSize: size.cachedVisibleSize };\n        }\n        else {\n            viewSize = view.minimumSize;\n        }\n        const item = this.orientation === 0 /* VERTICAL */\n            ? new VerticalViewItem(container, view, viewSize, disposable)\n            : new HorizontalViewItem(container, view, viewSize, disposable);\n        this.viewItems.splice(index, 0, item);\n        // Add sash\n        if (this.viewItems.length > 1) {\n            let opts = { orthogonalStartSash: this.orthogonalStartSash, orthogonalEndSash: this.orthogonalEndSash };\n            const sash = this.orientation === 0 /* VERTICAL */\n                ? new Sash(this.sashContainer, { getHorizontalSashTop: s => this.getSashPosition(s), getHorizontalSashWidth: this.getSashOrthogonalSize }, Object.assign(Object.assign({}, opts), { orientation: 1 /* HORIZONTAL */ }))\n                : new Sash(this.sashContainer, { getVerticalSashLeft: s => this.getSashPosition(s), getVerticalSashHeight: this.getSashOrthogonalSize }, Object.assign(Object.assign({}, opts), { orientation: 0 /* VERTICAL */ }));\n            const sashEventMapper = this.orientation === 0 /* VERTICAL */\n                ? (e) => ({ sash, start: e.startY, current: e.currentY, alt: e.altKey })\n                : (e) => ({ sash, start: e.startX, current: e.currentX, alt: e.altKey });\n            const onStart = Event.map(sash.onDidStart, sashEventMapper);\n            const onStartDisposable = onStart(this.onSashStart, this);\n            const onChange = Event.map(sash.onDidChange, sashEventMapper);\n            const onChangeDisposable = onChange(this.onSashChange, this);\n            const onEnd = Event.map(sash.onDidEnd, () => this.sashItems.findIndex(item => item.sash === sash));\n            const onEndDisposable = onEnd(this.onSashEnd, this);\n            const onDidResetDisposable = sash.onDidReset(() => {\n                const index = this.sashItems.findIndex(item => item.sash === sash);\n                const upIndexes = range(index, -1);\n                const downIndexes = range(index + 1, this.viewItems.length);\n                const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n                const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n                if (typeof snapBeforeIndex === 'number' && !this.viewItems[snapBeforeIndex].visible) {\n                    return;\n                }\n                if (typeof snapAfterIndex === 'number' && !this.viewItems[snapAfterIndex].visible) {\n                    return;\n                }\n                this._onDidSashReset.fire(index);\n            });\n            const disposable = combinedDisposable(onStartDisposable, onChangeDisposable, onEndDisposable, onDidResetDisposable, sash);\n            const sashItem = { sash, disposable };\n            this.sashItems.splice(index - 1, 0, sashItem);\n        }\n        container.appendChild(view.element);\n        let highPriorityIndexes;\n        if (typeof size !== 'number' && size.type === 'split') {\n            highPriorityIndexes = [size.index];\n        }\n        if (!skipLayout) {\n            this.relayout([index], highPriorityIndexes);\n        }\n        this.state = State.Idle;\n        if (!skipLayout && typeof size !== 'number' && size.type === 'distribute') {\n            this.distributeViewSizes();\n        }\n    }\n    relayout(lowPriorityIndexes, highPriorityIndexes) {\n        const contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n        this.resize(this.viewItems.length - 1, this.size - contentSize, undefined, lowPriorityIndexes, highPriorityIndexes);\n        this.distributeEmptySpace();\n        this.layoutViews();\n        this.saveProportions();\n    }\n    resize(index, delta, sizes = this.viewItems.map(i => i.size), lowPriorityIndexes, highPriorityIndexes, overloadMinDelta = Number.NEGATIVE_INFINITY, overloadMaxDelta = Number.POSITIVE_INFINITY, snapBefore, snapAfter) {\n        if (index < 0 || index >= this.viewItems.length) {\n            return 0;\n        }\n        const upIndexes = range(index, -1);\n        const downIndexes = range(index + 1, this.viewItems.length);\n        if (highPriorityIndexes) {\n            for (const index of highPriorityIndexes) {\n                pushToStart(upIndexes, index);\n                pushToStart(downIndexes, index);\n            }\n        }\n        if (lowPriorityIndexes) {\n            for (const index of lowPriorityIndexes) {\n                pushToEnd(upIndexes, index);\n                pushToEnd(downIndexes, index);\n            }\n        }\n        const upItems = upIndexes.map(i => this.viewItems[i]);\n        const upSizes = upIndexes.map(i => sizes[i]);\n        const downItems = downIndexes.map(i => this.viewItems[i]);\n        const downSizes = downIndexes.map(i => sizes[i]);\n        const minDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].minimumSize - sizes[i]), 0);\n        const maxDeltaUp = upIndexes.reduce((r, i) => r + (this.viewItems[i].maximumSize - sizes[i]), 0);\n        const maxDeltaDown = downIndexes.length === 0 ? Number.POSITIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].minimumSize), 0);\n        const minDeltaDown = downIndexes.length === 0 ? Number.NEGATIVE_INFINITY : downIndexes.reduce((r, i) => r + (sizes[i] - this.viewItems[i].maximumSize), 0);\n        const minDelta = Math.max(minDeltaUp, minDeltaDown, overloadMinDelta);\n        const maxDelta = Math.min(maxDeltaDown, maxDeltaUp, overloadMaxDelta);\n        let snapped = false;\n        if (snapBefore) {\n            const snapView = this.viewItems[snapBefore.index];\n            const visible = delta >= snapBefore.limitDelta;\n            snapped = visible !== snapView.visible;\n            snapView.setVisible(visible, snapBefore.size);\n        }\n        if (!snapped && snapAfter) {\n            const snapView = this.viewItems[snapAfter.index];\n            const visible = delta < snapAfter.limitDelta;\n            snapped = visible !== snapView.visible;\n            snapView.setVisible(visible, snapAfter.size);\n        }\n        if (snapped) {\n            return this.resize(index, delta, sizes, lowPriorityIndexes, highPriorityIndexes, overloadMinDelta, overloadMaxDelta);\n        }\n        delta = clamp(delta, minDelta, maxDelta);\n        for (let i = 0, deltaUp = delta; i < upItems.length; i++) {\n            const item = upItems[i];\n            const size = clamp(upSizes[i] + deltaUp, item.minimumSize, item.maximumSize);\n            const viewDelta = size - upSizes[i];\n            deltaUp -= viewDelta;\n            item.size = size;\n        }\n        for (let i = 0, deltaDown = delta; i < downItems.length; i++) {\n            const item = downItems[i];\n            const size = clamp(downSizes[i] - deltaDown, item.minimumSize, item.maximumSize);\n            const viewDelta = size - downSizes[i];\n            deltaDown += viewDelta;\n            item.size = size;\n        }\n        return delta;\n    }\n    distributeEmptySpace(lowPriorityIndex) {\n        const contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n        let emptyDelta = this.size - contentSize;\n        const indexes = range(this.viewItems.length - 1, -1);\n        const lowPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 1 /* Low */);\n        const highPriorityIndexes = indexes.filter(i => this.viewItems[i].priority === 2 /* High */);\n        for (const index of highPriorityIndexes) {\n            pushToStart(indexes, index);\n        }\n        for (const index of lowPriorityIndexes) {\n            pushToEnd(indexes, index);\n        }\n        if (typeof lowPriorityIndex === 'number') {\n            pushToEnd(indexes, lowPriorityIndex);\n        }\n        for (let i = 0; emptyDelta !== 0 && i < indexes.length; i++) {\n            const item = this.viewItems[indexes[i]];\n            const size = clamp(item.size + emptyDelta, item.minimumSize, item.maximumSize);\n            const viewDelta = size - item.size;\n            emptyDelta -= viewDelta;\n            item.size = size;\n        }\n    }\n    layoutViews() {\n        // Save new content size\n        this.contentSize = this.viewItems.reduce((r, i) => r + i.size, 0);\n        // Layout views\n        let offset = 0;\n        for (const viewItem of this.viewItems) {\n            viewItem.layout(offset, this.layoutContext);\n            offset += viewItem.size;\n        }\n        // Layout sashes\n        this.sashItems.forEach(item => item.sash.layout());\n        this.updateSashEnablement();\n        this.updateScrollableElement();\n    }\n    updateScrollableElement() {\n        if (this.orientation === 0 /* VERTICAL */) {\n            this.scrollableElement.setScrollDimensions({\n                height: this.size,\n                scrollHeight: this.contentSize\n            });\n        }\n        else {\n            this.scrollableElement.setScrollDimensions({\n                width: this.size,\n                scrollWidth: this.contentSize\n            });\n        }\n    }\n    updateSashEnablement() {\n        let previous = false;\n        const collapsesDown = this.viewItems.map(i => previous = (i.size - i.minimumSize > 0) || previous);\n        previous = false;\n        const expandsDown = this.viewItems.map(i => previous = (i.maximumSize - i.size > 0) || previous);\n        const reverseViews = [...this.viewItems].reverse();\n        previous = false;\n        const collapsesUp = reverseViews.map(i => previous = (i.size - i.minimumSize > 0) || previous).reverse();\n        previous = false;\n        const expandsUp = reverseViews.map(i => previous = (i.maximumSize - i.size > 0) || previous).reverse();\n        let position = 0;\n        for (let index = 0; index < this.sashItems.length; index++) {\n            const { sash } = this.sashItems[index];\n            const viewItem = this.viewItems[index];\n            position += viewItem.size;\n            const min = !(collapsesDown[index] && expandsUp[index + 1]);\n            const max = !(expandsDown[index] && collapsesUp[index + 1]);\n            if (min && max) {\n                const upIndexes = range(index, -1);\n                const downIndexes = range(index + 1, this.viewItems.length);\n                const snapBeforeIndex = this.findFirstSnapIndex(upIndexes);\n                const snapAfterIndex = this.findFirstSnapIndex(downIndexes);\n                const snappedBefore = typeof snapBeforeIndex === 'number' && !this.viewItems[snapBeforeIndex].visible;\n                const snappedAfter = typeof snapAfterIndex === 'number' && !this.viewItems[snapAfterIndex].visible;\n                if (snappedBefore && collapsesUp[index] && (position > 0 || this.startSnappingEnabled)) {\n                    sash.state = 1 /* Minimum */;\n                }\n                else if (snappedAfter && collapsesDown[index] && (position < this.contentSize || this.endSnappingEnabled)) {\n                    sash.state = 2 /* Maximum */;\n                }\n                else {\n                    sash.state = 0 /* Disabled */;\n                }\n            }\n            else if (min && !max) {\n                sash.state = 1 /* Minimum */;\n            }\n            else if (!min && max) {\n                sash.state = 2 /* Maximum */;\n            }\n            else {\n                sash.state = 3 /* Enabled */;\n            }\n        }\n    }\n    getSashPosition(sash) {\n        let position = 0;\n        for (let i = 0; i < this.sashItems.length; i++) {\n            position += this.viewItems[i].size;\n            if (this.sashItems[i].sash === sash) {\n                return position;\n            }\n        }\n        return 0;\n    }\n    findFirstSnapIndex(indexes) {\n        // visible views first\n        for (const index of indexes) {\n            const viewItem = this.viewItems[index];\n            if (!viewItem.visible) {\n                continue;\n            }\n            if (viewItem.snap) {\n                return index;\n            }\n        }\n        // then, hidden views\n        for (const index of indexes) {\n            const viewItem = this.viewItems[index];\n            if (viewItem.visible && viewItem.maximumSize - viewItem.minimumSize > 0) {\n                return undefined;\n            }\n            if (!viewItem.visible && viewItem.snap) {\n                return index;\n            }\n        }\n        return undefined;\n    }\n    dispose() {\n        super.dispose();\n        this.viewItems.forEach(i => i.dispose());\n        this.viewItems = [];\n        this.sashItems.forEach(i => i.disposable.dispose());\n        this.sashItems = [];\n    }\n}\n"]},"metadata":{},"sourceType":"module"}