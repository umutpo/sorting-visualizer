{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { IdleValue, raceCancellation } from '../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { assertType } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { EditorStateCancellationTokenSource } from '../../browser/core/editorState.js';\nimport { EditorAction, EditorCommand, registerEditorAction, registerEditorCommand, registerEditorContribution, registerModelAndPositionCommand } from '../../browser/editorExtensions.js';\nimport { IBulkEditService, ResourceEdit } from '../../browser/services/bulkEditService.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { RenameProviderRegistry } from '../../common/modes.js';\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfigurationService.js';\nimport { MessageController } from '../message/messageController.js';\nimport * as nls from '../../../nls.js';\nimport { Extensions } from '../../../platform/configuration/common/configurationRegistry.js';\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { IEditorProgressService } from '../../../platform/progress/common/progress.js';\nimport { Registry } from '../../../platform/registry/common/platform.js';\nimport { CONTEXT_RENAME_INPUT_VISIBLE, RenameInputField } from './renameInputField.js';\n\nclass RenameSkeleton {\n  constructor(model, position) {\n    this.model = model;\n    this.position = position;\n    this._providerRenameIdx = 0;\n    this._providers = RenameProviderRegistry.ordered(model);\n  }\n\n  hasProvider() {\n    return this._providers.length > 0;\n  }\n\n  resolveRenameLocation(token) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const rejects = [];\n\n      for (this._providerRenameIdx = 0; this._providerRenameIdx < this._providers.length; this._providerRenameIdx++) {\n        const provider = this._providers[this._providerRenameIdx];\n\n        if (!provider.resolveRenameLocation) {\n          break;\n        }\n\n        let res = yield provider.resolveRenameLocation(this.model, this.position, token);\n\n        if (!res) {\n          continue;\n        }\n\n        if (res.rejectReason) {\n          rejects.push(res.rejectReason);\n          continue;\n        }\n\n        return res;\n      }\n\n      const word = this.model.getWordAtPosition(this.position);\n\n      if (!word) {\n        return {\n          range: Range.fromPositions(this.position),\n          text: '',\n          rejectReason: rejects.length > 0 ? rejects.join('\\n') : undefined\n        };\n      }\n\n      return {\n        range: new Range(this.position.lineNumber, word.startColumn, this.position.lineNumber, word.endColumn),\n        text: word.word,\n        rejectReason: rejects.length > 0 ? rejects.join('\\n') : undefined\n      };\n    });\n  }\n\n  provideRenameEdits(newName, token) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._provideRenameEdits(newName, this._providerRenameIdx, [], token);\n    });\n  }\n\n  _provideRenameEdits(newName, i, rejects, token) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const provider = this._providers[i];\n\n      if (!provider) {\n        return {\n          edits: [],\n          rejectReason: rejects.join('\\n')\n        };\n      }\n\n      const result = yield provider.provideRenameEdits(this.model, this.position, newName, token);\n\n      if (!result) {\n        return this._provideRenameEdits(newName, i + 1, rejects.concat(nls.localize('no result', \"No result.\")), token);\n      } else if (result.rejectReason) {\n        return this._provideRenameEdits(newName, i + 1, rejects.concat(result.rejectReason), token);\n      }\n\n      return result;\n    });\n  }\n\n}\n\nexport function rename(model, position, newName) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const skeleton = new RenameSkeleton(model, position);\n    const loc = yield skeleton.resolveRenameLocation(CancellationToken.None);\n\n    if (loc === null || loc === void 0 ? void 0 : loc.rejectReason) {\n      return {\n        edits: [],\n        rejectReason: loc.rejectReason\n      };\n    }\n\n    return skeleton.provideRenameEdits(newName, CancellationToken.None);\n  });\n} // ---  register actions and commands\n\nlet RenameController = class RenameController {\n  constructor(editor, _instaService, _notificationService, _bulkEditService, _progressService, _logService, _configService) {\n    this.editor = editor;\n    this._instaService = _instaService;\n    this._notificationService = _notificationService;\n    this._bulkEditService = _bulkEditService;\n    this._progressService = _progressService;\n    this._logService = _logService;\n    this._configService = _configService;\n    this._dispoableStore = new DisposableStore();\n    this._cts = new CancellationTokenSource();\n    this._renameInputField = this._dispoableStore.add(new IdleValue(() => this._dispoableStore.add(this._instaService.createInstance(RenameInputField, this.editor, ['acceptRenameInput', 'acceptRenameInputWithPreview']))));\n  }\n\n  static get(editor) {\n    return editor.getContribution(RenameController.ID);\n  }\n\n  dispose() {\n    this._dispoableStore.dispose();\n\n    this._cts.dispose(true);\n  }\n\n  run() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this._cts.dispose(true);\n\n      if (!this.editor.hasModel()) {\n        return undefined;\n      }\n\n      const position = this.editor.getPosition();\n      const skeleton = new RenameSkeleton(this.editor.getModel(), position);\n\n      if (!skeleton.hasProvider()) {\n        return undefined;\n      }\n\n      this._cts = new EditorStateCancellationTokenSource(this.editor, 4\n      /* Position */\n      | 1\n      /* Value */\n      ); // resolve rename location\n\n      let loc;\n\n      try {\n        const resolveLocationOperation = skeleton.resolveRenameLocation(this._cts.token);\n\n        this._progressService.showWhile(resolveLocationOperation, 250);\n\n        loc = yield resolveLocationOperation;\n      } catch (e) {\n        MessageController.get(this.editor).showMessage(e || nls.localize('resolveRenameLocationFailed', \"An unknown error occurred while resolving rename location\"), position);\n        return undefined;\n      }\n\n      if (!loc) {\n        return undefined;\n      }\n\n      if (loc.rejectReason) {\n        MessageController.get(this.editor).showMessage(loc.rejectReason, position);\n        return undefined;\n      }\n\n      if (this._cts.token.isCancellationRequested) {\n        return undefined;\n      }\n\n      this._cts.dispose();\n\n      this._cts = new EditorStateCancellationTokenSource(this.editor, 4\n      /* Position */\n      | 1\n      /* Value */\n      , loc.range); // do rename at location\n\n      let selection = this.editor.getSelection();\n      let selectionStart = 0;\n      let selectionEnd = loc.text.length;\n\n      if (!Range.isEmpty(selection) && !Range.spansMultipleLines(selection) && Range.containsRange(loc.range, selection)) {\n        selectionStart = Math.max(0, selection.startColumn - loc.range.startColumn);\n        selectionEnd = Math.min(loc.range.endColumn, selection.endColumn) - loc.range.startColumn;\n      }\n\n      const supportPreview = this._bulkEditService.hasPreviewHandler() && this._configService.getValue(this.editor.getModel().uri, 'editor.rename.enablePreview');\n\n      const inputFieldResult = yield this._renameInputField.value.getInput(loc.range, loc.text, selectionStart, selectionEnd, supportPreview, this._cts.token); // no result, only hint to focus the editor or not\n\n      if (typeof inputFieldResult === 'boolean') {\n        if (inputFieldResult) {\n          this.editor.focus();\n        }\n\n        return undefined;\n      }\n\n      this.editor.focus();\n      const renameOperation = raceCancellation(skeleton.provideRenameEdits(inputFieldResult.newName, this._cts.token), this._cts.token).then(renameResult => __awaiter(this, void 0, void 0, function* () {\n        if (!renameResult || !this.editor.hasModel()) {\n          return;\n        }\n\n        if (renameResult.rejectReason) {\n          this._notificationService.info(renameResult.rejectReason);\n\n          return;\n        } // collapse selection to active end\n\n\n        this.editor.setSelection(Range.fromPositions(this.editor.getSelection().getPosition()));\n\n        this._bulkEditService.apply(ResourceEdit.convert(renameResult), {\n          editor: this.editor,\n          showPreview: inputFieldResult.wantsPreview,\n          label: nls.localize('label', \"Renaming '{0}'\", loc === null || loc === void 0 ? void 0 : loc.text),\n          quotableLabel: nls.localize('quotableLabel', \"Renaming {0}\", loc === null || loc === void 0 ? void 0 : loc.text)\n        }).then(result => {\n          if (result.ariaSummary) {\n            alert(nls.localize('aria', \"Successfully renamed '{0}' to '{1}'. Summary: {2}\", loc.text, inputFieldResult.newName, result.ariaSummary));\n          }\n        }).catch(err => {\n          this._notificationService.error(nls.localize('rename.failedApply', \"Rename failed to apply edits\"));\n\n          this._logService.error(err);\n        });\n      }), err => {\n        this._notificationService.error(nls.localize('rename.failed', \"Rename failed to compute edits\"));\n\n        this._logService.error(err);\n      });\n\n      this._progressService.showWhile(renameOperation, 250);\n\n      return renameOperation;\n    });\n  }\n\n  acceptRenameInput(wantsPreview) {\n    this._renameInputField.value.acceptInput(wantsPreview);\n  }\n\n  cancelRenameInput() {\n    this._renameInputField.value.cancelInput(true);\n  }\n\n};\nRenameController.ID = 'editor.contrib.renameController';\nRenameController = __decorate([__param(1, IInstantiationService), __param(2, INotificationService), __param(3, IBulkEditService), __param(4, IEditorProgressService), __param(5, ILogService), __param(6, ITextResourceConfigurationService)], RenameController); // ---- action implementation\n\nexport class RenameAction extends EditorAction {\n  constructor() {\n    super({\n      id: 'editor.action.rename',\n      label: nls.localize('rename.label', \"Rename Symbol\"),\n      alias: 'Rename Symbol',\n      precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasRenameProvider),\n      kbOpts: {\n        kbExpr: EditorContextKeys.editorTextFocus,\n        primary: 60\n        /* F2 */\n        ,\n        weight: 100\n        /* EditorContrib */\n\n      },\n      contextMenuOpts: {\n        group: '1_modification',\n        order: 1.1\n      }\n    });\n  }\n\n  runCommand(accessor, args) {\n    const editorService = accessor.get(ICodeEditorService);\n    const [uri, pos] = Array.isArray(args) && args || [undefined, undefined];\n\n    if (URI.isUri(uri) && Position.isIPosition(pos)) {\n      return editorService.openCodeEditor({\n        resource: uri\n      }, editorService.getActiveCodeEditor()).then(editor => {\n        if (!editor) {\n          return;\n        }\n\n        editor.setPosition(pos);\n        editor.invokeWithinContext(accessor => {\n          this.reportTelemetry(accessor, editor);\n          return this.run(accessor, editor);\n        });\n      }, onUnexpectedError);\n    }\n\n    return super.runCommand(accessor, args);\n  }\n\n  run(accessor, editor) {\n    const controller = RenameController.get(editor);\n\n    if (controller) {\n      return controller.run();\n    }\n\n    return Promise.resolve();\n  }\n\n}\nregisterEditorContribution(RenameController.ID, RenameController);\nregisterEditorAction(RenameAction);\nconst RenameCommand = EditorCommand.bindToContribution(RenameController.get);\nregisterEditorCommand(new RenameCommand({\n  id: 'acceptRenameInput',\n  precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n  handler: x => x.acceptRenameInput(false),\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 3\n    /* Enter */\n\n  }\n}));\nregisterEditorCommand(new RenameCommand({\n  id: 'acceptRenameInputWithPreview',\n  precondition: ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE, ContextKeyExpr.has('config.editor.rename.enablePreview')),\n  handler: x => x.acceptRenameInput(true),\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 1024\n    /* Shift */\n    + 3\n    /* Enter */\n\n  }\n}));\nregisterEditorCommand(new RenameCommand({\n  id: 'cancelRenameInput',\n  precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n  handler: x => x.cancelRenameInput(),\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 99,\n    kbExpr: EditorContextKeys.focus,\n    primary: 9\n    /* Escape */\n    ,\n    secondary: [1024\n    /* Shift */\n    | 9\n    /* Escape */\n    ]\n  }\n})); // ---- api bridge command\n\nregisterModelAndPositionCommand('_executeDocumentRenameProvider', function (model, position) {\n  for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    args[_key - 2] = arguments[_key];\n  }\n\n  const [newName] = args;\n  assertType(typeof newName === 'string');\n  return rename(model, position, newName);\n});\nregisterModelAndPositionCommand('_executePrepareRename', function (model, position) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const skeleton = new RenameSkeleton(model, position);\n    const loc = yield skeleton.resolveRenameLocation(CancellationToken.None);\n\n    if (loc === null || loc === void 0 ? void 0 : loc.rejectReason) {\n      throw new Error(loc.rejectReason);\n    }\n\n    return loc;\n  });\n}); //todo@jrieken use editor options world\n\nRegistry.as(Extensions.Configuration).registerConfiguration({\n  id: 'editor',\n  properties: {\n    'editor.rename.enablePreview': {\n      scope: 5\n      /* LANGUAGE_OVERRIDABLE */\n      ,\n      description: nls.localize('enablePreview', \"Enable/disable the ability to preview changes before renaming\"),\n      default: true,\n      type: 'boolean'\n    }\n  }\n});","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/contrib/rename/rename.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","alert","IdleValue","raceCancellation","CancellationToken","CancellationTokenSource","onUnexpectedError","DisposableStore","assertType","URI","EditorStateCancellationTokenSource","EditorAction","EditorCommand","registerEditorAction","registerEditorCommand","registerEditorContribution","registerModelAndPositionCommand","IBulkEditService","ResourceEdit","ICodeEditorService","Position","Range","EditorContextKeys","RenameProviderRegistry","ITextResourceConfigurationService","MessageController","nls","Extensions","ContextKeyExpr","IInstantiationService","ILogService","INotificationService","IEditorProgressService","Registry","CONTEXT_RENAME_INPUT_VISIBLE","RenameInputField","RenameSkeleton","constructor","model","position","_providerRenameIdx","_providers","ordered","hasProvider","resolveRenameLocation","token","rejects","provider","res","rejectReason","push","word","getWordAtPosition","range","fromPositions","text","join","undefined","lineNumber","startColumn","endColumn","provideRenameEdits","newName","_provideRenameEdits","edits","concat","localize","rename","skeleton","loc","None","RenameController","editor","_instaService","_notificationService","_bulkEditService","_progressService","_logService","_configService","_dispoableStore","_cts","_renameInputField","add","createInstance","get","getContribution","ID","dispose","run","hasModel","getPosition","getModel","resolveLocationOperation","showWhile","showMessage","isCancellationRequested","selection","getSelection","selectionStart","selectionEnd","isEmpty","spansMultipleLines","containsRange","Math","max","min","supportPreview","hasPreviewHandler","getValue","uri","inputFieldResult","getInput","focus","renameOperation","renameResult","info","setSelection","convert","showPreview","wantsPreview","label","quotableLabel","ariaSummary","catch","err","error","acceptRenameInput","acceptInput","cancelRenameInput","cancelInput","RenameAction","id","alias","precondition","and","writable","hasRenameProvider","kbOpts","kbExpr","editorTextFocus","primary","weight","contextMenuOpts","group","order","runCommand","accessor","args","editorService","pos","Array","isArray","isUri","isIPosition","openCodeEditor","resource","getActiveCodeEditor","setPosition","invokeWithinContext","reportTelemetry","controller","RenameCommand","bindToContribution","handler","x","has","secondary","Error","as","Configuration","registerConfiguration","properties","scope","description","default","type"],"mappings":"AAAA;AACA;AACA;AACA;AACA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,IAAIQ,OAAO,GAAI,QAAQ,KAAKA,OAAd,IAA0B,UAAUC,UAAV,EAAsBC,SAAtB,EAAiC;AACrE,SAAO,UAAUhB,MAAV,EAAkBC,GAAlB,EAAuB;AAAEe,IAAAA,SAAS,CAAChB,MAAD,EAASC,GAAT,EAAcc,UAAd,CAAT;AAAqC,GAArE;AACH,CAFD;;AAGA,IAAIE,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAASC,KAAT,CAAeC,KAAf,EAAsB;AAAE,WAAOA,KAAK,YAAYH,CAAjB,GAAqBG,KAArB,GAA6B,IAAIH,CAAJ,CAAM,UAAUI,OAAV,EAAmB;AAAEA,MAAAA,OAAO,CAACD,KAAD,CAAP;AAAiB,KAA5C,CAApC;AAAoF;;AAC5G,SAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAT,CAAN,EAAyB,UAAUD,OAAV,EAAmBE,MAAnB,EAA2B;AACvD,aAASC,SAAT,CAAmBJ,KAAnB,EAA0B;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAACQ,IAAV,CAAeN,KAAf,CAAD,CAAJ;AAA8B,OAApC,CAAqC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC3F,aAASC,QAAT,CAAkBR,KAAlB,EAAyB;AAAE,UAAI;AAAEK,QAAAA,IAAI,CAACP,SAAS,CAAC,OAAD,CAAT,CAAmBE,KAAnB,CAAD,CAAJ;AAAkC,OAAxC,CAAyC,OAAOO,CAAP,EAAU;AAAEJ,QAAAA,MAAM,CAACI,CAAD,CAAN;AAAY;AAAE;;AAC9F,aAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,MAAAA,MAAM,CAACC,IAAP,GAAcT,OAAO,CAACQ,MAAM,CAACT,KAAR,CAArB,GAAsCD,KAAK,CAACU,MAAM,CAACT,KAAR,CAAL,CAAoBW,IAApB,CAAyBP,SAAzB,EAAoCI,QAApC,CAAtC;AAAsF;;AAC9GH,IAAAA,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAV,CAAgBjB,OAAhB,EAAyBC,UAAU,IAAI,EAAvC,CAAb,EAAyDU,IAAzD,EAAD,CAAJ;AACH,GALM,CAAP;AAMH,CARD;;AASA,SAASO,KAAT,QAAsB,uCAAtB;AACA,SAASC,SAAT,EAAoBC,gBAApB,QAA4C,+BAA5C;AACA,SAASC,iBAAT,EAA4BC,uBAA5B,QAA2D,sCAA3D;AACA,SAASC,iBAAT,QAAkC,gCAAlC;AACA,SAASC,eAAT,QAAgC,mCAAhC;AACA,SAASC,UAAT,QAA2B,+BAA3B;AACA,SAASC,GAAT,QAAoB,6BAApB;AACA,SAASC,kCAAT,QAAmD,mCAAnD;AACA,SAASC,YAAT,EAAuBC,aAAvB,EAAsCC,oBAAtC,EAA4DC,qBAA5D,EAAmFC,0BAAnF,EAA+GC,+BAA/G,QAAsJ,mCAAtJ;AACA,SAASC,gBAAT,EAA2BC,YAA3B,QAA+C,2CAA/C;AACA,SAASC,kBAAT,QAAmC,6CAAnC;AACA,SAASC,QAAT,QAAyB,+BAAzB;AACA,SAASC,KAAT,QAAsB,4BAAtB;AACA,SAASC,iBAAT,QAAkC,mCAAlC;AACA,SAASC,sBAAT,QAAuC,uBAAvC;AACA,SAASC,iCAAT,QAAkD,2DAAlD;AACA,SAASC,iBAAT,QAAkC,iCAAlC;AACA,OAAO,KAAKC,GAAZ,MAAqB,iBAArB;AACA,SAASC,UAAT,QAA2B,iEAA3B;AACA,SAASC,cAAT,QAA+B,mDAA/B;AACA,SAASC,qBAAT,QAAsC,yDAAtC;AACA,SAASC,WAAT,QAA4B,qCAA5B;AACA,SAASC,oBAAT,QAAqC,uDAArC;AACA,SAASC,sBAAT,QAAuC,+CAAvC;AACA,SAASC,QAAT,QAAyB,+CAAzB;AACA,SAASC,4BAAT,EAAuCC,gBAAvC,QAA+D,uBAA/D;;AACA,MAAMC,cAAN,CAAqB;AACjBC,EAAAA,WAAW,CAACC,KAAD,EAAQC,QAAR,EAAkB;AACzB,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKC,kBAAL,GAA0B,CAA1B;AACA,SAAKC,UAAL,GAAkBlB,sBAAsB,CAACmB,OAAvB,CAA+BJ,KAA/B,CAAlB;AACH;;AACDK,EAAAA,WAAW,GAAG;AACV,WAAO,KAAKF,UAAL,CAAgBvE,MAAhB,GAAyB,CAAhC;AACH;;AACD0E,EAAAA,qBAAqB,CAACC,KAAD,EAAQ;AACzB,WAAO/D,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,YAAMgE,OAAO,GAAG,EAAhB;;AACA,WAAK,KAAKN,kBAAL,GAA0B,CAA/B,EAAkC,KAAKA,kBAAL,GAA0B,KAAKC,UAAL,CAAgBvE,MAA5E,EAAoF,KAAKsE,kBAAL,EAApF,EAA+G;AAC3G,cAAMO,QAAQ,GAAG,KAAKN,UAAL,CAAgB,KAAKD,kBAArB,CAAjB;;AACA,YAAI,CAACO,QAAQ,CAACH,qBAAd,EAAqC;AACjC;AACH;;AACD,YAAII,GAAG,GAAG,MAAMD,QAAQ,CAACH,qBAAT,CAA+B,KAAKN,KAApC,EAA2C,KAAKC,QAAhD,EAA0DM,KAA1D,CAAhB;;AACA,YAAI,CAACG,GAAL,EAAU;AACN;AACH;;AACD,YAAIA,GAAG,CAACC,YAAR,EAAsB;AAClBH,UAAAA,OAAO,CAACI,IAAR,CAAaF,GAAG,CAACC,YAAjB;AACA;AACH;;AACD,eAAOD,GAAP;AACH;;AACD,YAAMG,IAAI,GAAG,KAAKb,KAAL,CAAWc,iBAAX,CAA6B,KAAKb,QAAlC,CAAb;;AACA,UAAI,CAACY,IAAL,EAAW;AACP,eAAO;AACHE,UAAAA,KAAK,EAAEhC,KAAK,CAACiC,aAAN,CAAoB,KAAKf,QAAzB,CADJ;AAEHgB,UAAAA,IAAI,EAAE,EAFH;AAGHN,UAAAA,YAAY,EAAEH,OAAO,CAAC5E,MAAR,GAAiB,CAAjB,GAAqB4E,OAAO,CAACU,IAAR,CAAa,IAAb,CAArB,GAA0CC;AAHrD,SAAP;AAKH;;AACD,aAAO;AACHJ,QAAAA,KAAK,EAAE,IAAIhC,KAAJ,CAAU,KAAKkB,QAAL,CAAcmB,UAAxB,EAAoCP,IAAI,CAACQ,WAAzC,EAAsD,KAAKpB,QAAL,CAAcmB,UAApE,EAAgFP,IAAI,CAACS,SAArF,CADJ;AAEHL,QAAAA,IAAI,EAAEJ,IAAI,CAACA,IAFR;AAGHF,QAAAA,YAAY,EAAEH,OAAO,CAAC5E,MAAR,GAAiB,CAAjB,GAAqB4E,OAAO,CAACU,IAAR,CAAa,IAAb,CAArB,GAA0CC;AAHrD,OAAP;AAKH,KA9Be,CAAhB;AA+BH;;AACDI,EAAAA,kBAAkB,CAACC,OAAD,EAAUjB,KAAV,EAAiB;AAC/B,WAAO/D,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,aAAO,KAAKiF,mBAAL,CAAyBD,OAAzB,EAAkC,KAAKtB,kBAAvC,EAA2D,EAA3D,EAA+DK,KAA/D,CAAP;AACH,KAFe,CAAhB;AAGH;;AACDkB,EAAAA,mBAAmB,CAACD,OAAD,EAAUrF,CAAV,EAAaqE,OAAb,EAAsBD,KAAtB,EAA6B;AAC5C,WAAO/D,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,YAAMiE,QAAQ,GAAG,KAAKN,UAAL,CAAgBhE,CAAhB,CAAjB;;AACA,UAAI,CAACsE,QAAL,EAAe;AACX,eAAO;AACHiB,UAAAA,KAAK,EAAE,EADJ;AAEHf,UAAAA,YAAY,EAAEH,OAAO,CAACU,IAAR,CAAa,IAAb;AAFX,SAAP;AAIH;;AACD,YAAM3D,MAAM,GAAG,MAAMkD,QAAQ,CAACc,kBAAT,CAA4B,KAAKvB,KAAjC,EAAwC,KAAKC,QAA7C,EAAuDuB,OAAvD,EAAgEjB,KAAhE,CAArB;;AACA,UAAI,CAAChD,MAAL,EAAa;AACT,eAAO,KAAKkE,mBAAL,CAAyBD,OAAzB,EAAkCrF,CAAC,GAAG,CAAtC,EAAyCqE,OAAO,CAACmB,MAAR,CAAevC,GAAG,CAACwC,QAAJ,CAAa,WAAb,EAA0B,YAA1B,CAAf,CAAzC,EAAkGrB,KAAlG,CAAP;AACH,OAFD,MAGK,IAAIhD,MAAM,CAACoD,YAAX,EAAyB;AAC1B,eAAO,KAAKc,mBAAL,CAAyBD,OAAzB,EAAkCrF,CAAC,GAAG,CAAtC,EAAyCqE,OAAO,CAACmB,MAAR,CAAepE,MAAM,CAACoD,YAAtB,CAAzC,EAA8EJ,KAA9E,CAAP;AACH;;AACD,aAAOhD,MAAP;AACH,KAhBe,CAAhB;AAiBH;;AAlEgB;;AAoErB,OAAO,SAASsE,MAAT,CAAgB7B,KAAhB,EAAuBC,QAAvB,EAAiCuB,OAAjC,EAA0C;AAC7C,SAAOhF,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,UAAMsF,QAAQ,GAAG,IAAIhC,cAAJ,CAAmBE,KAAnB,EAA0BC,QAA1B,CAAjB;AACA,UAAM8B,GAAG,GAAG,MAAMD,QAAQ,CAACxB,qBAAT,CAA+BxC,iBAAiB,CAACkE,IAAjD,CAAlB;;AACA,QAAID,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACpB,YAAlD,EAAgE;AAC5D,aAAO;AAAEe,QAAAA,KAAK,EAAE,EAAT;AAAaf,QAAAA,YAAY,EAAEoB,GAAG,CAACpB;AAA/B,OAAP;AACH;;AACD,WAAOmB,QAAQ,CAACP,kBAAT,CAA4BC,OAA5B,EAAqC1D,iBAAiB,CAACkE,IAAvD,CAAP;AACH,GAPe,CAAhB;AAQH,C,CACD;;AACA,IAAIC,gBAAgB,GAAG,MAAMA,gBAAN,CAAuB;AAC1ClC,EAAAA,WAAW,CAACmC,MAAD,EAASC,aAAT,EAAwBC,oBAAxB,EAA8CC,gBAA9C,EAAgEC,gBAAhE,EAAkFC,WAAlF,EAA+FC,cAA/F,EAA+G;AACtH,SAAKN,MAAL,GAAcA,MAAd;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,oBAAL,GAA4BA,oBAA5B;AACA,SAAKC,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAKC,eAAL,GAAuB,IAAIxE,eAAJ,EAAvB;AACA,SAAKyE,IAAL,GAAY,IAAI3E,uBAAJ,EAAZ;AACA,SAAK4E,iBAAL,GAAyB,KAAKF,eAAL,CAAqBG,GAArB,CAAyB,IAAIhF,SAAJ,CAAc,MAAM,KAAK6E,eAAL,CAAqBG,GAArB,CAAyB,KAAKT,aAAL,CAAmBU,cAAnB,CAAkChD,gBAAlC,EAAoD,KAAKqC,MAAzD,EAAiE,CAAC,mBAAD,EAAsB,8BAAtB,CAAjE,CAAzB,CAApB,CAAzB,CAAzB;AACH;;AACS,SAAHY,GAAG,CAACZ,MAAD,EAAS;AACf,WAAOA,MAAM,CAACa,eAAP,CAAuBd,gBAAgB,CAACe,EAAxC,CAAP;AACH;;AACDC,EAAAA,OAAO,GAAG;AACN,SAAKR,eAAL,CAAqBQ,OAArB;;AACA,SAAKP,IAAL,CAAUO,OAAV,CAAkB,IAAlB;AACH;;AACDC,EAAAA,GAAG,GAAG;AACF,WAAO1G,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,WAAKkG,IAAL,CAAUO,OAAV,CAAkB,IAAlB;;AACA,UAAI,CAAC,KAAKf,MAAL,CAAYiB,QAAZ,EAAL,EAA6B;AACzB,eAAOhC,SAAP;AACH;;AACD,YAAMlB,QAAQ,GAAG,KAAKiC,MAAL,CAAYkB,WAAZ,EAAjB;AACA,YAAMtB,QAAQ,GAAG,IAAIhC,cAAJ,CAAmB,KAAKoC,MAAL,CAAYmB,QAAZ,EAAnB,EAA2CpD,QAA3C,CAAjB;;AACA,UAAI,CAAC6B,QAAQ,CAACzB,WAAT,EAAL,EAA6B;AACzB,eAAOc,SAAP;AACH;;AACD,WAAKuB,IAAL,GAAY,IAAItE,kCAAJ,CAAuC,KAAK8D,MAA5C,EAAoD;AAAE;AAAF,QAAmB;AAAE;AAAzE,OAAZ,CAVgD,CAWhD;;AACA,UAAIH,GAAJ;;AACA,UAAI;AACA,cAAMuB,wBAAwB,GAAGxB,QAAQ,CAACxB,qBAAT,CAA+B,KAAKoC,IAAL,CAAUnC,KAAzC,CAAjC;;AACA,aAAK+B,gBAAL,CAAsBiB,SAAtB,CAAgCD,wBAAhC,EAA0D,GAA1D;;AACAvB,QAAAA,GAAG,GAAG,MAAMuB,wBAAZ;AACH,OAJD,CAKA,OAAOjG,CAAP,EAAU;AACN8B,QAAAA,iBAAiB,CAAC2D,GAAlB,CAAsB,KAAKZ,MAA3B,EAAmCsB,WAAnC,CAA+CnG,CAAC,IAAI+B,GAAG,CAACwC,QAAJ,CAAa,6BAAb,EAA4C,2DAA5C,CAApD,EAA8J3B,QAA9J;AACA,eAAOkB,SAAP;AACH;;AACD,UAAI,CAACY,GAAL,EAAU;AACN,eAAOZ,SAAP;AACH;;AACD,UAAIY,GAAG,CAACpB,YAAR,EAAsB;AAClBxB,QAAAA,iBAAiB,CAAC2D,GAAlB,CAAsB,KAAKZ,MAA3B,EAAmCsB,WAAnC,CAA+CzB,GAAG,CAACpB,YAAnD,EAAiEV,QAAjE;AACA,eAAOkB,SAAP;AACH;;AACD,UAAI,KAAKuB,IAAL,CAAUnC,KAAV,CAAgBkD,uBAApB,EAA6C;AACzC,eAAOtC,SAAP;AACH;;AACD,WAAKuB,IAAL,CAAUO,OAAV;;AACA,WAAKP,IAAL,GAAY,IAAItE,kCAAJ,CAAuC,KAAK8D,MAA5C,EAAoD;AAAE;AAAF,QAAmB;AAAE;AAAzE,QAAsFH,GAAG,CAAChB,KAA1F,CAAZ,CAjCgD,CAkChD;;AACA,UAAI2C,SAAS,GAAG,KAAKxB,MAAL,CAAYyB,YAAZ,EAAhB;AACA,UAAIC,cAAc,GAAG,CAArB;AACA,UAAIC,YAAY,GAAG9B,GAAG,CAACd,IAAJ,CAASrF,MAA5B;;AACA,UAAI,CAACmD,KAAK,CAAC+E,OAAN,CAAcJ,SAAd,CAAD,IAA6B,CAAC3E,KAAK,CAACgF,kBAAN,CAAyBL,SAAzB,CAA9B,IAAqE3E,KAAK,CAACiF,aAAN,CAAoBjC,GAAG,CAAChB,KAAxB,EAA+B2C,SAA/B,CAAzE,EAAoH;AAChHE,QAAAA,cAAc,GAAGK,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYR,SAAS,CAACrC,WAAV,GAAwBU,GAAG,CAAChB,KAAJ,CAAUM,WAA9C,CAAjB;AACAwC,QAAAA,YAAY,GAAGI,IAAI,CAACE,GAAL,CAASpC,GAAG,CAAChB,KAAJ,CAAUO,SAAnB,EAA8BoC,SAAS,CAACpC,SAAxC,IAAqDS,GAAG,CAAChB,KAAJ,CAAUM,WAA9E;AACH;;AACD,YAAM+C,cAAc,GAAG,KAAK/B,gBAAL,CAAsBgC,iBAAtB,MAA6C,KAAK7B,cAAL,CAAoB8B,QAApB,CAA6B,KAAKpC,MAAL,CAAYmB,QAAZ,GAAuBkB,GAApD,EAAyD,6BAAzD,CAApE;;AACA,YAAMC,gBAAgB,GAAG,MAAM,KAAK7B,iBAAL,CAAuB7F,KAAvB,CAA6B2H,QAA7B,CAAsC1C,GAAG,CAAChB,KAA1C,EAAiDgB,GAAG,CAACd,IAArD,EAA2D2C,cAA3D,EAA2EC,YAA3E,EAAyFO,cAAzF,EAAyG,KAAK1B,IAAL,CAAUnC,KAAnH,CAA/B,CA3CgD,CA4ChD;;AACA,UAAI,OAAOiE,gBAAP,KAA4B,SAAhC,EAA2C;AACvC,YAAIA,gBAAJ,EAAsB;AAClB,eAAKtC,MAAL,CAAYwC,KAAZ;AACH;;AACD,eAAOvD,SAAP;AACH;;AACD,WAAKe,MAAL,CAAYwC,KAAZ;AACA,YAAMC,eAAe,GAAG9G,gBAAgB,CAACiE,QAAQ,CAACP,kBAAT,CAA4BiD,gBAAgB,CAAChD,OAA7C,EAAsD,KAAKkB,IAAL,CAAUnC,KAAhE,CAAD,EAAyE,KAAKmC,IAAL,CAAUnC,KAAnF,CAAhB,CAA0G9C,IAA1G,CAAgHmH,YAAD,IAAkBpI,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAClM,YAAI,CAACoI,YAAD,IAAiB,CAAC,KAAK1C,MAAL,CAAYiB,QAAZ,EAAtB,EAA8C;AAC1C;AACH;;AACD,YAAIyB,YAAY,CAACjE,YAAjB,EAA+B;AAC3B,eAAKyB,oBAAL,CAA0ByC,IAA1B,CAA+BD,YAAY,CAACjE,YAA5C;;AACA;AACH,SAPiM,CAQlM;;;AACA,aAAKuB,MAAL,CAAY4C,YAAZ,CAAyB/F,KAAK,CAACiC,aAAN,CAAoB,KAAKkB,MAAL,CAAYyB,YAAZ,GAA2BP,WAA3B,EAApB,CAAzB;;AACA,aAAKf,gBAAL,CAAsB3E,KAAtB,CAA4BkB,YAAY,CAACmG,OAAb,CAAqBH,YAArB,CAA5B,EAAgE;AAC5D1C,UAAAA,MAAM,EAAE,KAAKA,MAD+C;AAE5D8C,UAAAA,WAAW,EAAER,gBAAgB,CAACS,YAF8B;AAG5DC,UAAAA,KAAK,EAAE9F,GAAG,CAACwC,QAAJ,CAAa,OAAb,EAAsB,gBAAtB,EAAwCG,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACd,IAAtF,CAHqD;AAI5DkE,UAAAA,aAAa,EAAE/F,GAAG,CAACwC,QAAJ,CAAa,eAAb,EAA8B,cAA9B,EAA8CG,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACd,IAA5F;AAJ6C,SAAhE,EAKGxD,IALH,CAKQF,MAAM,IAAI;AACd,cAAIA,MAAM,CAAC6H,WAAX,EAAwB;AACpBzH,YAAAA,KAAK,CAACyB,GAAG,CAACwC,QAAJ,CAAa,MAAb,EAAqB,mDAArB,EAA0EG,GAAG,CAACd,IAA9E,EAAoFuD,gBAAgB,CAAChD,OAArG,EAA8GjE,MAAM,CAAC6H,WAArH,CAAD,CAAL;AACH;AACJ,SATD,EASGC,KATH,CASSC,GAAG,IAAI;AACZ,eAAKlD,oBAAL,CAA0BmD,KAA1B,CAAgCnG,GAAG,CAACwC,QAAJ,CAAa,oBAAb,EAAmC,8BAAnC,CAAhC;;AACA,eAAKW,WAAL,CAAiBgD,KAAjB,CAAuBD,GAAvB;AACH,SAZD;AAaH,OAvBiK,CAA1I,EAuBpBA,GAAG,IAAI;AACP,aAAKlD,oBAAL,CAA0BmD,KAA1B,CAAgCnG,GAAG,CAACwC,QAAJ,CAAa,eAAb,EAA8B,gCAA9B,CAAhC;;AACA,aAAKW,WAAL,CAAiBgD,KAAjB,CAAuBD,GAAvB;AACH,OA1BuB,CAAxB;;AA2BA,WAAKhD,gBAAL,CAAsBiB,SAAtB,CAAgCoB,eAAhC,EAAiD,GAAjD;;AACA,aAAOA,eAAP;AACH,KAjFe,CAAhB;AAkFH;;AACDa,EAAAA,iBAAiB,CAACP,YAAD,EAAe;AAC5B,SAAKtC,iBAAL,CAAuB7F,KAAvB,CAA6B2I,WAA7B,CAAyCR,YAAzC;AACH;;AACDS,EAAAA,iBAAiB,GAAG;AAChB,SAAK/C,iBAAL,CAAuB7F,KAAvB,CAA6B6I,WAA7B,CAAyC,IAAzC;AACH;;AA7GyC,CAA9C;AA+GA1D,gBAAgB,CAACe,EAAjB,GAAsB,iCAAtB;AACAf,gBAAgB,GAAG5G,UAAU,CAAC,CAC1BgB,OAAO,CAAC,CAAD,EAAIkD,qBAAJ,CADmB,EAE1BlD,OAAO,CAAC,CAAD,EAAIoD,oBAAJ,CAFmB,EAG1BpD,OAAO,CAAC,CAAD,EAAIsC,gBAAJ,CAHmB,EAI1BtC,OAAO,CAAC,CAAD,EAAIqD,sBAAJ,CAJmB,EAK1BrD,OAAO,CAAC,CAAD,EAAImD,WAAJ,CALmB,EAM1BnD,OAAO,CAAC,CAAD,EAAI6C,iCAAJ,CANmB,CAAD,EAO1B+C,gBAP0B,CAA7B,C,CAQA;;AACA,OAAO,MAAM2D,YAAN,SAA2BvH,YAA3B,CAAwC;AAC3C0B,EAAAA,WAAW,GAAG;AACV,UAAM;AACF8F,MAAAA,EAAE,EAAE,sBADF;AAEFX,MAAAA,KAAK,EAAE9F,GAAG,CAACwC,QAAJ,CAAa,cAAb,EAA6B,eAA7B,CAFL;AAGFkE,MAAAA,KAAK,EAAE,eAHL;AAIFC,MAAAA,YAAY,EAAEzG,cAAc,CAAC0G,GAAf,CAAmBhH,iBAAiB,CAACiH,QAArC,EAA+CjH,iBAAiB,CAACkH,iBAAjE,CAJZ;AAKFC,MAAAA,MAAM,EAAE;AACJC,QAAAA,MAAM,EAAEpH,iBAAiB,CAACqH,eADtB;AAEJC,QAAAA,OAAO,EAAE;AAAG;AAFR;AAGJC,QAAAA,MAAM,EAAE;AAAI;;AAHR,OALN;AAUFC,MAAAA,eAAe,EAAE;AACbC,QAAAA,KAAK,EAAE,gBADM;AAEbC,QAAAA,KAAK,EAAE;AAFM;AAVf,KAAN;AAeH;;AACDC,EAAAA,UAAU,CAACC,QAAD,EAAWC,IAAX,EAAiB;AACvB,UAAMC,aAAa,GAAGF,QAAQ,CAAC9D,GAAT,CAAajE,kBAAb,CAAtB;AACA,UAAM,CAAC0F,GAAD,EAAMwC,GAAN,IAAaC,KAAK,CAACC,OAAN,CAAcJ,IAAd,KAAuBA,IAAvB,IAA+B,CAAC1F,SAAD,EAAYA,SAAZ,CAAlD;;AACA,QAAIhD,GAAG,CAAC+I,KAAJ,CAAU3C,GAAV,KAAkBzF,QAAQ,CAACqI,WAAT,CAAqBJ,GAArB,CAAtB,EAAiD;AAC7C,aAAOD,aAAa,CAACM,cAAd,CAA6B;AAAEC,QAAAA,QAAQ,EAAE9C;AAAZ,OAA7B,EAAgDuC,aAAa,CAACQ,mBAAd,EAAhD,EAAqF7J,IAArF,CAA0FyE,MAAM,IAAI;AACvG,YAAI,CAACA,MAAL,EAAa;AACT;AACH;;AACDA,QAAAA,MAAM,CAACqF,WAAP,CAAmBR,GAAnB;AACA7E,QAAAA,MAAM,CAACsF,mBAAP,CAA2BZ,QAAQ,IAAI;AACnC,eAAKa,eAAL,CAAqBb,QAArB,EAA+B1E,MAA/B;AACA,iBAAO,KAAKgB,GAAL,CAAS0D,QAAT,EAAmB1E,MAAnB,CAAP;AACH,SAHD;AAIH,OATM,EASJlE,iBATI,CAAP;AAUH;;AACD,WAAO,MAAM2I,UAAN,CAAiBC,QAAjB,EAA2BC,IAA3B,CAAP;AACH;;AACD3D,EAAAA,GAAG,CAAC0D,QAAD,EAAW1E,MAAX,EAAmB;AAClB,UAAMwF,UAAU,GAAGzF,gBAAgB,CAACa,GAAjB,CAAqBZ,MAArB,CAAnB;;AACA,QAAIwF,UAAJ,EAAgB;AACZ,aAAOA,UAAU,CAACxE,GAAX,EAAP;AACH;;AACD,WAAOlG,OAAO,CAACD,OAAR,EAAP;AACH;;AAzC0C;AA2C/C0B,0BAA0B,CAACwD,gBAAgB,CAACe,EAAlB,EAAsBf,gBAAtB,CAA1B;AACA1D,oBAAoB,CAACqH,YAAD,CAApB;AACA,MAAM+B,aAAa,GAAGrJ,aAAa,CAACsJ,kBAAd,CAAiC3F,gBAAgB,CAACa,GAAlD,CAAtB;AACAtE,qBAAqB,CAAC,IAAImJ,aAAJ,CAAkB;AACpC9B,EAAAA,EAAE,EAAE,mBADgC;AAEpCE,EAAAA,YAAY,EAAEnG,4BAFsB;AAGpCiI,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACtC,iBAAF,CAAoB,KAApB,CAHsB;AAIpCW,EAAAA,MAAM,EAAE;AACJI,IAAAA,MAAM,EAAE;AAAI;AAAJ,MAA0B,EAD9B;AAEJH,IAAAA,MAAM,EAAEpH,iBAAiB,CAAC0F,KAFtB;AAGJ4B,IAAAA,OAAO,EAAE;AAAE;;AAHP;AAJ4B,CAAlB,CAAD,CAArB;AAUA9H,qBAAqB,CAAC,IAAImJ,aAAJ,CAAkB;AACpC9B,EAAAA,EAAE,EAAE,8BADgC;AAEpCE,EAAAA,YAAY,EAAEzG,cAAc,CAAC0G,GAAf,CAAmBpG,4BAAnB,EAAiDN,cAAc,CAACyI,GAAf,CAAmB,oCAAnB,CAAjD,CAFsB;AAGpCF,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACtC,iBAAF,CAAoB,IAApB,CAHsB;AAIpCW,EAAAA,MAAM,EAAE;AACJI,IAAAA,MAAM,EAAE;AAAI;AAAJ,MAA0B,EAD9B;AAEJH,IAAAA,MAAM,EAAEpH,iBAAiB,CAAC0F,KAFtB;AAGJ4B,IAAAA,OAAO,EAAE;AAAK;AAAL,MAAmB;AAAE;;AAH1B;AAJ4B,CAAlB,CAAD,CAArB;AAUA9H,qBAAqB,CAAC,IAAImJ,aAAJ,CAAkB;AACpC9B,EAAAA,EAAE,EAAE,mBADgC;AAEpCE,EAAAA,YAAY,EAAEnG,4BAFsB;AAGpCiI,EAAAA,OAAO,EAAEC,CAAC,IAAIA,CAAC,CAACpC,iBAAF,EAHsB;AAIpCS,EAAAA,MAAM,EAAE;AACJI,IAAAA,MAAM,EAAE;AAAI;AAAJ,MAA0B,EAD9B;AAEJH,IAAAA,MAAM,EAAEpH,iBAAiB,CAAC0F,KAFtB;AAGJ4B,IAAAA,OAAO,EAAE;AAAE;AAHP;AAIJ0B,IAAAA,SAAS,EAAE,CAAC;AAAK;AAAL,MAAmB;AAAE;AAAtB;AAJP;AAJ4B,CAAlB,CAAD,CAArB,C,CAWA;;AACAtJ,+BAA+B,CAAC,gCAAD,EAAmC,UAAUsB,KAAV,EAAiBC,QAAjB,EAAoC;AAAA,oCAAN4G,IAAM;AAANA,IAAAA,IAAM;AAAA;;AAClG,QAAM,CAACrF,OAAD,IAAYqF,IAAlB;AACA3I,EAAAA,UAAU,CAAC,OAAOsD,OAAP,KAAmB,QAApB,CAAV;AACA,SAAOK,MAAM,CAAC7B,KAAD,EAAQC,QAAR,EAAkBuB,OAAlB,CAAb;AACH,CAJ8B,CAA/B;AAKA9C,+BAA+B,CAAC,uBAAD,EAA0B,UAAUsB,KAAV,EAAiBC,QAAjB,EAA2B;AAChF,SAAOzD,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;AAChD,UAAMsF,QAAQ,GAAG,IAAIhC,cAAJ,CAAmBE,KAAnB,EAA0BC,QAA1B,CAAjB;AACA,UAAM8B,GAAG,GAAG,MAAMD,QAAQ,CAACxB,qBAAT,CAA+BxC,iBAAiB,CAACkE,IAAjD,CAAlB;;AACA,QAAID,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,KAAK,CAA7B,GAAiC,KAAK,CAAtC,GAA0CA,GAAG,CAACpB,YAAlD,EAAgE;AAC5D,YAAM,IAAIsH,KAAJ,CAAUlG,GAAG,CAACpB,YAAd,CAAN;AACH;;AACD,WAAOoB,GAAP;AACH,GAPe,CAAhB;AAQH,CAT8B,CAA/B,C,CAUA;;AACApC,QAAQ,CAACuI,EAAT,CAAY7I,UAAU,CAAC8I,aAAvB,EAAsCC,qBAAtC,CAA4D;AACxDvC,EAAAA,EAAE,EAAE,QADoD;AAExDwC,EAAAA,UAAU,EAAE;AACR,mCAA+B;AAC3BC,MAAAA,KAAK,EAAE;AAAE;AADkB;AAE3BC,MAAAA,WAAW,EAAEnJ,GAAG,CAACwC,QAAJ,CAAa,eAAb,EAA8B,+DAA9B,CAFc;AAG3B4G,MAAAA,OAAO,EAAE,IAHkB;AAI3BC,MAAAA,IAAI,EAAE;AAJqB;AADvB;AAF4C,CAA5D","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { IdleValue, raceCancellation } from '../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { assertType } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { EditorStateCancellationTokenSource } from '../../browser/core/editorState.js';\nimport { EditorAction, EditorCommand, registerEditorAction, registerEditorCommand, registerEditorContribution, registerModelAndPositionCommand } from '../../browser/editorExtensions.js';\nimport { IBulkEditService, ResourceEdit } from '../../browser/services/bulkEditService.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { EditorContextKeys } from '../../common/editorContextKeys.js';\nimport { RenameProviderRegistry } from '../../common/modes.js';\nimport { ITextResourceConfigurationService } from '../../common/services/textResourceConfigurationService.js';\nimport { MessageController } from '../message/messageController.js';\nimport * as nls from '../../../nls.js';\nimport { Extensions } from '../../../platform/configuration/common/configurationRegistry.js';\nimport { ContextKeyExpr } from '../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { IEditorProgressService } from '../../../platform/progress/common/progress.js';\nimport { Registry } from '../../../platform/registry/common/platform.js';\nimport { CONTEXT_RENAME_INPUT_VISIBLE, RenameInputField } from './renameInputField.js';\nclass RenameSkeleton {\n    constructor(model, position) {\n        this.model = model;\n        this.position = position;\n        this._providerRenameIdx = 0;\n        this._providers = RenameProviderRegistry.ordered(model);\n    }\n    hasProvider() {\n        return this._providers.length > 0;\n    }\n    resolveRenameLocation(token) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const rejects = [];\n            for (this._providerRenameIdx = 0; this._providerRenameIdx < this._providers.length; this._providerRenameIdx++) {\n                const provider = this._providers[this._providerRenameIdx];\n                if (!provider.resolveRenameLocation) {\n                    break;\n                }\n                let res = yield provider.resolveRenameLocation(this.model, this.position, token);\n                if (!res) {\n                    continue;\n                }\n                if (res.rejectReason) {\n                    rejects.push(res.rejectReason);\n                    continue;\n                }\n                return res;\n            }\n            const word = this.model.getWordAtPosition(this.position);\n            if (!word) {\n                return {\n                    range: Range.fromPositions(this.position),\n                    text: '',\n                    rejectReason: rejects.length > 0 ? rejects.join('\\n') : undefined\n                };\n            }\n            return {\n                range: new Range(this.position.lineNumber, word.startColumn, this.position.lineNumber, word.endColumn),\n                text: word.word,\n                rejectReason: rejects.length > 0 ? rejects.join('\\n') : undefined\n            };\n        });\n    }\n    provideRenameEdits(newName, token) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this._provideRenameEdits(newName, this._providerRenameIdx, [], token);\n        });\n    }\n    _provideRenameEdits(newName, i, rejects, token) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const provider = this._providers[i];\n            if (!provider) {\n                return {\n                    edits: [],\n                    rejectReason: rejects.join('\\n')\n                };\n            }\n            const result = yield provider.provideRenameEdits(this.model, this.position, newName, token);\n            if (!result) {\n                return this._provideRenameEdits(newName, i + 1, rejects.concat(nls.localize('no result', \"No result.\")), token);\n            }\n            else if (result.rejectReason) {\n                return this._provideRenameEdits(newName, i + 1, rejects.concat(result.rejectReason), token);\n            }\n            return result;\n        });\n    }\n}\nexport function rename(model, position, newName) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const skeleton = new RenameSkeleton(model, position);\n        const loc = yield skeleton.resolveRenameLocation(CancellationToken.None);\n        if (loc === null || loc === void 0 ? void 0 : loc.rejectReason) {\n            return { edits: [], rejectReason: loc.rejectReason };\n        }\n        return skeleton.provideRenameEdits(newName, CancellationToken.None);\n    });\n}\n// ---  register actions and commands\nlet RenameController = class RenameController {\n    constructor(editor, _instaService, _notificationService, _bulkEditService, _progressService, _logService, _configService) {\n        this.editor = editor;\n        this._instaService = _instaService;\n        this._notificationService = _notificationService;\n        this._bulkEditService = _bulkEditService;\n        this._progressService = _progressService;\n        this._logService = _logService;\n        this._configService = _configService;\n        this._dispoableStore = new DisposableStore();\n        this._cts = new CancellationTokenSource();\n        this._renameInputField = this._dispoableStore.add(new IdleValue(() => this._dispoableStore.add(this._instaService.createInstance(RenameInputField, this.editor, ['acceptRenameInput', 'acceptRenameInputWithPreview']))));\n    }\n    static get(editor) {\n        return editor.getContribution(RenameController.ID);\n    }\n    dispose() {\n        this._dispoableStore.dispose();\n        this._cts.dispose(true);\n    }\n    run() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this._cts.dispose(true);\n            if (!this.editor.hasModel()) {\n                return undefined;\n            }\n            const position = this.editor.getPosition();\n            const skeleton = new RenameSkeleton(this.editor.getModel(), position);\n            if (!skeleton.hasProvider()) {\n                return undefined;\n            }\n            this._cts = new EditorStateCancellationTokenSource(this.editor, 4 /* Position */ | 1 /* Value */);\n            // resolve rename location\n            let loc;\n            try {\n                const resolveLocationOperation = skeleton.resolveRenameLocation(this._cts.token);\n                this._progressService.showWhile(resolveLocationOperation, 250);\n                loc = yield resolveLocationOperation;\n            }\n            catch (e) {\n                MessageController.get(this.editor).showMessage(e || nls.localize('resolveRenameLocationFailed', \"An unknown error occurred while resolving rename location\"), position);\n                return undefined;\n            }\n            if (!loc) {\n                return undefined;\n            }\n            if (loc.rejectReason) {\n                MessageController.get(this.editor).showMessage(loc.rejectReason, position);\n                return undefined;\n            }\n            if (this._cts.token.isCancellationRequested) {\n                return undefined;\n            }\n            this._cts.dispose();\n            this._cts = new EditorStateCancellationTokenSource(this.editor, 4 /* Position */ | 1 /* Value */, loc.range);\n            // do rename at location\n            let selection = this.editor.getSelection();\n            let selectionStart = 0;\n            let selectionEnd = loc.text.length;\n            if (!Range.isEmpty(selection) && !Range.spansMultipleLines(selection) && Range.containsRange(loc.range, selection)) {\n                selectionStart = Math.max(0, selection.startColumn - loc.range.startColumn);\n                selectionEnd = Math.min(loc.range.endColumn, selection.endColumn) - loc.range.startColumn;\n            }\n            const supportPreview = this._bulkEditService.hasPreviewHandler() && this._configService.getValue(this.editor.getModel().uri, 'editor.rename.enablePreview');\n            const inputFieldResult = yield this._renameInputField.value.getInput(loc.range, loc.text, selectionStart, selectionEnd, supportPreview, this._cts.token);\n            // no result, only hint to focus the editor or not\n            if (typeof inputFieldResult === 'boolean') {\n                if (inputFieldResult) {\n                    this.editor.focus();\n                }\n                return undefined;\n            }\n            this.editor.focus();\n            const renameOperation = raceCancellation(skeleton.provideRenameEdits(inputFieldResult.newName, this._cts.token), this._cts.token).then((renameResult) => __awaiter(this, void 0, void 0, function* () {\n                if (!renameResult || !this.editor.hasModel()) {\n                    return;\n                }\n                if (renameResult.rejectReason) {\n                    this._notificationService.info(renameResult.rejectReason);\n                    return;\n                }\n                // collapse selection to active end\n                this.editor.setSelection(Range.fromPositions(this.editor.getSelection().getPosition()));\n                this._bulkEditService.apply(ResourceEdit.convert(renameResult), {\n                    editor: this.editor,\n                    showPreview: inputFieldResult.wantsPreview,\n                    label: nls.localize('label', \"Renaming '{0}'\", loc === null || loc === void 0 ? void 0 : loc.text),\n                    quotableLabel: nls.localize('quotableLabel', \"Renaming {0}\", loc === null || loc === void 0 ? void 0 : loc.text),\n                }).then(result => {\n                    if (result.ariaSummary) {\n                        alert(nls.localize('aria', \"Successfully renamed '{0}' to '{1}'. Summary: {2}\", loc.text, inputFieldResult.newName, result.ariaSummary));\n                    }\n                }).catch(err => {\n                    this._notificationService.error(nls.localize('rename.failedApply', \"Rename failed to apply edits\"));\n                    this._logService.error(err);\n                });\n            }), err => {\n                this._notificationService.error(nls.localize('rename.failed', \"Rename failed to compute edits\"));\n                this._logService.error(err);\n            });\n            this._progressService.showWhile(renameOperation, 250);\n            return renameOperation;\n        });\n    }\n    acceptRenameInput(wantsPreview) {\n        this._renameInputField.value.acceptInput(wantsPreview);\n    }\n    cancelRenameInput() {\n        this._renameInputField.value.cancelInput(true);\n    }\n};\nRenameController.ID = 'editor.contrib.renameController';\nRenameController = __decorate([\n    __param(1, IInstantiationService),\n    __param(2, INotificationService),\n    __param(3, IBulkEditService),\n    __param(4, IEditorProgressService),\n    __param(5, ILogService),\n    __param(6, ITextResourceConfigurationService)\n], RenameController);\n// ---- action implementation\nexport class RenameAction extends EditorAction {\n    constructor() {\n        super({\n            id: 'editor.action.rename',\n            label: nls.localize('rename.label', \"Rename Symbol\"),\n            alias: 'Rename Symbol',\n            precondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasRenameProvider),\n            kbOpts: {\n                kbExpr: EditorContextKeys.editorTextFocus,\n                primary: 60 /* F2 */,\n                weight: 100 /* EditorContrib */\n            },\n            contextMenuOpts: {\n                group: '1_modification',\n                order: 1.1\n            }\n        });\n    }\n    runCommand(accessor, args) {\n        const editorService = accessor.get(ICodeEditorService);\n        const [uri, pos] = Array.isArray(args) && args || [undefined, undefined];\n        if (URI.isUri(uri) && Position.isIPosition(pos)) {\n            return editorService.openCodeEditor({ resource: uri }, editorService.getActiveCodeEditor()).then(editor => {\n                if (!editor) {\n                    return;\n                }\n                editor.setPosition(pos);\n                editor.invokeWithinContext(accessor => {\n                    this.reportTelemetry(accessor, editor);\n                    return this.run(accessor, editor);\n                });\n            }, onUnexpectedError);\n        }\n        return super.runCommand(accessor, args);\n    }\n    run(accessor, editor) {\n        const controller = RenameController.get(editor);\n        if (controller) {\n            return controller.run();\n        }\n        return Promise.resolve();\n    }\n}\nregisterEditorContribution(RenameController.ID, RenameController);\nregisterEditorAction(RenameAction);\nconst RenameCommand = EditorCommand.bindToContribution(RenameController.get);\nregisterEditorCommand(new RenameCommand({\n    id: 'acceptRenameInput',\n    precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n    handler: x => x.acceptRenameInput(false),\n    kbOpts: {\n        weight: 100 /* EditorContrib */ + 99,\n        kbExpr: EditorContextKeys.focus,\n        primary: 3 /* Enter */\n    }\n}));\nregisterEditorCommand(new RenameCommand({\n    id: 'acceptRenameInputWithPreview',\n    precondition: ContextKeyExpr.and(CONTEXT_RENAME_INPUT_VISIBLE, ContextKeyExpr.has('config.editor.rename.enablePreview')),\n    handler: x => x.acceptRenameInput(true),\n    kbOpts: {\n        weight: 100 /* EditorContrib */ + 99,\n        kbExpr: EditorContextKeys.focus,\n        primary: 1024 /* Shift */ + 3 /* Enter */\n    }\n}));\nregisterEditorCommand(new RenameCommand({\n    id: 'cancelRenameInput',\n    precondition: CONTEXT_RENAME_INPUT_VISIBLE,\n    handler: x => x.cancelRenameInput(),\n    kbOpts: {\n        weight: 100 /* EditorContrib */ + 99,\n        kbExpr: EditorContextKeys.focus,\n        primary: 9 /* Escape */,\n        secondary: [1024 /* Shift */ | 9 /* Escape */]\n    }\n}));\n// ---- api bridge command\nregisterModelAndPositionCommand('_executeDocumentRenameProvider', function (model, position, ...args) {\n    const [newName] = args;\n    assertType(typeof newName === 'string');\n    return rename(model, position, newName);\n});\nregisterModelAndPositionCommand('_executePrepareRename', function (model, position) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const skeleton = new RenameSkeleton(model, position);\n        const loc = yield skeleton.resolveRenameLocation(CancellationToken.None);\n        if (loc === null || loc === void 0 ? void 0 : loc.rejectReason) {\n            throw new Error(loc.rejectReason);\n        }\n        return loc;\n    });\n});\n//todo@jrieken use editor options world\nRegistry.as(Extensions.Configuration).registerConfiguration({\n    id: 'editor',\n    properties: {\n        'editor.rename.enablePreview': {\n            scope: 5 /* LANGUAGE_OVERRIDABLE */,\n            description: nls.localize('enablePreview', \"Enable/disable the ability to preview changes before renaming\"),\n            default: true,\n            type: 'boolean'\n        }\n    }\n});\n"]},"metadata":{},"sourceType":"module"}