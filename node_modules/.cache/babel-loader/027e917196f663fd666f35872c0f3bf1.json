{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { doHash } from '../../../base/common/hash.js';\nimport { toDisposable } from '../../../base/common/lifecycle.js';\nimport { LRUCache } from '../../../base/common/map.js';\nimport { MovingAverage } from '../../../base/common/numbers.js';\nimport { score } from './languageSelector.js';\nimport { shouldSynchronizeModel } from '../services/modelService.js';\n\nfunction isExclusive(selector) {\n  if (typeof selector === 'string') {\n    return false;\n  } else if (Array.isArray(selector)) {\n    return selector.every(isExclusive);\n  } else {\n    return !!selector.exclusive; // TODO: microsoft/TypeScript#42768\n  }\n}\n\nexport class LanguageFeatureRegistry {\n  constructor() {\n    this._clock = 0;\n    this._entries = [];\n    this._onDidChange = new Emitter();\n  }\n\n  get onDidChange() {\n    return this._onDidChange.event;\n  }\n\n  register(selector, provider) {\n    let entry = {\n      selector,\n      provider,\n      _score: -1,\n      _time: this._clock++\n    };\n\n    this._entries.push(entry);\n\n    this._lastCandidate = undefined;\n\n    this._onDidChange.fire(this._entries.length);\n\n    return toDisposable(() => {\n      if (entry) {\n        let idx = this._entries.indexOf(entry);\n\n        if (idx >= 0) {\n          this._entries.splice(idx, 1);\n\n          this._lastCandidate = undefined;\n\n          this._onDidChange.fire(this._entries.length);\n\n          entry = undefined;\n        }\n      }\n    });\n  }\n\n  has(model) {\n    return this.all(model).length > 0;\n  }\n\n  all(model) {\n    if (!model) {\n      return [];\n    }\n\n    this._updateScores(model);\n\n    const result = []; // from registry\n\n    for (let entry of this._entries) {\n      if (entry._score > 0) {\n        result.push(entry.provider);\n      }\n    }\n\n    return result;\n  }\n\n  ordered(model) {\n    const result = [];\n\n    this._orderedForEach(model, entry => result.push(entry.provider));\n\n    return result;\n  }\n\n  orderedGroups(model) {\n    const result = [];\n    let lastBucket;\n    let lastBucketScore;\n\n    this._orderedForEach(model, entry => {\n      if (lastBucket && lastBucketScore === entry._score) {\n        lastBucket.push(entry.provider);\n      } else {\n        lastBucketScore = entry._score;\n        lastBucket = [entry.provider];\n        result.push(lastBucket);\n      }\n    });\n\n    return result;\n  }\n\n  _orderedForEach(model, callback) {\n    if (!model) {\n      return;\n    }\n\n    this._updateScores(model);\n\n    for (const entry of this._entries) {\n      if (entry._score > 0) {\n        callback(entry);\n      }\n    }\n  }\n\n  _updateScores(model) {\n    let candidate = {\n      uri: model.uri.toString(),\n      language: model.getLanguageId()\n    };\n\n    if (this._lastCandidate && this._lastCandidate.language === candidate.language && this._lastCandidate.uri === candidate.uri) {\n      // nothing has changed\n      return;\n    }\n\n    this._lastCandidate = candidate;\n\n    for (let entry of this._entries) {\n      entry._score = score(entry.selector, model.uri, model.getLanguageId(), shouldSynchronizeModel(model));\n\n      if (isExclusive(entry.selector) && entry._score > 0) {\n        // support for one exclusive selector that overwrites\n        // any other selector\n        for (let entry of this._entries) {\n          entry._score = 0;\n        }\n\n        entry._score = 1000;\n        break;\n      }\n    } // needs sorting\n\n\n    this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n  }\n\n  static _compareByScoreAndTime(a, b) {\n    if (a._score < b._score) {\n      return 1;\n    } else if (a._score > b._score) {\n      return -1;\n    } else if (a._time < b._time) {\n      return 1;\n    } else if (a._time > b._time) {\n      return -1;\n    } else {\n      return 0;\n    }\n  }\n\n}\n\nconst _hashes = new WeakMap();\n\nlet pool = 0;\n\nfunction weakHash(obj) {\n  let value = _hashes.get(obj);\n\n  if (value === undefined) {\n    value = ++pool;\n\n    _hashes.set(obj, value);\n  }\n\n  return value;\n}\n/**\n * Keeps moving average per model and set of providers so that requests\n * can be debounce according to the provider performance\n */\n\n\nexport class LanguageFeatureRequestDelays {\n  constructor(_registry, min) {\n    let max = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Number.MAX_SAFE_INTEGER;\n    this._registry = _registry;\n    this.min = min;\n    this.max = max;\n    this._cache = new LRUCache(50, 0.7);\n  }\n\n  _key(model) {\n    return model.id + this._registry.all(model).reduce((hashVal, obj) => doHash(weakHash(obj), hashVal), 0);\n  }\n\n  _clamp(value) {\n    if (value === undefined) {\n      return this.min;\n    } else {\n      return Math.min(this.max, Math.max(this.min, Math.floor(value * 1.3)));\n    }\n  }\n\n  get(model) {\n    const key = this._key(model);\n\n    const avg = this._cache.get(key);\n\n    return this._clamp(avg === null || avg === void 0 ? void 0 : avg.value);\n  }\n\n  update(model, value) {\n    const key = this._key(model);\n\n    let avg = this._cache.get(key);\n\n    if (!avg) {\n      avg = new MovingAverage();\n\n      this._cache.set(key, avg);\n    }\n\n    avg.update(value);\n    return this.get(model);\n  }\n\n}","map":{"version":3,"sources":["/home/umut/Documents/cs/cs410/Project2Group14/node_modules/monaco-editor/esm/vs/editor/common/modes/languageFeatureRegistry.js"],"names":["Emitter","doHash","toDisposable","LRUCache","MovingAverage","score","shouldSynchronizeModel","isExclusive","selector","Array","isArray","every","exclusive","LanguageFeatureRegistry","constructor","_clock","_entries","_onDidChange","onDidChange","event","register","provider","entry","_score","_time","push","_lastCandidate","undefined","fire","length","idx","indexOf","splice","has","model","all","_updateScores","result","ordered","_orderedForEach","orderedGroups","lastBucket","lastBucketScore","callback","candidate","uri","toString","language","getLanguageId","sort","_compareByScoreAndTime","a","b","_hashes","WeakMap","pool","weakHash","obj","value","get","set","LanguageFeatureRequestDelays","_registry","min","max","Number","MAX_SAFE_INTEGER","_cache","_key","id","reduce","hashVal","_clamp","Math","floor","key","avg","update"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { doHash } from '../../../base/common/hash.js';\nimport { toDisposable } from '../../../base/common/lifecycle.js';\nimport { LRUCache } from '../../../base/common/map.js';\nimport { MovingAverage } from '../../../base/common/numbers.js';\nimport { score } from './languageSelector.js';\nimport { shouldSynchronizeModel } from '../services/modelService.js';\nfunction isExclusive(selector) {\n    if (typeof selector === 'string') {\n        return false;\n    }\n    else if (Array.isArray(selector)) {\n        return selector.every(isExclusive);\n    }\n    else {\n        return !!selector.exclusive; // TODO: microsoft/TypeScript#42768\n    }\n}\nexport class LanguageFeatureRegistry {\n    constructor() {\n        this._clock = 0;\n        this._entries = [];\n        this._onDidChange = new Emitter();\n    }\n    get onDidChange() {\n        return this._onDidChange.event;\n    }\n    register(selector, provider) {\n        let entry = {\n            selector,\n            provider,\n            _score: -1,\n            _time: this._clock++\n        };\n        this._entries.push(entry);\n        this._lastCandidate = undefined;\n        this._onDidChange.fire(this._entries.length);\n        return toDisposable(() => {\n            if (entry) {\n                let idx = this._entries.indexOf(entry);\n                if (idx >= 0) {\n                    this._entries.splice(idx, 1);\n                    this._lastCandidate = undefined;\n                    this._onDidChange.fire(this._entries.length);\n                    entry = undefined;\n                }\n            }\n        });\n    }\n    has(model) {\n        return this.all(model).length > 0;\n    }\n    all(model) {\n        if (!model) {\n            return [];\n        }\n        this._updateScores(model);\n        const result = [];\n        // from registry\n        for (let entry of this._entries) {\n            if (entry._score > 0) {\n                result.push(entry.provider);\n            }\n        }\n        return result;\n    }\n    ordered(model) {\n        const result = [];\n        this._orderedForEach(model, entry => result.push(entry.provider));\n        return result;\n    }\n    orderedGroups(model) {\n        const result = [];\n        let lastBucket;\n        let lastBucketScore;\n        this._orderedForEach(model, entry => {\n            if (lastBucket && lastBucketScore === entry._score) {\n                lastBucket.push(entry.provider);\n            }\n            else {\n                lastBucketScore = entry._score;\n                lastBucket = [entry.provider];\n                result.push(lastBucket);\n            }\n        });\n        return result;\n    }\n    _orderedForEach(model, callback) {\n        if (!model) {\n            return;\n        }\n        this._updateScores(model);\n        for (const entry of this._entries) {\n            if (entry._score > 0) {\n                callback(entry);\n            }\n        }\n    }\n    _updateScores(model) {\n        let candidate = {\n            uri: model.uri.toString(),\n            language: model.getLanguageId()\n        };\n        if (this._lastCandidate\n            && this._lastCandidate.language === candidate.language\n            && this._lastCandidate.uri === candidate.uri) {\n            // nothing has changed\n            return;\n        }\n        this._lastCandidate = candidate;\n        for (let entry of this._entries) {\n            entry._score = score(entry.selector, model.uri, model.getLanguageId(), shouldSynchronizeModel(model));\n            if (isExclusive(entry.selector) && entry._score > 0) {\n                // support for one exclusive selector that overwrites\n                // any other selector\n                for (let entry of this._entries) {\n                    entry._score = 0;\n                }\n                entry._score = 1000;\n                break;\n            }\n        }\n        // needs sorting\n        this._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n    }\n    static _compareByScoreAndTime(a, b) {\n        if (a._score < b._score) {\n            return 1;\n        }\n        else if (a._score > b._score) {\n            return -1;\n        }\n        else if (a._time < b._time) {\n            return 1;\n        }\n        else if (a._time > b._time) {\n            return -1;\n        }\n        else {\n            return 0;\n        }\n    }\n}\nconst _hashes = new WeakMap();\nlet pool = 0;\nfunction weakHash(obj) {\n    let value = _hashes.get(obj);\n    if (value === undefined) {\n        value = ++pool;\n        _hashes.set(obj, value);\n    }\n    return value;\n}\n/**\n * Keeps moving average per model and set of providers so that requests\n * can be debounce according to the provider performance\n */\nexport class LanguageFeatureRequestDelays {\n    constructor(_registry, min, max = Number.MAX_SAFE_INTEGER) {\n        this._registry = _registry;\n        this.min = min;\n        this.max = max;\n        this._cache = new LRUCache(50, 0.7);\n    }\n    _key(model) {\n        return model.id + this._registry.all(model).reduce((hashVal, obj) => doHash(weakHash(obj), hashVal), 0);\n    }\n    _clamp(value) {\n        if (value === undefined) {\n            return this.min;\n        }\n        else {\n            return Math.min(this.max, Math.max(this.min, Math.floor(value * 1.3)));\n        }\n    }\n    get(model) {\n        const key = this._key(model);\n        const avg = this._cache.get(key);\n        return this._clamp(avg === null || avg === void 0 ? void 0 : avg.value);\n    }\n    update(model, value) {\n        const key = this._key(model);\n        let avg = this._cache.get(key);\n        if (!avg) {\n            avg = new MovingAverage();\n            this._cache.set(key, avg);\n        }\n        avg.update(value);\n        return this.get(model);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}